var kp=Object.defineProperty;var Ep=(r,e,t)=>e in r?kp(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var ae=(r,e,t)=>(Ep(r,typeof e!="symbol"?e+"":e,t),t);import{S as Z,i as Q,s as K,w as Ce,a as N,d as B,f as w,x as Fe,y as Oe,z as Re,t as S,h as k,j as $,g as D,b as O,A as ye,B as ne,C as It,D as Mp,H as _e,n as U,p as me,I as de,J as vr,K as _r,c as L,m as A,k as C,N as be,E as Bt,e as rt,O as Gt,l as Bi,Q as Pp,R as Xe,v as ve,T as Lp,U as qs,V as Ap,W as rf,X as Se,Y as Ee,Z as Ni,_ as ue,$ as fe,a0 as Cp,a1 as V,a2 as st,a3 as Fp,a4 as Te,a5 as Op,a6 as Rp,a7 as ee,a8 as us,a9 as nf,aa as zs,ab as Un,ac as of,ad as Ip,ae as Bp,F as bn,af as Np,ag as fs,ah as cs,ai as Tp,aj as sf,ak as Ie,al as lf,am as an,an as af,ao as uf,G as ir,ap as Dp,o as Nt,L as br,aq as bt,P as ps,ar as nt,as as oi,at as jp,M as Gp,q as Up,r as qp}from"./boundaries-b5bc10c3.js";function $e(r,e){const t={},n={},i={$$scope:1};let o=r.length;for(;o--;){const s=r[o],l=e[o];if(l){for(const a in s)a in l||(n[a]=1);for(const a in l)i[a]||(t[a]=l[a],i[a]=1);r[o]=l}else for(const a in s)i[a]=1}for(const s in n)s in t||(t[s]=void 0);return t}function De(r){return typeof r=="object"&&r!==null?r:{}}function zp(r){let e,t;const n=r[1].default,i=Ce(n,r,r[0],null);return{c(){e=N("div"),i&&i.c(),B(e,"class","govuk-button-group")},m(o,s){w(o,e,s),i&&i.m(e,null),t=!0},p(o,[s]){i&&i.p&&(!t||s&1)&&Fe(i,n,o,o[0],t?Re(n,o[0],s,null):Oe(o[0]),null)},i(o){t||(S(i,o),t=!0)},o(o){k(i,o),t=!1},d(o){o&&$(e),i&&i.d(o)}}}function Wp(r,e,t){let{$$slots:n={},$$scope:i}=e;return r.$$set=o=>{"$$scope"in o&&t(0,i=o.$$scope)},[i,n]}class Jt extends Z{constructor(e){super(),Q(this,e,Wp,zp,K,{})}}function Hp(r){let e,t,n;const i=r[3].default,o=Ce(i,r,r[2],null);return{c(){e=N("fieldset"),t=N("div"),o&&o.c(),B(t,"class",r[0]),B(t,"data-module","govuk-checkboxes"),B(e,"class","govuk-fieldset")},m(s,l){w(s,e,l),D(e,t),o&&o.m(t,null),n=!0},p(s,[l]){o&&o.p&&(!n||l&4)&&Fe(o,i,s,s[2],n?Re(i,s[2],l,null):Oe(s[2]),null)},i(s){n||(S(o,s),n=!0)},o(s){k(o,s),n=!1},d(s){s&&$(e),o&&o.d(s)}}}function Jp(r,e,t){let{$$slots:n={},$$scope:i}=e,{small:o=!1}=e,s=o?"govuk-checkboxes--small":"govuk-checkboxes";return r.$$set=l=>{"small"in l&&t(1,o=l.small),"$$scope"in l&&t(2,i=l.$$scope)},[s,o,i,n]}class Vp extends Z{constructor(e){super(),Q(this,e,Jp,Hp,K,{small:1})}}let An;const Yp=new Uint8Array(16);function Xp(){if(!An&&(An=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!An))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return An(Yp)}const Be=[];for(let r=0;r<256;++r)Be.push((r+256).toString(16).slice(1));function Kp(r,e=0){return Be[r[e+0]]+Be[r[e+1]]+Be[r[e+2]]+Be[r[e+3]]+"-"+Be[r[e+4]]+Be[r[e+5]]+"-"+Be[r[e+6]]+Be[r[e+7]]+"-"+Be[r[e+8]]+Be[r[e+9]]+"-"+Be[r[e+10]]+Be[r[e+11]]+Be[r[e+12]]+Be[r[e+13]]+Be[r[e+14]]+Be[r[e+15]]}const Zp=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Ws={randomUUID:Zp};function Rr(r,e,t){if(Ws.randomUUID&&!e&&!r)return Ws.randomUUID();r=r||{};const n=r.random||(r.rng||Xp)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,e){t=t||0;for(let i=0;i<16;++i)e[t+i]=n[i];return e}return Kp(n)}const Qp=r=>({}),Hs=r=>({});function xp(r){let e,t,n,i,o,s,l,a,u;const f=r[5].default,c=Ce(f,r,r[4],null),g=r[5].right,p=Ce(g,r,r[4],Hs);return{c(){e=N("div"),t=N("input"),n=O(),i=N("label"),c&&c.c(),o=O(),s=N("span"),p&&p.c(),B(t,"type","checkbox"),B(t,"class","govuk-checkboxes__input"),B(t,"id",r[3]),B(i,"class","govuk-label govuk-checkboxes__label"),B(i,"for",r[3]),B(i,"title",r[1]),ye(s,"float","right"),B(e,"class","govuk-checkboxes__item"),B(e,"style",r[2])},m(h,m){w(h,e,m),D(e,t),t.checked=r[0],D(e,n),D(e,i),c&&c.m(i,null),D(e,o),D(e,s),p&&p.m(s,null),l=!0,a||(u=[ne(t,"change",r[7]),ne(t,"change",r[6])],a=!0)},p(h,[m]){m&1&&(t.checked=h[0]),c&&c.p&&(!l||m&16)&&Fe(c,f,h,h[4],l?Re(f,h[4],m,null):Oe(h[4]),null),(!l||m&2)&&B(i,"title",h[1]),p&&p.p&&(!l||m&16)&&Fe(p,g,h,h[4],l?Re(g,h[4],m,Qp):Oe(h[4]),Hs)},i(h){l||(S(c,h),S(p,h),l=!0)},o(h){k(c,h),k(p,h),l=!1},d(h){h&&$(e),c&&c.d(h),p&&p.d(h),a=!1,It(u)}}}function eg(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=Mp(n);let{checked:s}=e,{hint:l=null}=e,u=o.right!==void 0?"float: none":"",f=Rr();function c(p){_e.call(this,r,p)}function g(){s=this.checked,t(0,s)}return r.$$set=p=>{"checked"in p&&t(0,s=p.checked),"hint"in p&&t(1,l=p.hint),"$$scope"in p&&t(4,i=p.$$scope)},[s,l,u,f,i,n,c,g]}class _o extends Z{constructor(e){super(),Q(this,e,eg,xp,K,{checked:0,hint:1})}}function tg(r){let e,t,n,i,o,s,l;const a=r[3].default,u=Ce(a,r,r[2],null);return{c(){e=N("details"),t=N("summary"),n=N("span"),i=U(r[0]),o=O(),s=N("div"),u&&u.c(),B(n,"class","govuk-details__summary-text"),B(t,"class","govuk-details__summary"),B(s,"class","govuk-details__text"),e.open=r[1],B(e,"class","govuk-details"),B(e,"data-module","govuk-details")},m(f,c){w(f,e,c),D(e,t),D(t,n),D(n,i),D(e,o),D(e,s),u&&u.m(s,null),l=!0},p(f,[c]){(!l||c&1)&&me(i,f[0]),u&&u.p&&(!l||c&4)&&Fe(u,a,f,f[2],l?Re(a,f[2],c,null):Oe(f[2]),null),(!l||c&2)&&(e.open=f[1])},i(f){l||(S(u,f),l=!0)},o(f){k(u,f),l=!1},d(f){f&&$(e),u&&u.d(f)}}}function rg(r,e,t){let{$$slots:n={},$$scope:i}=e,{label:o}=e,{open:s=!1}=e;return r.$$set=l=>{"label"in l&&t(0,o=l.label),"open"in l&&t(1,s=l.open),"$$scope"in l&&t(2,i=l.$$scope)},[o,s,i,n]}class ng extends Z{constructor(e){super(),Q(this,e,rg,tg,K,{label:0,open:1})}}function ig(r){let e,t,n,i;const o=r[2].default,s=Ce(o,r,r[1],null);let l=[{type:"button"},{class:"govuk-button"},{"data-module":"govuk-button"},r[0]],a={};for(let u=0;u<l.length;u+=1)a=de(a,l[u]);return{c(){e=N("button"),s&&s.c(),vr(e,a)},m(u,f){w(u,e,f),s&&s.m(e,null),e.autofocus&&e.focus(),t=!0,n||(i=ne(e,"click",r[3]),n=!0)},p(u,[f]){s&&s.p&&(!t||f&2)&&Fe(s,o,u,u[1],t?Re(o,u[1],f,null):Oe(u[1]),null),vr(e,a=$e(l,[{type:"button"},{class:"govuk-button"},{"data-module":"govuk-button"},f&1&&u[0]]))},i(u){t||(S(s,u),t=!0)},o(u){k(s,u),t=!1},d(u){u&&$(e),s&&s.d(u),n=!1,i()}}}function og(r,e,t){let{$$slots:n={},$$scope:i}=e;function o(s){_e.call(this,r,s)}return r.$$set=s=>{t(0,e=de(de({},e),_r(s))),"$$scope"in s&&t(1,i=s.$$scope)},e=_r(e),[e,i,n,o]}class Tt extends Z{constructor(e){super(),Q(this,e,og,ig,K,{})}}function sg(r){let e,t,n;return{c(){e=N("input"),e.disabled=r[1],B(e,"class","govuk-file-upload"),B(e,"id",r[4]),B(e,"type","file")},m(i,o){w(i,e,o),r[6](e),t||(n=ne(e,"change",r[3]),t=!0)},p(i,o){o&2&&(e.disabled=i[1])},d(i){i&&$(e),r[6](null),t=!1,n()}}}function lg(r){let e,t;return e=new Ir({props:{label:r[0],id:r[4],$$slots:{default:[sg]},$$scope:{ctx:r}}}),{c(){L(e.$$.fragment)},m(n,i){A(e,n,i),t=!0},p(n,[i]){const o={};i&1&&(o.label=n[0]),i&134&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(S(e.$$.fragment,n),t=!0)},o(n){k(e.$$.fragment,n),t=!1},d(n){C(e,n)}}}function ag(r,e,t){let{label:n}=e,{onLoad:i}=e,{disabled:o=!1}=e,s;async function l(f){let c=s.files[0].name,g=await s.files[0].text();i(c,g)}let a=Rr();function u(f){be[f?"unshift":"push"](()=>{s=f,t(2,s)})}return r.$$set=f=>{"label"in f&&t(0,n=f.label),"onLoad"in f&&t(5,i=f.onLoad),"disabled"in f&&t(1,o=f.disabled)},[n,o,s,l,a,i,u]}class ff extends Z{constructor(e){super(),Q(this,e,ag,lg,K,{label:0,onLoad:5,disabled:1})}}function ug(r){let e,t,n,i,o;const s=r[3].default,l=Ce(s,r,r[2],null);return{c(){e=N("div"),t=N("label"),n=U(r[0]),i=O(),l&&l.c(),B(t,"class","govuk-label govuk-label--s"),B(t,"for",r[1]),B(e,"class","govuk-form-group")},m(a,u){w(a,e,u),D(e,t),D(t,n),D(e,i),l&&l.m(e,null),o=!0},p(a,[u]){(!o||u&1)&&me(n,a[0]),(!o||u&2)&&B(t,"for",a[1]),l&&l.p&&(!o||u&4)&&Fe(l,s,a,a[2],o?Re(s,a[2],u,null):Oe(a[2]),null)},i(a){o||(S(l,a),o=!0)},o(a){k(l,a),o=!1},d(a){a&&$(e),l&&l.d(a)}}}function fg(r,e,t){let{$$slots:n={},$$scope:i}=e,{label:o}=e,{id:s}=e;return r.$$set=l=>{"label"in l&&t(0,o=l.label),"id"in l&&t(1,s=l.id),"$$scope"in l&&t(2,i=l.$$scope)},[o,s,i,n]}class Ir extends Z{constructor(e){super(),Q(this,e,fg,ug,K,{label:0,id:1})}}function Js(r,e,t){const n=r.slice();return n[10]=e[t][0],n[11]=e[t][1],n}function Vs(r){let e,t,n,i,o=!1,s,l,a=r[11]+"",u,f,c,g,p,h;return g=Pp(r[9][0]),{c(){e=N("div"),t=N("input"),s=O(),l=N("label"),u=U(a),c=O(),B(t,"class","govuk-radios__input"),B(t,"id",n=r[5]+r[10]),B(t,"type","radio"),t.__value=i=r[10],Xe(t,t.__value),B(l,"class","govuk-label govuk-radios__label"),B(l,"for",f=r[5]+r[10]),B(e,"class","govuk-radios__item"),g.p(t)},m(m,v){w(m,e,v),D(e,t),t.checked=t.__value===r[0],D(e,s),D(e,l),D(l,u),D(e,c),p||(h=[ne(t,"change",r[8]),ne(t,"change",r[7])],p=!0)},p(m,v){v&4&&n!==(n=m[5]+m[10])&&B(t,"id",n),v&4&&i!==(i=m[10])&&(t.__value=i,Xe(t,t.__value),o=!0),(o||v&5)&&(t.checked=t.__value===m[0]),v&4&&a!==(a=m[11]+"")&&me(u,a),v&4&&f!==(f=m[5]+m[10])&&B(l,"for",f)},d(m){m&&$(e),g.r(),p=!1,It(h)}}}function cg(r){let e,t,n,i,o,s,l,a,u;s=new Bt({props:{errorMessage:r[4]}});let f=rt(r[2]),c=[];for(let g=0;g<f.length;g+=1)c[g]=Vs(Js(r,f,g));return{c(){e=N("div"),t=N("fieldset"),n=N("legend"),i=U(r[1]),o=O(),L(s.$$.fragment),l=O(),a=N("div");for(let g=0;g<c.length;g+=1)c[g].c();B(n,"class","govuk-fieldset__legend govuk-label--s"),B(a,"class","govuk-radios"),B(a,"data-module","govuk-radios"),Gt(a,"govuk-radios--inline",r[3]),Gt(a,"govuk-radios--small",r[3]),B(t,"class","govuk-fieldset"),B(e,"class","govuk-form-group")},m(g,p){w(g,e,p),D(e,t),D(t,n),D(n,i),D(t,o),A(s,t,null),D(t,l),D(t,a);for(let h=0;h<c.length;h+=1)c[h]&&c[h].m(a,null);u=!0},p(g,[p]){(!u||p&2)&&me(i,g[1]);const h={};if(p&16&&(h.errorMessage=g[4]),s.$set(h),p&37){f=rt(g[2]);let m;for(m=0;m<f.length;m+=1){const v=Js(g,f,m);c[m]?c[m].p(v,p):(c[m]=Vs(v),c[m].c(),c[m].m(a,null))}for(;m<c.length;m+=1)c[m].d(1);c.length=f.length}(!u||p&8)&&Gt(a,"govuk-radios--inline",g[3]),(!u||p&8)&&Gt(a,"govuk-radios--small",g[3])},i(g){u||(S(s.$$.fragment,g),u=!0)},o(g){k(s.$$.fragment,g),u=!1},d(g){g&&$(e),C(s),Bi(c,g)}}}function pg(r,e,t){let n,{legend:i}=e,{choices:o}=e,{inlineSmall:s=!1}=e,{required:l=!1}=e,{value:a}=e,u=Rr();const f=[[]];function c(p){_e.call(this,r,p)}function g(){a=this.__value,t(0,a)}return r.$$set=p=>{"legend"in p&&t(1,i=p.legend),"choices"in p&&t(2,o=p.choices),"inlineSmall"in p&&t(3,s=p.inlineSmall),"required"in p&&t(6,l=p.required),"value"in p&&t(0,a=p.value)},r.$$.update=()=>{r.$$.dirty&65&&t(4,n=l&&a==""?"Required":"")},[a,i,o,s,n,u,l,c,g,f]}class cf extends Z{constructor(e){super(),Q(this,e,pg,cg,K,{legend:1,choices:2,inlineSmall:3,required:6,value:0})}}function gg(r){let e,t,n,i;const o=r[2].default,s=Ce(o,r,r[1],null);let l=[{type:"button"},{class:"govuk-button govuk-button--secondary"},{"data-module":"govuk-button"},r[0]],a={};for(let u=0;u<l.length;u+=1)a=de(a,l[u]);return{c(){e=N("button"),s&&s.c(),vr(e,a)},m(u,f){w(u,e,f),s&&s.m(e,null),e.autofocus&&e.focus(),t=!0,n||(i=[ne(e,"click",r[3]),ne(e,"mouseenter",r[4]),ne(e,"mouseleave",r[5])],n=!0)},p(u,[f]){s&&s.p&&(!t||f&2)&&Fe(s,o,u,u[1],t?Re(o,u[1],f,null):Oe(u[1]),null),vr(e,a=$e(l,[{type:"button"},{class:"govuk-button govuk-button--secondary"},{"data-module":"govuk-button"},f&1&&u[0]]))},i(u){t||(S(s,u),t=!0)},o(u){k(s,u),t=!1},d(u){u&&$(e),s&&s.d(u),n=!1,It(i)}}}function hg(r,e,t){let{$$slots:n={},$$scope:i}=e;function o(a){_e.call(this,r,a)}function s(a){_e.call(this,r,a)}function l(a){_e.call(this,r,a)}return r.$$set=a=>{t(0,e=de(de({},e),_r(a))),"$$scope"in a&&t(1,i=a.$$scope)},e=_r(e),[e,i,n,o,s,l]}class pe extends Z{constructor(e){super(),Q(this,e,hg,gg,K,{})}}function Ys(r,e,t){const n=r.slice();return n[10]=e[t][0],n[11]=e[t][1],n}function Xs(r){let e,t;return{c(){e=N("div"),t=U(r[2]),B(e,"class","govuk-hint")},m(n,i){w(n,e,i),D(e,t)},p(n,i){i&4&&me(t,n[2])},d(n){n&&$(e)}}}function Ks(r){let e;return{c(){e=N("option"),e.__value="",Xe(e,e.__value)},m(t,n){w(t,e,n)},d(t){t&&$(e)}}}function Zs(r){let e,t=r[11]+"",n,i;return{c(){e=N("option"),n=U(t),e.__value=i=r[10],Xe(e,e.__value)},m(o,s){w(o,e,s),D(e,n)},p(o,s){s&8&&t!==(t=o[11]+"")&&me(n,t),s&8&&i!==(i=o[10])&&(e.__value=i,Xe(e,e.__value))},d(o){o&&$(e)}}}function mg(r){let e,t,n,i,o,s,l,a;e=new Bt({props:{errorMessage:r[6]}});let u=r[2]&&Xs(r),f=r[4]&&Ks(),c=rt(r[3]),g=[];for(let p=0;p<c.length;p+=1)g[p]=Zs(Ys(r,c,p));return{c(){L(e.$$.fragment),t=O(),u&&u.c(),n=O(),i=N("select"),f&&f.c(),o=ve();for(let p=0;p<g.length;p+=1)g[p].c();B(i,"class","govuk-select"),B(i,"id",r[7]),i.disabled=r[5],r[0]===void 0&&Lp(()=>r[9].call(i))},m(p,h){A(e,p,h),w(p,t,h),u&&u.m(p,h),w(p,n,h),w(p,i,h),f&&f.m(i,null),D(i,o);for(let m=0;m<g.length;m+=1)g[m]&&g[m].m(i,null);qs(i,r[0],!0),s=!0,l||(a=[ne(i,"change",r[9]),ne(i,"change",r[8])],l=!0)},p(p,h){const m={};if(h&64&&(m.errorMessage=p[6]),e.$set(m),p[2]?u?u.p(p,h):(u=Xs(p),u.c(),u.m(n.parentNode,n)):u&&(u.d(1),u=null),p[4]?f||(f=Ks(),f.c(),f.m(i,o)):f&&(f.d(1),f=null),h&8){c=rt(p[3]);let v;for(v=0;v<c.length;v+=1){const _=Ys(p,c,v);g[v]?g[v].p(_,h):(g[v]=Zs(_),g[v].c(),g[v].m(i,null))}for(;v<g.length;v+=1)g[v].d(1);g.length=c.length}(!s||h&32)&&(i.disabled=p[5]),h&9&&qs(i,p[0])},i(p){s||(S(e.$$.fragment,p),s=!0)},o(p){k(e.$$.fragment,p),s=!1},d(p){p&&($(t),$(n),$(i)),C(e,p),u&&u.d(p),f&&f.d(),Bi(g,p),l=!1,It(a)}}}function dg(r){let e,t;return e=new Ir({props:{label:r[1],id:r[7],$$slots:{default:[mg]},$$scope:{ctx:r}}}),{c(){L(e.$$.fragment)},m(n,i){A(e,n,i),t=!0},p(n,[i]){const o={};i&2&&(o.label=n[1]),i&16509&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(S(e.$$.fragment,n),t=!0)},o(n){k(e.$$.fragment,n),t=!1},d(n){C(e,n)}}}function yg(r,e,t){let{label:n}=e,{hint:i=""}=e,{choices:o}=e,{emptyOption:s=!1}=e,{disabled:l=!1}=e,{errorMessage:a=""}=e,{value:u}=e,f=Rr();function c(p){_e.call(this,r,p)}function g(){u=Ap(this),t(0,u),t(3,o)}return r.$$set=p=>{"label"in p&&t(1,n=p.label),"hint"in p&&t(2,i=p.hint),"choices"in p&&t(3,o=p.choices),"emptyOption"in p&&t(4,s=p.emptyOption),"disabled"in p&&t(5,l=p.disabled),"errorMessage"in p&&t(6,a=p.errorMessage),"value"in p&&t(0,u=p.value)},[u,n,i,o,s,l,a,f,c,g]}class bo extends Z{constructor(e){super(),Q(this,e,yg,dg,K,{label:1,hint:2,choices:3,emptyOption:4,disabled:5,errorMessage:6,value:0})}}function Qs(r){let e,t;return{c(){e=N("div"),t=U(r[2]),B(e,"class","govuk-hint")},m(n,i){w(n,e,i),D(e,t)},p(n,i){i&4&&me(t,n[2])},d(n){n&&$(e)}}}function vg(r){let e,t,n,i,o,s,l;e=new Bt({props:{errorMessage:r[4]}});let a=r[2]&&Qs(r);return{c(){L(e.$$.fragment),t=O(),a&&a.c(),n=O(),i=N("textarea"),B(i,"class","govuk-textarea"),B(i,"id",r[5]),B(i,"rows",r[3])},m(u,f){A(e,u,f),w(u,t,f),a&&a.m(u,f),w(u,n,f),w(u,i,f),Xe(i,r[0]),o=!0,s||(l=ne(i,"input",r[6]),s=!0)},p(u,f){const c={};f&16&&(c.errorMessage=u[4]),e.$set(c),u[2]?a?a.p(u,f):(a=Qs(u),a.c(),a.m(n.parentNode,n)):a&&(a.d(1),a=null),(!o||f&8)&&B(i,"rows",u[3]),f&1&&Xe(i,u[0])},i(u){o||(S(e.$$.fragment,u),o=!0)},o(u){k(e.$$.fragment,u),o=!1},d(u){u&&($(t),$(n),$(i)),C(e,u),a&&a.d(u),s=!1,l()}}}function _g(r){let e,t;return e=new Ir({props:{label:r[1],id:r[5],$$slots:{default:[vg]},$$scope:{ctx:r}}}),{c(){L(e.$$.fragment)},m(n,i){A(e,n,i),t=!0},p(n,[i]){const o={};i&2&&(o.label=n[1]),i&157&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(S(e.$$.fragment,n),t=!0)},o(n){k(e.$$.fragment,n),t=!1},d(n){C(e,n)}}}function bg(r,e,t){let{label:n}=e,{hint:i=""}=e,{value:o}=e,{rows:s=5}=e,{errorMessage:l=""}=e,a=Rr();function u(){o=this.value,t(0,o)}return r.$$set=f=>{"label"in f&&t(1,n=f.label),"hint"in f&&t(2,i=f.hint),"value"in f&&t(0,o=f.value),"rows"in f&&t(3,s=f.rows),"errorMessage"in f&&t(4,l=f.errorMessage)},[o,n,i,s,l,a,u]}class wg extends Z{constructor(e){super(),Q(this,e,bg,_g,K,{label:1,hint:2,value:0,rows:3,errorMessage:4})}}function $g(r){let e,t,n,i,o,s;return e=new Bt({props:{errorMessage:r[2]}}),{c(){L(e.$$.fragment),t=O(),n=N("input"),B(n,"type","text"),B(n,"class","govuk-input"),B(n,"id",r[3])},m(l,a){A(e,l,a),w(l,t,a),w(l,n,a),Xe(n,r[0]),i=!0,o||(s=ne(n,"input",r[5]),o=!0)},p(l,a){const u={};a&4&&(u.errorMessage=l[2]),e.$set(u),a&1&&n.value!==l[0]&&Xe(n,l[0])},i(l){i||(S(e.$$.fragment,l),i=!0)},o(l){k(e.$$.fragment,l),i=!1},d(l){l&&($(t),$(n)),C(e,l),o=!1,s()}}}function Sg(r){let e,t;return e=new Ir({props:{label:r[1],id:r[3],$$slots:{default:[$g]},$$scope:{ctx:r}}}),{c(){L(e.$$.fragment)},m(n,i){A(e,n,i),t=!0},p(n,[i]){const o={};i&2&&(o.label=n[1]),i&69&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(S(e.$$.fragment,n),t=!0)},o(n){k(e.$$.fragment,n),t=!1},d(n){C(e,n)}}}function kg(r,e,t){let n,{label:i}=e,{value:o}=e,{required:s=!1}=e,l=Rr();function a(){o=this.value,t(0,o)}return r.$$set=u=>{"label"in u&&t(1,i=u.label),"value"in u&&t(0,o=u.value),"required"in u&&t(4,s=u.required)},r.$$.update=()=>{r.$$.dirty&17&&t(2,n=s&&(o==null||o=="")?"Required":"")},[o,i,n,l,s,a]}class pf extends Z{constructor(e){super(),Q(this,e,kg,Sg,K,{label:1,value:0,required:4})}}function Eg(r){let e,t,n,i;const o=r[2].default,s=Ce(o,r,r[1],null);let l=[{type:"button"},{class:"govuk-button govuk-button--warning"},{"data-module":"govuk-button"},r[0]],a={};for(let u=0;u<l.length;u+=1)a=de(a,l[u]);return{c(){e=N("button"),s&&s.c(),vr(e,a)},m(u,f){w(u,e,f),s&&s.m(e,null),e.autofocus&&e.focus(),t=!0,n||(i=ne(e,"click",r[3]),n=!0)},p(u,[f]){s&&s.p&&(!t||f&2)&&Fe(s,o,u,u[1],t?Re(o,u[1],f,null):Oe(u[1]),null),vr(e,a=$e(l,[{type:"button"},{class:"govuk-button govuk-button--warning"},{"data-module":"govuk-button"},f&1&&u[0]]))},i(u){t||(S(s,u),t=!0)},o(u){k(s,u),t=!1},d(u){u&&$(e),s&&s.d(u),n=!1,i()}}}function Mg(r,e,t){let{$$slots:n={},$$scope:i}=e;function o(s){_e.call(this,r,s)}return r.$$set=s=>{t(0,e=de(de({},e),_r(s))),"$$scope"in s&&t(1,i=s.$$scope)},e=_r(e),[e,i,n,o]}class Br extends Z{constructor(e){super(),Q(this,e,Mg,Eg,K,{})}}function Pg(r){let e;const t=r[16].default,n=Ce(t,r,r[24],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&16777216)&&Fe(n,t,i,i[24],e?Re(t,i[24],o,null):Oe(i[24]),null)},i(i){e||(S(n,i),e=!0)},o(i){k(n,i),e=!1},d(i){n&&n.d(i)}}}function Lg(r){let e,t,n;function i(s){r[17](s)}let o={id:r[1],type:"circle",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[Pg]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new rf({props:o}),be.push(()=>Se(e,"hovered",i)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){L(e.$$.fragment)},m(s,l){A(e,s,l),n=!0},p(s,[l]){const a={};l&2&&(a.id=s[1]),l&4&&(a.source=s[2]),l&8&&(a.sourceLayer=s[3]),l&16&&(a.beforeId=s[4]),l&32&&(a.beforeLayerType=s[5]),l&64&&(a.paint=s[6]),l&128&&(a.layout=s[7]),l&256&&(a.filter=s[8]),l&512&&(a.applyToClusters=s[9]),l&1024&&(a.minzoom=s[10]),l&2048&&(a.maxzoom=s[11]),l&4096&&(a.hoverCursor=s[12]),l&8192&&(a.manageHoverState=s[13]),l&16384&&(a.eventsIfTopMost=s[14]),l&32768&&(a.interactive=s[15]),l&16777216&&(a.$$scope={dirty:l,ctx:s}),!t&&l&1&&(t=!0,a.hovered=s[0],Ee(()=>t=!1)),e.$set(a)},i(s){n||(S(e.$$.fragment,s),n=!0)},o(s){k(e.$$.fragment,s),n=!1},d(s){C(e,s)}}}function Ag(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=Ni("circle")}=e,{source:s=void 0}=e,{sourceLayer:l=void 0}=e,{beforeId:a=void 0}=e,{beforeLayerType:u=void 0}=e,{paint:f}=e,{layout:c=void 0}=e,{filter:g=void 0}=e,{applyToClusters:p=void 0}=e,{minzoom:h=void 0}=e,{maxzoom:m=void 0}=e,{hoverCursor:v=void 0}=e,{manageHoverState:_=!1}=e,{hovered:y=null}=e,{eventsIfTopMost:d=!1}=e,{interactive:E=!0}=e;function b(P){y=P,t(0,y)}function M(P){_e.call(this,r,P)}function R(P){_e.call(this,r,P)}function j(P){_e.call(this,r,P)}function z(P){_e.call(this,r,P)}function G(P){_e.call(this,r,P)}function F(P){_e.call(this,r,P)}return r.$$set=P=>{"id"in P&&t(1,o=P.id),"source"in P&&t(2,s=P.source),"sourceLayer"in P&&t(3,l=P.sourceLayer),"beforeId"in P&&t(4,a=P.beforeId),"beforeLayerType"in P&&t(5,u=P.beforeLayerType),"paint"in P&&t(6,f=P.paint),"layout"in P&&t(7,c=P.layout),"filter"in P&&t(8,g=P.filter),"applyToClusters"in P&&t(9,p=P.applyToClusters),"minzoom"in P&&t(10,h=P.minzoom),"maxzoom"in P&&t(11,m=P.maxzoom),"hoverCursor"in P&&t(12,v=P.hoverCursor),"manageHoverState"in P&&t(13,_=P.manageHoverState),"hovered"in P&&t(0,y=P.hovered),"eventsIfTopMost"in P&&t(14,d=P.eventsIfTopMost),"interactive"in P&&t(15,E=P.interactive),"$$scope"in P&&t(24,i=P.$$scope)},[y,o,s,l,a,u,f,c,g,p,h,m,v,_,d,E,n,b,M,R,j,z,G,F,i]}class wr extends Z{constructor(e){super(),Q(this,e,Ag,Lg,K,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function xs(r){let e=r[0],t,n,i=el(r);return{c(){i.c(),t=ve()},m(o,s){i.m(o,s),w(o,t,s),n=!0},p(o,s){s&1&&K(e,e=o[0])?(ue(),k(i,1,1,ee),fe(),i=el(o),i.c(),S(i,1),i.m(t.parentNode,t)):i.p(o,s)},i(o){n||(S(i),n=!0)},o(o){k(i),n=!1},d(o){o&&$(t),i.d(o)}}}function el(r){let e;const t=r[10].default,n=Ce(t,r,r[9],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&512)&&Fe(n,t,i,i[9],e?Re(t,i[9],o,null):Oe(i[9]),null)},i(i){e||(S(n,i),e=!0)},o(i){k(n,i),e=!1},d(i){n&&n.d(i)}}}function Cg(r){let e,t,n=r[0]&&xs(r);return{c(){n&&n.c(),e=ve()},m(i,o){n&&n.m(i,o),w(i,e,o),t=!0},p(i,[o]){i[0]?n?(n.p(i,o),o&1&&S(n,1)):(n=xs(i),n.c(),S(n,1),n.m(e.parentNode,e)):n&&(ue(),k(n,1,1,()=>{n=null}),fe())},i(i){t||(S(n),t=!0)},o(i){k(n),t=!1},d(i){i&&$(e),n&&n.d(i)}}}function Fg(r,e,t){let n,i,{$$slots:o={},$$scope:s}=e,{id:l=Ni("image")}=e,{url:a}=e,{coordinates:u}=e;const{map:f,self:c}=Cp();V(r,f,h=>t(8,i=h)),V(r,c,h=>t(0,n=h));let g,p=!0;return st(()=>{n&&i&&(Fp(f,n,g),Te(c,n=null,n),t(6,g=void 0))}),r.$$set=h=>{"id"in h&&t(3,l=h.id),"url"in h&&t(4,a=h.url),"coordinates"in h&&t(5,u=h.coordinates),"$$scope"in h&&t(9,s=h.$$scope)},r.$$.update=()=>{r.$$.dirty&313&&i&&n!==l&&(Te(c,n=l,n),Op(i,n,Rp({type:"image",url:a,coordinates:u}),h=>i&&h===n,()=>{n&&(t(6,g=i==null?void 0:i.getSource(n)),t(7,p=!0))})),r.$$.dirty&264&&(i==null||i.on("style.load",()=>{t(6,g=i==null?void 0:i.getSource(l))})),r.$$.dirty&224&&g&&(p?t(7,p=!1):g.setCoordinates(u))},[n,f,c,l,a,u,g,p,i,s,o]}class Og extends Z{constructor(e){super(),Q(this,e,Fg,Cg,K,{id:3,url:4,coordinates:5})}}function Rg(r,e,t){let n;const i=us();let{layer:o=void 0}=e;const{map:s}=nf();V(r,s,f=>t(2,n=f));function l(f){i(f.type,{...f,map:s})}const a=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","contextmenu","mouseover","mouseout"],u=["click","dblclick","contextmenu","mousemove","movestart","moveend","zoomstart","zoom","zoomend"];return st(()=>{if(n)if(o)for(const f of a)n.off(f,o,l);else for(const f of u)n.off(f,l)}),r.$$set=f=>{"layer"in f&&t(1,o=f.layer)},r.$$.update=()=>{if(r.$$.dirty&6&&n)if(o)for(const f of a)n.on(f,o,l);else for(const f of u)n.on(f,l)},[s,o,n]}class Ig extends Z{constructor(e){super(),Q(this,e,Rg,null,K,{layer:1})}}const Bg=r=>({marker:r&8}),tl=r=>({marker:r[3]});function Ng(r){let e,t,n,i,o,s,l;const a=r[19].default,u=Ce(a,r,r[18],tl);return{c(){e=N("div"),u&&u.c(),B(e,"tabindex",t=r[1]?0:void 0),B(e,"role",n=r[1]?"button":void 0),ye(e,"z-index",r[2])},m(f,c){w(f,e,c),u&&u.m(e,null),o=!0,s||(l=[zs(r[7].call(null,e)),zs(i=Tg.call(null,e,r[0])),ne(e,"click",Un(r[20])),ne(e,"dblclick",Un(r[21])),ne(e,"contextmenu",Un(r[22])),ne(e,"mouseenter",r[23]),ne(e,"mouseleave",r[24]),ne(e,"mousemove",r[25]),ne(e,"keydown",r[8])],s=!0)},p(f,[c]){u&&u.p&&(!o||c&262152)&&Fe(u,a,f,f[18],o?Re(a,f[18],c,Bg):Oe(f[18]),tl),(!o||c&2&&t!==(t=f[1]?0:void 0))&&B(e,"tabindex",t),(!o||c&2&&n!==(n=f[1]?"button":void 0))&&B(e,"role",n),i&&of(i.update)&&c&1&&i.update.call(null,f[0]),c&4&&ye(e,"z-index",f[2])},i(f){o||(S(u,f),o=!0)},o(f){k(u,f),o=!1},d(f){f&&$(e),u&&u.d(f),s=!1,It(l)}}}function Tg(r,e){const t=r.className;function n(i){i?r.className=`${t} ${i}`:r.className=t}return n(e),{update:n}}function Dg(r,e,t){let n,i,o,{$$slots:s={},$$scope:l}=e,{marker:a=void 0}=e,{lngLat:u}=e,{class:f=void 0}=e,{interactive:c=!0}=e,{asButton:g=!1}=e,{draggable:p=!1}=e,{feature:h=null}=e,{offset:m=void 0}=e,{zIndex:v=void 0}=e,{rotation:_=0}=e,{opacity:y=1}=e;const d=us(),{map:E,layerEvent:b,self:M}=Ip();V(r,E,H=>t(27,o=H)),V(r,b,H=>t(26,n=H)),V(r,M,H=>t(3,i=H));function R(H){Te(M,i=new Bp.Marker({element:H,rotation:_,draggable:p,offset:m,opacity:y.toString()}).setLngLat(u).addTo(o),i),t(11,a=i);const T=()=>G("dragstart"),te=()=>{j(),G("drag")},ce=()=>{j(),G("dragend")};return p&&(i.on("dragstart",T),i.on("drag",te),i.on("dragend",ce)),{destroy(){p&&(i==null||i.off("dragstart",T),i==null||i.off("drag",te),i==null||i.off("dragend",ce)),t(11,a=void 0),i==null||i.remove()}}}function j(){let H=i==null?void 0:i.getLngLat();H&&(Array.isArray(u)?t(10,u=[H.lng,H.lat]):u&&"lon"in u?t(10,u={lon:H.lng,lat:H.lat}):t(10,u=H))}function z(H){H.key===" "&&(H.preventDefault(),H.stopPropagation(),G("click"))}function G(H){if(!c)return;let T=i==null?void 0:i.getLngLat();if(!T)return;const te=[T.lng,T.lat];let ce={map:o,marker:i,lngLat:te,features:[{type:"Feature",properties:(h==null?void 0:h.properties)??{},geometry:{type:"Point",coordinates:te}}]};Te(b,n={...ce,layerType:"marker",type:H},n),d(H,ce)}const F=()=>G("click"),P=()=>G("dblclick"),I=()=>G("contextmenu"),q=H=>{G("mouseenter")},ie=()=>{G("mouseleave")},X=()=>G("mousemove");return r.$$set=H=>{"marker"in H&&t(11,a=H.marker),"lngLat"in H&&t(10,u=H.lngLat),"class"in H&&t(0,f=H.class),"interactive"in H&&t(12,c=H.interactive),"asButton"in H&&t(1,g=H.asButton),"draggable"in H&&t(13,p=H.draggable),"feature"in H&&t(14,h=H.feature),"offset"in H&&t(15,m=H.offset),"zIndex"in H&&t(2,v=H.zIndex),"rotation"in H&&t(16,_=H.rotation),"opacity"in H&&t(17,y=H.opacity),"$$scope"in H&&t(18,l=H.$$scope)},r.$$.update=()=>{r.$$.dirty&1032&&(i==null||i.setLngLat(u)),r.$$.dirty&32776&&(i==null||i.setOffset(m??[0,0])),r.$$.dirty&65544&&(i==null||i.setRotation(_)),r.$$.dirty&131080&&(i==null||i.setOpacity(y.toString()))},[f,g,v,i,E,b,M,R,z,G,u,a,c,p,h,m,_,y,l,s,F,P,I,q,ie,X]}class wo extends Z{constructor(e){super(),Q(this,e,Dg,Ng,K,{marker:11,lngLat:10,class:0,interactive:12,asButton:1,draggable:13,feature:14,offset:15,zIndex:2,rotation:16,opacity:17})}}class Wi{constructor(){this._partials=new Float64Array(32),this._n=0}add(e){const t=this._partials;let n=0;for(let i=0;i<this._n&&i<32;i++){const o=t[i],s=e+o,l=Math.abs(e)<Math.abs(o)?e-(s-o):o-(s-e);l&&(t[n++]=l),e=s}return t[n]=e,this._n=n+1,this}valueOf(){const e=this._partials;let t=this._n,n,i,o,s=0;if(t>0){for(s=e[--t];t>0&&(n=s,i=e[--t],s=n+i,o=i-(s-n),!o););t>0&&(o<0&&e[t-1]<0||o>0&&e[t-1]>0)&&(i=o*2,n=s+i,i==n-s&&(s=n))}return s}}var jg=1e-6,rl=1e-12,gs=Math.PI,nl=gs/2,il=180/gs,Et=gs/180,gf=Math.atan2,Mt=Math.cos,$o=Math.hypot,Pt=Math.sin,Gg=Math.sqrt;function hf(r){return r>1?nl:r<-1?-nl:Math.asin(r)}function Ug(){}function si(r,e){r&&sl.hasOwnProperty(r.type)&&sl[r.type](r,e)}var ol={Feature:function(r,e){si(r.geometry,e)},FeatureCollection:function(r,e){for(var t=r.features,n=-1,i=t.length;++n<i;)si(t[n].geometry,e)}},sl={Sphere:function(r,e){e.sphere()},Point:function(r,e){r=r.coordinates,e.point(r[0],r[1],r[2])},MultiPoint:function(r,e){for(var t=r.coordinates,n=-1,i=t.length;++n<i;)r=t[n],e.point(r[0],r[1],r[2])},LineString:function(r,e){So(r.coordinates,e,0)},MultiLineString:function(r,e){for(var t=r.coordinates,n=-1,i=t.length;++n<i;)So(t[n],e,0)},Polygon:function(r,e){ll(r.coordinates,e)},MultiPolygon:function(r,e){for(var t=r.coordinates,n=-1,i=t.length;++n<i;)ll(t[n],e)},GeometryCollection:function(r,e){for(var t=r.geometries,n=-1,i=t.length;++n<i;)si(t[n],e)}};function So(r,e,t){var n=-1,i=r.length-t,o;for(e.lineStart();++n<i;)o=r[n],e.point(o[0],o[1],o[2]);e.lineEnd()}function ll(r,e){var t=-1,n=r.length;for(e.polygonStart();++t<n;)So(r[t],e,1);e.polygonEnd()}function qg(r,e){r&&ol.hasOwnProperty(r.type)?ol[r.type](r,e):si(r,e)}var Hr,li,ai,ui,fi,ci,pi,gi,ko,Eo,Mo,mf,df,Je,Ve,Ye,gt={sphere:Ug,point:hs,lineStart:al,lineEnd:ul,polygonStart:function(){gt.lineStart=Hg,gt.lineEnd=Jg},polygonEnd:function(){gt.lineStart=al,gt.lineEnd=ul}};function hs(r,e){r*=Et,e*=Et;var t=Mt(e);wn(t*Mt(r),t*Pt(r),Pt(e))}function wn(r,e,t){++Hr,ai+=(r-ai)/Hr,ui+=(e-ui)/Hr,fi+=(t-fi)/Hr}function al(){gt.point=zg}function zg(r,e){r*=Et,e*=Et;var t=Mt(e);Je=t*Mt(r),Ve=t*Pt(r),Ye=Pt(e),gt.point=Wg,wn(Je,Ve,Ye)}function Wg(r,e){r*=Et,e*=Et;var t=Mt(e),n=t*Mt(r),i=t*Pt(r),o=Pt(e),s=gf(Gg((s=Ve*o-Ye*i)*s+(s=Ye*n-Je*o)*s+(s=Je*i-Ve*n)*s),Je*n+Ve*i+Ye*o);li+=s,ci+=s*(Je+(Je=n)),pi+=s*(Ve+(Ve=i)),gi+=s*(Ye+(Ye=o)),wn(Je,Ve,Ye)}function ul(){gt.point=hs}function Hg(){gt.point=Vg}function Jg(){yf(mf,df),gt.point=hs}function Vg(r,e){mf=r,df=e,r*=Et,e*=Et,gt.point=yf;var t=Mt(e);Je=t*Mt(r),Ve=t*Pt(r),Ye=Pt(e),wn(Je,Ve,Ye)}function yf(r,e){r*=Et,e*=Et;var t=Mt(e),n=t*Mt(r),i=t*Pt(r),o=Pt(e),s=Ve*o-Ye*i,l=Ye*n-Je*o,a=Je*i-Ve*n,u=$o(s,l,a),f=hf(u),c=u&&-f/u;ko.add(c*s),Eo.add(c*l),Mo.add(c*a),li+=f,ci+=f*(Je+(Je=n)),pi+=f*(Ve+(Ve=i)),gi+=f*(Ye+(Ye=o)),wn(Je,Ve,Ye)}function Yg(r){Hr=li=ai=ui=fi=ci=pi=gi=0,ko=new Wi,Eo=new Wi,Mo=new Wi,qg(r,gt);var e=+ko,t=+Eo,n=+Mo,i=$o(e,t,n);return i<rl&&(e=ci,t=pi,n=gi,li<jg&&(e=ai,t=ui,n=fi),i=$o(e,t,n),i<rl)?[NaN,NaN]:[gf(t,e)*il,hf(n/i)*il]}const{Map:Xg}=sf;function fl(r,e,t){const n=r.slice();n[40]=e[t];const i=n[1](n[40]);n[41]=i;const o=typeof n[7]=="function"?n[7](n[40]):n[7];return n[42]=o,n}const Kg=r=>({feature:r[0]&1024,position:r[0]&1026}),cl=r=>({feature:r[40],position:r[41]});function pl(r){let e=[],t=new Xg,n,i,o=rt(r[10]);const s=l=>l[40].id;for(let l=0;l<o.length;l+=1){let a=fl(r,o,l),u=s(a);t.set(u,e[l]=gl(u,a))}return{c(){for(let l=0;l<e.length;l+=1)e[l].c();n=ve()},m(l,a){for(let u=0;u<e.length;u+=1)e[u]&&e[u].m(l,a);w(l,n,a),i=!0},p(l,a){a[0]&264095|a[1]&4&&(o=rt(l[10]),ue(),e=fs(e,a,s,1,l,o,t,n.parentNode,cs,gl,n,fl),fe())},i(l){if(!i){for(let a=0;a<o.length;a+=1)S(e[a]);i=!0}},o(l){for(let a=0;a<e.length;a+=1)k(e[a]);i=!1},d(l){l&&$(n);for(let a=0;a<e.length;a+=1)e[a].d(l)}}}function Zg(r){let e,t;const n=r[24].default,i=Ce(n,r,r[33],cl);return{c(){i&&i.c(),e=O()},m(o,s){i&&i.m(o,s),w(o,e,s),t=!0},p(o,s){i&&i.p&&(!t||s[0]&1026|s[1]&4)&&Fe(i,n,o,o[33],t?Re(n,o[33],s,Kg):Oe(o[33]),cl)},i(o){t||(S(i,o),t=!0)},o(o){k(i,o),t=!1},d(o){o&&$(e),i&&i.d(o)}}}function gl(r,e){let t,n,i;function o(){return e[25](e[40])}function s(){return e[26](e[40])}function l(...p){return e[27](e[40],...p)}function a(...p){return e[28](e[40],...p)}function u(...p){return e[29](e[40],...p)}function f(...p){return e[30](e[40],...p)}function c(...p){return e[31](e[40],...p)}function g(...p){return e[32](e[40],...p)}return n=new wo({props:{asButton:e[3],interactive:e[2],draggable:e[4],class:e[8],zIndex:e[42],lngLat:e[41],$$slots:{default:[Zg]},$$scope:{ctx:e}}}),n.$on("mouseenter",o),n.$on("mouseleave",s),n.$on("dragstart",l),n.$on("drag",a),n.$on("dragend",u),n.$on("click",f),n.$on("dblclick",c),n.$on("contextmenu",g),{key:r,first:null,c(){t=ve(),L(n.$$.fragment),this.first=t},m(p,h){w(p,t,h),A(n,p,h),i=!0},p(p,h){e=p;const m={};h[0]&8&&(m.asButton=e[3]),h[0]&4&&(m.interactive=e[2]),h[0]&16&&(m.draggable=e[4]),h[0]&256&&(m.class=e[8]),h[0]&1152&&(m.zIndex=e[42]),h[0]&1026&&(m.lngLat=e[41]),h[0]&1026|h[1]&4&&(m.$$scope={dirty:h,ctx:e}),n.$set(m)},i(p){i||(S(n.$$.fragment,p),i=!0)},o(p){k(n.$$.fragment,p),i=!1},d(p){p&&$(t),C(n,p)}}}function Qg(r){let e,t,n,i;e=new bn({props:{minzoom:r[5],maxzoom:r[6],paint:{"fill-opacity":0},beforeLayerType:"symbol"}});let o=r[11]>=r[13]&&r[11]<=r[12]&&pl(r);return{c(){L(e.$$.fragment),t=O(),o&&o.c(),n=ve()},m(s,l){A(e,s,l),w(s,t,l),o&&o.m(s,l),w(s,n,l),i=!0},p(s,l){const a={};l[0]&32&&(a.minzoom=s[5]),l[0]&64&&(a.maxzoom=s[6]),e.$set(a),s[11]>=s[13]&&s[11]<=s[12]?o?(o.p(s,l),l[0]&14336&&S(o,1)):(o=pl(s),o.c(),S(o,1),o.m(n.parentNode,n)):o&&(ue(),k(o,1,1,()=>{o=null}),fe())},i(s){i||(S(e.$$.fragment,s),S(o),i=!0)},o(s){k(e.$$.fragment,s),k(o),i=!1},d(s){s&&($(t),$(n)),C(e,s),o&&o.d(s)}}}function xg(r,e,t){let n,i,o,s,l,a,u,{$$slots:f={},$$scope:c}=e;const{map:g,source:p,minzoom:h,maxzoom:m}=nf();V(r,g,J=>t(21,s=J)),V(r,p,J=>t(9,l=J)),V(r,h,J=>t(23,u=J)),V(r,m,J=>t(22,a=J));const v=us();let{applyToClusters:_=void 0}=e,{filter:y=void 0}=e,{markerLngLat:d=Yg}=e,{interactive:E=!0}=e,{asButton:b=!1}=e,{draggable:M=!1}=e,{minzoom:R=void 0}=e,{maxzoom:j=void 0}=e,{hovered:z=null}=e,{zIndex:G=void 0}=e,{class:F=void 0}=e,P=!1;function I(){s&&(P=!0,s.on("zoom",T),s.on("move",X),s.on("moveend",X),s.loaded()?s.once("load",X):X())}function q(J){J.sourceId===l&&J.isSourceLoaded&&(P?X():I())}st(()=>{s&&(s.off("zoom",T),s.off("move",X),s.off("moveend",X),s.off("sourcedata",q))});let ie=[];function X(){var ur;if(!s||!l)return;let J=s.querySourceFeatures(l,{filter:o}),Le=new Map;for(let Ge of J)Ge.id||((ur=Ge.properties)!=null&&ur.cluster_id?Ge.id="autocluster_"+Ge.properties.cluster_id:Ge.id=Ni("autofeat")),Le.set(Ge.id,Ge);t(10,ie=[...Le.values()].sort((Ge,Sp)=>Ge.id.toString().localeCompare(Sp.id.toString())))}let H=(s==null?void 0:s.getZoom())??0;function T(J){t(11,H=s.getZoom()),X()}const te=J=>{t(0,z=J)},ce=J=>{(z==null?void 0:z.id)===J.id&&t(0,z=null)},We=(J,Le)=>v("dragstart",{...Le.detail,source:l,feature:J}),Pe=(J,Le)=>v("drag",{...Le.detail,source:l,feature:J}),we=(J,Le)=>v("dragend",{...Le.detail,source:l,feature:J}),W=(J,Le)=>v("click",{...Le.detail,source:l,feature:J}),x=(J,Le)=>v("dblclick",{...Le.detail,source:l,feature:J}),lt=(J,Le)=>v("contextmenu",{...Le.detail,source:l,feature:J});return r.$$set=J=>{"applyToClusters"in J&&t(19,_=J.applyToClusters),"filter"in J&&t(20,y=J.filter),"markerLngLat"in J&&t(1,d=J.markerLngLat),"interactive"in J&&t(2,E=J.interactive),"asButton"in J&&t(3,b=J.asButton),"draggable"in J&&t(4,M=J.draggable),"minzoom"in J&&t(5,R=J.minzoom),"maxzoom"in J&&t(6,j=J.maxzoom),"hovered"in J&&t(0,z=J.hovered),"zIndex"in J&&t(7,G=J.zIndex),"class"in J&&t(8,F=J.class),"$$scope"in J&&t(33,c=J.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&8388640&&t(13,n=R??u),r.$$.dirty[0]&4194368&&t(12,i=j??a),r.$$.dirty[0]&1572864&&(o=Np("all",Tp(_),y)),r.$$.dirty[0]&2097664&&s&&l){let J=s.getSource(l);J!=null&&J.loaded()?I():s.on("sourcedata",q)}},[z,d,E,b,M,R,j,G,F,l,ie,H,i,n,g,p,h,m,v,_,y,s,a,u,f,te,ce,We,Pe,we,W,x,lt,c]}class eh extends Z{constructor(e){super(),Q(this,e,xg,Qg,K,{applyToClusters:19,filter:20,markerLngLat:1,interactive:2,asButton:3,draggable:4,minzoom:5,maxzoom:6,hovered:0,zIndex:7,class:8},null,[-1,-1])}}function th(r){let e;const t=r[8].default,n=Ce(t,r,r[15],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&32768)&&Fe(n,t,i,i[15],e?Re(t,i[15],o,null):Oe(i[15]),null)},i(i){e||(S(n,i),e=!0)},o(i){k(n,i),e=!1},d(i){n&&n.d(i)}}}function rh(r){let e,t;return e=new rf({props:{id:r[0],type:"raster",source:r[1],beforeId:r[2],beforeLayerType:r[3],paint:r[4],layout:r[5],minzoom:r[6],maxzoom:r[7],$$slots:{default:[th]},$$scope:{ctx:r}}}),e.$on("click",r[9]),e.$on("dblclick",r[10]),e.$on("contextmenu",r[11]),e.$on("mouseenter",r[12]),e.$on("mousemove",r[13]),e.$on("mouseleave",r[14]),{c(){L(e.$$.fragment)},m(n,i){A(e,n,i),t=!0},p(n,[i]){const o={};i&1&&(o.id=n[0]),i&2&&(o.source=n[1]),i&4&&(o.beforeId=n[2]),i&8&&(o.beforeLayerType=n[3]),i&16&&(o.paint=n[4]),i&32&&(o.layout=n[5]),i&64&&(o.minzoom=n[6]),i&128&&(o.maxzoom=n[7]),i&32768&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(S(e.$$.fragment,n),t=!0)},o(n){k(e.$$.fragment,n),t=!1},d(n){C(e,n)}}}function nh(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=Ni("raster-layer")}=e,{source:s=void 0}=e,{beforeId:l=void 0}=e,{beforeLayerType:a=void 0}=e,{paint:u}=e,{layout:f=void 0}=e,{minzoom:c=void 0}=e,{maxzoom:g=void 0}=e;function p(d){_e.call(this,r,d)}function h(d){_e.call(this,r,d)}function m(d){_e.call(this,r,d)}function v(d){_e.call(this,r,d)}function _(d){_e.call(this,r,d)}function y(d){_e.call(this,r,d)}return r.$$set=d=>{"id"in d&&t(0,o=d.id),"source"in d&&t(1,s=d.source),"beforeId"in d&&t(2,l=d.beforeId),"beforeLayerType"in d&&t(3,a=d.beforeLayerType),"paint"in d&&t(4,u=d.paint),"layout"in d&&t(5,f=d.layout),"minzoom"in d&&t(6,c=d.minzoom),"maxzoom"in d&&t(7,g=d.maxzoom),"$$scope"in d&&t(15,i=d.$$scope)},[o,s,l,a,u,f,c,g,n,p,h,m,v,_,y,i]}class ih extends Z{constructor(e){super(),Q(this,e,nh,rh,K,{id:0,source:1,beforeId:2,beforeLayerType:3,paint:4,layout:5,minzoom:6,maxzoom:7})}}let ot=Ie(null);var hl=Object.prototype.toString,vf=function(e){var t=hl.call(e),n=t==="[object Arguments]";return n||(n=t!=="[object Array]"&&e!==null&&typeof e=="object"&&typeof e.length=="number"&&e.length>=0&&hl.call(e.callee)==="[object Function]"),n},Hi,ml;function oh(){if(ml)return Hi;ml=1;var r;if(!Object.keys){var e=Object.prototype.hasOwnProperty,t=Object.prototype.toString,n=vf,i=Object.prototype.propertyIsEnumerable,o=!i.call({toString:null},"toString"),s=i.call(function(){},"prototype"),l=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],a=function(g){var p=g.constructor;return p&&p.prototype===g},u={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},f=function(){if(typeof window>"u")return!1;for(var g in window)try{if(!u["$"+g]&&e.call(window,g)&&window[g]!==null&&typeof window[g]=="object")try{a(window[g])}catch{return!0}}catch{return!0}return!1}(),c=function(g){if(typeof window>"u"||!f)return a(g);try{return a(g)}catch{return!1}};r=function(p){var h=p!==null&&typeof p=="object",m=t.call(p)==="[object Function]",v=n(p),_=h&&t.call(p)==="[object String]",y=[];if(!h&&!m&&!v)throw new TypeError("Object.keys called on a non-object");var d=s&&m;if(_&&p.length>0&&!e.call(p,0))for(var E=0;E<p.length;++E)y.push(String(E));if(v&&p.length>0)for(var b=0;b<p.length;++b)y.push(String(b));else for(var M in p)!(d&&M==="prototype")&&e.call(p,M)&&y.push(String(M));if(o)for(var R=c(p),j=0;j<l.length;++j)!(R&&l[j]==="constructor")&&e.call(p,l[j])&&y.push(l[j]);return y}}return Hi=r,Hi}var sh=Array.prototype.slice,lh=vf,dl=Object.keys,qn=dl?function(e){return dl(e)}:oh(),yl=Object.keys;qn.shim=function(){if(Object.keys){var e=function(){var t=Object.keys(arguments);return t&&t.length===arguments.length}(1,2);e||(Object.keys=function(n){return lh(n)?yl(sh.call(n)):yl(n)})}else Object.keys=qn;return Object.keys||qn};var ms=qn,ah=Error,uh=EvalError,fh=RangeError,ch=ReferenceError,_f=SyntaxError,Vt=TypeError,ph=URIError,Ti=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var e={},t=Symbol("test"),n=Object(t);if(typeof t=="string"||Object.prototype.toString.call(t)!=="[object Symbol]"||Object.prototype.toString.call(n)!=="[object Symbol]")return!1;var i=42;e[t]=i;for(t in e)return!1;if(typeof Object.keys=="function"&&Object.keys(e).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(e).length!==0)return!1;var o=Object.getOwnPropertySymbols(e);if(o.length!==1||o[0]!==t||!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var s=Object.getOwnPropertyDescriptor(e,t);if(s.value!==i||s.enumerable!==!0)return!1}return!0},vl=typeof Symbol<"u"&&Symbol,gh=Ti,ds=function(){return typeof vl!="function"||typeof Symbol!="function"||typeof vl("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:gh()},Ji={__proto__:null,foo:{}},hh=Object,mh=function(){return{__proto__:Ji}.foo===Ji.foo&&!(Ji instanceof hh)},dh="Function.prototype.bind called on incompatible ",yh=Object.prototype.toString,vh=Math.max,_h="[object Function]",_l=function(e,t){for(var n=[],i=0;i<e.length;i+=1)n[i]=e[i];for(var o=0;o<t.length;o+=1)n[o+e.length]=t[o];return n},bh=function(e,t){for(var n=[],i=t||0,o=0;i<e.length;i+=1,o+=1)n[o]=e[i];return n},wh=function(r,e){for(var t="",n=0;n<r.length;n+=1)t+=r[n],n+1<r.length&&(t+=e);return t},$h=function(e){var t=this;if(typeof t!="function"||yh.apply(t)!==_h)throw new TypeError(dh+t);for(var n=bh(arguments,1),i,o=function(){if(this instanceof i){var f=t.apply(this,_l(n,arguments));return Object(f)===f?f:this}return t.apply(e,_l(n,arguments))},s=vh(0,t.length-n.length),l=[],a=0;a<s;a++)l[a]="$"+a;if(i=Function("binder","return function ("+wh(l,",")+"){ return binder.apply(this,arguments); }")(o),t.prototype){var u=function(){};u.prototype=t.prototype,i.prototype=new u,u.prototype=null}return i},Sh=$h,ys=Function.prototype.bind||Sh,kh=Function.prototype.call,Eh=Object.prototype.hasOwnProperty,Mh=ys,bf=Mh.call(kh,Eh),se,Ph=ah,Lh=uh,Ah=fh,Ch=ch,$r=_f,yr=Vt,Fh=ph,wf=Function,Vi=function(r){try{return wf('"use strict"; return ('+r+").constructor;")()}catch{}},er=Object.getOwnPropertyDescriptor;if(er)try{er({},"")}catch{er=null}var Yi=function(){throw new yr},Oh=er?function(){try{return arguments.callee,Yi}catch{try{return er(arguments,"callee").get}catch{return Yi}}}():Yi,fr=ds(),Rh=mh(),Ae=Object.getPrototypeOf||(Rh?function(r){return r.__proto__}:null),hr={},Ih=typeof Uint8Array>"u"||!Ae?se:Ae(Uint8Array),tr={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?se:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?se:ArrayBuffer,"%ArrayIteratorPrototype%":fr&&Ae?Ae([][Symbol.iterator]()):se,"%AsyncFromSyncIteratorPrototype%":se,"%AsyncFunction%":hr,"%AsyncGenerator%":hr,"%AsyncGeneratorFunction%":hr,"%AsyncIteratorPrototype%":hr,"%Atomics%":typeof Atomics>"u"?se:Atomics,"%BigInt%":typeof BigInt>"u"?se:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?se:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?se:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?se:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Ph,"%eval%":eval,"%EvalError%":Lh,"%Float32Array%":typeof Float32Array>"u"?se:Float32Array,"%Float64Array%":typeof Float64Array>"u"?se:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?se:FinalizationRegistry,"%Function%":wf,"%GeneratorFunction%":hr,"%Int8Array%":typeof Int8Array>"u"?se:Int8Array,"%Int16Array%":typeof Int16Array>"u"?se:Int16Array,"%Int32Array%":typeof Int32Array>"u"?se:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":fr&&Ae?Ae(Ae([][Symbol.iterator]())):se,"%JSON%":typeof JSON=="object"?JSON:se,"%Map%":typeof Map>"u"?se:Map,"%MapIteratorPrototype%":typeof Map>"u"||!fr||!Ae?se:Ae(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?se:Promise,"%Proxy%":typeof Proxy>"u"?se:Proxy,"%RangeError%":Ah,"%ReferenceError%":Ch,"%Reflect%":typeof Reflect>"u"?se:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?se:Set,"%SetIteratorPrototype%":typeof Set>"u"||!fr||!Ae?se:Ae(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?se:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":fr&&Ae?Ae(""[Symbol.iterator]()):se,"%Symbol%":fr?Symbol:se,"%SyntaxError%":$r,"%ThrowTypeError%":Oh,"%TypedArray%":Ih,"%TypeError%":yr,"%Uint8Array%":typeof Uint8Array>"u"?se:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?se:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?se:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?se:Uint32Array,"%URIError%":Fh,"%WeakMap%":typeof WeakMap>"u"?se:WeakMap,"%WeakRef%":typeof WeakRef>"u"?se:WeakRef,"%WeakSet%":typeof WeakSet>"u"?se:WeakSet};if(Ae)try{null.error}catch(r){var Bh=Ae(Ae(r));tr["%Error.prototype%"]=Bh}var Nh=function r(e){var t;if(e==="%AsyncFunction%")t=Vi("async function () {}");else if(e==="%GeneratorFunction%")t=Vi("function* () {}");else if(e==="%AsyncGeneratorFunction%")t=Vi("async function* () {}");else if(e==="%AsyncGenerator%"){var n=r("%AsyncGeneratorFunction%");n&&(t=n.prototype)}else if(e==="%AsyncIteratorPrototype%"){var i=r("%AsyncGenerator%");i&&Ae&&(t=Ae(i.prototype))}return tr[e]=t,t},bl={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},$n=ys,hi=bf,Th=$n.call(Function.call,Array.prototype.concat),Dh=$n.call(Function.apply,Array.prototype.splice),wl=$n.call(Function.call,String.prototype.replace),mi=$n.call(Function.call,String.prototype.slice),jh=$n.call(Function.call,RegExp.prototype.exec),Gh=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,Uh=/\\(\\)?/g,qh=function(e){var t=mi(e,0,1),n=mi(e,-1);if(t==="%"&&n!=="%")throw new $r("invalid intrinsic syntax, expected closing `%`");if(n==="%"&&t!=="%")throw new $r("invalid intrinsic syntax, expected opening `%`");var i=[];return wl(e,Gh,function(o,s,l,a){i[i.length]=l?wl(a,Uh,"$1"):s||o}),i},zh=function(e,t){var n=e,i;if(hi(bl,n)&&(i=bl[n],n="%"+i[0]+"%"),hi(tr,n)){var o=tr[n];if(o===hr&&(o=Nh(n)),typeof o>"u"&&!t)throw new yr("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:i,name:n,value:o}}throw new $r("intrinsic "+e+" does not exist!")},Lt=function(e,t){if(typeof e!="string"||e.length===0)throw new yr("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof t!="boolean")throw new yr('"allowMissing" argument must be a boolean');if(jh(/^%?[^%]*%?$/,e)===null)throw new $r("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var n=qh(e),i=n.length>0?n[0]:"",o=zh("%"+i+"%",t),s=o.name,l=o.value,a=!1,u=o.alias;u&&(i=u[0],Dh(n,Th([0,1],u)));for(var f=1,c=!0;f<n.length;f+=1){var g=n[f],p=mi(g,0,1),h=mi(g,-1);if((p==='"'||p==="'"||p==="`"||h==='"'||h==="'"||h==="`")&&p!==h)throw new $r("property names with quotes must have matching quotes");if((g==="constructor"||!c)&&(a=!0),i+="."+g,s="%"+i+"%",hi(tr,s))l=tr[s];else if(l!=null){if(!(g in l)){if(!t)throw new yr("base intrinsic for "+e+" exists, but the property is not available.");return}if(er&&f+1>=n.length){var m=er(l,g);c=!!m,c&&"get"in m&&!("originalValue"in m.get)?l=m.get:l=l[g]}else c=hi(l,g),l=l[g];c&&!a&&(tr[s]=l)}}return l},Xi,$l;function vs(){if($l)return Xi;$l=1;var r=Lt,e=r("%Object.defineProperty%",!0)||!1;if(e)try{e({},"a",{value:1})}catch{e=!1}return Xi=e,Xi}var Wh=Lt,zn=Wh("%Object.getOwnPropertyDescriptor%",!0);if(zn)try{zn([],"length")}catch{zn=null}var _s=zn,Sl=vs(),Hh=_f,cr=Vt,kl=_s,bs=function(e,t,n){if(!e||typeof e!="object"&&typeof e!="function")throw new cr("`obj` must be an object or a function`");if(typeof t!="string"&&typeof t!="symbol")throw new cr("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new cr("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new cr("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new cr("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new cr("`loose`, if provided, must be a boolean");var i=arguments.length>3?arguments[3]:null,o=arguments.length>4?arguments[4]:null,s=arguments.length>5?arguments[5]:null,l=arguments.length>6?arguments[6]:!1,a=!!kl&&kl(e,t);if(Sl)Sl(e,t,{configurable:s===null&&a?a.configurable:!s,enumerable:i===null&&a?a.enumerable:!i,value:n,writable:o===null&&a?a.writable:!o});else if(l||!i&&!o&&!s)e[t]=n;else throw new Hh("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},Po=vs(),$f=function(){return!!Po};$f.hasArrayLengthDefineBug=function(){if(!Po)return null;try{return Po([],"length",{value:1}).length!==1}catch{return!0}};var ws=$f,Jh=ms,Vh=typeof Symbol=="function"&&typeof Symbol("foo")=="symbol",Yh=Object.prototype.toString,Xh=Array.prototype.concat,El=bs,Kh=function(r){return typeof r=="function"&&Yh.call(r)==="[object Function]"},Sf=ws(),Zh=function(r,e,t,n){if(e in r){if(n===!0){if(r[e]===t)return}else if(!Kh(n)||!n())return}Sf?El(r,e,t,!0):El(r,e,t)},kf=function(r,e){var t=arguments.length>2?arguments[2]:{},n=Jh(e);Vh&&(n=Xh.call(n,Object.getOwnPropertySymbols(e)));for(var i=0;i<n.length;i+=1)Zh(r,n[i],e[n[i]],t[n[i]])};kf.supportsDescriptors=!!Sf;var lr=kf,Ef={exports:{}},Qh=Lt,Ml=bs,xh=ws(),Pl=_s,Ll=Vt,em=Qh("%Math.floor%"),tm=function(e,t){if(typeof e!="function")throw new Ll("`fn` is not a function");if(typeof t!="number"||t<0||t>4294967295||em(t)!==t)throw new Ll("`length` must be a positive 32-bit integer");var n=arguments.length>2&&!!arguments[2],i=!0,o=!0;if("length"in e&&Pl){var s=Pl(e,"length");s&&!s.configurable&&(i=!1),s&&!s.writable&&(o=!1)}return(i||o||!n)&&(xh?Ml(e,"length",t,!0,!0):Ml(e,"length",t)),e};(function(r){var e=ys,t=Lt,n=tm,i=Vt,o=t("%Function.prototype.apply%"),s=t("%Function.prototype.call%"),l=t("%Reflect.apply%",!0)||e.call(s,o),a=vs(),u=t("%Math.max%");r.exports=function(g){if(typeof g!="function")throw new i("a function is required");var p=l(e,s,arguments);return n(p,1+u(0,g.length-(arguments.length-1)),!0)};var f=function(){return l(e,o,arguments)};a?a(r.exports,"apply",{value:f}):r.exports.apply=f})(Ef);var Nr=Ef.exports,Mf=Lt,Pf=Nr,rm=Pf(Mf("String.prototype.indexOf")),ct=function(e,t){var n=Mf(e,!!t);return typeof n=="function"&&rm(e,".prototype.")>-1?Pf(n):n},nm=ms,Lf=Ti(),Af=ct,Al=Object,im=Af("Array.prototype.push"),Cl=Af("Object.prototype.propertyIsEnumerable"),om=Lf?Object.getOwnPropertySymbols:null,Cf=function(e,t){if(e==null)throw new TypeError("target must be an object");var n=Al(e);if(arguments.length===1)return n;for(var i=1;i<arguments.length;++i){var o=Al(arguments[i]),s=nm(o),l=Lf&&(Object.getOwnPropertySymbols||om);if(l)for(var a=l(o),u=0;u<a.length;++u){var f=a[u];Cl(o,f)&&im(s,f)}for(var c=0;c<s.length;++c){var g=s[c];if(Cl(o,g)){var p=o[g];n[g]=p}}}return n},Ki=Cf,sm=function(){if(!Object.assign)return!1;for(var r="abcdefghijklmnopqrst",e=r.split(""),t={},n=0;n<e.length;++n)t[e[n]]=e[n];var i=Object.assign({},t),o="";for(var s in i)o+=s;return r!==o},lm=function(){if(!Object.assign||!Object.preventExtensions)return!1;var r=Object.preventExtensions({1:2});try{Object.assign(r,"xy")}catch{return r[1]==="y"}return!1},Ff=function(){return!Object.assign||sm()||lm()?Ki:Object.assign},am=lr,um=Ff,fm=function(){var e=um();return am(Object,{assign:e},{assign:function(){return Object.assign!==e}}),e},cm=lr,pm=Nr,gm=Cf,Of=Ff,hm=fm,mm=pm.apply(Of()),Rf=function(e,t){return mm(Object,arguments)};cm(Rf,{getPolyfill:Of,implementation:gm,shim:hm});var dm=Rf,un=function(){return typeof(function(){}).name=="string"},Zr=Object.getOwnPropertyDescriptor;if(Zr)try{Zr([],"length")}catch{Zr=null}un.functionsHaveConfigurableNames=function(){if(!un()||!Zr)return!1;var e=Zr(function(){},"name");return!!e&&!!e.configurable};var ym=Function.prototype.bind;un.boundFunctionsHaveNames=function(){return un()&&typeof ym=="function"&&(function(){}).bind().name!==""};var vm=un,Fl=bs,_m=ws(),bm=vm.functionsHaveConfigurableNames(),wm=Vt,$m=function(e,t){if(typeof e!="function")throw new wm("`fn` is not a function");var n=arguments.length>2&&!!arguments[2];return(!n||bm)&&(_m?Fl(e,"name",t,!0,!0):Fl(e,"name",t)),e},Sm=$m,km=Vt,Em=Object,If=Sm(function(){if(this==null||this!==Em(this))throw new km("RegExp.prototype.flags getter called on non-object");var e="";return this.hasIndices&&(e+="d"),this.global&&(e+="g"),this.ignoreCase&&(e+="i"),this.multiline&&(e+="m"),this.dotAll&&(e+="s"),this.unicode&&(e+="u"),this.unicodeSets&&(e+="v"),this.sticky&&(e+="y"),e},"get flags",!0),Mm=If,Pm=lr.supportsDescriptors,Lm=Object.getOwnPropertyDescriptor,Bf=function(){if(Pm&&/a/mig.flags==="gim"){var e=Lm(RegExp.prototype,"flags");if(e&&typeof e.get=="function"&&typeof RegExp.prototype.dotAll=="boolean"&&typeof RegExp.prototype.hasIndices=="boolean"){var t="",n={};if(Object.defineProperty(n,"hasIndices",{get:function(){t+="d"}}),Object.defineProperty(n,"sticky",{get:function(){t+="y"}}),t==="dy")return e.get}}return Mm},Am=lr.supportsDescriptors,Cm=Bf,Fm=Object.getOwnPropertyDescriptor,Om=Object.defineProperty,Rm=TypeError,Ol=Object.getPrototypeOf,Im=/a/,Bm=function(){if(!Am||!Ol)throw new Rm("RegExp.prototype.flags requires a true ES5 environment that supports property descriptors");var e=Cm(),t=Ol(Im),n=Fm(t,"flags");return(!n||n.get!==e)&&Om(t,"flags",{configurable:!0,enumerable:!1,get:e}),e},Nm=lr,Tm=Nr,Dm=If,Nf=Bf,jm=Bm,Tf=Tm(Nf());Nm(Tf,{getPolyfill:Nf,implementation:Dm,shim:jm});var Gm=Tf,Wn={exports:{}},Um=Ti,ar=function(){return Um()&&!!Symbol.toStringTag},qm=ar(),zm=ct,Lo=zm("Object.prototype.toString"),Di=function(e){return qm&&e&&typeof e=="object"&&Symbol.toStringTag in e?!1:Lo(e)==="[object Arguments]"},Df=function(e){return Di(e)?!0:e!==null&&typeof e=="object"&&typeof e.length=="number"&&e.length>=0&&Lo(e)!=="[object Array]"&&Lo(e.callee)==="[object Function]"},Wm=function(){return Di(arguments)}();Di.isLegacyArguments=Df;var jf=Wm?Di:Df;const Hm={},Jm=Object.freeze(Object.defineProperty({__proto__:null,default:Hm},Symbol.toStringTag,{value:"Module"})),Vm=lf(Jm);var $s=typeof Map=="function"&&Map.prototype,Zi=Object.getOwnPropertyDescriptor&&$s?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,di=$s&&Zi&&typeof Zi.get=="function"?Zi.get:null,Rl=$s&&Map.prototype.forEach,Ss=typeof Set=="function"&&Set.prototype,Qi=Object.getOwnPropertyDescriptor&&Ss?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,yi=Ss&&Qi&&typeof Qi.get=="function"?Qi.get:null,Il=Ss&&Set.prototype.forEach,Ym=typeof WeakMap=="function"&&WeakMap.prototype,Qr=Ym?WeakMap.prototype.has:null,Xm=typeof WeakSet=="function"&&WeakSet.prototype,xr=Xm?WeakSet.prototype.has:null,Km=typeof WeakRef=="function"&&WeakRef.prototype,Bl=Km?WeakRef.prototype.deref:null,Zm=Boolean.prototype.valueOf,Qm=Object.prototype.toString,xm=Function.prototype.toString,ed=String.prototype.match,ks=String.prototype.slice,Ut=String.prototype.replace,td=String.prototype.toUpperCase,Nl=String.prototype.toLowerCase,Gf=RegExp.prototype.test,Tl=Array.prototype.concat,$t=Array.prototype.join,rd=Array.prototype.slice,Dl=Math.floor,Ao=typeof BigInt=="function"?BigInt.prototype.valueOf:null,xi=Object.getOwnPropertySymbols,Co=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,Sr=typeof Symbol=="function"&&typeof Symbol.iterator=="object",ze=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===Sr||"symbol")?Symbol.toStringTag:null,Uf=Object.prototype.propertyIsEnumerable,jl=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(r){return r.__proto__}:null);function Gl(r,e){if(r===1/0||r===-1/0||r!==r||r&&r>-1e3&&r<1e3||Gf.call(/e/,e))return e;var t=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof r=="number"){var n=r<0?-Dl(-r):Dl(r);if(n!==r){var i=String(n),o=ks.call(e,i.length+1);return Ut.call(i,t,"$&_")+"."+Ut.call(Ut.call(o,/([0-9]{3})/g,"$&_"),/_$/,"")}}return Ut.call(e,t,"$&_")}var Fo=Vm,Ul=Fo.custom,ql=zf(Ul)?Ul:null,nd=function r(e,t,n,i){var o=t||{};if(Dt(o,"quoteStyle")&&o.quoteStyle!=="single"&&o.quoteStyle!=="double")throw new TypeError('option "quoteStyle" must be "single" or "double"');if(Dt(o,"maxStringLength")&&(typeof o.maxStringLength=="number"?o.maxStringLength<0&&o.maxStringLength!==1/0:o.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var s=Dt(o,"customInspect")?o.customInspect:!0;if(typeof s!="boolean"&&s!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(Dt(o,"indent")&&o.indent!==null&&o.indent!=="	"&&!(parseInt(o.indent,10)===o.indent&&o.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(Dt(o,"numericSeparator")&&typeof o.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var l=o.numericSeparator;if(typeof e>"u")return"undefined";if(e===null)return"null";if(typeof e=="boolean")return e?"true":"false";if(typeof e=="string")return Hf(e,o);if(typeof e=="number"){if(e===0)return 1/0/e>0?"0":"-0";var a=String(e);return l?Gl(e,a):a}if(typeof e=="bigint"){var u=String(e)+"n";return l?Gl(e,u):u}var f=typeof o.depth>"u"?5:o.depth;if(typeof n>"u"&&(n=0),n>=f&&f>0&&typeof e=="object")return Oo(e)?"[Array]":"[Object]";var c=wd(o,n);if(typeof i>"u")i=[];else if(Wf(i,e)>=0)return"[Circular]";function g(I,q,ie){if(q&&(i=rd.call(i),i.push(q)),ie){var X={depth:o.depth};return Dt(o,"quoteStyle")&&(X.quoteStyle=o.quoteStyle),r(I,X,n+1,i)}return r(I,o,n+1,i)}if(typeof e=="function"&&!zl(e)){var p=pd(e),h=Cn(e,g);return"[Function"+(p?": "+p:" (anonymous)")+"]"+(h.length>0?" { "+$t.call(h,", ")+" }":"")}if(zf(e)){var m=Sr?Ut.call(String(e),/^(Symbol\(.*\))_[^)]*$/,"$1"):Co.call(e);return typeof e=="object"&&!Sr?Dr(m):m}if(vd(e)){for(var v="<"+Nl.call(String(e.nodeName)),_=e.attributes||[],y=0;y<_.length;y++)v+=" "+_[y].name+"="+qf(id(_[y].value),"double",o);return v+=">",e.childNodes&&e.childNodes.length&&(v+="..."),v+="</"+Nl.call(String(e.nodeName))+">",v}if(Oo(e)){if(e.length===0)return"[]";var d=Cn(e,g);return c&&!bd(d)?"["+Ro(d,c)+"]":"[ "+$t.call(d,", ")+" ]"}if(sd(e)){var E=Cn(e,g);return!("cause"in Error.prototype)&&"cause"in e&&!Uf.call(e,"cause")?"{ ["+String(e)+"] "+$t.call(Tl.call("[cause]: "+g(e.cause),E),", ")+" }":E.length===0?"["+String(e)+"]":"{ ["+String(e)+"] "+$t.call(E,", ")+" }"}if(typeof e=="object"&&s){if(ql&&typeof e[ql]=="function"&&Fo)return Fo(e,{depth:f-n});if(s!=="symbol"&&typeof e.inspect=="function")return e.inspect()}if(gd(e)){var b=[];return Rl&&Rl.call(e,function(I,q){b.push(g(q,e,!0)+" => "+g(I,e))}),Wl("Map",di.call(e),b,c)}if(dd(e)){var M=[];return Il&&Il.call(e,function(I){M.push(g(I,e))}),Wl("Set",yi.call(e),M,c)}if(hd(e))return eo("WeakMap");if(yd(e))return eo("WeakSet");if(md(e))return eo("WeakRef");if(ad(e))return Dr(g(Number(e)));if(fd(e))return Dr(g(Ao.call(e)));if(ud(e))return Dr(Zm.call(e));if(ld(e))return Dr(g(String(e)));if(typeof window<"u"&&e===window)return"{ [object Window] }";if(typeof globalThis<"u"&&e===globalThis||typeof an<"u"&&e===an)return"{ [object globalThis] }";if(!od(e)&&!zl(e)){var R=Cn(e,g),j=jl?jl(e)===Object.prototype:e instanceof Object||e.constructor===Object,z=e instanceof Object?"":"null prototype",G=!j&&ze&&Object(e)===e&&ze in e?ks.call(Yt(e),8,-1):z?"Object":"",F=j||typeof e.constructor!="function"?"":e.constructor.name?e.constructor.name+" ":"",P=F+(G||z?"["+$t.call(Tl.call([],G||[],z||[]),": ")+"] ":"");return R.length===0?P+"{}":c?P+"{"+Ro(R,c)+"}":P+"{ "+$t.call(R,", ")+" }"}return String(e)};function qf(r,e,t){var n=(t.quoteStyle||e)==="double"?'"':"'";return n+r+n}function id(r){return Ut.call(String(r),/"/g,"&quot;")}function Oo(r){return Yt(r)==="[object Array]"&&(!ze||!(typeof r=="object"&&ze in r))}function od(r){return Yt(r)==="[object Date]"&&(!ze||!(typeof r=="object"&&ze in r))}function zl(r){return Yt(r)==="[object RegExp]"&&(!ze||!(typeof r=="object"&&ze in r))}function sd(r){return Yt(r)==="[object Error]"&&(!ze||!(typeof r=="object"&&ze in r))}function ld(r){return Yt(r)==="[object String]"&&(!ze||!(typeof r=="object"&&ze in r))}function ad(r){return Yt(r)==="[object Number]"&&(!ze||!(typeof r=="object"&&ze in r))}function ud(r){return Yt(r)==="[object Boolean]"&&(!ze||!(typeof r=="object"&&ze in r))}function zf(r){if(Sr)return r&&typeof r=="object"&&r instanceof Symbol;if(typeof r=="symbol")return!0;if(!r||typeof r!="object"||!Co)return!1;try{return Co.call(r),!0}catch{}return!1}function fd(r){if(!r||typeof r!="object"||!Ao)return!1;try{return Ao.call(r),!0}catch{}return!1}var cd=Object.prototype.hasOwnProperty||function(r){return r in this};function Dt(r,e){return cd.call(r,e)}function Yt(r){return Qm.call(r)}function pd(r){if(r.name)return r.name;var e=ed.call(xm.call(r),/^function\s*([\w$]+)/);return e?e[1]:null}function Wf(r,e){if(r.indexOf)return r.indexOf(e);for(var t=0,n=r.length;t<n;t++)if(r[t]===e)return t;return-1}function gd(r){if(!di||!r||typeof r!="object")return!1;try{di.call(r);try{yi.call(r)}catch{return!0}return r instanceof Map}catch{}return!1}function hd(r){if(!Qr||!r||typeof r!="object")return!1;try{Qr.call(r,Qr);try{xr.call(r,xr)}catch{return!0}return r instanceof WeakMap}catch{}return!1}function md(r){if(!Bl||!r||typeof r!="object")return!1;try{return Bl.call(r),!0}catch{}return!1}function dd(r){if(!yi||!r||typeof r!="object")return!1;try{yi.call(r);try{di.call(r)}catch{return!0}return r instanceof Set}catch{}return!1}function yd(r){if(!xr||!r||typeof r!="object")return!1;try{xr.call(r,xr);try{Qr.call(r,Qr)}catch{return!0}return r instanceof WeakSet}catch{}return!1}function vd(r){return!r||typeof r!="object"?!1:typeof HTMLElement<"u"&&r instanceof HTMLElement?!0:typeof r.nodeName=="string"&&typeof r.getAttribute=="function"}function Hf(r,e){if(r.length>e.maxStringLength){var t=r.length-e.maxStringLength,n="... "+t+" more character"+(t>1?"s":"");return Hf(ks.call(r,0,e.maxStringLength),e)+n}var i=Ut.call(Ut.call(r,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,_d);return qf(i,"single",e)}function _d(r){var e=r.charCodeAt(0),t={8:"b",9:"t",10:"n",12:"f",13:"r"}[e];return t?"\\"+t:"\\x"+(e<16?"0":"")+td.call(e.toString(16))}function Dr(r){return"Object("+r+")"}function eo(r){return r+" { ? }"}function Wl(r,e,t,n){var i=n?Ro(t,n):$t.call(t,", ");return r+" ("+e+") {"+i+"}"}function bd(r){for(var e=0;e<r.length;e++)if(Wf(r[e],`
`)>=0)return!1;return!0}function wd(r,e){var t;if(r.indent==="	")t="	";else if(typeof r.indent=="number"&&r.indent>0)t=$t.call(Array(r.indent+1)," ");else return null;return{base:t,prev:$t.call(Array(e+1),t)}}function Ro(r,e){if(r.length===0)return"";var t=`
`+e.prev+e.base;return t+$t.call(r,","+t)+`
`+e.prev}function Cn(r,e){var t=Oo(r),n=[];if(t){n.length=r.length;for(var i=0;i<r.length;i++)n[i]=Dt(r,i)?e(r[i],r):""}var o=typeof xi=="function"?xi(r):[],s;if(Sr){s={};for(var l=0;l<o.length;l++)s["$"+o[l]]=o[l]}for(var a in r)Dt(r,a)&&(t&&String(Number(a))===a&&a<r.length||Sr&&s["$"+a]instanceof Symbol||(Gf.call(/[^\w$]/,a)?n.push(e(a,r)+": "+e(r[a],r)):n.push(a+": "+e(r[a],r))));if(typeof xi=="function")for(var u=0;u<o.length;u++)Uf.call(r,o[u])&&n.push("["+e(o[u])+"]: "+e(r[o[u]],r));return n}var Jf=Lt,Tr=ct,$d=nd,Sd=Vt,Fn=Jf("%WeakMap%",!0),On=Jf("%Map%",!0),kd=Tr("WeakMap.prototype.get",!0),Ed=Tr("WeakMap.prototype.set",!0),Md=Tr("WeakMap.prototype.has",!0),Pd=Tr("Map.prototype.get",!0),Ld=Tr("Map.prototype.set",!0),Ad=Tr("Map.prototype.has",!0),Es=function(r,e){for(var t=r,n;(n=t.next)!==null;t=n)if(n.key===e)return t.next=n.next,n.next=r.next,r.next=n,n},Cd=function(r,e){var t=Es(r,e);return t&&t.value},Fd=function(r,e,t){var n=Es(r,e);n?n.value=t:r.next={key:e,next:r.next,value:t}},Od=function(r,e){return!!Es(r,e)},Vf=function(){var e,t,n,i={assert:function(o){if(!i.has(o))throw new Sd("Side channel does not contain "+$d(o))},get:function(o){if(Fn&&o&&(typeof o=="object"||typeof o=="function")){if(e)return kd(e,o)}else if(On){if(t)return Pd(t,o)}else if(n)return Cd(n,o)},has:function(o){if(Fn&&o&&(typeof o=="object"||typeof o=="function")){if(e)return Md(e,o)}else if(On){if(t)return Ad(t,o)}else if(n)return Od(n,o);return!1},set:function(o,s){Fn&&o&&(typeof o=="object"||typeof o=="function")?(e||(e=new Fn),Ed(e,o,s)):On?(t||(t=new On),Ld(t,o,s)):(n||(n={key:{},next:null}),Fd(n,o,s))}};return i},Rd=bf,jr=Vf(),Ft=Vt,Ms={assert:function(r,e){if(!r||typeof r!="object"&&typeof r!="function")throw new Ft("`O` is not an object");if(typeof e!="string")throw new Ft("`slot` must be a string");if(jr.assert(r),!Ms.has(r,e))throw new Ft("`"+e+"` is not present on `O`")},get:function(r,e){if(!r||typeof r!="object"&&typeof r!="function")throw new Ft("`O` is not an object");if(typeof e!="string")throw new Ft("`slot` must be a string");var t=jr.get(r);return t&&t["$"+e]},has:function(r,e){if(!r||typeof r!="object"&&typeof r!="function")throw new Ft("`O` is not an object");if(typeof e!="string")throw new Ft("`slot` must be a string");var t=jr.get(r);return!!t&&Rd(t,"$"+e)},set:function(r,e,t){if(!r||typeof r!="object"&&typeof r!="function")throw new Ft("`O` is not an object");if(typeof e!="string")throw new Ft("`slot` must be a string");var n=jr.get(r);n||(n={},jr.set(r,n)),n["$"+e]=t}};Object.freeze&&Object.freeze(Ms);var Id=Ms,Gr=Id,Bd=SyntaxError,Hl=typeof StopIteration=="object"?StopIteration:null,Nd=function(e){if(!Hl)throw new Bd("this environment lacks StopIteration");Gr.set(e,"[[Done]]",!1);var t={next:function(){var i=Gr.get(this,"[[Iterator]]"),o=Gr.get(i,"[[Done]]");try{return{done:o,value:o?void 0:i.next()}}catch(s){if(Gr.set(i,"[[Done]]",!0),s!==Hl)throw s;return{done:!0,value:void 0}}}};return Gr.set(t,"[[Iterator]]",e),t},Td={}.toString,Yf=Array.isArray||function(r){return Td.call(r)=="[object Array]"},Dd=String.prototype.valueOf,jd=function(e){try{return Dd.call(e),!0}catch{return!1}},Gd=Object.prototype.toString,Ud="[object String]",qd=ar(),Xf=function(e){return typeof e=="string"?!0:typeof e!="object"?!1:qd?jd(e):Gd.call(e)===Ud},Ps=typeof Map=="function"&&Map.prototype?Map:null,zd=typeof Set=="function"&&Set.prototype?Set:null,vi;Ps||(vi=function(e){return!1});var Kf=Ps?Map.prototype.has:null,Jl=zd?Set.prototype.has:null;!vi&&!Kf&&(vi=function(e){return!1});var Zf=vi||function(e){if(!e||typeof e!="object")return!1;try{if(Kf.call(e),Jl)try{Jl.call(e)}catch{return!0}return e instanceof Ps}catch{}return!1},Wd=typeof Map=="function"&&Map.prototype?Map:null,Ls=typeof Set=="function"&&Set.prototype?Set:null,_i;Ls||(_i=function(e){return!1});var Vl=Wd?Map.prototype.has:null,Qf=Ls?Set.prototype.has:null;!_i&&!Qf&&(_i=function(e){return!1});var xf=_i||function(e){if(!e||typeof e!="object")return!1;try{if(Qf.call(e),Vl)try{Vl.call(e)}catch{return!0}return e instanceof Ls}catch{}return!1},Yl=jf,Xl=Nd;if(ds()||Ti()){var to=Symbol.iterator;Wn.exports=function(e){if(e!=null&&typeof e[to]<"u")return e[to]();if(Yl(e))return Array.prototype[to].call(e)}}else{var Hd=Yf,Jd=Xf,Kl=Lt,Vd=Kl("%Map%",!0),Yd=Kl("%Set%",!0),pt=ct,Zl=pt("Array.prototype.push"),Ql=pt("String.prototype.charCodeAt"),Xd=pt("String.prototype.slice"),Kd=function(e,t){var n=e.length;if(t+1>=n)return t+1;var i=Ql(e,t);if(i<55296||i>56319)return t+1;var o=Ql(e,t+1);return o<56320||o>57343?t+1:t+2},ro=function(e){var t=0;return{next:function(){var i=t>=e.length,o;return i||(o=e[t],t+=1),{done:i,value:o}}}},xl=function(e,t){if(Hd(e)||Yl(e))return ro(e);if(Jd(e)){var n=0;return{next:function(){var o=Kd(e,n),s=Xd(e,n,o);return n=o,{done:o>e.length,value:s}}}}if(t&&typeof e["_es6-shim iterator_"]<"u")return e["_es6-shim iterator_"]()};if(!Vd&&!Yd)Wn.exports=function(e){if(e!=null)return xl(e,!0)};else{var Zd=Zf,Qd=xf,ea=pt("Map.prototype.forEach",!0),ta=pt("Set.prototype.forEach",!0);if(typeof process>"u"||!process.versions||!process.versions.node)var ra=pt("Map.prototype.iterator",!0),na=pt("Set.prototype.iterator",!0);var ia=pt("Map.prototype.@@iterator",!0)||pt("Map.prototype._es6-shim iterator_",!0),oa=pt("Set.prototype.@@iterator",!0)||pt("Set.prototype._es6-shim iterator_",!0),xd=function(e){if(Zd(e)){if(ra)return Xl(ra(e));if(ia)return ia(e);if(ea){var t=[];return ea(e,function(i,o){Zl(t,[o,i])}),ro(t)}}if(Qd(e)){if(na)return Xl(na(e));if(oa)return oa(e);if(ta){var n=[];return ta(e,function(i){Zl(n,i)}),ro(n)}}};Wn.exports=function(e){return xd(e)||xl(e)}}}var ey=Wn.exports,sa=function(r){return r!==r},ec=function(e,t){return e===0&&t===0?1/e===1/t:!!(e===t||sa(e)&&sa(t))},ty=ec,tc=function(){return typeof Object.is=="function"?Object.is:ty},ry=tc,ny=lr,iy=function(){var e=ry();return ny(Object,{is:e},{is:function(){return Object.is!==e}}),e},oy=lr,sy=Nr,ly=ec,rc=tc,ay=iy,nc=sy(rc(),Object);oy(nc,{getPolyfill:rc,implementation:ly,shim:ay});var uy=nc,fy=Nr,ic=ct,cy=Lt,Io=cy("%ArrayBuffer%",!0),Hn=ic("ArrayBuffer.prototype.byteLength",!0),py=ic("Object.prototype.toString"),la=!!Io&&!Hn&&new Io(0).slice,aa=!!la&&fy(la),oc=Hn||aa?function(e){if(!e||typeof e!="object")return!1;try{return Hn?Hn(e):aa(e,0),!0}catch{return!1}}:Io?function(e){return py(e)==="[object ArrayBuffer]"}:function(e){return!1},gy=Date.prototype.getDay,hy=function(e){try{return gy.call(e),!0}catch{return!1}},my=Object.prototype.toString,dy="[object Date]",yy=ar(),vy=function(e){return typeof e!="object"||e===null?!1:yy?hy(e):my.call(e)===dy},Bo=ct,sc=ar(),lc,ac,No,To;if(sc){lc=Bo("Object.prototype.hasOwnProperty"),ac=Bo("RegExp.prototype.exec"),No={};var no=function(){throw No};To={toString:no,valueOf:no},typeof Symbol.toPrimitive=="symbol"&&(To[Symbol.toPrimitive]=no)}var _y=Bo("Object.prototype.toString"),by=Object.getOwnPropertyDescriptor,wy="[object RegExp]",$y=sc?function(e){if(!e||typeof e!="object")return!1;var t=by(e,"lastIndex"),n=t&&lc(t,"value");if(!n)return!1;try{ac(e,To)}catch(i){return i===No}}:function(e){return!e||typeof e!="object"&&typeof e!="function"?!1:_y(e)===wy},Sy=ct,ua=Sy("SharedArrayBuffer.prototype.byteLength",!0),ky=ua?function(e){if(!e||typeof e!="object")return!1;try{return ua(e),!0}catch{return!1}}:function(e){return!1},Ey=Number.prototype.toString,My=function(e){try{return Ey.call(e),!0}catch{return!1}},Py=Object.prototype.toString,Ly="[object Number]",Ay=ar(),Cy=function(e){return typeof e=="number"?!0:typeof e!="object"?!1:Ay?My(e):Py.call(e)===Ly},uc=ct,Fy=uc("Boolean.prototype.toString"),Oy=uc("Object.prototype.toString"),Ry=function(e){try{return Fy(e),!0}catch{return!1}},Iy="[object Boolean]",By=ar(),Ny=function(e){return typeof e=="boolean"?!0:e===null||typeof e!="object"?!1:By&&Symbol.toStringTag in e?Ry(e):Oy(e)===Iy},Do={exports:{}},Ty=Object.prototype.toString,Dy=ds();if(Dy){var jy=Symbol.prototype.toString,Gy=/^Symbol\(.*\)$/,Uy=function(e){return typeof e.valueOf()!="symbol"?!1:Gy.test(jy.call(e))};Do.exports=function(e){if(typeof e=="symbol")return!0;if(Ty.call(e)!=="[object Symbol]")return!1;try{return Uy(e)}catch{return!1}}}else Do.exports=function(e){return!1};var qy=Do.exports,jo={exports:{}},fa=typeof BigInt<"u"&&BigInt,zy=function(){return typeof fa=="function"&&typeof BigInt=="function"&&typeof fa(42)=="bigint"&&typeof BigInt(42)=="bigint"},Wy=zy();if(Wy){var Hy=BigInt.prototype.valueOf,Jy=function(e){try{return Hy.call(e),!0}catch{}return!1};jo.exports=function(e){return e===null||typeof e>"u"||typeof e=="boolean"||typeof e=="string"||typeof e=="number"||typeof e=="symbol"||typeof e=="function"?!1:typeof e=="bigint"?!0:Jy(e)}}else jo.exports=function(e){return!1};var Vy=jo.exports,Yy=Xf,Xy=Cy,Ky=Ny,Zy=qy,Qy=Vy,xy=function(e){if(e==null||typeof e!="object"&&typeof e!="function")return null;if(Yy(e))return"String";if(Xy(e))return"Number";if(Ky(e))return"Boolean";if(Zy(e))return"Symbol";if(Qy(e))return"BigInt"},bi=typeof WeakMap=="function"&&WeakMap.prototype?WeakMap:null,ca=typeof WeakSet=="function"&&WeakSet.prototype?WeakSet:null,wi;bi||(wi=function(e){return!1});var Go=bi?bi.prototype.has:null,io=ca?ca.prototype.has:null;!wi&&!Go&&(wi=function(e){return!1});var ev=wi||function(e){if(!e||typeof e!="object")return!1;try{if(Go.call(e,Go),io)try{io.call(e,io)}catch{return!0}return e instanceof bi}catch{}return!1},Uo={exports:{}},tv=Lt,fc=ct,rv=tv("%WeakSet%",!0),oo=fc("WeakSet.prototype.has",!0);if(oo){var so=fc("WeakMap.prototype.has",!0);Uo.exports=function(e){if(!e||typeof e!="object")return!1;try{if(oo(e,oo),so)try{so(e,so)}catch{return!0}return e instanceof rv}catch{}return!1}}else Uo.exports=function(e){return!1};var nv=Uo.exports,iv=Zf,ov=xf,sv=ev,lv=nv,av=function(e){if(e&&typeof e=="object"){if(iv(e))return"Map";if(ov(e))return"Set";if(sv(e))return"WeakMap";if(lv(e))return"WeakSet"}return!1},cc=Function.prototype.toString,dr=typeof Reflect=="object"&&Reflect!==null&&Reflect.apply,qo,Jn;if(typeof dr=="function"&&typeof Object.defineProperty=="function")try{qo=Object.defineProperty({},"length",{get:function(){throw Jn}}),Jn={},dr(function(){throw 42},null,qo)}catch(r){r!==Jn&&(dr=null)}else dr=null;var uv=/^\s*class\b/,zo=function(e){try{var t=cc.call(e);return uv.test(t)}catch{return!1}},lo=function(e){try{return zo(e)?!1:(cc.call(e),!0)}catch{return!1}},Vn=Object.prototype.toString,fv="[object Object]",cv="[object Function]",pv="[object GeneratorFunction]",gv="[object HTMLAllCollection]",hv="[object HTML document.all class]",mv="[object HTMLCollection]",dv=typeof Symbol=="function"&&!!Symbol.toStringTag,yv=!(0 in[,]),Wo=function(){return!1};if(typeof document=="object"){var vv=document.all;Vn.call(vv)===Vn.call(document.all)&&(Wo=function(e){if((yv||!e)&&(typeof e>"u"||typeof e=="object"))try{var t=Vn.call(e);return(t===gv||t===hv||t===mv||t===fv)&&e("")==null}catch{}return!1})}var _v=dr?function(e){if(Wo(e))return!0;if(!e||typeof e!="function"&&typeof e!="object")return!1;try{dr(e,null,qo)}catch(t){if(t!==Jn)return!1}return!zo(e)&&lo(e)}:function(e){if(Wo(e))return!0;if(!e||typeof e!="function"&&typeof e!="object")return!1;if(dv)return lo(e);if(zo(e))return!1;var t=Vn.call(e);return t!==cv&&t!==pv&&!/^\[object HTML/.test(t)?!1:lo(e)},bv=_v,wv=Object.prototype.toString,pc=Object.prototype.hasOwnProperty,$v=function(e,t,n){for(var i=0,o=e.length;i<o;i++)pc.call(e,i)&&(n==null?t(e[i],i,e):t.call(n,e[i],i,e))},Sv=function(e,t,n){for(var i=0,o=e.length;i<o;i++)n==null?t(e.charAt(i),i,e):t.call(n,e.charAt(i),i,e)},kv=function(e,t,n){for(var i in e)pc.call(e,i)&&(n==null?t(e[i],i,e):t.call(n,e[i],i,e))},Ev=function(e,t,n){if(!bv(t))throw new TypeError("iterator must be a function");var i;arguments.length>=3&&(i=n),wv.call(e)==="[object Array]"?$v(e,t,i):typeof e=="string"?Sv(e,t,i):kv(e,t,i)},Mv=Ev,Pv=["Float32Array","Float64Array","Int8Array","Int16Array","Int32Array","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","BigInt64Array","BigUint64Array"],ao=Pv,Lv=typeof globalThis>"u"?an:globalThis,Av=function(){for(var e=[],t=0;t<ao.length;t++)typeof Lv[ao[t]]=="function"&&(e[e.length]=ao[t]);return e},$i=Mv,Cv=Av,pa=Nr,As=ct,Yn=_s,Fv=As("Object.prototype.toString"),gc=ar(),ga=typeof globalThis>"u"?an:globalThis,Ho=Cv(),Cs=As("String.prototype.slice"),uo=Object.getPrototypeOf,Ov=As("Array.prototype.indexOf",!0)||function(e,t){for(var n=0;n<e.length;n+=1)if(e[n]===t)return n;return-1},Si={__proto__:null};gc&&Yn&&uo?$i(Ho,function(r){var e=new ga[r];if(Symbol.toStringTag in e){var t=uo(e),n=Yn(t,Symbol.toStringTag);if(!n){var i=uo(t);n=Yn(i,Symbol.toStringTag)}Si["$"+r]=pa(n.get)}}):$i(Ho,function(r){var e=new ga[r],t=e.slice||e.set;t&&(Si["$"+r]=pa(t))});var Rv=function(e){var t=!1;return $i(Si,function(n,i){if(!t)try{"$"+n(e)===i&&(t=Cs(i,1))}catch{}}),t},Iv=function(e){var t=!1;return $i(Si,function(n,i){if(!t)try{n(e),t=Cs(i,1)}catch{}}),t},Bv=function(e){if(!e||typeof e!="object")return!1;if(!gc){var t=Cs(Fv(e),8,-1);return Ov(Ho,t)>-1?t:t!=="Object"?!1:Iv(e)}return Yn?Rv(e):null},Nv=ct,ha=Nv("ArrayBuffer.prototype.byteLength",!0),Tv=oc,Dv=function(e){return Tv(e)?ha?ha(e):e.byteLength:NaN},hc=dm,At=ct,ma=Gm,jv=Lt,kr=ey,Gv=Vf,da=uy,ya=jf,va=Yf,_a=oc,ba=vy,wa=$y,$a=ky,Sa=ms,ka=xy,Ea=av,Ma=Bv,Pa=Dv,La=At("SharedArrayBuffer.prototype.byteLength",!0),Aa=At("Date.prototype.getTime"),fo=Object.getPrototypeOf,Ca=At("Object.prototype.toString"),ki=jv("%Set%",!0),Jo=At("Map.prototype.has",!0),Ei=At("Map.prototype.get",!0),Fa=At("Map.prototype.size",!0),Mi=At("Set.prototype.add",!0),mc=At("Set.prototype.delete",!0),Pi=At("Set.prototype.has",!0),Xn=At("Set.prototype.size",!0);function Oa(r,e,t,n){for(var i=kr(r),o;(o=i.next())&&!o.done;)if(_t(e,o.value,t,n))return mc(r,o.value),!0;return!1}function dc(r){if(typeof r>"u")return null;if(typeof r!="object")return typeof r=="symbol"?!1:typeof r=="string"||typeof r=="number"?+r==+r:!0}function Uv(r,e,t,n,i,o){var s=dc(t);if(s!=null)return s;var l=Ei(e,s),a=hc({},i,{strict:!1});return typeof l>"u"&&!Jo(e,s)||!_t(n,l,a,o)?!1:!Jo(r,s)&&_t(n,l,a,o)}function qv(r,e,t){var n=dc(t);return n??(Pi(e,n)&&!Pi(r,n))}function Ra(r,e,t,n,i,o){for(var s=kr(r),l,a;(l=s.next())&&!l.done;)if(a=l.value,_t(t,a,i,o)&&_t(n,Ei(e,a),i,o))return mc(r,a),!0;return!1}function _t(r,e,t,n){var i=t||{};if(i.strict?da(r,e):r===e)return!0;var o=ka(r),s=ka(e);if(o!==s)return!1;if(!r||!e||typeof r!="object"&&typeof e!="object")return i.strict?da(r,e):r==e;var l=n.has(r),a=n.has(e),u;if(l&&a){if(n.get(r)===n.get(e))return!0}else u={};return l||n.set(r,u),a||n.set(e,u),Hv(r,e,i,n)}function Ia(r){return!r||typeof r!="object"||typeof r.length!="number"||typeof r.copy!="function"||typeof r.slice!="function"||r.length>0&&typeof r[0]!="number"?!1:!!(r.constructor&&r.constructor.isBuffer&&r.constructor.isBuffer(r))}function zv(r,e,t,n){if(Xn(r)!==Xn(e))return!1;for(var i=kr(r),o=kr(e),s,l,a;(s=i.next())&&!s.done;)if(s.value&&typeof s.value=="object")a||(a=new ki),Mi(a,s.value);else if(!Pi(e,s.value)){if(t.strict||!qv(r,e,s.value))return!1;a||(a=new ki),Mi(a,s.value)}if(a){for(;(l=o.next())&&!l.done;)if(l.value&&typeof l.value=="object"){if(!Oa(a,l.value,t.strict,n))return!1}else if(!t.strict&&!Pi(r,l.value)&&!Oa(a,l.value,t.strict,n))return!1;return Xn(a)===0}return!0}function Wv(r,e,t,n){if(Fa(r)!==Fa(e))return!1;for(var i=kr(r),o=kr(e),s,l,a,u,f,c;(s=i.next())&&!s.done;)if(u=s.value[0],f=s.value[1],u&&typeof u=="object")a||(a=new ki),Mi(a,u);else if(c=Ei(e,u),typeof c>"u"&&!Jo(e,u)||!_t(f,c,t,n)){if(t.strict||!Uv(r,e,u,f,t,n))return!1;a||(a=new ki),Mi(a,u)}if(a){for(;(l=o.next())&&!l.done;)if(u=l.value[0],c=l.value[1],u&&typeof u=="object"){if(!Ra(a,r,u,c,t,n))return!1}else if(!t.strict&&(!r.has(u)||!_t(Ei(r,u),c,t,n))&&!Ra(a,r,u,c,hc({},t,{strict:!1}),n))return!1;return Xn(a)===0}return!0}function Hv(r,e,t,n){var i,o;if(typeof r!=typeof e||r==null||e==null||Ca(r)!==Ca(e)||ya(r)!==ya(e))return!1;var s=va(r),l=va(e);if(s!==l)return!1;var a=r instanceof Error,u=e instanceof Error;if(a!==u||(a||u)&&(r.name!==e.name||r.message!==e.message))return!1;var f=wa(r),c=wa(e);if(f!==c||(f||c)&&(r.source!==e.source||ma(r)!==ma(e)))return!1;var g=ba(r),p=ba(e);if(g!==p||(g||p)&&Aa(r)!==Aa(e)||t.strict&&fo&&fo(r)!==fo(e))return!1;var h=Ma(r),m=Ma(e);if(h!==m)return!1;if(h||m){if(r.length!==e.length)return!1;for(i=0;i<r.length;i++)if(r[i]!==e[i])return!1;return!0}var v=Ia(r),_=Ia(e);if(v!==_)return!1;if(v||_){if(r.length!==e.length)return!1;for(i=0;i<r.length;i++)if(r[i]!==e[i])return!1;return!0}var y=_a(r),d=_a(e);if(y!==d)return!1;if(y||d)return Pa(r)!==Pa(e)?!1:typeof Uint8Array=="function"&&_t(new Uint8Array(r),new Uint8Array(e),t,n);var E=$a(r),b=$a(e);if(E!==b)return!1;if(E||b)return La(r)!==La(e)?!1:typeof Uint8Array=="function"&&_t(new Uint8Array(r),new Uint8Array(e),t,n);if(typeof r!=typeof e)return!1;var M=Sa(r),R=Sa(e);if(M.length!==R.length)return!1;for(M.sort(),R.sort(),i=M.length-1;i>=0;i--)if(M[i]!=R[i])return!1;for(i=M.length-1;i>=0;i--)if(o=M[i],!_t(r[o],e[o],t,n))return!1;var j=Ea(r),z=Ea(e);return j!==z?!1:j==="Set"||z==="Set"?zv(r,e,t,n):j==="Map"?Wv(r,e,t,n):!0}var Jv=function(e,t,n){return _t(e,t,n,Gv())};const Vv=af(Jv);var Yv=Object.defineProperty,ge=(r,e)=>Yv(r,"name",{value:e,configurable:!0}),Xv=class{constructor(e){this.direction=!1,this.compareProperties=!0;var t,n,i;this.precision=10**-((t=e==null?void 0:e.precision)!=null?t:17),this.direction=(n=e==null?void 0:e.direction)!=null?n:!1,this.compareProperties=(i=e==null?void 0:e.compareProperties)!=null?i:!0}compare(e,t){if(e.type!==t.type||!Jr(e,t))return!1;switch(e.type){case"Point":return this.compareCoord(e.coordinates,t.coordinates);case"LineString":return this.compareLine(e.coordinates,t.coordinates);case"Polygon":return this.comparePolygon(e,t);case"GeometryCollection":return this.compareGeometryCollection(e,t);case"Feature":return this.compareFeature(e,t);case"FeatureCollection":return this.compareFeatureCollection(e,t);default:if(e.type.startsWith("Multi")){const n=Vo(e),i=Vo(t);return n.every(o=>i.some(s=>this.compare(o,s)))}}return!1}compareCoord(e,t){return e.length===t.length&&e.every((n,i)=>Math.abs(n-t[i])<this.precision)}compareLine(e,t,n=0,i=!1){if(!Jr(e,t))return!1;const o=e;let s=t;if(i&&!this.compareCoord(o[0],s[0])){const a=this.fixStartIndex(s,o);if(a)s=a;else return!1}const l=this.compareCoord(o[n],s[n]);return this.direction||l?this.comparePath(o,s):this.compareCoord(o[n],s[s.length-(1+n)])?this.comparePath(o.slice().reverse(),s):!1}fixStartIndex(e,t){let n,i=-1;for(let o=0;o<e.length;o++)if(this.compareCoord(e[o],t[0])){i=o;break}return i>=0&&(n=[].concat(e.slice(i,e.length),e.slice(1,i+1))),n}comparePath(e,t){return e.every((n,i)=>this.compareCoord(n,t[i]))}comparePolygon(e,t){if(this.compareLine(e.coordinates[0],t.coordinates[0],1,!0)){const n=e.coordinates.slice(1,e.coordinates.length),i=t.coordinates.slice(1,t.coordinates.length);return n.every(o=>i.some(s=>this.compareLine(o,s,1,!0)))}return!1}compareGeometryCollection(e,t){return Jr(e.geometries,t.geometries)&&this.compareBBox(e,t)&&e.geometries.every((n,i)=>this.compare(n,t.geometries[i]))}compareFeature(e,t){return e.id===t.id&&(this.compareProperties?Vv(e.properties,t.properties):!0)&&this.compareBBox(e,t)&&this.compare(e.geometry,t.geometry)}compareFeatureCollection(e,t){return Jr(e.features,t.features)&&this.compareBBox(e,t)&&e.features.every((n,i)=>this.compare(n,t.features[i]))}compareBBox(e,t){return!e.bbox&&!t.bbox||(e.bbox&&t.bbox?this.compareCoord(e.bbox,t.bbox):!1)}};ge(Xv,"GeojsonEquality");function Jr(r,e){return r.coordinates?r.coordinates.length===e.coordinates.length:r.length===e.length}ge(Jr,"sameLength");function Vo(r){return r.coordinates.map(e=>({type:r.type.replace("Multi",""),coordinates:e}))}ge(Vo,"explode");var it=63710088e-1,yc={centimeters:it*100,centimetres:it*100,degrees:360/(2*Math.PI),feet:it*3.28084,inches:it*39.37,kilometers:it/1e3,kilometres:it/1e3,meters:it,metres:it,miles:it/1609.344,millimeters:it*1e3,millimetres:it*1e3,nauticalmiles:it/1852,radians:1,yards:it*1.0936},Ba={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,nauticalmiles:29155334959812285e-23,millimeters:1e6,millimetres:1e6,yards:1.195990046};function ft(r,e,t={}){const n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=r,n}ge(ft,"feature");function Kv(r,e,t={}){switch(r){case"Point":return tt(e).geometry;case"LineString":return ht(e).geometry;case"Polygon":return ji(e).geometry;case"MultiPoint":return _c(e).geometry;case"MultiLineString":return vc(e).geometry;case"MultiPolygon":return Fs(e).geometry;default:throw new Error(r+" is invalid")}}ge(Kv,"geometry");function tt(r,e,t={}){if(!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Mr(r[0])||!Mr(r[1]))throw new Error("coordinates must contain numbers");return ft({type:"Point",coordinates:r},e,t)}ge(tt,"point");function Zv(r,e,t={}){return Er(r.map(n=>tt(n,e)),t)}ge(Zv,"points");function ji(r,e,t={}){for(const i of r){if(i.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(i[i.length-1].length!==i[0].length)throw new Error("First and last Position are not equivalent.");for(let o=0;o<i[i.length-1].length;o++)if(i[i.length-1][o]!==i[0][o])throw new Error("First and last Position are not equivalent.")}return ft({type:"Polygon",coordinates:r},e,t)}ge(ji,"polygon");function Qv(r,e,t={}){return Er(r.map(n=>ji(n,e)),t)}ge(Qv,"polygons");function ht(r,e,t={}){if(r.length<2)throw new Error("coordinates must be an array of two or more positions");return ft({type:"LineString",coordinates:r},e,t)}ge(ht,"lineString");function xv(r,e,t={}){return Er(r.map(n=>ht(n,e)),t)}ge(xv,"lineStrings");function Er(r,e={}){const t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=r,t}ge(Er,"featureCollection");function vc(r,e,t={}){return ft({type:"MultiLineString",coordinates:r},e,t)}ge(vc,"multiLineString");function _c(r,e,t={}){return ft({type:"MultiPoint",coordinates:r},e,t)}ge(_c,"multiPoint");function Fs(r,e,t={}){return ft({type:"MultiPolygon",coordinates:r},e,t)}ge(Fs,"multiPolygon");function e_(r,e,t={}){return ft({type:"GeometryCollection",geometries:r},e,t)}ge(e_,"geometryCollection");function t_(r,e=0){if(e&&!(e>=0))throw new Error("precision must be a positive number");const t=Math.pow(10,e||0);return Math.round(r*t)/t}ge(t_,"round");function Os(r,e="kilometers"){const t=yc[e];if(!t)throw new Error(e+" units is invalid");return r*t}ge(Os,"radiansToLength");function Gi(r,e="kilometers"){const t=yc[e];if(!t)throw new Error(e+" units is invalid");return r/t}ge(Gi,"lengthToRadians");function r_(r,e){return fn(Gi(r,e))}ge(r_,"lengthToDegrees");function n_(r){let e=r%360;return e<0&&(e+=360),e}ge(n_,"bearingToAzimuth");function fn(r){return r%(2*Math.PI)*180/Math.PI}ge(fn,"radiansToDegrees");function ut(r){return r%360*Math.PI/180}ge(ut,"degreesToRadians");function i_(r,e="kilometers",t="kilometers"){if(!(r>=0))throw new Error("length must be a positive number");return Os(Gi(r,e),t)}ge(i_,"convertLength");function o_(r,e="meters",t="kilometers"){if(!(r>=0))throw new Error("area must be a positive number");const n=Ba[e];if(!n)throw new Error("invalid original units");const i=Ba[t];if(!i)throw new Error("invalid final units");return r/n*i}ge(o_,"convertArea");function Mr(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}ge(Mr,"isNumber");function Rs(r){return r!==null&&typeof r=="object"&&!Array.isArray(r)}ge(Rs,"isObject");function s_(r){if(!r)throw new Error("bbox is required");if(!Array.isArray(r))throw new Error("bbox must be an Array");if(r.length!==4&&r.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");r.forEach(e=>{if(!Mr(e))throw new Error("bbox must only contain numbers")})}ge(s_,"validateBBox");function l_(r){if(!r)throw new Error("id is required");if(["string","number"].indexOf(typeof r)===-1)throw new Error("id must be a number or a string")}ge(l_,"validateId");/**
 * splaytree v3.1.2
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function a_(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(u){return function(f){return a([u,f])}}function a(u){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=u[0]&2?i.return:u[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,u[1])).done)return o;switch(i=0,o&&(u=[u[0]&2,o.value]),u[0]){case 0:case 1:o=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,i=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!o||u[1]>o[0]&&u[1]<o[3])){t.label=u[1];break}if(u[0]===6&&t.label<o[1]){t.label=o[1],o=u;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(u);break}o[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(r,t)}catch(f){u=[6,f],i=0}finally{n=o=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}var Ht=function(){function r(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null}return r}();function u_(r,e){return r>e?1:r<e?-1:0}function jt(r,e,t){for(var n=new Ht(null,null),i=n,o=n;;){var s=t(r,e.key);if(s<0){if(e.left===null)break;if(t(r,e.left.key)<0){var l=e.left;if(e.left=l.right,l.right=e,e=l,e.left===null)break}o.left=e,o=e,e=e.left}else if(s>0){if(e.right===null)break;if(t(r,e.right.key)>0){var l=e.right;if(e.right=l.left,l.left=e,e=l,e.right===null)break}i.right=e,i=e,e=e.right}else break}return i.right=e.left,o.left=e.right,e.left=n.right,e.right=n.left,e}function co(r,e,t,n){var i=new Ht(r,e);if(t===null)return i.left=i.right=null,i;t=jt(r,t,n);var o=n(r,t.key);return o<0?(i.left=t.left,i.right=t,t.left=null):o>=0&&(i.right=t.right,i.left=t,t.right=null),i}function Na(r,e,t){var n=null,i=null;if(e){e=jt(r,e,t);var o=t(e.key,r);o===0?(n=e.left,i=e.right):o<0?(i=e.right,e.right=null,n=e):(n=e.left,e.left=null,i=e)}return{left:n,right:i}}function f_(r,e,t){return e===null?r:(r===null||(e=jt(r.key,e,t),e.left=r),e)}function Yo(r,e,t,n,i){if(r){n(""+e+(t?"└── ":"├── ")+i(r)+`
`);var o=e+(t?"    ":"│   ");r.left&&Yo(r.left,o,!1,n,i),r.right&&Yo(r.right,o,!0,n,i)}}var Is=function(){function r(e){e===void 0&&(e=u_),this._root=null,this._size=0,this._comparator=e}return r.prototype.insert=function(e,t){return this._size++,this._root=co(e,t,this._root,this._comparator)},r.prototype.add=function(e,t){var n=new Ht(e,t);this._root===null&&(n.left=n.right=null,this._size++,this._root=n);var i=this._comparator,o=jt(e,this._root,i),s=i(e,o.key);return s===0?this._root=o:(s<0?(n.left=o.left,n.right=o,o.left=null):s>0&&(n.right=o.right,n.left=o,o.right=null),this._size++,this._root=n),this._root},r.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},r.prototype._remove=function(e,t,n){var i;if(t===null)return null;t=jt(e,t,n);var o=n(e,t.key);return o===0?(t.left===null?i=t.right:(i=jt(e,t.left,n),i.right=t.right),this._size--,i):t},r.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=jt(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},r.prototype.findStatic=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return t;i<0?t=t.left:t=t.right}return null},r.prototype.find=function(e){return this._root&&(this._root=jt(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},r.prototype.contains=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return!0;i<0?t=t.left:t=t.right}return!1},r.prototype.forEach=function(e,t){for(var n=this._root,i=[],o=!1;!o;)n!==null?(i.push(n),n=n.left):i.length!==0?(n=i.pop(),e.call(t,n),n=n.right):o=!0;return this},r.prototype.range=function(e,t,n,i){for(var o=[],s=this._comparator,l=this._root,a;o.length!==0||l;)if(l)o.push(l),l=l.left;else{if(l=o.pop(),a=s(l.key,t),a>0)break;if(s(l.key,e)>=0&&n.call(i,l))return this;l=l.right}return this},r.prototype.keys=function(){var e=[];return this.forEach(function(t){var n=t.key;return e.push(n)}),e},r.prototype.values=function(){var e=[];return this.forEach(function(t){var n=t.data;return e.push(n)}),e},r.prototype.min=function(){return this._root?this.minNode(this._root).key:null},r.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},r.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},r.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},r.prototype.at=function(e){for(var t=this._root,n=!1,i=0,o=[];!n;)if(t)o.push(t),t=t.left;else if(o.length>0){if(t=o.pop(),i===e)return t;i++,t=t.right}else n=!0;return null},r.prototype.next=function(e){var t=this._root,n=null;if(e.right){for(n=e.right;n.left;)n=n.left;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?(n=t,t=t.left):t=t.right}return n},r.prototype.prev=function(e){var t=this._root,n=null;if(e.left!==null){for(n=e.left;n.right;)n=n.right;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?t=t.left:(n=t,t=t.right)}return n},r.prototype.clear=function(){return this._root=null,this._size=0,this},r.prototype.toList=function(){return p_(this._root)},r.prototype.load=function(e,t,n){t===void 0&&(t=[]),n===void 0&&(n=!1);var i=e.length,o=this._comparator;if(n&&Zo(e,t,0,i-1,o),this._root===null)this._root=Xo(e,t,0,i),this._size=i;else{var s=g_(this.toList(),c_(e,t),o);i=this._size+i,this._root=Ko({head:s},0,i)}return this},r.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(r.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),r.prototype.toString=function(e){e===void 0&&(e=function(n){return String(n.key)});var t=[];return Yo(this._root,"",!0,function(n){return t.push(n)},e),t.join("")},r.prototype.update=function(e,t,n){var i=this._comparator,o=Na(e,this._root,i),s=o.left,l=o.right;i(e,t)<0?l=co(t,n,l,i):s=co(t,n,s,i),this._root=f_(s,l,i)},r.prototype.split=function(e){return Na(e,this._root,this._comparator)},r.prototype[Symbol.iterator]=function(){var e,t,n;return a_(this,function(i){switch(i.label){case 0:e=this._root,t=[],n=!1,i.label=1;case 1:return n?[3,6]:e===null?[3,2]:(t.push(e),e=e.left,[3,5]);case 2:return t.length===0?[3,4]:(e=t.pop(),[4,e]);case 3:return i.sent(),e=e.right,[3,5];case 4:n=!0,i.label=5;case 5:return[3,1];case 6:return[2]}})},r}();function Xo(r,e,t,n){var i=n-t;if(i>0){var o=t+Math.floor(i/2),s=r[o],l=e[o],a=new Ht(s,l);return a.left=Xo(r,e,t,o),a.right=Xo(r,e,o+1,n),a}return null}function c_(r,e){for(var t=new Ht(null,null),n=t,i=0;i<r.length;i++)n=n.next=new Ht(r[i],e[i]);return n.next=null,t.next}function p_(r){for(var e=r,t=[],n=!1,i=new Ht(null,null),o=i;!n;)e?(t.push(e),e=e.left):t.length>0?(e=o=o.next=t.pop(),e=e.right):n=!0;return o.next=null,i.next}function Ko(r,e,t){var n=t-e;if(n>0){var i=e+Math.floor(n/2),o=Ko(r,e,i),s=r.head;return s.left=o,r.head=r.head.next,s.right=Ko(r,i+1,t),s}return null}function g_(r,e,t){for(var n=new Ht(null,null),i=n,o=r,s=e;o!==null&&s!==null;)t(o.key,s.key)<0?(i.next=o,o=o.next):(i.next=s,s=s.next),i=i.next;return o!==null?i.next=o:s!==null&&(i.next=s),n.next}function Zo(r,e,t,n,i){if(!(t>=n)){for(var o=r[t+n>>1],s=t-1,l=n+1;;){do s++;while(i(r[s],o)<0);do l--;while(i(r[l],o)>0);if(s>=l)break;var a=r[s];r[s]=r[l],r[l]=a,a=e[s],e[s]=e[l],e[l]=a}Zo(r,e,t,l,i),Zo(r,e,l+1,n,i)}}const Rt=11102230246251565e-32,Ue=134217729,h_=(3+8*Rt)*Rt;function po(r,e,t,n,i){let o,s,l,a,u=e[0],f=n[0],c=0,g=0;f>u==f>-u?(o=u,u=e[++c]):(o=f,f=n[++g]);let p=0;if(c<r&&g<t)for(f>u==f>-u?(s=u+o,l=o-(s-u),u=e[++c]):(s=f+o,l=o-(s-f),f=n[++g]),o=s,l!==0&&(i[p++]=l);c<r&&g<t;)f>u==f>-u?(s=o+u,a=s-o,l=o-(s-a)+(u-a),u=e[++c]):(s=o+f,a=s-o,l=o-(s-a)+(f-a),f=n[++g]),o=s,l!==0&&(i[p++]=l);for(;c<r;)s=o+u,a=s-o,l=o-(s-a)+(u-a),u=e[++c],o=s,l!==0&&(i[p++]=l);for(;g<t;)s=o+f,a=s-o,l=o-(s-a)+(f-a),f=n[++g],o=s,l!==0&&(i[p++]=l);return(o!==0||p===0)&&(i[p++]=o),p}function m_(r,e){let t=e[0];for(let n=1;n<r;n++)t+=e[n];return t}function Sn(r){return new Float64Array(r)}const d_=(3+16*Rt)*Rt,y_=(2+12*Rt)*Rt,v_=(9+64*Rt)*Rt*Rt,pr=Sn(4),Ta=Sn(8),Da=Sn(12),ja=Sn(16),He=Sn(4);function __(r,e,t,n,i,o,s){let l,a,u,f,c,g,p,h,m,v,_,y,d,E,b,M,R,j;const z=r-i,G=t-i,F=e-o,P=n-o;E=z*P,g=Ue*z,p=g-(g-z),h=z-p,g=Ue*P,m=g-(g-P),v=P-m,b=h*v-(E-p*m-h*m-p*v),M=F*G,g=Ue*F,p=g-(g-F),h=F-p,g=Ue*G,m=g-(g-G),v=G-m,R=h*v-(M-p*m-h*m-p*v),_=b-R,c=b-_,pr[0]=b-(_+c)+(c-R),y=E+_,c=y-E,d=E-(y-c)+(_-c),_=d-M,c=d-_,pr[1]=d-(_+c)+(c-M),j=y+_,c=j-y,pr[2]=y-(j-c)+(_-c),pr[3]=j;let I=m_(4,pr),q=y_*s;if(I>=q||-I>=q||(c=r-z,l=r-(z+c)+(c-i),c=t-G,u=t-(G+c)+(c-i),c=e-F,a=e-(F+c)+(c-o),c=n-P,f=n-(P+c)+(c-o),l===0&&a===0&&u===0&&f===0)||(q=v_*s+h_*Math.abs(I),I+=z*f+P*l-(F*u+G*a),I>=q||-I>=q))return I;E=l*P,g=Ue*l,p=g-(g-l),h=l-p,g=Ue*P,m=g-(g-P),v=P-m,b=h*v-(E-p*m-h*m-p*v),M=a*G,g=Ue*a,p=g-(g-a),h=a-p,g=Ue*G,m=g-(g-G),v=G-m,R=h*v-(M-p*m-h*m-p*v),_=b-R,c=b-_,He[0]=b-(_+c)+(c-R),y=E+_,c=y-E,d=E-(y-c)+(_-c),_=d-M,c=d-_,He[1]=d-(_+c)+(c-M),j=y+_,c=j-y,He[2]=y-(j-c)+(_-c),He[3]=j;const ie=po(4,pr,4,He,Ta);E=z*f,g=Ue*z,p=g-(g-z),h=z-p,g=Ue*f,m=g-(g-f),v=f-m,b=h*v-(E-p*m-h*m-p*v),M=F*u,g=Ue*F,p=g-(g-F),h=F-p,g=Ue*u,m=g-(g-u),v=u-m,R=h*v-(M-p*m-h*m-p*v),_=b-R,c=b-_,He[0]=b-(_+c)+(c-R),y=E+_,c=y-E,d=E-(y-c)+(_-c),_=d-M,c=d-_,He[1]=d-(_+c)+(c-M),j=y+_,c=j-y,He[2]=y-(j-c)+(_-c),He[3]=j;const X=po(ie,Ta,4,He,Da);E=l*f,g=Ue*l,p=g-(g-l),h=l-p,g=Ue*f,m=g-(g-f),v=f-m,b=h*v-(E-p*m-h*m-p*v),M=a*u,g=Ue*a,p=g-(g-a),h=a-p,g=Ue*u,m=g-(g-u),v=u-m,R=h*v-(M-p*m-h*m-p*v),_=b-R,c=b-_,He[0]=b-(_+c)+(c-R),y=E+_,c=y-E,d=E-(y-c)+(_-c),_=d-M,c=d-_,He[1]=d-(_+c)+(c-M),j=y+_,c=j-y,He[2]=y-(j-c)+(_-c),He[3]=j;const H=po(X,Da,4,He,ja);return ja[H-1]}function b_(r,e,t,n,i,o){const s=(e-o)*(t-i),l=(r-i)*(n-o),a=s-l,u=Math.abs(s+l);return Math.abs(a)>=d_*u?a:-__(r,e,t,n,i,o,u)}const Ur=(r,e)=>r.ll.x<=e.x&&e.x<=r.ur.x&&r.ll.y<=e.y&&e.y<=r.ur.y,Qo=(r,e)=>{if(e.ur.x<r.ll.x||r.ur.x<e.ll.x||e.ur.y<r.ll.y||r.ur.y<e.ll.y)return null;const t=r.ll.x<e.ll.x?e.ll.x:r.ll.x,n=r.ur.x<e.ur.x?r.ur.x:e.ur.x,i=r.ll.y<e.ll.y?e.ll.y:r.ll.y,o=r.ur.y<e.ur.y?r.ur.y:e.ur.y;return{ll:{x:t,y:i},ur:{x:n,y:o}}};let qt=Number.EPSILON;qt===void 0&&(qt=Math.pow(2,-52));const w_=qt*qt,Ga=(r,e)=>{if(-qt<r&&r<qt&&-qt<e&&e<qt)return 0;const t=r-e;return t*t<w_*r*e?0:r<e?-1:1};class $_{constructor(){this.reset()}reset(){this.xRounder=new Ua,this.yRounder=new Ua}round(e,t){return{x:this.xRounder.round(e),y:this.yRounder.round(t)}}}class Ua{constructor(){this.tree=new Is,this.round(0)}round(e){const t=this.tree.add(e),n=this.tree.prev(t);if(n!==null&&Ga(t.key,n.key)===0)return this.tree.remove(e),n.key;const i=this.tree.next(t);return i!==null&&Ga(t.key,i.key)===0?(this.tree.remove(e),i.key):e}}const cn=new $_,Kn=(r,e)=>r.x*e.y-r.y*e.x,bc=(r,e)=>r.x*e.x+r.y*e.y,qa=(r,e,t)=>{const n=b_(r.x,r.y,e.x,e.y,t.x,t.y);return n>0?-1:n<0?1:0},Li=r=>Math.sqrt(bc(r,r)),S_=(r,e,t)=>{const n={x:e.x-r.x,y:e.y-r.y},i={x:t.x-r.x,y:t.y-r.y};return Kn(i,n)/Li(i)/Li(n)},k_=(r,e,t)=>{const n={x:e.x-r.x,y:e.y-r.y},i={x:t.x-r.x,y:t.y-r.y};return bc(i,n)/Li(i)/Li(n)},za=(r,e,t)=>e.y===0?null:{x:r.x+e.x/e.y*(t-r.y),y:t},Wa=(r,e,t)=>e.x===0?null:{x:t,y:r.y+e.y/e.x*(t-r.x)},E_=(r,e,t,n)=>{if(e.x===0)return Wa(t,n,r.x);if(n.x===0)return Wa(r,e,t.x);if(e.y===0)return za(t,n,r.y);if(n.y===0)return za(r,e,t.y);const i=Kn(e,n);if(i==0)return null;const o={x:t.x-r.x,y:t.y-r.y},s=Kn(o,e)/i,l=Kn(o,n)/i,a=r.x+l*e.x,u=t.x+s*n.x,f=r.y+l*e.y,c=t.y+s*n.y,g=(a+u)/2,p=(f+c)/2;return{x:g,y:p}};class at{static compare(e,t){const n=at.comparePoints(e.point,t.point);return n!==0?n:(e.point!==t.point&&e.link(t),e.isLeft!==t.isLeft?e.isLeft?1:-1:Ai.compare(e.segment,t.segment))}static comparePoints(e,t){return e.x<t.x?-1:e.x>t.x?1:e.y<t.y?-1:e.y>t.y?1:0}constructor(e,t){e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}link(e){if(e.point===this.point)throw new Error("Tried to link already linked events");const t=e.point.events;for(let n=0,i=t.length;n<i;n++){const o=t[n];this.point.events.push(o),o.point=this.point}this.checkForConsuming()}checkForConsuming(){const e=this.point.events.length;for(let t=0;t<e;t++){const n=this.point.events[t];if(n.segment.consumedBy===void 0)for(let i=t+1;i<e;i++){const o=this.point.events[i];o.consumedBy===void 0&&n.otherSE.point.events===o.otherSE.point.events&&n.segment.consume(o.segment)}}}getAvailableLinkedEvents(){const e=[];for(let t=0,n=this.point.events.length;t<n;t++){const i=this.point.events[t];i!==this&&!i.segment.ringOut&&i.segment.isInResult()&&e.push(i)}return e}getLeftmostComparator(e){const t=new Map,n=i=>{const o=i.otherSE;t.set(i,{sine:S_(this.point,e.point,o.point),cosine:k_(this.point,e.point,o.point)})};return(i,o)=>{t.has(i)||n(i),t.has(o)||n(o);const{sine:s,cosine:l}=t.get(i),{sine:a,cosine:u}=t.get(o);return s>=0&&a>=0?l<u?1:l>u?-1:0:s<0&&a<0?l<u?-1:l>u?1:0:a<s?-1:a>s?1:0}}}let M_=0,Ai=class Zn{static compare(e,t){const n=e.leftSE.point.x,i=t.leftSE.point.x,o=e.rightSE.point.x,s=t.rightSE.point.x;if(s<n)return 1;if(o<i)return-1;const l=e.leftSE.point.y,a=t.leftSE.point.y,u=e.rightSE.point.y,f=t.rightSE.point.y;if(n<i){if(a<l&&a<u)return 1;if(a>l&&a>u)return-1;const c=e.comparePoint(t.leftSE.point);if(c<0)return 1;if(c>0)return-1;const g=t.comparePoint(e.rightSE.point);return g!==0?g:-1}if(n>i){if(l<a&&l<f)return-1;if(l>a&&l>f)return 1;const c=t.comparePoint(e.leftSE.point);if(c!==0)return c;const g=e.comparePoint(t.rightSE.point);return g<0?1:g>0?-1:1}if(l<a)return-1;if(l>a)return 1;if(o<s){const c=t.comparePoint(e.rightSE.point);if(c!==0)return c}if(o>s){const c=e.comparePoint(t.rightSE.point);if(c<0)return 1;if(c>0)return-1}if(o!==s){const c=u-l,g=o-n,p=f-a,h=s-i;if(c>g&&p<h)return 1;if(c<g&&p>h)return-1}return o>s?1:o<s||u<f?-1:u>f?1:e.id<t.id?-1:e.id>t.id?1:0}constructor(e,t,n,i){this.id=++M_,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=n,this.windings=i}static fromRing(e,t,n){let i,o,s;const l=at.comparePoints(e,t);if(l<0)i=e,o=t,s=1;else if(l>0)i=t,o=e,s=-1;else throw new Error(`Tried to create degenerate segment at [${e.x}, ${e.y}]`);const a=new at(i,!0),u=new at(o,!1);return new Zn(a,u,[n],[s])}replaceRightSE(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const e=this.leftSE.point.y,t=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e<t?e:t},ur:{x:this.rightSE.point.x,y:e>t?e:t}}}vector(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}isAnEndpoint(e){return e.x===this.leftSE.point.x&&e.y===this.leftSE.point.y||e.x===this.rightSE.point.x&&e.y===this.rightSE.point.y}comparePoint(e){if(this.isAnEndpoint(e))return 0;const t=this.leftSE.point,n=this.rightSE.point,i=this.vector();if(t.x===n.x)return e.x===t.x?0:e.x<t.x?1:-1;const o=(e.y-t.y)/i.y,s=t.x+o*i.x;if(e.x===s)return 0;const l=(e.x-t.x)/i.x,a=t.y+l*i.y;return e.y===a?0:e.y<a?-1:1}getIntersection(e){const t=this.bbox(),n=e.bbox(),i=Qo(t,n);if(i===null)return null;const o=this.leftSE.point,s=this.rightSE.point,l=e.leftSE.point,a=e.rightSE.point,u=Ur(t,l)&&this.comparePoint(l)===0,f=Ur(n,o)&&e.comparePoint(o)===0,c=Ur(t,a)&&this.comparePoint(a)===0,g=Ur(n,s)&&e.comparePoint(s)===0;if(f&&u)return g&&!c?s:!g&&c?a:null;if(f)return c&&o.x===a.x&&o.y===a.y?null:o;if(u)return g&&s.x===l.x&&s.y===l.y?null:l;if(g&&c)return null;if(g)return s;if(c)return a;const p=E_(o,this.vector(),l,e.vector());return p===null||!Ur(i,p)?null:cn.round(p.x,p.y)}split(e){const t=[],n=e.events!==void 0,i=new at(e,!0),o=new at(e,!1),s=this.rightSE;this.replaceRightSE(o),t.push(o),t.push(i);const l=new Zn(i,s,this.rings.slice(),this.windings.slice());return at.comparePoints(l.leftSE.point,l.rightSE.point)>0&&l.swapEvents(),at.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),n&&(i.checkForConsuming(),o.checkForConsuming()),t}swapEvents(){const e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let t=0,n=this.windings.length;t<n;t++)this.windings[t]*=-1}consume(e){let t=this,n=e;for(;t.consumedBy;)t=t.consumedBy;for(;n.consumedBy;)n=n.consumedBy;const i=Zn.compare(t,n);if(i!==0){if(i>0){const o=t;t=n,n=o}if(t.prev===n){const o=t;t=n,n=o}for(let o=0,s=n.rings.length;o<s;o++){const l=n.rings[o],a=n.windings[o],u=t.rings.indexOf(l);u===-1?(t.rings.push(l),t.windings.push(a)):t.windings[u]+=a}n.rings=null,n.windings=null,n.consumedBy=t,n.leftSE.consumedBy=t.leftSE,n.rightSE.consumedBy=t.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const e=this.prev.consumedBy||this.prev;this._beforeState=e.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};const t=this._afterState.rings,n=this._afterState.windings,i=this._afterState.multiPolys;for(let l=0,a=this.rings.length;l<a;l++){const u=this.rings[l],f=this.windings[l],c=t.indexOf(u);c===-1?(t.push(u),n.push(f)):n[c]+=f}const o=[],s=[];for(let l=0,a=t.length;l<a;l++){if(n[l]===0)continue;const u=t[l],f=u.poly;if(s.indexOf(f)===-1)if(u.isExterior)o.push(f);else{s.indexOf(f)===-1&&s.push(f);const c=o.indexOf(u.poly);c!==-1&&o.splice(c,1)}}for(let l=0,a=o.length;l<a;l++){const u=o[l].multiPoly;i.indexOf(u)===-1&&i.push(u)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const e=this.beforeState().multiPolys,t=this.afterState().multiPolys;switch(mt.type){case"union":{const n=e.length===0,i=t.length===0;this._isInResult=n!==i;break}case"intersection":{let n,i;e.length<t.length?(n=e.length,i=t.length):(n=t.length,i=e.length),this._isInResult=i===mt.numMultiPolys&&n<i;break}case"xor":{const n=Math.abs(e.length-t.length);this._isInResult=n%2===1;break}case"difference":{const n=i=>i.length===1&&i[0].isSubject;this._isInResult=n(e)!==n(t);break}default:throw new Error(`Unrecognized operation type found ${mt.type}`)}return this._isInResult}};class Ha{constructor(e,t,n){if(!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=n,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const i=cn.round(e[0][0],e[0][1]);this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};let o=i;for(let s=1,l=e.length;s<l;s++){if(typeof e[s][0]!="number"||typeof e[s][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let a=cn.round(e[s][0],e[s][1]);a.x===o.x&&a.y===o.y||(this.segments.push(Ai.fromRing(o,a,this)),a.x<this.bbox.ll.x&&(this.bbox.ll.x=a.x),a.y<this.bbox.ll.y&&(this.bbox.ll.y=a.y),a.x>this.bbox.ur.x&&(this.bbox.ur.x=a.x),a.y>this.bbox.ur.y&&(this.bbox.ur.y=a.y),o=a)}(i.x!==o.x||i.y!==o.y)&&this.segments.push(Ai.fromRing(o,i,this))}getSweepEvents(){const e=[];for(let t=0,n=this.segments.length;t<n;t++){const i=this.segments[t];e.push(i.leftSE),e.push(i.rightSE)}return e}}class P_{constructor(e,t){if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new Ha(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let n=1,i=e.length;n<i;n++){const o=new Ha(e[n],this,!1);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.interiorRings.push(o)}this.multiPoly=t}getSweepEvents(){const e=this.exteriorRing.getSweepEvents();for(let t=0,n=this.interiorRings.length;t<n;t++){const i=this.interiorRings[t].getSweepEvents();for(let o=0,s=i.length;o<s;o++)e.push(i[o])}return e}}class Ja{constructor(e,t){if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(let n=0,i=e.length;n<i;n++){const o=new P_(e[n],this);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.polys.push(o)}this.isSubject=t}getSweepEvents(){const e=[];for(let t=0,n=this.polys.length;t<n;t++){const i=this.polys[t].getSweepEvents();for(let o=0,s=i.length;o<s;o++)e.push(i[o])}return e}}class Ci{static factory(e){const t=[];for(let n=0,i=e.length;n<i;n++){const o=e[n];if(!o.isInResult()||o.ringOut)continue;let s=null,l=o.leftSE,a=o.rightSE;const u=[l],f=l.point,c=[];for(;s=l,l=a,u.push(l),l.point!==f;)for(;;){const g=l.getAvailableLinkedEvents();if(g.length===0){const m=u[0].point,v=u[u.length-1].point;throw new Error(`Unable to complete output ring starting at [${m.x}, ${m.y}]. Last matching segment found ends at [${v.x}, ${v.y}].`)}if(g.length===1){a=g[0].otherSE;break}let p=null;for(let m=0,v=c.length;m<v;m++)if(c[m].point===l.point){p=m;break}if(p!==null){const m=c.splice(p)[0],v=u.splice(m.index);v.unshift(v[0].otherSE),t.push(new Ci(v.reverse()));continue}c.push({index:u.length,point:l.point});const h=l.getLeftmostComparator(s);a=g.sort(h)[0].otherSE;break}t.push(new Ci(u))}return t}constructor(e){this.events=e;for(let t=0,n=e.length;t<n;t++)e[t].segment.ringOut=this;this.poly=null}getGeom(){let e=this.events[0].point;const t=[e];for(let u=1,f=this.events.length-1;u<f;u++){const c=this.events[u].point,g=this.events[u+1].point;qa(c,e,g)!==0&&(t.push(c),e=c)}if(t.length===1)return null;const n=t[0],i=t[1];qa(n,e,i)===0&&t.shift(),t.push(t[0]);const o=this.isExteriorRing()?1:-1,s=this.isExteriorRing()?0:t.length-1,l=this.isExteriorRing()?t.length:-1,a=[];for(let u=s;u!=l;u+=o)a.push([t[u].x,t[u].y]);return a}isExteriorRing(){if(this._isExteriorRing===void 0){const e=this.enclosingRing();this._isExteriorRing=e?!e.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let e=this.events[0];for(let i=1,o=this.events.length;i<o;i++){const s=this.events[i];at.compare(e,s)>0&&(e=s)}let t=e.segment.prevInResult(),n=t?t.prevInResult():null;for(;;){if(!t)return null;if(!n)return t.ringOut;if(n.ringOut!==t.ringOut)return n.ringOut.enclosingRing()!==t.ringOut?t.ringOut:t.ringOut.enclosingRing();t=n.prevInResult(),n=t?t.prevInResult():null}}}class Va{constructor(e){this.exteriorRing=e,e.poly=this,this.interiorRings=[]}addInterior(e){this.interiorRings.push(e),e.poly=this}getGeom(){const e=[this.exteriorRing.getGeom()];if(e[0]===null)return null;for(let t=0,n=this.interiorRings.length;t<n;t++){const i=this.interiorRings[t].getGeom();i!==null&&e.push(i)}return e}}class L_{constructor(e){this.rings=e,this.polys=this._composePolys(e)}getGeom(){const e=[];for(let t=0,n=this.polys.length;t<n;t++){const i=this.polys[t].getGeom();i!==null&&e.push(i)}return e}_composePolys(e){const t=[];for(let n=0,i=e.length;n<i;n++){const o=e[n];if(!o.poly)if(o.isExteriorRing())t.push(new Va(o));else{const s=o.enclosingRing();s.poly||t.push(new Va(s)),s.poly.addInterior(o)}}return t}}class A_{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Ai.compare;this.queue=e,this.tree=new Is(t),this.segments=[]}process(e){const t=e.segment,n=[];if(e.consumedBy)return e.isLeft?this.queue.remove(e.otherSE):this.tree.remove(t),n;const i=e.isLeft?this.tree.add(t):this.tree.find(t);if(!i)throw new Error(`Unable to find segment #${t.id} [${t.leftSE.point.x}, ${t.leftSE.point.y}] -> [${t.rightSE.point.x}, ${t.rightSE.point.y}] in SweepLine tree.`);let o=i,s=i,l,a;for(;l===void 0;)o=this.tree.prev(o),o===null?l=null:o.key.consumedBy===void 0&&(l=o.key);for(;a===void 0;)s=this.tree.next(s),s===null?a=null:s.key.consumedBy===void 0&&(a=s.key);if(e.isLeft){let u=null;if(l){const c=l.getIntersection(t);if(c!==null&&(t.isAnEndpoint(c)||(u=c),!l.isAnEndpoint(c))){const g=this._splitSafely(l,c);for(let p=0,h=g.length;p<h;p++)n.push(g[p])}}let f=null;if(a){const c=a.getIntersection(t);if(c!==null&&(t.isAnEndpoint(c)||(f=c),!a.isAnEndpoint(c))){const g=this._splitSafely(a,c);for(let p=0,h=g.length;p<h;p++)n.push(g[p])}}if(u!==null||f!==null){let c=null;u===null?c=f:f===null?c=u:c=at.comparePoints(u,f)<=0?u:f,this.queue.remove(t.rightSE),n.push(t.rightSE);const g=t.split(c);for(let p=0,h=g.length;p<h;p++)n.push(g[p])}n.length>0?(this.tree.remove(t),n.push(e)):(this.segments.push(t),t.prev=l)}else{if(l&&a){const u=l.getIntersection(a);if(u!==null){if(!l.isAnEndpoint(u)){const f=this._splitSafely(l,u);for(let c=0,g=f.length;c<g;c++)n.push(f[c])}if(!a.isAnEndpoint(u)){const f=this._splitSafely(a,u);for(let c=0,g=f.length;c<g;c++)n.push(f[c])}}}this.tree.remove(t)}return n}_splitSafely(e,t){this.tree.remove(e);const n=e.rightSE;this.queue.remove(n);const i=e.split(t);return i.push(n),e.consumedBy===void 0&&this.tree.add(e),i}}const Ya=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,C_=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6;class F_{run(e,t,n){mt.type=e,cn.reset();const i=[new Ja(t,!0)];for(let c=0,g=n.length;c<g;c++)i.push(new Ja(n[c],!1));if(mt.numMultiPolys=i.length,mt.type==="difference"){const c=i[0];let g=1;for(;g<i.length;)Qo(i[g].bbox,c.bbox)!==null?g++:i.splice(g,1)}if(mt.type==="intersection")for(let c=0,g=i.length;c<g;c++){const p=i[c];for(let h=c+1,m=i.length;h<m;h++)if(Qo(p.bbox,i[h].bbox)===null)return[]}const o=new Is(at.compare);for(let c=0,g=i.length;c<g;c++){const p=i[c].getSweepEvents();for(let h=0,m=p.length;h<m;h++)if(o.insert(p[h]),o.size>Ya)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big).")}const s=new A_(o);let l=o.size,a=o.pop();for(;a;){const c=a.key;if(o.size===l){const p=c.segment;throw new Error(`Unable to pop() ${c.isLeft?"left":"right"} SweepEvent [${c.point.x}, ${c.point.y}] from segment #${p.id} [${p.leftSE.point.x}, ${p.leftSE.point.y}] -> [${p.rightSE.point.x}, ${p.rightSE.point.y}] from queue.`)}if(o.size>Ya)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big).");if(s.segments.length>C_)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments).");const g=s.process(c);for(let p=0,h=g.length;p<h;p++){const m=g[p];m.consumedBy===void 0&&o.insert(m)}l=o.size,a=o.pop()}cn.reset();const u=Ci.factory(s.segments);return new L_(u).getGeom()}}const mt=new F_,O_=function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return mt.run("union",r,t)},R_=function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return mt.run("intersection",r,t)},I_=function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return mt.run("xor",r,t)},B_=function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return mt.run("difference",r,t)};var Qn={union:O_,intersection:R_,xor:I_,difference:B_},N_=Object.defineProperty,Ui=(r,e)=>N_(r,"name",{value:e,configurable:!0});function wc(r,e){var t=Sc(e),n=null;return r.type==="FeatureCollection"?n=$c(r):n=Bs(Qn.union(r.geometry.coordinates)),n.geometry.coordinates.forEach(function(i){t.geometry.coordinates.push(i[0])}),t}Ui(wc,"mask");function $c(r){var e=r.features.length===2?Qn.union(r.features[0].geometry.coordinates,r.features[1].geometry.coordinates):Qn.union.apply(Qn,r.features.map(function(t){return t.geometry.coordinates}));return Bs(e)}Ui($c,"unionFc");function Bs(r){return Fs(r)}Ui(Bs,"createGeomFromPolygonClippingOutput");function Sc(r){var e=[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]],t=r&&r.geometry.coordinates||e;return ji(t)}Ui(Sc,"createMask");var Xa=wc;function le(r,e){return{id:e,beforeId:T_(r,e)}}function T_(r,e){let t=uf(ot);if(!t){console.warn(`getBeforeId(${e}) called before map is ready. Z-ordering may be incorrect.`);return}let n,i=!1;for(let o=r.layerZorder.length-1;o>=0;o--){let s=r.layerZorder[o];if(s==e){i=!0;break}t.getLayer(s)&&(n=s)}if(!i)throw new Error(`Layer ID ${e} not defined in layerZorder`);return n}function kc(r,e,t){if(r!==null)for(var n,i,o,s,l,a,u,f=0,c=0,g,p=r.type,h=p==="FeatureCollection",m=p==="Feature",v=h?r.features.length:1,_=0;_<v;_++){u=h?r.features[_].geometry:m?r.geometry:r,g=u?u.type==="GeometryCollection":!1,l=g?u.geometries.length:1;for(var y=0;y<l;y++){var d=0,E=0;if(s=g?u.geometries[y]:u,s!==null){a=s.coordinates;var b=s.type;switch(f=t&&(b==="Polygon"||b==="MultiPolygon")?1:0,b){case null:break;case"Point":if(e(a,c,_,d,E)===!1)return!1;c++,d++;break;case"LineString":case"MultiPoint":for(n=0;n<a.length;n++){if(e(a[n],c,_,d,E)===!1)return!1;c++,b==="MultiPoint"&&d++}b==="LineString"&&d++;break;case"Polygon":case"MultiLineString":for(n=0;n<a.length;n++){for(i=0;i<a[n].length-f;i++){if(e(a[n][i],c,_,d,E)===!1)return!1;c++}b==="MultiLineString"&&d++,b==="Polygon"&&E++}b==="Polygon"&&d++;break;case"MultiPolygon":for(n=0;n<a.length;n++){for(E=0,i=0;i<a[n].length;i++){for(o=0;o<a[n][i].length-f;o++){if(e(a[n][i][o],c,_,d,E)===!1)return!1;c++}E++}d++}break;case"GeometryCollection":for(n=0;n<s.geometries.length;n++)if(kc(s.geometries[n],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function pn(r){var e=[1/0,1/0,-1/0,-1/0];return kc(r,function(t){e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])}),e}pn.default=pn;const D_=Object.freeze(Object.defineProperty({__proto__:null,default:pn},Symbol.toStringTag,{value:"Module"})),xt=["==",["geometry-type"],"Polygon"],gn=["==",["geometry-type"],"LineString"],hn=["==",["geometry-type"],"Point"];function Pr(){return{type:"FeatureCollection",features:[]}}function Vr(r,e,t){let n=["match",r];for(let[i,o]of Object.entries(e))n.push(i),n.push(o);return n.push(t),n}function Ec(r){return pn(r)}function j_(r){var t,n;let e={type:"FeatureCollection",features:[]};for(let i of r.features)if(e.features.push(i),i.geometry.type=="LineString"&&!((t=i.properties)!=null&&t.hide_while_editing))for(let o of[i.geometry.coordinates[0],i.geometry.coordinates[i.geometry.coordinates.length-1]])e.features.push({type:"Feature",properties:{endpoint:!0,scheme_reference:(n=i.properties)==null?void 0:n.scheme_reference},geometry:{type:"Point",coordinates:o}});return e}function G_(r){let e,t;const n=[le(r[0],"boundary"),{paint:{"fill-color":"black","fill-opacity":.5}}];let i={};for(let o=0;o<n.length;o+=1)i=de(i,n[o]);return e=new bn({props:i}),{c(){L(e.$$.fragment)},m(o,s){A(e,o,s),t=!0},p(o,s){const l=s&1?$e(n,[De(le(o[0],"boundary")),n[1]]):{};e.$set(l)},i(o){t||(S(e.$$.fragment,o),t=!0)},o(o){k(e.$$.fragment,o),t=!1},d(o){C(e,o)}}}function U_(r){let e,t;return e=new ir({props:{data:Xa(r[1]),$$slots:{default:[G_]},$$scope:{ctx:r}}}),{c(){L(e.$$.fragment)},m(n,i){A(e,n,i),t=!0},p(n,[i]){const o={};i&2&&(o.data=Xa(n[1])),i&17&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(S(e.$$.fragment,n),t=!0)},o(n){k(e.$$.fragment,n),t=!1},d(n){C(e,n)}}}function q_(r,e,t){let n;V(r,ot,l=>t(3,n=l));let{cfg:i}=e,{boundaryGeojson:o}=e,{fitBoundsAtStart:s=!1}=e;return(Dp("setCamera")||s)&&(n==null||n.fitBounds(Ec(o),{padding:20,animate:!1})),r.$$set=l=>{"cfg"in l&&t(0,i=l.cfg),"boundaryGeojson"in l&&t(1,o=l.boundaryGeojson),"fitBoundsAtStart"in l&&t(2,s=l.fitBoundsAtStart)},[i,o,s]}class z_ extends Z{constructor(e){super(),Q(this,e,q_,U_,K,{cfg:0,boundaryGeojson:1,fitBoundsAtStart:2})}}class W_{constructor(e){ae(this,"map");ae(this,"active");ae(this,"eventListenersSuccess");ae(this,"eventListenersFailure");ae(this,"cursor");ae(this,"onMouseMove",e=>{this.active&&(this.cursor={type:"Feature",properties:{},geometry:{type:"Point",coordinates:Qc(e.lngLat.toArray())}})});ae(this,"onClick",()=>{if(this.active&&this.cursor){for(let e of this.eventListenersSuccess)e(this.cursor);this.stop()}});ae(this,"onKeyDown",e=>{this.active&&e.key=="Escape"&&(e.stopPropagation(),this.cancel())});this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersFailure=[],this.cursor=null,this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),document.addEventListener("keydown",this.onKeyDown)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),document.removeEventListener("keydown",this.onKeyDown)}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersFailure=[]}start(){this.map.getCanvas().style.cursor="crosshair",this.active=!0}stop(){this.map.getCanvas().style.cursor="inherit",this.cursor=null,this.active=!1}}var Ke=63710088e-1,Mc={centimeters:Ke*100,centimetres:Ke*100,degrees:Ke/111325,feet:Ke*3.28084,inches:Ke*39.37,kilometers:Ke/1e3,kilometres:Ke/1e3,meters:Ke,metres:Ke,miles:Ke/1609.344,millimeters:Ke*1e3,millimetres:Ke*1e3,nauticalmiles:Ke/1852,radians:1,yards:Ke*1.0936};function Lr(r,e,t){t===void 0&&(t={});var n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=r,n}function en(r,e,t){if(t===void 0&&(t={}),!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Qa(r[0])||!Qa(r[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:r};return Lr(n,e,t)}function Ka(r,e,t){if(t===void 0&&(t={}),r.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:r};return Lr(n,e,t)}function Za(r,e){e===void 0&&(e={});var t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=r,t}function H_(r,e){e===void 0&&(e="kilometers");var t=Mc[e];if(!t)throw new Error(e+" units is invalid");return r*t}function J_(r,e){e===void 0&&(e="kilometers");var t=Mc[e];if(!t)throw new Error(e+" units is invalid");return r/t}function xo(r){var e=r%(2*Math.PI);return e*180/Math.PI}function dt(r){var e=r%360;return e*Math.PI/180}function Qa(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}function mn(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return r.geometry.coordinates;if(r.type==="Point")return r.coordinates}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return r;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Fi(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Pc(r,e,t){if(t===void 0&&(t={}),t.final===!0)return V_(r,e);var n=mn(r),i=mn(e),o=dt(n[0]),s=dt(i[0]),l=dt(n[1]),a=dt(i[1]),u=Math.sin(s-o)*Math.cos(a),f=Math.cos(l)*Math.sin(a)-Math.sin(l)*Math.cos(a)*Math.cos(s-o);return xo(Math.atan2(u,f))}function V_(r,e){var t=Pc(e,r);return t=(t+180)%360,t}function qr(r,e,t){t===void 0&&(t={});var n=mn(r),i=mn(e),o=dt(i[1]-n[1]),s=dt(i[0]-n[0]),l=dt(n[1]),a=dt(i[1]),u=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(l)*Math.cos(a);return H_(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)),t.units)}function xa(r,e,t,n){n===void 0&&(n={});var i=mn(r),o=dt(i[0]),s=dt(i[1]),l=dt(t),a=J_(e,n.units),u=Math.asin(Math.sin(s)*Math.cos(a)+Math.cos(s)*Math.sin(a)*Math.cos(l)),f=o+Math.atan2(Math.sin(l)*Math.sin(a)*Math.cos(s),Math.cos(a)-Math.sin(s)*Math.sin(u)),c=xo(f),g=xo(u);return en([c,g],n.properties)}function es(r,e,t){t===void 0&&(t={});var n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=r,n}function Y_(r,e,t){if(t===void 0&&(t={}),r.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:r};return es(n,e,t)}function X_(r,e){e===void 0&&(e={});var t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=r,t}function eu(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function K_(r,e){var t,n,i,o,s,l,a,u,f,c,g=0,p=r.type==="FeatureCollection",h=r.type==="Feature",m=p?r.features.length:1;for(t=0;t<m;t++){for(l=p?r.features[t].geometry:h?r.geometry:r,u=p?r.features[t].properties:h?r.properties:{},f=p?r.features[t].bbox:h?r.bbox:void 0,c=p?r.features[t].id:h?r.id:void 0,a=l?l.type==="GeometryCollection":!1,s=a?l.geometries.length:1,i=0;i<s;i++){if(o=a?l.geometries[i]:l,o===null){if(e(null,g,u,f,c)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(o,g,u,f,c)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<o.geometries.length;n++)if(e(o.geometries[n],g,u,f,c)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}g++}}function Z_(r,e){K_(r,function(t,n,i,o,s){var l=t===null?null:t.type;switch(l){case null:case"Point":case"LineString":case"Polygon":return e(es(t,i,{bbox:o,id:s}),n,0)===!1?!1:void 0}var a;switch(l){case"MultiPoint":a="Point";break;case"MultiLineString":a="LineString";break;case"MultiPolygon":a="Polygon";break}for(var u=0;u<t.coordinates.length;u++){var f=t.coordinates[u],c={type:a,coordinates:f};if(e(es(c,i),n,u)===!1)return!1}})}function or(r){if(!r)throw new Error("geojson is required");var e=[];return Z_(r,function(t){Q_(t,e)}),X_(e)}function Q_(r,e){var t=[],n=r.geometry;if(n!==null){switch(n.type){case"Polygon":t=eu(n);break;case"LineString":t=[eu(n)]}t.forEach(function(i){var o=x_(i,r.properties);o.forEach(function(s){s.id=e.length,e.push(s)})})}}function x_(r,e){var t=[];return r.reduce(function(n,i){var o=Y_([n,i],e);return o.bbox=e0(n,i),t.push(o),i}),t}function e0(r,e){var t=r[0],n=r[1],i=e[0],o=e[1],s=t<i?t:i,l=n<o?n:o,a=t>i?t:i,u=n>o?n:o;return[s,l,a,u]}function tu(r,e){if(r.type==="Feature")e(r,0);else if(r.type==="FeatureCollection")for(var t=0;t<r.features.length&&e(r.features[t],t)!==!1;t++);}function t0(r,e){var t,n,i,o,s,l,a,u,f,c,g=0,p=r.type==="FeatureCollection",h=r.type==="Feature",m=p?r.features.length:1;for(t=0;t<m;t++){for(l=p?r.features[t].geometry:h?r.geometry:r,u=p?r.features[t].properties:h?r.properties:{},f=p?r.features[t].bbox:h?r.bbox:void 0,c=p?r.features[t].id:h?r.id:void 0,a=l?l.type==="GeometryCollection":!1,s=a?l.geometries.length:1,i=0;i<s;i++){if(o=a?l.geometries[i]:l,o===null){if(e(null,g,u,f,c)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(o,g,u,f,c)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<o.geometries.length;n++)if(e(o.geometries[n],g,u,f,c)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}g++}}function r0(r,e){t0(r,function(t,n,i,o,s){var l=t===null?null:t.type;switch(l){case null:case"Point":case"LineString":case"Polygon":return e(Lr(t,i,{bbox:o,id:s}),n,0)===!1?!1:void 0}var a;switch(l){case"MultiPoint":a="Point";break;case"MultiLineString":a="LineString";break;case"MultiPolygon":a="Polygon";break}for(var u=0;u<t.coordinates.length;u++){var f=t.coordinates[u],c={type:a,coordinates:f};if(e(Lr(c,i),n,u)===!1)return!1}})}var Ns={exports:{}},Lc={exports:{}};(function(r,e){(function(t,n){r.exports=n()})(an,function(){function t(y,d,E,b,M){(function R(j,z,G,F,P){for(;F>G;){if(F-G>600){var I=F-G+1,q=z-G+1,ie=Math.log(I),X=.5*Math.exp(2*ie/3),H=.5*Math.sqrt(ie*X*(I-X)/I)*(q-I/2<0?-1:1),T=Math.max(G,Math.floor(z-q*X/I+H)),te=Math.min(F,Math.floor(z+(I-q)*X/I+H));R(j,z,T,te,P)}var ce=j[z],We=G,Pe=F;for(n(j,G,z),P(j[F],ce)>0&&n(j,G,F);We<Pe;){for(n(j,We,Pe),We++,Pe--;P(j[We],ce)<0;)We++;for(;P(j[Pe],ce)>0;)Pe--}P(j[G],ce)===0?n(j,G,Pe):n(j,++Pe,F),Pe<=z&&(G=Pe+1),z<=Pe&&(F=Pe-1)}})(y,d,E||0,b||y.length-1,M||i)}function n(y,d,E){var b=y[d];y[d]=y[E],y[E]=b}function i(y,d){return y<d?-1:y>d?1:0}var o=function(y){y===void 0&&(y=9),this._maxEntries=Math.max(4,y),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function s(y,d,E){if(!E)return d.indexOf(y);for(var b=0;b<d.length;b++)if(E(y,d[b]))return b;return-1}function l(y,d){a(y,0,y.children.length,d,y)}function a(y,d,E,b,M){M||(M=v(null)),M.minX=1/0,M.minY=1/0,M.maxX=-1/0,M.maxY=-1/0;for(var R=d;R<E;R++){var j=y.children[R];u(M,y.leaf?b(j):j)}return M}function u(y,d){return y.minX=Math.min(y.minX,d.minX),y.minY=Math.min(y.minY,d.minY),y.maxX=Math.max(y.maxX,d.maxX),y.maxY=Math.max(y.maxY,d.maxY),y}function f(y,d){return y.minX-d.minX}function c(y,d){return y.minY-d.minY}function g(y){return(y.maxX-y.minX)*(y.maxY-y.minY)}function p(y){return y.maxX-y.minX+(y.maxY-y.minY)}function h(y,d){return y.minX<=d.minX&&y.minY<=d.minY&&d.maxX<=y.maxX&&d.maxY<=y.maxY}function m(y,d){return d.minX<=y.maxX&&d.minY<=y.maxY&&d.maxX>=y.minX&&d.maxY>=y.minY}function v(y){return{children:y,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function _(y,d,E,b,M){for(var R=[d,E];R.length;)if(!((E=R.pop())-(d=R.pop())<=b)){var j=d+Math.ceil((E-d)/b/2)*b;t(y,j,d,E,M),R.push(d,j,j,E)}}return o.prototype.all=function(){return this._all(this.data,[])},o.prototype.search=function(y){var d=this.data,E=[];if(!m(y,d))return E;for(var b=this.toBBox,M=[];d;){for(var R=0;R<d.children.length;R++){var j=d.children[R],z=d.leaf?b(j):j;m(y,z)&&(d.leaf?E.push(j):h(y,z)?this._all(j,E):M.push(j))}d=M.pop()}return E},o.prototype.collides=function(y){var d=this.data;if(!m(y,d))return!1;for(var E=[];d;){for(var b=0;b<d.children.length;b++){var M=d.children[b],R=d.leaf?this.toBBox(M):M;if(m(y,R)){if(d.leaf||h(y,R))return!0;E.push(M)}}d=E.pop()}return!1},o.prototype.load=function(y){if(!y||!y.length)return this;if(y.length<this._minEntries){for(var d=0;d<y.length;d++)this.insert(y[d]);return this}var E=this._build(y.slice(),0,y.length-1,0);if(this.data.children.length)if(this.data.height===E.height)this._splitRoot(this.data,E);else{if(this.data.height<E.height){var b=this.data;this.data=E,E=b}this._insert(E,this.data.height-E.height-1,!0)}else this.data=E;return this},o.prototype.insert=function(y){return y&&this._insert(y,this.data.height-1),this},o.prototype.clear=function(){return this.data=v([]),this},o.prototype.remove=function(y,d){if(!y)return this;for(var E,b,M,R=this.data,j=this.toBBox(y),z=[],G=[];R||z.length;){if(R||(R=z.pop(),b=z[z.length-1],E=G.pop(),M=!0),R.leaf){var F=s(y,R.children,d);if(F!==-1)return R.children.splice(F,1),z.push(R),this._condense(z),this}M||R.leaf||!h(R,j)?b?(E++,R=b.children[E],M=!1):R=null:(z.push(R),G.push(E),E=0,b=R,R=R.children[0])}return this},o.prototype.toBBox=function(y){return y},o.prototype.compareMinX=function(y,d){return y.minX-d.minX},o.prototype.compareMinY=function(y,d){return y.minY-d.minY},o.prototype.toJSON=function(){return this.data},o.prototype.fromJSON=function(y){return this.data=y,this},o.prototype._all=function(y,d){for(var E=[];y;)y.leaf?d.push.apply(d,y.children):E.push.apply(E,y.children),y=E.pop();return d},o.prototype._build=function(y,d,E,b){var M,R=E-d+1,j=this._maxEntries;if(R<=j)return l(M=v(y.slice(d,E+1)),this.toBBox),M;b||(b=Math.ceil(Math.log(R)/Math.log(j)),j=Math.ceil(R/Math.pow(j,b-1))),(M=v([])).leaf=!1,M.height=b;var z=Math.ceil(R/j),G=z*Math.ceil(Math.sqrt(j));_(y,d,E,G,this.compareMinX);for(var F=d;F<=E;F+=G){var P=Math.min(F+G-1,E);_(y,F,P,z,this.compareMinY);for(var I=F;I<=P;I+=z){var q=Math.min(I+z-1,P);M.children.push(this._build(y,I,q,b-1))}}return l(M,this.toBBox),M},o.prototype._chooseSubtree=function(y,d,E,b){for(;b.push(d),!d.leaf&&b.length-1!==E;){for(var M=1/0,R=1/0,j=void 0,z=0;z<d.children.length;z++){var G=d.children[z],F=g(G),P=(I=y,q=G,(Math.max(q.maxX,I.maxX)-Math.min(q.minX,I.minX))*(Math.max(q.maxY,I.maxY)-Math.min(q.minY,I.minY))-F);P<R?(R=P,M=F<M?F:M,j=G):P===R&&F<M&&(M=F,j=G)}d=j||d.children[0]}var I,q;return d},o.prototype._insert=function(y,d,E){var b=E?y:this.toBBox(y),M=[],R=this._chooseSubtree(b,this.data,d,M);for(R.children.push(y),u(R,b);d>=0&&M[d].children.length>this._maxEntries;)this._split(M,d),d--;this._adjustParentBBoxes(b,M,d)},o.prototype._split=function(y,d){var E=y[d],b=E.children.length,M=this._minEntries;this._chooseSplitAxis(E,M,b);var R=this._chooseSplitIndex(E,M,b),j=v(E.children.splice(R,E.children.length-R));j.height=E.height,j.leaf=E.leaf,l(E,this.toBBox),l(j,this.toBBox),d?y[d-1].children.push(j):this._splitRoot(E,j)},o.prototype._splitRoot=function(y,d){this.data=v([y,d]),this.data.height=y.height+1,this.data.leaf=!1,l(this.data,this.toBBox)},o.prototype._chooseSplitIndex=function(y,d,E){for(var b,M,R,j,z,G,F,P=1/0,I=1/0,q=d;q<=E-d;q++){var ie=a(y,0,q,this.toBBox),X=a(y,q,E,this.toBBox),H=(M=ie,R=X,j=void 0,z=void 0,G=void 0,F=void 0,j=Math.max(M.minX,R.minX),z=Math.max(M.minY,R.minY),G=Math.min(M.maxX,R.maxX),F=Math.min(M.maxY,R.maxY),Math.max(0,G-j)*Math.max(0,F-z)),T=g(ie)+g(X);H<P?(P=H,b=q,I=T<I?T:I):H===P&&T<I&&(I=T,b=q)}return b||E-d},o.prototype._chooseSplitAxis=function(y,d,E){var b=y.leaf?this.compareMinX:f,M=y.leaf?this.compareMinY:c;this._allDistMargin(y,d,E,b)<this._allDistMargin(y,d,E,M)&&y.children.sort(b)},o.prototype._allDistMargin=function(y,d,E,b){y.children.sort(b);for(var M=this.toBBox,R=a(y,0,d,M),j=a(y,E-d,E,M),z=p(R)+p(j),G=d;G<E-d;G++){var F=y.children[G];u(R,y.leaf?M(F):F),z+=p(R)}for(var P=E-d-1;P>=d;P--){var I=y.children[P];u(j,y.leaf?M(I):I),z+=p(j)}return z},o.prototype._adjustParentBBoxes=function(y,d,E){for(var b=E;b>=0;b--)u(d[b],y)},o.prototype._condense=function(y){for(var d=y.length-1,E=void 0;d>=0;d--)y[d].children.length===0?d>0?(E=y[d-1].children).splice(E.indexOf(y[d]),1):this.clear():l(y[d],this.toBBox)},o})})(Lc);var n0=Lc.exports,Ts={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.earthRadius=63710088e-1,r.factors={centimeters:r.earthRadius*100,centimetres:r.earthRadius*100,degrees:r.earthRadius/111325,feet:r.earthRadius*3.28084,inches:r.earthRadius*39.37,kilometers:r.earthRadius/1e3,kilometres:r.earthRadius/1e3,meters:r.earthRadius,metres:r.earthRadius,miles:r.earthRadius/1609.344,millimeters:r.earthRadius*1e3,millimetres:r.earthRadius*1e3,nauticalmiles:r.earthRadius/1852,radians:1,yards:r.earthRadius*1.0936},r.unitsFactors={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/r.earthRadius,yards:1.0936133},r.areaFactors={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function e(F,P,I){I===void 0&&(I={});var q={type:"Feature"};return(I.id===0||I.id)&&(q.id=I.id),I.bbox&&(q.bbox=I.bbox),q.properties=P||{},q.geometry=F,q}r.feature=e;function t(F,P,I){switch(F){case"Point":return n(P).geometry;case"LineString":return l(P).geometry;case"Polygon":return o(P).geometry;case"MultiPoint":return c(P).geometry;case"MultiLineString":return f(P).geometry;case"MultiPolygon":return g(P).geometry;default:throw new Error(F+" is invalid")}}r.geometry=t;function n(F,P,I){if(I===void 0&&(I={}),!F)throw new Error("coordinates is required");if(!Array.isArray(F))throw new Error("coordinates must be an Array");if(F.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!R(F[0])||!R(F[1]))throw new Error("coordinates must contain numbers");var q={type:"Point",coordinates:F};return e(q,P,I)}r.point=n;function i(F,P,I){return I===void 0&&(I={}),u(F.map(function(q){return n(q,P)}),I)}r.points=i;function o(F,P,I){I===void 0&&(I={});for(var q=0,ie=F;q<ie.length;q++){var X=ie[q];if(X.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var H=0;H<X[X.length-1].length;H++)if(X[X.length-1][H]!==X[0][H])throw new Error("First and last Position are not equivalent.")}var T={type:"Polygon",coordinates:F};return e(T,P,I)}r.polygon=o;function s(F,P,I){return I===void 0&&(I={}),u(F.map(function(q){return o(q,P)}),I)}r.polygons=s;function l(F,P,I){if(I===void 0&&(I={}),F.length<2)throw new Error("coordinates must be an array of two or more positions");var q={type:"LineString",coordinates:F};return e(q,P,I)}r.lineString=l;function a(F,P,I){return I===void 0&&(I={}),u(F.map(function(q){return l(q,P)}),I)}r.lineStrings=a;function u(F,P){P===void 0&&(P={});var I={type:"FeatureCollection"};return P.id&&(I.id=P.id),P.bbox&&(I.bbox=P.bbox),I.features=F,I}r.featureCollection=u;function f(F,P,I){I===void 0&&(I={});var q={type:"MultiLineString",coordinates:F};return e(q,P,I)}r.multiLineString=f;function c(F,P,I){I===void 0&&(I={});var q={type:"MultiPoint",coordinates:F};return e(q,P,I)}r.multiPoint=c;function g(F,P,I){I===void 0&&(I={});var q={type:"MultiPolygon",coordinates:F};return e(q,P,I)}r.multiPolygon=g;function p(F,P,I){I===void 0&&(I={});var q={type:"GeometryCollection",geometries:F};return e(q,P,I)}r.geometryCollection=p;function h(F,P){if(P===void 0&&(P=0),P&&!(P>=0))throw new Error("precision must be a positive number");var I=Math.pow(10,P||0);return Math.round(F*I)/I}r.round=h;function m(F,P){P===void 0&&(P="kilometers");var I=r.factors[P];if(!I)throw new Error(P+" units is invalid");return F*I}r.radiansToLength=m;function v(F,P){P===void 0&&(P="kilometers");var I=r.factors[P];if(!I)throw new Error(P+" units is invalid");return F/I}r.lengthToRadians=v;function _(F,P){return d(v(F,P))}r.lengthToDegrees=_;function y(F){var P=F%360;return P<0&&(P+=360),P}r.bearingToAzimuth=y;function d(F){var P=F%(2*Math.PI);return P*180/Math.PI}r.radiansToDegrees=d;function E(F){var P=F%360;return P*Math.PI/180}r.degreesToRadians=E;function b(F,P,I){if(P===void 0&&(P="kilometers"),I===void 0&&(I="kilometers"),!(F>=0))throw new Error("length must be a positive number");return m(v(F,P),I)}r.convertLength=b;function M(F,P,I){if(P===void 0&&(P="meters"),I===void 0&&(I="kilometers"),!(F>=0))throw new Error("area must be a positive number");var q=r.areaFactors[P];if(!q)throw new Error("invalid original units");var ie=r.areaFactors[I];if(!ie)throw new Error("invalid final units");return F/q*ie}r.convertArea=M;function R(F){return!isNaN(F)&&F!==null&&!Array.isArray(F)}r.isNumber=R;function j(F){return!!F&&F.constructor===Object}r.isObject=j;function z(F){if(!F)throw new Error("bbox is required");if(!Array.isArray(F))throw new Error("bbox must be an Array");if(F.length!==4&&F.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");F.forEach(function(P){if(!R(P))throw new Error("bbox must only contain numbers")})}r.validateBBox=z;function G(F){if(!F)throw new Error("id is required");if(["string","number"].indexOf(typeof F)===-1)throw new Error("id must be a number or a string")}r.validateId=G})(Ts);var Me={};Object.defineProperty(Me,"__esModule",{value:!0});var qe=Ts;function kn(r,e,t){if(r!==null)for(var n,i,o,s,l,a,u,f=0,c=0,g,p=r.type,h=p==="FeatureCollection",m=p==="Feature",v=h?r.features.length:1,_=0;_<v;_++){u=h?r.features[_].geometry:m?r.geometry:r,g=u?u.type==="GeometryCollection":!1,l=g?u.geometries.length:1;for(var y=0;y<l;y++){var d=0,E=0;if(s=g?u.geometries[y]:u,s!==null){a=s.coordinates;var b=s.type;switch(f=t&&(b==="Polygon"||b==="MultiPolygon")?1:0,b){case null:break;case"Point":if(e(a,c,_,d,E)===!1)return!1;c++,d++;break;case"LineString":case"MultiPoint":for(n=0;n<a.length;n++){if(e(a[n],c,_,d,E)===!1)return!1;c++,b==="MultiPoint"&&d++}b==="LineString"&&d++;break;case"Polygon":case"MultiLineString":for(n=0;n<a.length;n++){for(i=0;i<a[n].length-f;i++){if(e(a[n][i],c,_,d,E)===!1)return!1;c++}b==="MultiLineString"&&d++,b==="Polygon"&&E++}b==="Polygon"&&d++;break;case"MultiPolygon":for(n=0;n<a.length;n++){for(E=0,i=0;i<a[n].length;i++){for(o=0;o<a[n][i].length-f;o++){if(e(a[n][i][o],c,_,d,E)===!1)return!1;c++}E++}d++}break;case"GeometryCollection":for(n=0;n<s.geometries.length;n++)if(kn(s.geometries[n],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function i0(r,e,t,n){var i=t;return kn(r,function(o,s,l,a,u){s===0&&t===void 0?i=o:i=e(i,o,s,l,a,u)},n),i}function Ac(r,e){var t;switch(r.type){case"FeatureCollection":for(t=0;t<r.features.length&&e(r.features[t].properties,t)!==!1;t++);break;case"Feature":e(r.properties,0);break}}function o0(r,e,t){var n=t;return Ac(r,function(i,o){o===0&&t===void 0?n=i:n=e(n,i,o)}),n}function Cc(r,e){if(r.type==="Feature")e(r,0);else if(r.type==="FeatureCollection")for(var t=0;t<r.features.length&&e(r.features[t],t)!==!1;t++);}function s0(r,e,t){var n=t;return Cc(r,function(i,o){o===0&&t===void 0?n=i:n=e(n,i,o)}),n}function l0(r){var e=[];return kn(r,function(t){e.push(t)}),e}function Ds(r,e){var t,n,i,o,s,l,a,u,f,c,g=0,p=r.type==="FeatureCollection",h=r.type==="Feature",m=p?r.features.length:1;for(t=0;t<m;t++){for(l=p?r.features[t].geometry:h?r.geometry:r,u=p?r.features[t].properties:h?r.properties:{},f=p?r.features[t].bbox:h?r.bbox:void 0,c=p?r.features[t].id:h?r.id:void 0,a=l?l.type==="GeometryCollection":!1,s=a?l.geometries.length:1,i=0;i<s;i++){if(o=a?l.geometries[i]:l,o===null){if(e(null,g,u,f,c)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(o,g,u,f,c)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<o.geometries.length;n++)if(e(o.geometries[n],g,u,f,c)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}g++}}function a0(r,e,t){var n=t;return Ds(r,function(i,o,s,l,a){o===0&&t===void 0?n=i:n=e(n,i,o,s,l,a)}),n}function qi(r,e){Ds(r,function(t,n,i,o,s){var l=t===null?null:t.type;switch(l){case null:case"Point":case"LineString":case"Polygon":return e(qe.feature(t,i,{bbox:o,id:s}),n,0)===!1?!1:void 0}var a;switch(l){case"MultiPoint":a="Point";break;case"MultiLineString":a="LineString";break;case"MultiPolygon":a="Polygon";break}for(var u=0;u<t.coordinates.length;u++){var f=t.coordinates[u],c={type:a,coordinates:f};if(e(qe.feature(c,i),n,u)===!1)return!1}})}function u0(r,e,t){var n=t;return qi(r,function(i,o,s){o===0&&s===0&&t===void 0?n=i:n=e(n,i,o,s)}),n}function Fc(r,e){qi(r,function(t,n,i){var o=0;if(t.geometry){var s=t.geometry.type;if(!(s==="Point"||s==="MultiPoint")){var l,a=0,u=0,f=0;if(kn(t,function(c,g,p,h,m){if(l===void 0||n>a||h>u||m>f){l=c,a=n,u=h,f=m,o=0;return}var v=qe.lineString([l,c],t.properties);if(e(v,n,i,m,o)===!1)return!1;o++,l=c})===!1)return!1}}})}function f0(r,e,t){var n=t,i=!1;return Fc(r,function(o,s,l,a,u){i===!1&&t===void 0?n=o:n=e(n,o,s,l,a,u),i=!0}),n}function Oc(r,e){if(!r)throw new Error("geojson is required");qi(r,function(t,n,i){if(t.geometry!==null){var o=t.geometry.type,s=t.geometry.coordinates;switch(o){case"LineString":if(e(t,n,i,0,0)===!1)return!1;break;case"Polygon":for(var l=0;l<s.length;l++)if(e(qe.lineString(s[l],t.properties),n,i,l)===!1)return!1;break}}})}function c0(r,e,t){var n=t;return Oc(r,function(i,o,s,l){o===0&&t===void 0?n=i:n=e(n,i,o,s,l)}),n}function p0(r,e){if(e=e||{},!qe.isObject(e))throw new Error("options is invalid");var t=e.featureIndex||0,n=e.multiFeatureIndex||0,i=e.geometryIndex||0,o=e.segmentIndex||0,s=e.properties,l;switch(r.type){case"FeatureCollection":t<0&&(t=r.features.length+t),s=s||r.features[t].properties,l=r.features[t].geometry;break;case"Feature":s=s||r.properties,l=r.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":l=r;break;default:throw new Error("geojson is invalid")}if(l===null)return null;var a=l.coordinates;switch(l.type){case"Point":case"MultiPoint":return null;case"LineString":return o<0&&(o=a.length+o-1),qe.lineString([a[o],a[o+1]],s,e);case"Polygon":return i<0&&(i=a.length+i),o<0&&(o=a[i].length+o-1),qe.lineString([a[i][o],a[i][o+1]],s,e);case"MultiLineString":return n<0&&(n=a.length+n),o<0&&(o=a[n].length+o-1),qe.lineString([a[n][o],a[n][o+1]],s,e);case"MultiPolygon":return n<0&&(n=a.length+n),i<0&&(i=a[n].length+i),o<0&&(o=a[n][i].length-o-1),qe.lineString([a[n][i][o],a[n][i][o+1]],s,e)}throw new Error("geojson is invalid")}function g0(r,e){if(e=e||{},!qe.isObject(e))throw new Error("options is invalid");var t=e.featureIndex||0,n=e.multiFeatureIndex||0,i=e.geometryIndex||0,o=e.coordIndex||0,s=e.properties,l;switch(r.type){case"FeatureCollection":t<0&&(t=r.features.length+t),s=s||r.features[t].properties,l=r.features[t].geometry;break;case"Feature":s=s||r.properties,l=r.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":l=r;break;default:throw new Error("geojson is invalid")}if(l===null)return null;var a=l.coordinates;switch(l.type){case"Point":return qe.point(a,s,e);case"MultiPoint":return n<0&&(n=a.length+n),qe.point(a[n],s,e);case"LineString":return o<0&&(o=a.length+o),qe.point(a[o],s,e);case"Polygon":return i<0&&(i=a.length+i),o<0&&(o=a[i].length+o),qe.point(a[i][o],s,e);case"MultiLineString":return n<0&&(n=a.length+n),o<0&&(o=a[n].length+o),qe.point(a[n][o],s,e);case"MultiPolygon":return n<0&&(n=a.length+n),i<0&&(i=a[n].length+i),o<0&&(o=a[n][i].length-o),qe.point(a[n][i][o],s,e)}throw new Error("geojson is invalid")}Me.coordAll=l0;Me.coordEach=kn;Me.coordReduce=i0;Me.featureEach=Cc;Me.featureReduce=s0;Me.findPoint=g0;Me.findSegment=p0;Me.flattenEach=qi;Me.flattenReduce=u0;Me.geomEach=Ds;Me.geomReduce=a0;Me.lineEach=Oc;Me.lineReduce=c0;Me.propEach=Ac;Me.propReduce=o0;Me.segmentEach=Fc;Me.segmentReduce=f0;const h0=lf(D_);var wt=n0,Rc=Ts,Ic=Me,gr=h0.default,m0=Ic.featureEach;Ic.coordEach;Rc.polygon;var ru=Rc.featureCollection;function Bc(r){var e=new wt(r);return e.insert=function(t){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:gr(t),wt.prototype.insert.call(this,t)},e.load=function(t){var n=[];return Array.isArray(t)?t.forEach(function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:gr(i),n.push(i)}):m0(t,function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:gr(i),n.push(i)}),wt.prototype.load.call(this,n)},e.remove=function(t,n){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:gr(t),wt.prototype.remove.call(this,t,n)},e.clear=function(){return wt.prototype.clear.call(this)},e.search=function(t){var n=wt.prototype.search.call(this,this.toBBox(t));return ru(n)},e.collides=function(t){return wt.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=wt.prototype.all.call(this);return ru(t)},e.toJSON=function(){return wt.prototype.toJSON.call(this)},e.fromJSON=function(t){return wt.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var n;if(t.bbox)n=t.bbox;else if(Array.isArray(t)&&t.length===4)n=t;else if(Array.isArray(t)&&t.length===6)n=[t[0],t[1],t[3],t[4]];else if(t.type==="Feature")n=gr(t);else if(t.type==="FeatureCollection")n=gr(t);else throw new Error("invalid geojson");return{minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]}},e}Ns.exports=Bc;Ns.exports.default=Bc;var d0=Ns.exports;const En=af(d0);function y0(r,e){var t={},n=[];if(r.type==="LineString"&&(r=Lr(r)),e.type==="LineString"&&(e=Lr(e)),r.type==="Feature"&&e.type==="Feature"&&r.geometry!==null&&e.geometry!==null&&r.geometry.type==="LineString"&&e.geometry.type==="LineString"&&r.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var i=nu(r,e);return i&&n.push(i),Za(n)}var o=En();return o.load(or(e)),tu(or(r),function(s){tu(o.search(s),function(l){var a=nu(s,l);if(a){var u=Fi(a).join(",");t[u]||(t[u]=!0,n.push(a))}})}),Za(n)}function nu(r,e){var t=Fi(r),n=Fi(e);if(t.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(n.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var i=t[0][0],o=t[0][1],s=t[1][0],l=t[1][1],a=n[0][0],u=n[0][1],f=n[1][0],c=n[1][1],g=(c-u)*(s-i)-(f-a)*(l-o),p=(f-a)*(o-u)-(c-u)*(i-a),h=(s-i)*(o-u)-(l-o)*(i-a);if(g===0)return null;var m=p/g,v=h/g;if(m>=0&&m<=1&&v>=0&&v<=1){var _=i+m*(s-i),y=o+m*(l-o);return en([_,y])}return null}function v0(r,e,t){t===void 0&&(t={});var n=en([1/0,1/0],{dist:1/0}),i=0;return r0(r,function(o){for(var s=Fi(o),l=0;l<s.length-1;l++){var a=en(s[l]);a.properties.dist=qr(e,a,t);var u=en(s[l+1]);u.properties.dist=qr(e,u,t);var f=qr(a,u,t),c=Math.max(a.properties.dist,u.properties.dist),g=Pc(a,u),p=xa(e,c,g+90,t),h=xa(e,c,g-90,t),m=y0(Ka([p.geometry.coordinates,h.geometry.coordinates]),Ka([a.geometry.coordinates,u.geometry.coordinates])),v=null;m.features.length>0&&(v=m.features[0],v.properties.dist=qr(e,v,t),v.properties.location=i+qr(a,v,t)),a.properties.dist<n.properties.dist&&(n=a,n.properties.index=l,n.properties.location=i),u.properties.dist<n.properties.dist&&(n=u,n.properties.index=l+1,n.properties.location=i+f),v&&v.properties.dist<n.properties.dist&&(n=v,n.properties.index=l),i+=f}}),n}function Nc(){return{type:"FeatureCollection",features:[]}}function go(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:Tc(r)}}}function Tc(r){return[Math.round(r[0]*1e7)/1e7,Math.round(r[1]*1e7)/1e7]}const Dc=Ie(Nc()),jc=Ie(0),_0=100;class b0{constructor(e){ae(this,"map");ae(this,"active");ae(this,"eventListenersSuccess");ae(this,"eventListenersUpdated");ae(this,"eventListenersFailure");ae(this,"points");ae(this,"cursor");ae(this,"hover");ae(this,"dragFrom");ae(this,"previousStates");ae(this,"onMouseMove",e=>{if(this.active&&!this.dragFrom)this.recalculateHovering(e);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let t=this.dragFrom[0]-e.lngLat.lng,n=this.dragFrom[1]-e.lngLat.lat;for(let i of this.points)i[0]-=t,i[1]-=n}else this.points[this.hover]=e.lngLat.toArray();this.dragFrom=e.lngLat.toArray(),this.redraw()}});ae(this,"onClick",e=>{if(this.beforeUpdate(),this.active&&this.cursor){let t=[];if(iu(this.points).forEach((n,i)=>{t.push([i+1,v0(n,this.cursor).properties.dist])}),t.sort((n,i)=>n[1]-i[1]),t.length>0){let n=t[0][0];this.points.splice(n,0,this.cursor.geometry.coordinates),this.hover=n}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw(),this.pointsUpdated()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.pointsUpdated(),this.recalculateHovering(e))});ae(this,"onDoubleClick",e=>{this.active&&(e.preventDefault(),this.cursor=go(e.lngLat.toArray()),this.onClick(e),this.finish())});ae(this,"onMouseDown",e=>{this.active&&!this.dragFrom&&this.hover!=null&&(e.preventDefault(),this.cursor=null,this.dragFrom=e.lngLat.toArray(),this.beforeUpdate(),this.redraw())});ae(this,"onMouseUp",()=>{this.active&&this.dragFrom&&(this.dragFrom=null,this.redraw(),this.pointsUpdated())});ae(this,"onKeypress",e=>{this.active&&(e.key=="Enter"?(e.stopPropagation(),this.finish()):e.key=="z"&&e.ctrlKey&&this.undo())});ae(this,"onKeyDown",e=>{this.active&&e.key=="Escape"&&(e.stopPropagation(),this.cancel())});this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.previousStates=[],this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("mousedown",this.onMouseDown),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keypress",this.onKeypress),document.addEventListener("keydown",this.onKeyDown)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("mousedown",this.onMouseDown),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keypress",this.onKeypress),document.removeEventListener("keydown",this.onKeyDown)}finish(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersSuccess)t(e);else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}startNew(){this.active=!0,this.map.doubleClickZoom.disable()}editExisting(e){this.active=!0,this.map.doubleClickZoom.disable(),this.points=JSON.parse(JSON.stringify(e.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.map.doubleClickZoom.enable(),this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.previousStates=[],this.redraw(),this.map.getCanvas().style.cursor="inherit"}undo(){this.dragFrom!=null||this.previousStates.length==0||(this.points=this.previousStates.pop(),this.hover=null,this.redraw())}redraw(){let e=Nc();this.points.forEach((i,o)=>{let s=go(i);s.properties.hover=this.hover==o,s.properties.idx=o,e.features.push(s)}),e.features=e.features.concat(iu(this.points));let t=this.polygonFeature();t&&(t.properties.hover=this.hover=="polygon",e.features.push(t)),Dc.set(e);let n="crosshair";this.hover!=null&&(n=this.dragFrom?"grabbing":"pointer"),this.map.getCanvas().style.cursor=n,jc.set(this.previousStates.length)}pointsUpdated(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersUpdated)t(e)}recalculateHovering(e){this.cursor=null,this.hover=null;for(let t of this.map.queryRenderedFeatures(e.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(t.geometry.type=="Polygon"){this.hover="polygon";break}else if(t.geometry.type=="Point"&&Object.hasOwn(t.properties,"idx")){this.hover=t.properties.idx;break}this.hover==null&&(this.cursor=go(e.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let e=this.points.map(Tc),t=[JSON.parse(JSON.stringify(e))];return t[0].push(JSON.parse(JSON.stringify(t[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:t},properties:{}}}beforeUpdate(){this.previousStates.push(JSON.parse(JSON.stringify(this.points))),this.previousStates.length>_0&&this.previousStates.shift()}}function iu(r){let e=[];for(let t=0;t<r.length-1;t++)e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[t],r[t+1]]},properties:{}});return r.length>=3&&e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[r.length-1],r[0]]},properties:{}}),e}let Y;const Gc=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&Gc.decode();let Yr=null;function tn(){return(Yr===null||Yr.byteLength===0)&&(Yr=new Uint8Array(Y.memory.buffer)),Yr}function St(r,e){return r=r>>>0,Gc.decode(tn().subarray(r,r+e))}const Ot=new Array(128).fill(void 0);Ot.push(void 0,null,!0,!1);let rn=Ot.length;function ke(r){rn===Ot.length&&Ot.push(Ot.length+1);const e=rn;return rn=Ot[e],Ot[e]=r,e}function re(r){return Ot[r]}function w0(r){r<132||(Ot[r]=rn,rn=r)}function xn(r){const e=re(r);return w0(r),e}function ho(r){return r==null}let Xr=null;function $0(){return(Xr===null||Xr.byteLength===0)&&(Xr=new Float64Array(Y.memory.buffer)),Xr}let Kr=null;function he(){return(Kr===null||Kr.byteLength===0)&&(Kr=new Int32Array(Y.memory.buffer)),Kr}let zt=0;const ei=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},S0=typeof ei.encodeInto=="function"?function(r,e){return ei.encodeInto(r,e)}:function(r,e){const t=ei.encode(r);return e.set(t),{read:r.length,written:t.length}};function Rn(r,e,t){if(t===void 0){const l=ei.encode(r),a=e(l.length,1)>>>0;return tn().subarray(a,a+l.length).set(l),zt=l.length,a}let n=r.length,i=e(n,1)>>>0;const o=tn();let s=0;for(;s<n;s++){const l=r.charCodeAt(s);if(l>127)break;o[i+s]=l}if(s!==n){s!==0&&(r=r.slice(s)),i=t(i,n,n=s+r.length*3,1)>>>0;const l=tn().subarray(i+s,i+n),a=S0(r,l);s+=a.written}return zt=s,i}function ts(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const i=r.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=r.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(r)){const i=r.length;let o="[";i>0&&(o+=ts(r[0]));for(let s=1;s<i;s++)o+=", "+ts(r[s]);return o+="]",o}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function k0(r,e){const t=e(r.length*1,1)>>>0;return tn().set(r,t/1),zt=r.length,t}function mo(r,e){try{return r.apply(this,e)}catch(t){Y.__wbindgen_exn_store(ke(t))}}class Oi{static __wrap(e){e=e>>>0;const t=Object.create(Oi.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();Y.__wbg_jsroutesnapper_free(e)}constructor(e){try{const o=Y.__wbindgen_add_to_stack_pointer(-16),s=k0(e,Y.__wbindgen_malloc),l=zt;Y.jsroutesnapper_new(o,s,l);var t=he()[o/4+0],n=he()[o/4+1],i=he()[o/4+2];if(i)throw xn(n);return Oi.__wrap(t)}finally{Y.__wbindgen_add_to_stack_pointer(16)}}setRouteConfig(e){Y.jsroutesnapper_setRouteConfig(this.__wbg_ptr,ke(e))}setAreaMode(){Y.jsroutesnapper_setAreaMode(this.__wbg_ptr)}getConfig(){let e,t;try{const o=Y.__wbindgen_add_to_stack_pointer(-16);Y.jsroutesnapper_getConfig(o,this.__wbg_ptr);var n=he()[o/4+0],i=he()[o/4+1];return e=n,t=i,St(n,i)}finally{Y.__wbindgen_add_to_stack_pointer(16),Y.__wbindgen_free(e,t,1)}}toFinalFeature(){try{const n=Y.__wbindgen_add_to_stack_pointer(-16);Y.jsroutesnapper_toFinalFeature(n,this.__wbg_ptr);var e=he()[n/4+0],t=he()[n/4+1];let i;return e!==0&&(i=St(e,t).slice(),Y.__wbindgen_free(e,t*1)),i}finally{Y.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){let e,t;try{const o=Y.__wbindgen_add_to_stack_pointer(-16);Y.jsroutesnapper_renderGeojson(o,this.__wbg_ptr);var n=he()[o/4+0],i=he()[o/4+1];return e=n,t=i,St(n,i)}finally{Y.__wbindgen_add_to_stack_pointer(16),Y.__wbindgen_free(e,t,1)}}toggleSnapMode(){Y.jsroutesnapper_toggleSnapMode(this.__wbg_ptr)}onMouseMove(e,t,n){return Y.jsroutesnapper_onMouseMove(this.__wbg_ptr,e,t,n)!==0}onClick(){Y.jsroutesnapper_onClick(this.__wbg_ptr)}onDragStart(){return Y.jsroutesnapper_onDragStart(this.__wbg_ptr)!==0}onMouseUp(){return Y.jsroutesnapper_onMouseUp(this.__wbg_ptr)!==0}clearState(){Y.jsroutesnapper_clearState(this.__wbg_ptr)}editExisting(e){try{const i=Y.__wbindgen_add_to_stack_pointer(-16);Y.jsroutesnapper_editExisting(i,this.__wbg_ptr,ke(e));var t=he()[i/4+0],n=he()[i/4+1];if(n)throw xn(t)}finally{Y.__wbindgen_add_to_stack_pointer(16)}}debugRenderGraph(){let e,t;try{const o=Y.__wbindgen_add_to_stack_pointer(-16);Y.jsroutesnapper_debugRenderGraph(o,this.__wbg_ptr);var n=he()[o/4+0],i=he()[o/4+1];return e=n,t=i,St(n,i)}finally{Y.__wbindgen_add_to_stack_pointer(16),Y.__wbindgen_free(e,t,1)}}debugSnappableNodes(){let e,t;try{const o=Y.__wbindgen_add_to_stack_pointer(-16);Y.jsroutesnapper_debugSnappableNodes(o,this.__wbg_ptr);var n=he()[o/4+0],i=he()[o/4+1];return e=n,t=i,St(n,i)}finally{Y.__wbindgen_add_to_stack_pointer(16),Y.__wbindgen_free(e,t,1)}}routeNameForWaypoints(e){let t,n;try{const f=Y.__wbindgen_add_to_stack_pointer(-16);Y.jsroutesnapper_routeNameForWaypoints(f,this.__wbg_ptr,ke(e));var i=he()[f/4+0],o=he()[f/4+1],s=he()[f/4+2],l=he()[f/4+3],a=i,u=o;if(l)throw a=0,u=0,xn(s);return t=a,n=u,St(a,u)}finally{Y.__wbindgen_add_to_stack_pointer(16),Y.__wbindgen_free(t,n,1)}}addSnappedWaypoint(e,t){Y.jsroutesnapper_addSnappedWaypoint(this.__wbg_ptr,e,t)}undo(){Y.jsroutesnapper_undo(this.__wbg_ptr)}}async function E0(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function M0(){const r={};return r.wbg={},r.wbg.__wbindgen_string_new=function(e,t){const n=St(e,t);return ke(n)},r.wbg.__wbindgen_object_drop_ref=function(e){xn(e)},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(St(e,t));return ke(n)},r.wbg.__wbindgen_is_object=function(e){const t=re(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_is_undefined=function(e){return re(e)===void 0},r.wbg.__wbindgen_in=function(e,t){return re(e)in re(t)},r.wbg.__wbindgen_number_get=function(e,t){const n=re(t),i=typeof n=="number"?n:void 0;$0()[e/8+1]=ho(i)?0:i,he()[e/4+0]=!ho(i)},r.wbg.__wbindgen_boolean_get=function(e){const t=re(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return re(e)==re(t)},r.wbg.__wbindgen_string_get=function(e,t){const n=re(t),i=typeof n=="string"?n:void 0;var o=ho(i)?0:Rn(i,Y.__wbindgen_malloc,Y.__wbindgen_realloc),s=zt;he()[e/4+1]=s,he()[e/4+0]=o},r.wbg.__wbg_getwithrefkey_d1f0d12f1f1b63ea=function(e,t){const n=re(e)[re(t)];return ke(n)},r.wbg.__wbindgen_object_clone_ref=function(e){const t=re(e);return ke(t)},r.wbg.__wbg_String_4370c5505c674d30=function(e,t){const n=String(re(t)),i=Rn(n,Y.__wbindgen_malloc,Y.__wbindgen_realloc),o=zt;he()[e/4+1]=o,he()[e/4+0]=i},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return ke(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=re(t).stack,i=Rn(n,Y.__wbindgen_malloc,Y.__wbindgen_realloc),o=zt;he()[e/4+1]=o,he()[e/4+0]=i},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let n,i;try{n=e,i=t,console.error(St(e,t))}finally{Y.__wbindgen_free(n,i,1)}},r.wbg.__wbg_debug_9a6b3243fbbebb61=function(e){console.debug(re(e))},r.wbg.__wbg_error_788ae33f81d3b84b=function(e){console.error(re(e))},r.wbg.__wbg_info_2e30e8204b29d91d=function(e){console.info(re(e))},r.wbg.__wbg_log_1d3ae0273d8f4f8a=function(e){console.log(re(e))},r.wbg.__wbg_warn_d60e832f9882c1b2=function(e){console.warn(re(e))},r.wbg.__wbg_get_44be0491f933a435=function(e,t){const n=re(e)[t>>>0];return ke(n)},r.wbg.__wbg_length_fff51ee6522a1a18=function(e){return re(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof re(e)=="function"},r.wbg.__wbg_next_526fc47e980da008=function(e){const t=re(e).next;return ke(t)},r.wbg.__wbg_next_ddb3312ca1c4e32a=function(){return mo(function(e){const t=re(e).next();return ke(t)},arguments)},r.wbg.__wbg_done_5c1f01fb660d73b5=function(e){return re(e).done},r.wbg.__wbg_value_1695675138684bd5=function(e){const t=re(e).value;return ke(t)},r.wbg.__wbg_iterator_97f0c81209c6c35a=function(){return ke(Symbol.iterator)},r.wbg.__wbg_get_97b561fb56f034b5=function(){return mo(function(e,t){const n=Reflect.get(re(e),re(t));return ke(n)},arguments)},r.wbg.__wbg_call_cb65541d95d71282=function(){return mo(function(e,t){const n=re(e).call(re(t));return ke(n)},arguments)},r.wbg.__wbg_isArray_4c24b343cb13cfb1=function(e){return Array.isArray(re(e))},r.wbg.__wbg_instanceof_ArrayBuffer_39ac22089b74fddb=function(e){let t;try{t=re(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_buffer_085ec1f694018c4f=function(e){const t=re(e).buffer;return ke(t)},r.wbg.__wbg_new_8125e318e6245eed=function(e){const t=new Uint8Array(re(e));return ke(t)},r.wbg.__wbg_set_5cf90238115182c3=function(e,t,n){re(e).set(re(t),n>>>0)},r.wbg.__wbg_length_72e2208bbc0efc61=function(e){return re(e).length},r.wbg.__wbg_instanceof_Uint8Array_d8d9cb2b8e8ac1d4=function(e){let t;try{t=re(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbindgen_debug_string=function(e,t){const n=ts(re(t)),i=Rn(n,Y.__wbindgen_malloc,Y.__wbindgen_realloc),o=zt;he()[e/4+1]=o,he()[e/4+0]=i},r.wbg.__wbindgen_throw=function(e,t){throw new Error(St(e,t))},r.wbg.__wbindgen_memory=function(){const e=Y.memory;return ke(e)},r}function P0(r,e){return Y=r.exports,Uc.__wbindgen_wasm_module=e,Xr=null,Kr=null,Yr=null,Y}async function Uc(r){if(Y!==void 0)return Y;typeof r>"u"&&(r="/scheme-sketcher/assets/route_snapper_bg.wasm");const e=M0();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await E0(await r,e);return P0(t,n)}function L0(r,e,t){t===void 0&&(t={});var n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=r,n}function A0(r,e,t){if(t===void 0&&(t={}),!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!ou(r[0])||!ou(r[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:r};return L0(n,e,t)}function ou(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}var Ze=63710088e-1,C0={centimeters:Ze*100,centimetres:Ze*100,degrees:Ze/111325,feet:Ze*3.28084,inches:Ze*39.37,kilometers:Ze/1e3,kilometres:Ze/1e3,meters:Ze,metres:Ze,miles:Ze/1609.344,millimeters:Ze*1e3,millimetres:Ze*1e3,nauticalmiles:Ze/1852,radians:1,yards:Ze*1.0936};function rs(r,e,t){t===void 0&&(t={});var n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=r,n}function F0(r,e,t){if(t===void 0&&(t={}),r.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:r};return rs(n,e,t)}function O0(r,e){e===void 0&&(e="kilometers");var t=C0[e];if(!t)throw new Error(e+" units is invalid");return r*t}function In(r){var e=r%360;return e*Math.PI/180}function su(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return r.geometry.coordinates;if(r.type==="Point")return r.coordinates}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return r;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function R0(r,e,t){t===void 0&&(t={});var n=su(r),i=su(e),o=In(i[1]-n[1]),s=In(i[0]-n[0]),l=In(n[1]),a=In(i[1]),u=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(l)*Math.cos(a);return O0(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)),t.units)}function qc(r,e,t){if(r!==null)for(var n,i,o,s,l,a,u,f=0,c=0,g,p=r.type,h=p==="FeatureCollection",m=p==="Feature",v=h?r.features.length:1,_=0;_<v;_++){u=h?r.features[_].geometry:m?r.geometry:r,g=u?u.type==="GeometryCollection":!1,l=g?u.geometries.length:1;for(var y=0;y<l;y++){var d=0,E=0;if(s=g?u.geometries[y]:u,s!==null){a=s.coordinates;var b=s.type;switch(f=t&&(b==="Polygon"||b==="MultiPolygon")?1:0,b){case null:break;case"Point":if(e(a,c,_,d,E)===!1)return!1;c++,d++;break;case"LineString":case"MultiPoint":for(n=0;n<a.length;n++){if(e(a[n],c,_,d,E)===!1)return!1;c++,b==="MultiPoint"&&d++}b==="LineString"&&d++;break;case"Polygon":case"MultiLineString":for(n=0;n<a.length;n++){for(i=0;i<a[n].length-f;i++){if(e(a[n][i],c,_,d,E)===!1)return!1;c++}b==="MultiLineString"&&d++,b==="Polygon"&&E++}b==="Polygon"&&d++;break;case"MultiPolygon":for(n=0;n<a.length;n++){for(E=0,i=0;i<a[n].length;i++){for(o=0;o<a[n][i].length-f;o++){if(e(a[n][i][o],c,_,d,E)===!1)return!1;c++}E++}d++}break;case"GeometryCollection":for(n=0;n<s.geometries.length;n++)if(qc(s.geometries[n],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function I0(r,e){var t,n,i,o,s,l,a,u,f,c,g=0,p=r.type==="FeatureCollection",h=r.type==="Feature",m=p?r.features.length:1;for(t=0;t<m;t++){for(l=p?r.features[t].geometry:h?r.geometry:r,u=p?r.features[t].properties:h?r.properties:{},f=p?r.features[t].bbox:h?r.bbox:void 0,c=p?r.features[t].id:h?r.id:void 0,a=l?l.type==="GeometryCollection":!1,s=a?l.geometries.length:1,i=0;i<s;i++){if(o=a?l.geometries[i]:l,o===null){if(e(null,g,u,f,c)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(o,g,u,f,c)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<o.geometries.length;n++)if(e(o.geometries[n],g,u,f,c)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}g++}}function B0(r,e){I0(r,function(t,n,i,o,s){var l=t===null?null:t.type;switch(l){case null:case"Point":case"LineString":case"Polygon":return e(rs(t,i,{bbox:o,id:s}),n,0)===!1?!1:void 0}var a;switch(l){case"MultiPoint":a="Point";break;case"MultiLineString":a="LineString";break;case"MultiPolygon":a="Polygon";break}for(var u=0;u<t.coordinates.length;u++){var f=t.coordinates[u],c={type:a,coordinates:f};if(e(rs(c,i),n,u)===!1)return!1}})}function N0(r,e){B0(r,function(t,n,i){var o=0;if(t.geometry){var s=t.geometry.type;if(!(s==="Point"||s==="MultiPoint")){var l,a=0,u=0,f=0;if(qc(t,function(c,g,p,h,m){if(l===void 0||n>a||h>u||m>f){l=c,a=n,u=h,f=m,o=0;return}var v=F0([l,c],t.properties);if(e(v,n,i,m,o)===!1)return!1;o++,l=c})===!1)return!1}}})}function T0(r,e,t){var n=t,i=!1;return N0(r,function(o,s,l,a,u){i===!1&&t===void 0?n=o:n=e(n,o,s,l,a,u),i=!0}),n}function ns(r,e){return e===void 0&&(e={}),T0(r,function(t,n){var i=n.geometry.coordinates;return t+R0(i[0],i[1],e)},0)}var Qe=63710088e-1,zc={centimeters:Qe*100,centimetres:Qe*100,degrees:Qe/111325,feet:Qe*3.28084,inches:Qe*39.37,kilometers:Qe/1e3,kilometres:Qe/1e3,meters:Qe,metres:Qe,miles:Qe/1609.344,millimeters:Qe*1e3,millimetres:Qe*1e3,nauticalmiles:Qe/1852,radians:1,yards:Qe*1.0936};function Ar(r,e,t){t===void 0&&(t={});var n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=r,n}function nn(r,e,t){if(t===void 0&&(t={}),!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!au(r[0])||!au(r[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:r};return Ar(n,e,t)}function is(r,e,t){if(t===void 0&&(t={}),r.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:r};return Ar(n,e,t)}function lu(r,e){e===void 0&&(e={});var t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=r,t}function D0(r,e){e===void 0&&(e="kilometers");var t=zc[e];if(!t)throw new Error(e+" units is invalid");return r*t}function j0(r,e){e===void 0&&(e="kilometers");var t=zc[e];if(!t)throw new Error(e+" units is invalid");return r/t}function os(r){var e=r%(2*Math.PI);return e*180/Math.PI}function yt(r){var e=r%360;return e*Math.PI/180}function au(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}function dn(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return r.geometry.coordinates;if(r.type==="Point")return r.coordinates}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return r;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function yn(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function G0(r,e){return r.type==="FeatureCollection"?"FeatureCollection":r.type==="GeometryCollection"?"GeometryCollection":r.type==="Feature"&&r.geometry!==null?r.geometry.type:r.type}function Wc(r,e,t){if(t===void 0&&(t={}),t.final===!0)return U0(r,e);var n=dn(r),i=dn(e),o=yt(n[0]),s=yt(i[0]),l=yt(n[1]),a=yt(i[1]),u=Math.sin(s-o)*Math.cos(a),f=Math.cos(l)*Math.sin(a)-Math.sin(l)*Math.cos(a)*Math.cos(s-o);return os(Math.atan2(u,f))}function U0(r,e){var t=Wc(e,r);return t=(t+180)%360,t}function zr(r,e,t){t===void 0&&(t={});var n=dn(r),i=dn(e),o=yt(i[1]-n[1]),s=yt(i[0]-n[0]),l=yt(n[1]),a=yt(i[1]),u=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(l)*Math.cos(a);return D0(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)),t.units)}function uu(r,e,t,n){n===void 0&&(n={});var i=dn(r),o=yt(i[0]),s=yt(i[1]),l=yt(t),a=j0(e,n.units),u=Math.asin(Math.sin(s)*Math.cos(a)+Math.cos(s)*Math.sin(a)*Math.cos(l)),f=o+Math.atan2(Math.sin(l)*Math.sin(a)*Math.cos(s),Math.cos(a)-Math.sin(s)*Math.sin(u)),c=os(f),g=os(u);return nn([c,g],n.properties)}function fu(r,e){if(r.type==="Feature")e(r,0);else if(r.type==="FeatureCollection")for(var t=0;t<r.features.length&&e(r.features[t],t)!==!1;t++);}function q0(r,e){var t,n,i,o,s,l,a,u,f,c,g=0,p=r.type==="FeatureCollection",h=r.type==="Feature",m=p?r.features.length:1;for(t=0;t<m;t++){for(l=p?r.features[t].geometry:h?r.geometry:r,u=p?r.features[t].properties:h?r.properties:{},f=p?r.features[t].bbox:h?r.bbox:void 0,c=p?r.features[t].id:h?r.id:void 0,a=l?l.type==="GeometryCollection":!1,s=a?l.geometries.length:1,i=0;i<s;i++){if(o=a?l.geometries[i]:l,o===null){if(e(null,g,u,f,c)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(o,g,u,f,c)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<o.geometries.length;n++)if(e(o.geometries[n],g,u,f,c)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}g++}}function z0(r,e){q0(r,function(t,n,i,o,s){var l=t===null?null:t.type;switch(l){case null:case"Point":case"LineString":case"Polygon":return e(Ar(t,i,{bbox:o,id:s}),n,0)===!1?!1:void 0}var a;switch(l){case"MultiPoint":a="Point";break;case"MultiLineString":a="LineString";break;case"MultiPolygon":a="Polygon";break}for(var u=0;u<t.coordinates.length;u++){var f=t.coordinates[u],c={type:a,coordinates:f};if(e(Ar(c,i),n,u)===!1)return!1}})}function W0(r,e){var t={},n=[];if(r.type==="LineString"&&(r=Ar(r)),e.type==="LineString"&&(e=Ar(e)),r.type==="Feature"&&e.type==="Feature"&&r.geometry!==null&&e.geometry!==null&&r.geometry.type==="LineString"&&e.geometry.type==="LineString"&&r.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var i=cu(r,e);return i&&n.push(i),lu(n)}var o=En();return o.load(or(e)),fu(or(r),function(s){fu(o.search(s),function(l){var a=cu(s,l);if(a){var u=yn(a).join(",");t[u]||(t[u]=!0,n.push(a))}})}),lu(n)}function cu(r,e){var t=yn(r),n=yn(e);if(t.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(n.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var i=t[0][0],o=t[0][1],s=t[1][0],l=t[1][1],a=n[0][0],u=n[0][1],f=n[1][0],c=n[1][1],g=(c-u)*(s-i)-(f-a)*(l-o),p=(f-a)*(o-u)-(c-u)*(i-a),h=(s-i)*(o-u)-(l-o)*(i-a);if(g===0)return null;var m=p/g,v=h/g;if(m>=0&&m<=1&&v>=0&&v<=1){var _=i+m*(s-i),y=o+m*(l-o);return nn([_,y])}return null}function pu(r,e,t){t===void 0&&(t={});var n=nn([1/0,1/0],{dist:1/0}),i=0;return z0(r,function(o){for(var s=yn(o),l=0;l<s.length-1;l++){var a=nn(s[l]);a.properties.dist=zr(e,a,t);var u=nn(s[l+1]);u.properties.dist=zr(e,u,t);var f=zr(a,u,t),c=Math.max(a.properties.dist,u.properties.dist),g=Wc(a,u),p=uu(e,c,g+90,t),h=uu(e,c,g-90,t),m=W0(is([p.geometry.coordinates,h.geometry.coordinates]),is([a.geometry.coordinates,u.geometry.coordinates])),v=null;m.features.length>0&&(v=m.features[0],v.properties.dist=zr(e,v,t),v.properties.location=i+zr(a,v,t)),a.properties.dist<n.properties.dist&&(n=a,n.properties.index=l,n.properties.location=i),u.properties.dist<n.properties.dist&&(n=u,n.properties.index=l+1,n.properties.location=i+f),v&&v.properties.dist<n.properties.dist&&(n=v,n.properties.index=l),i+=f}}),n}function H0(r,e,t){var n=yn(t);if(G0(t)!=="LineString")throw new Error("line must be a LineString");var i=pu(t,r),o=pu(t,e),s;i.properties.index<=o.properties.index?s=[i,o]:s=[o,i];for(var l=[s[0].geometry.coordinates],a=s[0].properties.index+1;a<s[1].properties.index+1;a++)l.push(n[a]);return l.push(s[1].geometry.coordinates),is(l,t.properties)}var xe=63710088e-1,J0={centimeters:xe*100,centimetres:xe*100,degrees:xe/111325,feet:xe*3.28084,inches:xe*39.37,kilometers:xe/1e3,kilometres:xe/1e3,meters:xe,metres:xe,miles:xe/1609.344,millimeters:xe*1e3,millimetres:xe*1e3,nauticalmiles:xe/1852,radians:1,yards:xe*1.0936};function V0(r,e){e===void 0&&(e="kilometers");var t=J0[e];if(!t)throw new Error(e+" units is invalid");return r*t}function Bn(r){var e=r%360;return e*Math.PI/180}function gu(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return r.geometry.coordinates;if(r.type==="Point")return r.coordinates}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return r;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function hu(r,e,t){t===void 0&&(t={});var n=gu(r),i=gu(e),o=Bn(i[1]-n[1]),s=Bn(i[0]-n[0]),l=Bn(n[1]),a=Bn(i[1]),u=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(l)*Math.cos(a);return V0(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)),t.units)}function Y0(r){var e=r[0],t=r[1],n=r[2],i=r[3],o=hu(r.slice(0,2),[n,t]),s=hu(r.slice(0,2),[e,i]);if(o>=s){var l=(t+i)/2;return[e,l-(n-e)/2,n,l+(n-e)/2]}else{var a=(e+n)/2;return[a-(i-t)/2,t,a+(i-t)/2,i]}}function Hc(r,e,t){if(r!==null)for(var n,i,o,s,l,a,u,f=0,c=0,g,p=r.type,h=p==="FeatureCollection",m=p==="Feature",v=h?r.features.length:1,_=0;_<v;_++){u=h?r.features[_].geometry:m?r.geometry:r,g=u?u.type==="GeometryCollection":!1,l=g?u.geometries.length:1;for(var y=0;y<l;y++){var d=0,E=0;if(s=g?u.geometries[y]:u,s!==null){a=s.coordinates;var b=s.type;switch(f=t&&(b==="Polygon"||b==="MultiPolygon")?1:0,b){case null:break;case"Point":if(e(a,c,_,d,E)===!1)return!1;c++,d++;break;case"LineString":case"MultiPoint":for(n=0;n<a.length;n++){if(e(a[n],c,_,d,E)===!1)return!1;c++,b==="MultiPoint"&&d++}b==="LineString"&&d++;break;case"Polygon":case"MultiLineString":for(n=0;n<a.length;n++){for(i=0;i<a[n].length-f;i++){if(e(a[n][i],c,_,d,E)===!1)return!1;c++}b==="MultiLineString"&&d++,b==="Polygon"&&E++}b==="Polygon"&&d++;break;case"MultiPolygon":for(n=0;n<a.length;n++){for(E=0,i=0;i<a[n].length;i++){for(o=0;o<a[n][i].length-f;o++){if(e(a[n][i][o],c,_,d,E)===!1)return!1;c++}E++}d++}break;case"GeometryCollection":for(n=0;n<s.geometries.length;n++)if(Hc(s.geometries[n],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function X0(r,e){e===void 0&&(e={});var t=e.precision,n=e.coordinates,i=e.mutate;if(t=t==null||isNaN(t)?6:t,n=n==null||isNaN(n)?3:n,!r)throw new Error("<geojson> is required");if(typeof t!="number")throw new Error("<precision> must be a number");if(typeof n!="number")throw new Error("<coordinates> must be a number");(i===!1||i===void 0)&&(r=JSON.parse(JSON.stringify(r)));var o=Math.pow(10,t);return Hc(r,function(s){K0(s,o,n)}),r}function K0(r,e,t){r.length>t&&r.splice(t,r.length);for(var n=0;n<r.length;n++)r[n]=Math.round(r[n]*e)/e;return r}var et=63710088e-1,Jc={centimeters:et*100,centimetres:et*100,degrees:et/111325,feet:et*3.28084,inches:et*39.37,kilometers:et/1e3,kilometres:et/1e3,meters:et,metres:et,miles:et/1609.344,millimeters:et*1e3,millimetres:et*1e3,nauticalmiles:et/1852,radians:1,yards:et*1.0936};function Cr(r,e,t){t===void 0&&(t={});var n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=r,n}function on(r,e,t){if(t===void 0&&(t={}),!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!mu(r[0])||!mu(r[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:r};return Cr(n,e,t)}function Ri(r,e,t){if(t===void 0&&(t={}),r.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:r};return Cr(n,e,t)}function rr(r,e){e===void 0&&(e={});var t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=r,t}function Z0(r,e){e===void 0&&(e="kilometers");var t=Jc[e];if(!t)throw new Error(e+" units is invalid");return r*t}function Q0(r,e){e===void 0&&(e="kilometers");var t=Jc[e];if(!t)throw new Error(e+" units is invalid");return r/t}function ss(r){var e=r%(2*Math.PI);return e*180/Math.PI}function vt(r){var e=r%360;return e*Math.PI/180}function mu(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}function Wt(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return r.geometry.coordinates;if(r.type==="Point")return r.coordinates}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return r;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function nr(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function du(r,e){return r.type==="FeatureCollection"?"FeatureCollection":r.type==="GeometryCollection"?"GeometryCollection":r.type==="Feature"&&r.geometry!==null?r.geometry.type:r.type}function vn(r,e){if(r.type==="Feature")e(r,0);else if(r.type==="FeatureCollection")for(var t=0;t<r.features.length&&e(r.features[t],t)!==!1;t++);}function x0(r,e,t){var n=t;return vn(r,function(i,o){o===0&&t===void 0?n=i:n=e(n,i,o)}),n}function eb(r,e){var t,n,i,o,s,l,a,u,f,c,g=0,p=r.type==="FeatureCollection",h=r.type==="Feature",m=p?r.features.length:1;for(t=0;t<m;t++){for(l=p?r.features[t].geometry:h?r.geometry:r,u=p?r.features[t].properties:h?r.properties:{},f=p?r.features[t].bbox:h?r.bbox:void 0,c=p?r.features[t].id:h?r.id:void 0,a=l?l.type==="GeometryCollection":!1,s=a?l.geometries.length:1,i=0;i<s;i++){if(o=a?l.geometries[i]:l,o===null){if(e(null,g,u,f,c)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(o,g,u,f,c)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<o.geometries.length;n++)if(e(o.geometries[n],g,u,f,c)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}g++}}function Vc(r,e){eb(r,function(t,n,i,o,s){var l=t===null?null:t.type;switch(l){case null:case"Point":case"LineString":case"Polygon":return e(Cr(t,i,{bbox:o,id:s}),n,0)===!1?!1:void 0}var a;switch(l){case"MultiPoint":a="Point";break;case"MultiLineString":a="LineString";break;case"MultiPolygon":a="Polygon";break}for(var u=0;u<t.coordinates.length;u++){var f=t.coordinates[u],c={type:a,coordinates:f};if(e(Cr(c,i),n,u)===!1)return!1}})}function Yc(r,e){var t={},n=[];if(r.type==="LineString"&&(r=Cr(r)),e.type==="LineString"&&(e=Cr(e)),r.type==="Feature"&&e.type==="Feature"&&r.geometry!==null&&e.geometry!==null&&r.geometry.type==="LineString"&&e.geometry.type==="LineString"&&r.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var i=yu(r,e);return i&&n.push(i),rr(n)}var o=En();return o.load(or(e)),vn(or(r),function(s){vn(o.search(s),function(l){var a=yu(s,l);if(a){var u=nr(a).join(",");t[u]||(t[u]=!0,n.push(a))}})}),rr(n)}function yu(r,e){var t=nr(r),n=nr(e);if(t.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(n.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var i=t[0][0],o=t[0][1],s=t[1][0],l=t[1][1],a=n[0][0],u=n[0][1],f=n[1][0],c=n[1][1],g=(c-u)*(s-i)-(f-a)*(l-o),p=(f-a)*(o-u)-(c-u)*(i-a),h=(s-i)*(o-u)-(l-o)*(i-a);if(g===0)return null;var m=p/g,v=h/g;if(m>=0&&m<=1&&v>=0&&v<=1){var _=i+m*(s-i),y=o+m*(l-o);return on([_,y])}return null}function Xc(r,e,t){if(t===void 0&&(t={}),t.final===!0)return tb(r,e);var n=Wt(r),i=Wt(e),o=vt(n[0]),s=vt(i[0]),l=vt(n[1]),a=vt(i[1]),u=Math.sin(s-o)*Math.cos(a),f=Math.cos(l)*Math.sin(a)-Math.sin(l)*Math.cos(a)*Math.cos(s-o);return ss(Math.atan2(u,f))}function tb(r,e){var t=Xc(e,r);return t=(t+180)%360,t}function Wr(r,e,t){t===void 0&&(t={});var n=Wt(r),i=Wt(e),o=vt(i[1]-n[1]),s=vt(i[0]-n[0]),l=vt(n[1]),a=vt(i[1]),u=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(l)*Math.cos(a);return Z0(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)),t.units)}function vu(r,e,t,n){n===void 0&&(n={});var i=Wt(r),o=vt(i[0]),s=vt(i[1]),l=vt(t),a=Q0(e,n.units),u=Math.asin(Math.sin(s)*Math.cos(a)+Math.cos(s)*Math.sin(a)*Math.cos(l)),f=o+Math.atan2(Math.sin(l)*Math.sin(a)*Math.cos(s),Math.cos(a)-Math.sin(s)*Math.sin(u)),c=ss(f),g=ss(u);return on([c,g],n.properties)}function rb(r,e,t){t===void 0&&(t={});var n=on([1/0,1/0],{dist:1/0}),i=0;return Vc(r,function(o){for(var s=nr(o),l=0;l<s.length-1;l++){var a=on(s[l]);a.properties.dist=Wr(e,a,t);var u=on(s[l+1]);u.properties.dist=Wr(e,u,t);var f=Wr(a,u,t),c=Math.max(a.properties.dist,u.properties.dist),g=Xc(a,u),p=vu(e,c,g+90,t),h=vu(e,c,g-90,t),m=Yc(Ri([p.geometry.coordinates,h.geometry.coordinates]),Ri([a.geometry.coordinates,u.geometry.coordinates])),v=null;m.features.length>0&&(v=m.features[0],v.properties.dist=Wr(e,v,t),v.properties.location=i+Wr(a,v,t)),a.properties.dist<n.properties.dist&&(n=a,n.properties.index=l,n.properties.location=i),u.properties.dist<n.properties.dist&&(n=u,n.properties.index=l+1,n.properties.location=i+f),v&&v.properties.dist<n.properties.dist&&(n=v,n.properties.index=l),i+=f}}),n}function nb(r,e){if(!r)throw new Error("line is required");if(!e)throw new Error("splitter is required");var t=du(r),n=du(e);if(t!=="LineString")throw new Error("line must be LineString");if(n==="FeatureCollection")throw new Error("splitter cannot be a FeatureCollection");if(n==="GeometryCollection")throw new Error("splitter cannot be a GeometryCollection");var i=X0(e,{precision:7});switch(n){case"Point":return ls(r,i);case"MultiPoint":return _u(r,i);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return _u(r,Yc(r,i))}}function _u(r,e){var t=[],n=En();return Vc(e,function(i){if(t.forEach(function(l,a){l.id=a}),!t.length)t=ls(r,i).features,t.forEach(function(l){l.bbox||(l.bbox=Y0(pn(l)))}),n.load(rr(t));else{var o=n.search(i);if(o.features.length){var s=Kc(i,o);t=t.filter(function(l){return l.id!==s.id}),n.remove(s),vn(ls(s,i),function(l){t.push(l),n.insert(l)})}}}),rr(t)}function ls(r,e){var t=[],n=nr(r)[0],i=nr(r)[r.geometry.coordinates.length-1];if(yo(n,Wt(e))||yo(i,Wt(e)))return rr([r]);var o=En(),s=or(r);o.load(s);var l=o.search(e);if(!l.features.length)return rr([r]);var a=Kc(e,l),u=[n],f=x0(s,function(c,g,p){var h=nr(g)[1],m=Wt(e);return p===a.id?(c.push(m),t.push(Ri(c)),yo(m,h)?[m]:[m,h]):(c.push(h),c)},u);return f.length>1&&t.push(Ri(f)),rr(t)}function Kc(r,e){if(!e.features.length)throw new Error("lines must contain features");if(e.features.length===1)return e.features[0];var t,n=1/0;return vn(e,function(i){var o=rb(i,r),s=o.properties.dist;s<n&&(t=i,n=s)}),t}function yo(r,e){return r[0]===e[0]&&r[1]===e[1]}function ib(r,e){let t=nb(r,e);if(t.features.length!=2)return null;let n=t.features[0],i=t.features[1];return n.geometry.coordinates=n.geometry.coordinates.map(wu),i.geometry.coordinates=i.geometry.coordinates.map(wu),n.properties=JSON.parse(JSON.stringify(r.properties)),i.properties=JSON.parse(JSON.stringify(r.properties)),ob(r,n,i,e),[n,i]}function ob(r,e,t,n){e.properties.length_meters=ns(e,{units:"kilometers"})*1e3,t.properties.length_meters=ns(t,{units:"kilometers"})*1e3,e.properties.waypoints=[],t.properties.waypoints=[];let i=bu(r,n),o=!0,s=0;for(let l of r.properties.waypoints){let a=bu(r,A0([l.lon,l.lat]));if(o)if(a<i)e.properties.waypoints.push(l);else{let u=l.snapped&&r.properties.waypoints[s-1].snapped;e.properties.waypoints.push({lon:n.geometry.coordinates[0],lat:n.geometry.coordinates[1],snapped:u}),o=!1,t.properties.waypoints.push({lon:n.geometry.coordinates[0],lat:n.geometry.coordinates[1],snapped:u}),t.properties.waypoints.push(l)}else t.properties.waypoints.push(l);s++}}function bu(r,e){let t=r.geometry.coordinates[0],n=H0(t,e,r);return ns(n,{units:"kilometers"})*1e3}function wu(r){return[Math.round(r[0]*1e7)/1e7,Math.round(r[1]*1e7)/1e7]}const sb=30;class lb{constructor(e,t,n,i,o){this.onMouseMove=s=>{if(!this.active)return;const l=[s.point.x-sb,s.point.y],a=this.map.unproject(s.point).distanceTo(this.map.unproject(l));this.inner.onMouseMove(s.lngLat.lng,s.lngLat.lat,a)&&(this.redraw(),this.dataUpdated())},this.onClick=()=>{this.active&&(this.inner.onClick(),this.redraw(),this.dataUpdated())},this.onDoubleClick=s=>{this.active&&(s.preventDefault(),this.inner.onClick(),this.finish())},this.onDragStart=()=>{this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()},this.onMouseUp=()=>{this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()},this.onKeyDown=s=>{this.active&&s.key=="Escape"&&(s.stopPropagation(),this.cancel())},this.onKeyPress=s=>{this.active&&s.target.tagName!="INPUT"&&(s.key=="Enter"?(s.stopPropagation(),this.finish()):s.key=="s"||s.key=="S"?(s.stopPropagation(),this.inner.toggleSnapMode(),this.redraw()):s.key=="z"&&s.ctrlKey&&this.undo())},this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new Oi(t),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.routeToolGj=n,this.snapMode=i,this.undoLength=o,this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("dragstart",this.onDragStart),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keypress",this.onKeyPress)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("dragstart",this.onDragStart),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keypress",this.onKeyPress)}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}startArea(){this.active||(this.inner.setAreaMode(),this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable(),this.map.doubleClickZoom.enable()}editExistingRoute(e){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(e.properties.waypoints),this.redraw()}editExistingArea(e){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),e.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(e.properties.waypoints),this.redraw()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)for(let t of this.eventListenersSuccess)t(JSON.parse(e));else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(e){this.inner.setRouteConfig(e),this.redraw()}addSnappedWaypoint(e){this.inner.addSnappedWaypoint(e[0],e[1]),this.redraw()}undo(){this.inner.undo(),this.redraw()}toggleSnapMode(){this.inner.toggleSnapMode(),this.redraw()}redraw(){let e=JSON.parse(this.inner.renderGeojson());this.routeToolGj.set(e),this.map.getCanvas().style.cursor=e.cursor,this.snapMode.set(e.snap_mode),this.undoLength.set(e.undo_length)}dataUpdated(){let e=this.inner.toFinalFeature();if(e)for(let t of this.eventListenersUpdated)t(JSON.parse(e))}}function ab(r){return r=="google"||r=="bing"}var Ne=[];for(var vo=0;vo<256;++vo)Ne.push((vo+256).toString(16).slice(1));function ub(r,e=0){return(Ne[r[e+0]]+Ne[r[e+1]]+Ne[r[e+2]]+Ne[r[e+3]]+"-"+Ne[r[e+4]]+Ne[r[e+5]]+"-"+Ne[r[e+6]]+Ne[r[e+7]]+"-"+Ne[r[e+8]]+Ne[r[e+9]]+"-"+Ne[r[e+10]]+Ne[r[e+11]]+Ne[r[e+12]]+Ne[r[e+13]]+Ne[r[e+14]]+Ne[r[e+15]]).toLowerCase()}var Nn,fb=new Uint8Array(16);function cb(){if(!Nn&&(Nn=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Nn))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Nn(fb)}var pb=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const $u={randomUUID:pb};function Zc(r,e,t){if($u.randomUUID&&!e&&!r)return $u.randomUUID();r=r||{};var n=r.random||(r.rng||cb)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,e){t=t||0;for(var i=0;i<16;++i)e[t+i]=n[i];return e}return ub(n)}const sn={hovering:"black",lineEndpointColor:"black"},Ii=10,Qt=10;function gb(){return hb(["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00"])}function hb(r){return r[Math.floor(Math.random()*r.length)]}const _n=Ie(null),Fr=Ie(null),Ct=Ie(null),ti=Ie(new Set),ln=Ie(null),oe=Ie({mode:"list"});function Mn(r){let e=new Set;for(let n of r.features)e.add(n.id);let t=e.size+1;for(;e.has(t);)t++;return t}function Su(r,e){console.log(`Deleting intervention ${e}`),r.update(t=>(t.features=t.features.filter(n=>n.id!=e),t)),ln.set(null),oe.set({mode:"list"})}function zi(r){return Object.values(r.schemes)[0].scheme_reference}function Qc(r){return[Math.round(r[0]*1e7)/1e7,Math.round(r[1]*1e7)/1e7]}const sr=Ie(mb());sr.subscribe(r=>window.localStorage.setItem("userSettings",JSON.stringify(r)));function mb(){let r={streetViewImagery:"google",avoidDoublingBack:!1};try{let e=JSON.parse(window.localStorage.getItem("userSettings")||"{}");ab(e.streetViewImagery)&&(r.streetViewImagery=e.streetViewImagery),typeof e.avoidDoublingBack=="boolean"&&(r.avoidDoublingBack=e.avoidDoublingBack)}catch(e){console.log(`Couldn't parse userSettings from local storage: ${e}`)}return r}function xc(r){let e={type:"FeatureCollection",features:[],schemes:{}};return ep(r,e),e}function ep(r,e){let t=Zc(),n=r.initializeEmptyScheme({scheme_reference:t,color:gb()});e.schemes[t]=n}function db(r){let e;return{c(){e=N("li"),e.textContent="Click to add a new point"},m(t,n){w(t,e,n)},d(t){t&&$(e)}}}function yb(r){let e;return{c(){e=N("li"),e.textContent="Click to move the point here"},m(t,n){w(t,e,n)},d(t){t&&$(e)}}}function vb(r){let e,t,n;function i(l,a){return l[0]?yb:db}let o=i(r),s=o(r);return{c(){e=N("ul"),s.c(),t=O(),n=N("li"),n.innerHTML=`Press <b>Escape</b>
    to cancel`},m(l,a){w(l,e,a),s.m(e,null),D(e,t),D(e,n)},p(l,[a]){o!==(o=i(l))&&(s.d(1),s=o(l),s&&(s.c(),s.m(e,t)))},i:ee,o:ee,d(l){l&&$(e),s.d()}}}function _b(r,e,t){let{editingExisting:n}=e;return r.$$set=i=>{"editingExisting"in i&&t(0,n=i.editingExisting)},[n]}class tp extends Z{constructor(e){super(),Q(this,e,_b,vb,K,{editingExisting:0})}}function bb(r){let e,t,n;return{c(){e=U("Undo ("),t=U(r[0]),n=U(")")},m(i,o){w(i,e,o),w(i,t,o),w(i,n,o)},p(i,o){o&1&&me(t,i[0])},d(i){i&&($(e),$(t),$(n))}}}function wb(r){let e;return{c(){e=U("Undo")},m(t,n){w(t,e,n)},p:ee,d(t){t&&$(e)}}}function $b(r){let e;function t(o,s){return o[0]==0?wb:bb}let n=t(r),i=n(r);return{c(){i.c(),e=ve()},m(o,s){i.m(o,s),w(o,e,s)},p(o,s){n===(n=t(o))&&i?i.p(o,s):(i.d(1),i=n(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){o&&$(e),i.d(o)}}}function Sb(r){let e,t,n,i;return e=new pe({props:{disabled:r[0]==0,$$slots:{default:[$b]},$$scope:{ctx:r}}}),e.$on("click",r[1]),{c(){L(e.$$.fragment),t=O(),n=N("ul"),n.innerHTML=`<li><b>Click</b>
    the map to add a vertex</li> <li><b>Click</b>
    a vertex to delete it</li> <li><b>Drag</b>
    a vertex or the polygon to move it</li> <li>Press <b>Control+Z</b>
    to undo your last change</li> <li>Press <b>Enter</b>
    or
    <b>double click</b>
    to finish</li> <li>Press <b>Escape</b>
    to cancel</li>`},m(o,s){A(e,o,s),w(o,t,s),w(o,n,s),i=!0},p(o,[s]){const l={};s&1&&(l.disabled=o[0]==0),s&9&&(l.$$scope={dirty:s,ctx:o}),e.$set(l)},i(o){i||(S(e.$$.fragment,o),i=!0)},o(o){k(e.$$.fragment,o),i=!1},d(o){o&&($(t),$(n)),C(e,o)}}}function kb(r,e,t){let n,i;V(r,Fr,s=>t(2,n=s)),V(r,jc,s=>t(0,i=s));function o(){n.undo()}return[i,o]}class rp extends Z{constructor(e){super(),Q(this,e,kb,Sb,K,{})}}const np=Ie(Pr()),ri=Ie(Pr()),ip=Ie(!0),js=Ie(0);function ku(r,e,t){const n=r.slice();return n[9]=e[t],n}function Eu(r){let e,t,n=r[9].place_name+"",i,o,s;function l(...a){return r[5](r[9],...a)}return{c(){e=N("li"),t=N("a"),i=U(n),B(t,"href","#")},m(a,u){w(a,e,u),D(e,t),D(t,i),o||(s=ne(t,"click",l),o=!0)},p(a,u){r=a,u&2&&n!==(n=r[9].place_name+"")&&me(i,n)},d(a){a&&$(e),o=!1,s()}}}function Eb(r){let e,t,n,i,o;function s(f){r[4](f)}let l={label:"Add waypoint by search"};r[0]!==void 0&&(l.value=r[0]),e=new pf({props:l}),be.push(()=>Se(e,"value",s));let a=rt(r[1].features),u=[];for(let f=0;f<a.length;f+=1)u[f]=Eu(ku(r,a,f));return{c(){L(e.$$.fragment),n=O(),i=N("ol");for(let f=0;f<u.length;f+=1)u[f].c();B(i,"class","govuk-list govuk-list--number")},m(f,c){A(e,f,c),w(f,n,c),w(f,i,c);for(let g=0;g<u.length;g+=1)u[g]&&u[g].m(i,null);o=!0},p(f,[c]){const g={};if(!t&&c&1&&(t=!0,g.value=f[0],Ee(()=>t=!1)),e.$set(g),c&6){a=rt(f[1].features);let p;for(p=0;p<a.length;p+=1){const h=ku(f,a,p);u[p]?u[p].p(h,c):(u[p]=Eu(h),u[p].c(),u[p].m(i,null))}for(;p<u.length;p+=1)u[p].d(1);u.length=a.length}},i(f){o||(S(e.$$.fragment,f),o=!0)},o(f){k(e.$$.fragment,f),o=!1},d(f){f&&($(n),$(i)),C(e,f),Bi(u,f)}}}function Mb(r,e,t){let n,i,o;V(r,Ct,g=>t(6,n=g)),V(r,ri,g=>t(1,i=g)),V(r,ot,g=>t(7,o=g));let{cfg:s}=e,l="";async function a(g){if(!g){Te(ri,i=Pr(),i);return}let p=new URLSearchParams({country:"gb",proximity:o.getCenter().toArray().join(","),fuzzyMatch:"true",key:s.maptilerApiKey}).toString(),h=`https://api.maptiler.com/geocoding/${g}.json?${p}`,v=await(await fetch(h)).json(),_=1;for(let y of v.features)y.properties.number=_++;Te(ri,i=v,i)}function u(g,p){g.preventDefault(),n.addSnappedWaypoint(p),t(0,l="")}function f(g){l=g,t(0,l)}const c=(g,p)=>u(p,g.center);return r.$$set=g=>{"cfg"in g&&t(3,s=g.cfg)},r.$$.update=()=>{r.$$.dirty&1&&a(l)},[l,i,u,s,f,c]}class Pb extends Z{constructor(e){super(),Q(this,e,Mb,Eb,K,{cfg:3})}}function Lb(r){let e,t,n;return{c(){e=U("Undo ("),t=U(r[3]),n=U(")")},m(i,o){w(i,e,o),w(i,t,o),w(i,n,o)},p(i,o){o&8&&me(t,i[3])},d(i){i&&($(e),$(t),$(n))}}}function Ab(r){let e;return{c(){e=U("Undo")},m(t,n){w(t,e,n)},p:ee,d(t){t&&$(e)}}}function Cb(r){let e;function t(o,s){return o[3]==0?Ab:Lb}let n=t(r),i=n(r);return{c(){i.c(),e=ve()},m(o,s){i.m(o,s),w(o,e,s)},p(o,s){n===(n=t(o))&&i?i.p(o,s):(i.d(1),i=n(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){o&&$(e),i.d(o)}}}function Fb(r){let e,t,n,i;return n=new pe({props:{$$slots:{default:[Rb]},$$scope:{ctx:r}}}),n.$on("click",r[6]),{c(){e=N("p"),e.innerHTML=`Drawing points anywhere. Press <b>s</b>
    or click below to snap to roads`,t=O(),L(n.$$.fragment),ye(e,"background","blue"),ye(e,"color","white"),ye(e,"padding","8px")},m(o,s){w(o,e,s),w(o,t,s),A(n,o,s),i=!0},p(o,s){const l={};s&1024&&(l.$$scope={dirty:s,ctx:o}),n.$set(l)},i(o){i||(S(n.$$.fragment,o),i=!0)},o(o){k(n.$$.fragment,o),i=!1},d(o){o&&($(e),$(t)),C(n,o)}}}function Ob(r){let e,t,n,i;return n=new pe({props:{$$slots:{default:[Ib]},$$scope:{ctx:r}}}),n.$on("click",r[6]),{c(){e=N("p"),e.innerHTML=`Snapping to existing roads. Press <b>s</b>
    or click below to draw anywhere`,t=O(),L(n.$$.fragment),ye(e,"background","red"),ye(e,"color","white"),ye(e,"padding","8px")},m(o,s){w(o,e,s),w(o,t,s),A(n,o,s),i=!0},p(o,s){const l={};s&1024&&(l.$$scope={dirty:s,ctx:o}),n.$set(l)},i(o){i||(S(n.$$.fragment,o),i=!0)},o(o){k(n.$$.fragment,o),i=!1},d(o){o&&($(e),$(t)),C(n,o)}}}function Rb(r){let e;return{c(){e=U("Snap to roads")},m(t,n){w(t,e,n)},d(t){t&&$(e)}}}function Ib(r){let e;return{c(){e=U("Draw anywhere")},m(t,n){w(t,e,n)},d(t){t&&$(e)}}}function Bb(r){let e;return{c(){e=U("Add points to end")},m(t,n){w(t,e,n)},d(t){t&&$(e)}}}function Nb(r){let e;return{c(){e=U("Avoid doubling back")},m(t,n){w(t,e,n)},d(t){t&&$(e)}}}function Tb(r){let e,t,n,i,o,s;function l(c){r[8](c)}let a={hint:"Keep clicking to add more points to the end of the route",$$slots:{default:[Bb]},$$scope:{ctx:r}};r[0]!==void 0&&(a.checked=r[0]),e=new _o({props:a}),be.push(()=>Se(e,"checked",l));function u(c){r[9](c)}let f={hint:"Try to make the route avoid using the same streets with multiple waypoints",$$slots:{default:[Nb]},$$scope:{ctx:r}};return r[2].avoidDoublingBack!==void 0&&(f.checked=r[2].avoidDoublingBack),i=new _o({props:f}),be.push(()=>Se(i,"checked",u)),{c(){L(e.$$.fragment),n=O(),L(i.$$.fragment)},m(c,g){A(e,c,g),w(c,n,g),A(i,c,g),s=!0},p(c,g){const p={};g&1024&&(p.$$scope={dirty:g,ctx:c}),!t&&g&1&&(t=!0,p.checked=c[0],Ee(()=>t=!1)),e.$set(p);const h={};g&1024&&(h.$$scope={dirty:g,ctx:c}),!o&&g&4&&(o=!0,h.checked=c[2].avoidDoublingBack,Ee(()=>o=!1)),i.$set(h)},i(c){s||(S(e.$$.fragment,c),S(i.$$.fragment,c),s=!0)},o(c){k(e.$$.fragment,c),k(i.$$.fragment,c),s=!1},d(c){c&&$(n),C(e,c),C(i,c)}}}function Mu(r){let e,t;return e=new Pb({props:{cfg:r[1]}}),{c(){L(e.$$.fragment)},m(n,i){A(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.cfg=n[1]),e.$set(o)},i(n){t||(S(e.$$.fragment,n),t=!0)},o(n){k(e.$$.fragment,n),t=!1},d(n){C(e,n)}}}function Db(r){let e,t,n,i,o,s,l,a,u,f,c;e=new pe({props:{disabled:r[3]==0,$$slots:{default:[Cb]},$$scope:{ctx:r}}}),e.$on("click",r[5]);const g=[Ob,Fb],p=[];function h(v,_){return v[4]?0:1}n=h(r),i=p[n]=g[n](r),a=new Vp({props:{small:!0,$$slots:{default:[Tb]},$$scope:{ctx:r}}});let m=r[1].maptilerApiKey&&Mu(r);return{c(){L(e.$$.fragment),t=O(),i.c(),o=O(),s=N("ul"),s.innerHTML=`<li><b>Click</b>
    the map to add points</li> <li>Press <b>s</b>
    to switch between snapping points to existing roads and drawing anywhere</li> <li><b>Click and drag</b>
    any point to move it</li> <li><b>Click</b>
    a waypoint to delete it</li> <li>Press <b>Control+Z</b>
    to undo your last change</li> <li>Press <b>Enter</b>
    or
    <b>double click</b>
    to finish</li> <li>Press <b>Escape</b>
    to cancel</li>`,l=O(),L(a.$$.fragment),u=O(),m&&m.c(),f=ve()},m(v,_){A(e,v,_),w(v,t,_),p[n].m(v,_),w(v,o,_),w(v,s,_),w(v,l,_),A(a,v,_),w(v,u,_),m&&m.m(v,_),w(v,f,_),c=!0},p(v,[_]){const y={};_&8&&(y.disabled=v[3]==0),_&1032&&(y.$$scope={dirty:_,ctx:v}),e.$set(y);let d=n;n=h(v),n===d?p[n].p(v,_):(ue(),k(p[d],1,1,()=>{p[d]=null}),fe(),i=p[n],i?i.p(v,_):(i=p[n]=g[n](v),i.c()),S(i,1),i.m(o.parentNode,o));const E={};_&1029&&(E.$$scope={dirty:_,ctx:v}),a.$set(E),v[1].maptilerApiKey?m?(m.p(v,_),_&2&&S(m,1)):(m=Mu(v),m.c(),S(m,1),m.m(f.parentNode,f)):m&&(ue(),k(m,1,1,()=>{m=null}),fe())},i(v){c||(S(e.$$.fragment,v),S(i),S(a.$$.fragment,v),S(m),c=!0)},o(v){k(e.$$.fragment,v),k(i),k(a.$$.fragment,v),k(m),c=!1},d(v){v&&($(t),$(o),$(s),$(l),$(u),$(f)),C(e,v),p[n].d(v),C(a,v),m&&m.d(v)}}}function jb(r,e,t){let n,i,o,s;V(r,Ct,p=>t(7,n=p)),V(r,sr,p=>t(2,i=p)),V(r,js,p=>t(3,o=p)),V(r,ip,p=>t(4,s=p));let{cfg:l}=e,{extendRoute:a}=e;function u(){n.undo()}function f(){n.toggleSnapMode()}function c(p){a=p,t(0,a)}function g(p){r.$$.not_equal(i.avoidDoublingBack,p)&&(i.avoidDoublingBack=p,sr.set(i))}return r.$$set=p=>{"cfg"in p&&t(1,l=p.cfg),"extendRoute"in p&&t(0,a=p.extendRoute)},r.$$.update=()=>{r.$$.dirty&133&&n.setRouteConfig({avoid_doubling_back:i.avoidDoublingBack,extend_route:a})},[a,l,i,o,s,u,f,n,c,g]}class op extends Z{constructor(e){super(),Q(this,e,jb,Db,K,{cfg:1,extendRoute:0})}}function Gb(r){let e,t,n;return{c(){e=U("Undo ("),t=U(r[0]),n=U(")")},m(i,o){w(i,e,o),w(i,t,o),w(i,n,o)},p(i,o){o&1&&me(t,i[0])},d(i){i&&($(e),$(t),$(n))}}}function Ub(r){let e;return{c(){e=U("Undo")},m(t,n){w(t,e,n)},p:ee,d(t){t&&$(e)}}}function qb(r){let e;function t(o,s){return o[0]==0?Ub:Gb}let n=t(r),i=n(r);return{c(){i.c(),e=ve()},m(o,s){i.m(o,s),w(o,e,s)},p(o,s){n===(n=t(o))&&i?i.p(o,s):(i.d(1),i=n(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){o&&$(e),i.d(o)}}}function zb(r){let e,t,n,i;return e=new pe({props:{disabled:r[0]==0,$$slots:{default:[qb]},$$scope:{ctx:r}}}),e.$on("click",r[1]),{c(){L(e.$$.fragment),t=O(),n=N("ul"),n.innerHTML=`<li><b>Click</b>
    the map to add points</li> <li><b>Click and drag</b>
    any point to move it</li> <li><b>Click</b>
    a waypoint to delete it</li> <li>Press <b>Control+Z</b>
    to undo your last change</li> <li>Press <b>Enter</b>
    or
    <b>double click</b>
    to finish</li> <li>Press <b>Escape</b>
    to cancel</li>`},m(o,s){A(e,o,s),w(o,t,s),w(o,n,s),i=!0},p(o,[s]){const l={};s&1&&(l.disabled=o[0]==0),s&9&&(l.$$scope={dirty:s,ctx:o}),e.$set(l)},i(o){i||(S(e.$$.fragment,o),i=!0)},o(o){k(e.$$.fragment,o),i=!1},d(o){o&&($(t),$(n)),C(e,o)}}}function Wb(r,e,t){let n,i;V(r,Ct,s=>t(2,n=s)),V(r,js,s=>t(0,i=s));function o(){n.undo()}return[i,o]}class sp extends Z{constructor(e){super(),Q(this,e,Wb,zb,K,{})}}function Hb(r){let e;return{c(){e=U("Finish")},m(t,n){w(t,e,n)},d(t){t&&$(e)}}}function Jb(r){let e;return{c(){e=U("Cancel")},m(t,n){w(t,e,n)},d(t){t&&$(e)}}}function Vb(r){let e,t,n,i;return e=new Tt({props:{$$slots:{default:[Hb]},$$scope:{ctx:r}}}),e.$on("click",r[3]),n=new pe({props:{$$slots:{default:[Jb]},$$scope:{ctx:r}}}),n.$on("click",r[4]),{c(){L(e.$$.fragment),t=O(),L(n.$$.fragment)},m(o,s){A(e,o,s),w(o,t,s),A(n,o,s),i=!0},p(o,s){const l={};s&32768&&(l.$$scope={dirty:s,ctx:o}),e.$set(l);const a={};s&32768&&(a.$$scope={dirty:s,ctx:o}),n.$set(a)},i(o){i||(S(e.$$.fragment,o),S(n.$$.fragment,o),i=!0)},o(o){k(e.$$.fragment,o),k(n.$$.fragment,o),i=!1},d(o){o&&$(t),C(e,o),C(n,o)}}}function Yb(r){let e,t;return e=new sp({}),{c(){L(e.$$.fragment)},m(n,i){A(e,n,i),t=!0},p:ee,i(n){t||(S(e.$$.fragment,n),t=!0)},o(n){k(e.$$.fragment,n),t=!1},d(n){C(e,n)}}}function Xb(r){let e,t;return e=new rp({}),{c(){L(e.$$.fragment)},m(n,i){A(e,n,i),t=!0},p:ee,i(n){t||(S(e.$$.fragment,n),t=!0)},o(n){k(e.$$.fragment,n),t=!1},d(n){C(e,n)}}}function Kb(r){let e,t;return e=new op({props:{cfg:r[0],extendRoute:!1}}),{c(){L(e.$$.fragment)},m(n,i){A(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.cfg=n[0]),e.$set(o)},i(n){t||(S(e.$$.fragment,n),t=!0)},o(n){k(e.$$.fragment,n),t=!1},d(n){C(e,n)}}}function Zb(r){let e,t;return e=new tp({props:{editingExisting:!0}}),{c(){L(e.$$.fragment)},m(n,i){A(e,n,i),t=!0},p:ee,i(n){t||(S(e.$$.fragment,n),t=!0)},o(n){k(e.$$.fragment,n),t=!1},d(n){C(e,n)}}}function Qb(r){let e,t,n,i,o,s,l,a,u,f;o=new Jt({props:{$$slots:{default:[Vb]},$$scope:{ctx:r}}});const c=[Zb,Kb,Xb,Yb],g=[];function p(h,m){return h[2]=="point"?0:h[2]=="route"?1:h[2]=="freehand-polygon"?2:h[2]=="snapped-polygon"?3:-1}return~(l=p(r))&&(a=g[l]=c[l](r)),{c(){e=N("h2"),t=U("Editing "),n=U(r[1]),i=O(),L(o.$$.fragment),s=O(),a&&a.c(),u=ve()},m(h,m){w(h,e,m),D(e,t),D(e,n),w(h,i,m),A(o,h,m),w(h,s,m),~l&&g[l].m(h,m),w(h,u,m),f=!0},p(h,[m]){(!f||m&2)&&me(n,h[1]);const v={};m&32768&&(v.$$scope={dirty:m,ctx:h}),o.$set(v);let _=l;l=p(h),l===_?~l&&g[l].p(h,m):(a&&(ue(),k(g[_],1,1,()=>{g[_]=null}),fe()),~l?(a=g[l],a?a.p(h,m):(a=g[l]=c[l](h),a.c()),S(a,1),a.m(u.parentNode,u)):a=null)},i(h){f||(S(o.$$.fragment,h),S(a),f=!0)},o(h){k(o.$$.fragment,h),k(a),f=!1},d(h){h&&($(e),$(i),$(s),$(u)),C(o,h),~l&&g[l].d(h)}}}function xb(r,e,t){let n,i,o;V(r,Fr,y=>t(8,n=y)),V(r,Ct,y=>t(9,i=y)),V(r,_n,y=>t(10,o=y));let{cfg:s}=e,{gjSchemes:l}=e,{id:a}=e,u="",f="",c=null;Nt(()=>{let y=null;l.update(E=>(y=E.features.find(b=>b.id==a),y.properties.hide_while_editing=!0,E));let d=y;t(1,u=s.interventionName(d)),d.geometry.type=="LineString"?(i==null||i.editExistingRoute(d),i==null||i.addEventListenerSuccess(g),i==null||i.addEventListenerUpdated(p),i==null||i.addEventListenerFailure(h),t(2,f="route")):d.geometry.type=="Polygon"?d.properties.waypoints?(i==null||i.editExistingArea(d),i==null||i.addEventListenerSuccess(g),i==null||i.addEventListenerUpdated(p),i==null||i.addEventListenerFailure(h),t(2,f="snapped-polygon")):(n==null||n.editExisting(d),n==null||n.addEventListenerSuccess(g),n==null||n.addEventListenerUpdated(p),n==null||n.addEventListenerFailure(h),t(2,f="freehand-polygon")):d.geometry.type=="Point"&&(o==null||o.start(),o==null||o.addEventListenerSuccess(g),o==null||o.addEventListenerFailure(h),t(2,f="point"))}),st(()=>{o==null||o.stop(),o==null||o.clearEventListeners(),i==null||i.stop(),i==null||i.clearEventListeners(),n==null||n.stop(),n==null||n.clearEventListeners(),l.update(y=>{let d=y.features.find(E=>E.id==a);return delete d.properties.hide_while_editing,c&&m(d,c),y})});function g(y){y.properties??(y.properties={}),c=y,oe.set({mode:"edit-form",id:a})}function p(y){c=y}function h(){c=null,oe.set({mode:"edit-form",id:a})}function m(y,d){y.geometry=d.geometry,d.properties.length_meters&&(y.properties.length_meters=d.properties.length_meters),d.properties.waypoints&&(y.properties.waypoints=d.properties.waypoints),s.updateFeature(y,d)}function v(){oe.set({mode:"edit-form",id:a})}function _(){c=null,oe.set({mode:"edit-form",id:a})}return r.$$set=y=>{"cfg"in y&&t(0,s=y.cfg),"gjSchemes"in y&&t(5,l=y.gjSchemes),"id"in y&&t(6,a=y.id)},[s,u,f,v,_,l,a]}class e1 extends Z{constructor(e){super(),Q(this,e,xb,Qb,K,{cfg:0,gjSchemes:5,id:6})}}const ni=Ie(null),ii=Ie(100);function Pu(r){let e,t;return e=new Og({props:{url:r[3],coordinates:[[r[1].lng,r[1].lat],[r[4].lng,r[1].lat],[r[4].lng,r[4].lat],[r[1].lng,r[4].lat]],$$slots:{default:[t1]},$$scope:{ctx:r}}}),{c(){L(e.$$.fragment)},m(n,i){A(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.url=n[3]),i&18&&(o.coordinates=[[n[1].lng,n[1].lat],[n[4].lng,n[1].lat],[n[4].lng,n[4].lat],[n[1].lng,n[4].lat]]),i&545&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(S(e.$$.fragment,n),t=!0)},o(n){k(e.$$.fragment,n),t=!1},d(n){C(e,n)}}}function t1(r){let e,t;const n=[le(r[0],"georeferenced-image"),{paint:{"raster-fade-duration":0,"raster-opacity":r[5]/100}}];let i={};for(let o=0;o<n.length;o+=1)i=de(i,n[o]);return e=new ih({props:i}),{c(){L(e.$$.fragment)},m(o,s){A(e,o,s),t=!0},p(o,s){const l=s&33?$e(n,[s&1&&De(le(o[0],"georeferenced-image")),s&32&&{paint:{"raster-fade-duration":0,"raster-opacity":o[5]/100}}]):{};e.$set(l)},i(o){t||(S(e.$$.fragment,o),t=!0)},o(o){k(e.$$.fragment,o),t=!1},d(o){C(e,o)}}}function Lu(r){let e,t,n,i,o,s;function l(c){r[7](c)}let a={draggable:!0,$$slots:{default:[r1]},$$scope:{ctx:r}};r[1]!==void 0&&(a.lngLat=r[1]),e=new wo({props:a}),be.push(()=>Se(e,"lngLat",l));function u(c){r[8](c)}let f={draggable:!0,$$slots:{default:[n1]},$$scope:{ctx:r}};return r[4]!==void 0&&(f.lngLat=r[4]),i=new wo({props:f}),be.push(()=>Se(i,"lngLat",u)),{c(){L(e.$$.fragment),n=O(),L(i.$$.fragment)},m(c,g){A(e,c,g),w(c,n,g),A(i,c,g),s=!0},p(c,g){const p={};g&512&&(p.$$scope={dirty:g,ctx:c}),!t&&g&2&&(t=!0,p.lngLat=c[1],Ee(()=>t=!1)),e.$set(p);const h={};g&512&&(h.$$scope={dirty:g,ctx:c}),!o&&g&16&&(o=!0,h.lngLat=c[4],Ee(()=>o=!1)),i.$set(h)},i(c){s||(S(e.$$.fragment,c),S(i.$$.fragment,c),s=!0)},o(c){k(e.$$.fragment,c),k(i.$$.fragment,c),s=!1},d(c){c&&$(n),C(e,c),C(i,c)}}}function r1(r){let e;return{c(){e=N("span"),B(e,"class","dot svelte-1tmbx1c"),ye(e,"background-color","red")},m(t,n){w(t,e,n)},p:ee,d(t){t&&$(e)}}}function n1(r){let e;return{c(){e=N("span"),B(e,"class","dot svelte-1tmbx1c"),ye(e,"background-color","blue")},m(t,n){w(t,e,n)},p:ee,d(t){t&&$(e)}}}function i1(r){let e,t,n,i=r[3]&&Pu(r),o=r[3]&&r[2].mode=="set-image"&&Lu(r);return{c(){i&&i.c(),e=O(),o&&o.c(),t=ve()},m(s,l){i&&i.m(s,l),w(s,e,l),o&&o.m(s,l),w(s,t,l),n=!0},p(s,[l]){s[3]?i?(i.p(s,l),l&8&&S(i,1)):(i=Pu(s),i.c(),S(i,1),i.m(e.parentNode,e)):i&&(ue(),k(i,1,1,()=>{i=null}),fe()),s[3]&&s[2].mode=="set-image"?o?(o.p(s,l),l&12&&S(o,1)):(o=Lu(s),o.c(),S(o,1),o.m(t.parentNode,t)):o&&(ue(),k(o,1,1,()=>{o=null}),fe())},i(s){n||(S(i),S(o),n=!0)},o(s){k(i),k(o),n=!1},d(s){s&&($(e),$(t)),i&&i.d(s),o&&o.d(s)}}}function o1(r,e,t){let n,i,o,s;V(r,ot,g=>t(6,n=g)),V(r,oe,g=>t(2,i=g)),V(r,ni,g=>t(3,o=g)),V(r,ii,g=>t(5,s=g));let{cfg:l}=e,a={lng:0,lat:0},u={lng:0,lat:0};function f(g){a=g,t(1,a),t(6,n),t(3,o),t(2,i)}function c(g){u=g,t(4,u),t(6,n),t(3,o),t(2,i),t(1,a)}return r.$$set=g=>{"cfg"in g&&t(0,l=g.cfg)},r.$$.update=()=>{if(r.$$.dirty&78&&n&&o&&i.mode=="set-image"&&a.lng==0&&a.lat==0){let g=n.getBounds();t(1,a.lng=g.getWest()+.4*(g.getEast()-g.getWest()),a),t(4,u.lng=g.getWest()+.6*(g.getEast()-g.getWest()),u),t(1,a.lat=g.getNorth()+.4*(g.getSouth()-g.getNorth()),a),t(4,u.lat=g.getNorth()+.6*(g.getSouth()-g.getNorth()),u)}},[l,a,i,o,u,s,n,f,c]}class s1 extends Z{constructor(e){super(),Q(this,e,o1,i1,K,{cfg:0})}}function l1(r){let e,t,n,i,o,s;const l=[le(r[0],"hover-polygons"),{filter:xt},{paint:{"line-color":sn.hovering,"line-width":.5*Qt}}];let a={};for(let p=0;p<l.length;p+=1)a=de(a,l[p]);e=new br({props:a});const u=[le(r[0],"hover-lines"),{filter:gn},{paint:{"line-color":sn.hovering,"line-width":1.5*Qt}}];let f={};for(let p=0;p<u.length;p+=1)f=de(f,u[p]);n=new br({props:f});const c=[le(r[0],"hover-points"),{filter:hn},{paint:{"circle-color":sn.hovering,"circle-radius":1.5*Ii}}];let g={};for(let p=0;p<c.length;p+=1)g=de(g,c[p]);return o=new wr({props:g}),{c(){L(e.$$.fragment),t=O(),L(n.$$.fragment),i=O(),L(o.$$.fragment)},m(p,h){A(e,p,h),w(p,t,h),A(n,p,h),w(p,i,h),A(o,p,h),s=!0},p(p,h){const m=h&1?$e(l,[De(le(p[0],"hover-polygons")),l[1],l[2]]):{};e.$set(m);const v=h&1?$e(u,[De(le(p[0],"hover-lines")),u[1],u[2]]):{};n.$set(v);const _=h&1?$e(c,[De(le(p[0],"hover-points")),c[1],c[2]]):{};o.$set(_)},i(p){s||(S(e.$$.fragment,p),S(n.$$.fragment,p),S(o.$$.fragment,p),s=!0)},o(p){k(e.$$.fragment,p),k(n.$$.fragment,p),k(o.$$.fragment,p),s=!1},d(p){p&&($(t),$(i)),C(e,p),C(n,p),C(o,p)}}}function a1(r){let e,t;return e=new ir({props:{data:r[2],$$slots:{default:[l1]},$$scope:{ctx:r}}}),{c(){L(e.$$.fragment)},m(n,i){A(e,n,i),t=!0},p(n,[i]){const o={};i&4&&(o.data=n[2]),i&33&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(S(e.$$.fragment,n),t=!0)},o(n){k(e.$$.fragment,n),t=!1},d(n){C(e,n)}}}function u1(r,e,t){let n,i,o,s=ee,l=()=>(s(),s=bt(u,f=>t(4,o=f)),u);V(r,ln,f=>t(3,i=f)),r.$$.on_destroy.push(()=>s());let{cfg:a}=e,{gjSchemes:u}=e;return l(),r.$$set=f=>{"cfg"in f&&t(0,a=f.cfg),"gjSchemes"in f&&l(t(1,u=f.gjSchemes))},r.$$.update=()=>{r.$$.dirty&24&&t(2,n=i==null?Pr():o.features.find(f=>f.id==i))},[a,u,n,i,o]}class f1 extends Z{constructor(e){super(),Q(this,e,u1,a1,K,{cfg:0,gjSchemes:1})}}function Au(r){let e,t;return e=new ps({props:{openOn:"hover",openIfTopMost:!0,$$slots:{default:[c1,({features:n})=>({16:n}),({features:n})=>n?65536:0]},$$scope:{ctx:r}}}),{c(){L(e.$$.fragment)},m(n,i){A(e,n,i),t=!0},p(n,i){const o={};i&196608&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(S(e.$$.fragment,n),t=!0)},o(n){k(e.$$.fragment,n),t=!1},d(n){C(e,n)}}}function c1(r){let e,t,n=r[9](r[16])+"",i;return{c(){e=N("div"),t=N("p"),i=U(n),B(e,"class","govuk-prose")},m(o,s){w(o,e,s),D(e,t),D(t,i)},p(o,s){s&65536&&n!==(n=o[9](o[16])+"")&&me(i,n)},d(o){o&&$(e)}}}function p1(r){let e,t,n=r[4]&&Au(r);return{c(){n&&n.c(),e=ve()},m(i,o){n&&n.m(i,o),w(i,e,o),t=!0},p(i,o){i[4]?n?(n.p(i,o),o&16&&S(n,1)):(n=Au(i),n.c(),S(n,1),n.m(e.parentNode,e)):n&&(ue(),k(n,1,1,()=>{n=null}),fe())},i(i){t||(S(n),t=!0)},o(i){k(n),t=!1},d(i){i&&$(e),n&&n.d(i)}}}function Cu(r){let e,t;return e=new ps({props:{openOn:"hover",openIfTopMost:!0,$$slots:{default:[g1,({features:n})=>({16:n}),({features:n})=>n?65536:0]},$$scope:{ctx:r}}}),{c(){L(e.$$.fragment)},m(n,i){A(e,n,i),t=!0},p(n,i){const o={};i&196608&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(S(e.$$.fragment,n),t=!0)},o(n){k(e.$$.fragment,n),t=!1},d(n){C(e,n)}}}function g1(r){let e,t,n=r[9](r[16])+"",i;return{c(){e=N("div"),t=N("p"),i=U(n),B(e,"class","govuk-prose")},m(o,s){w(o,e,s),D(e,t),D(t,i)},p(o,s){s&65536&&n!==(n=o[9](o[16])+"")&&me(i,n)},d(o){o&&$(e)}}}function h1(r){let e,t,n=r[4]&&Cu(r);return{c(){n&&n.c(),e=ve()},m(i,o){n&&n.m(i,o),w(i,e,o),t=!0},p(i,o){i[4]?n?(n.p(i,o),o&16&&S(n,1)):(n=Cu(i),n.c(),S(n,1),n.m(e.parentNode,e)):n&&(ue(),k(n,1,1,()=>{n=null}),fe())},i(i){t||(S(n),t=!0)},o(i){k(n),t=!1},d(i){i&&$(e),n&&n.d(i)}}}function Fu(r){let e,t;return e=new ps({props:{openOn:"hover",openIfTopMost:!0,$$slots:{default:[m1,({features:n})=>({16:n}),({features:n})=>n?65536:0]},$$scope:{ctx:r}}}),{c(){L(e.$$.fragment)},m(n,i){A(e,n,i),t=!0},p(n,i){const o={};i&196608&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(S(e.$$.fragment,n),t=!0)},o(n){k(e.$$.fragment,n),t=!1},d(n){C(e,n)}}}function m1(r){let e,t,n=r[9](r[16])+"",i;return{c(){e=N("div"),t=N("p"),i=U(n),B(e,"class","govuk-prose")},m(o,s){w(o,e,s),D(e,t),D(t,i)},p(o,s){s&65536&&n!==(n=o[9](o[16])+"")&&me(i,n)},d(o){o&&$(e)}}}function d1(r){let e,t,n=r[4]&&Fu(r);return{c(){n&&n.c(),e=ve()},m(i,o){n&&n.m(i,o),w(i,e,o),t=!0},p(i,o){i[4]?n?(n.p(i,o),o&16&&S(n,1)):(n=Fu(i),n.c(),S(n,1),n.m(e.parentNode,e)):n&&(ue(),k(n,1,1,()=>{n=null}),fe())},i(i){t||(S(n),t=!0)},o(i){k(n),t=!1},d(i){i&&$(e),n&&n.d(i)}}}function y1(r){let e,t,n,i,o,s,l,a,u,f;const c=[le(r[0],"interventions-points"),{filter:["all",hn,r[6],r[7],r[3]]},{paint:{"circle-color":r[2],"circle-radius":Ii}},{hoverCursor:r[4]?"pointer":void 0},{manageHoverState:r[4]}];let g={$$slots:{default:[p1]},$$scope:{ctx:r}};for(let b=0;b<c.length;b+=1)g=de(g,c[b]);e=new wr({props:g}),e.$on("click",r[8]);const p=[le(r[0],"interventions-lines"),{filter:["all",gn,r[6],r[3]]},{paint:{"line-color":r[2],"line-width":Qt}},{hoverCursor:r[4]?"pointer":void 0},{manageHoverState:r[4]}];let h={$$slots:{default:[h1]},$$scope:{ctx:r}};for(let b=0;b<p.length;b+=1)h=de(h,p[b]);n=new br({props:h}),n.$on("click",r[8]);const m=[le(r[0],"interventions-lines-endpoints"),{filter:["all",["==",["get","endpoint"],!0],r[3]]},{paint:{"circle-radius":.5*Qt,"circle-opacity":0,"circle-stroke-color":sn.lineEndpointColor,"circle-stroke-width":2}}];let v={};for(let b=0;b<m.length;b+=1)v=de(v,m[b]);o=new wr({props:v});const _=[le(r[0],"interventions-polygons"),{filter:["all",xt,r[6],r[3]]},{paint:{"fill-color":r[2],"fill-opacity":.2}},{hoverCursor:r[4]?"pointer":void 0},{manageHoverState:r[4]}];let y={$$slots:{default:[d1]},$$scope:{ctx:r}};for(let b=0;b<_.length;b+=1)y=de(y,_[b]);l=new bn({props:y}),l.$on("click",r[8]);const d=[le(r[0],"interventions-polygons-outlines"),{filter:["all",xt,r[6],r[3]]},{paint:{"line-color":r[2],"line-opacity":.5,"line-width":.7*Qt}}];let E={};for(let b=0;b<d.length;b+=1)E=de(E,d[b]);return u=new br({props:E}),{c(){L(e.$$.fragment),t=O(),L(n.$$.fragment),i=O(),L(o.$$.fragment),s=O(),L(l.$$.fragment),a=O(),L(u.$$.fragment)},m(b,M){A(e,b,M),w(b,t,M),A(n,b,M),w(b,i,M),A(o,b,M),w(b,s,M),A(l,b,M),w(b,a,M),A(u,b,M),f=!0},p(b,M){const R=M&221?$e(c,[M&1&&De(le(b[0],"interventions-points")),M&200&&{filter:["all",hn,b[6],b[7],b[3]]},M&4&&{paint:{"circle-color":b[2],"circle-radius":Ii}},M&16&&{hoverCursor:b[4]?"pointer":void 0},M&16&&{manageHoverState:b[4]}]):{};M&131088&&(R.$$scope={dirty:M,ctx:b}),e.$set(R);const j=M&93?$e(p,[M&1&&De(le(b[0],"interventions-lines")),M&72&&{filter:["all",gn,b[6],b[3]]},M&4&&{paint:{"line-color":b[2],"line-width":Qt}},M&16&&{hoverCursor:b[4]?"pointer":void 0},M&16&&{manageHoverState:b[4]}]):{};M&131088&&(j.$$scope={dirty:M,ctx:b}),n.$set(j);const z=M&9?$e(m,[M&1&&De(le(b[0],"interventions-lines-endpoints")),M&8&&{filter:["all",["==",["get","endpoint"],!0],b[3]]},m[2]]):{};o.$set(z);const G=M&93?$e(_,[M&1&&De(le(b[0],"interventions-polygons")),M&72&&{filter:["all",xt,b[6],b[3]]},M&4&&{paint:{"fill-color":b[2],"fill-opacity":.2}},M&16&&{hoverCursor:b[4]?"pointer":void 0},M&16&&{manageHoverState:b[4]}]):{};M&131088&&(G.$$scope={dirty:M,ctx:b}),l.$set(G);const F=M&77?$e(d,[M&1&&De(le(b[0],"interventions-polygons-outlines")),M&72&&{filter:["all",xt,b[6],b[3]]},M&4&&{paint:{"line-color":b[2],"line-opacity":.5,"line-width":.7*Qt}}]):{};u.$set(F)},i(b){f||(S(e.$$.fragment,b),S(n.$$.fragment,b),S(o.$$.fragment,b),S(l.$$.fragment,b),S(u.$$.fragment,b),f=!0)},o(b){k(e.$$.fragment,b),k(n.$$.fragment,b),k(o.$$.fragment,b),k(l.$$.fragment,b),k(u.$$.fragment,b),f=!1},d(b){b&&($(t),$(i),$(s),$(a)),C(e,b),C(n,b),C(o,b),C(l,b),C(u,b)}}}function v1(r){let e,t;return e=new ir({props:{data:r[5],$$slots:{default:[y1]},$$scope:{ctx:r}}}),{c(){L(e.$$.fragment)},m(n,i){A(e,n,i),t=!0},p(n,[i]){const o={};i&32&&(o.data=n[5]),i&131101&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(S(e.$$.fragment,n),t=!0)},o(n){k(e.$$.fragment,n),t=!1},d(n){C(e,n)}}}function _1(r){let e=["all"];for(let t of r.keys())e.push(["!=",["get","scheme_reference"],t]);return e}function b1(r,e,t){let n,i,o,s,l,a=ee,u=()=>(a(),a=bt(h,b=>t(11,l=b)),h),f,c,g;V(r,ot,b=>t(14,f=b)),V(r,oe,b=>t(12,c=b)),V(r,ti,b=>t(13,g=b)),r.$$.on_destroy.push(()=>a());let{cfg:p}=e,{gjSchemes:h}=e;u();const m=["!=",["get","hide_while_editing"],!0],v=["!=",["get","endpoint"],!0];let _;function y(b){return Vr(["get","scheme_reference"],Object.fromEntries(Object.values(b.schemes).map(M=>[M.scheme_reference,M.color])),"black")}function d(b){c.mode!="list"||!f||b.detail.features[0]&&(f.getCanvas().style.cursor="inherit",oe.set({mode:"edit-form",id:b.detail.features[0].id}))}function E(b){if(b){let M=b[0],R=p.interventionName(M),j=p.schemeName(l.schemes[M.properties.scheme_reference]);return`${R} (${j})`}return"Tooltip bug"}return r.$$set=b=>{"cfg"in b&&t(0,p=b.cfg),"gjSchemes"in b&&u(t(1,h=b.gjSchemes))},r.$$.update=()=>{if(r.$$.dirty&2048&&t(5,n=j_(l)),r.$$.dirty&4096&&t(4,i=c.mode=="list"),r.$$.dirty&8192&&t(3,o=_1(g)),r.$$.dirty&2048&&t(10,s=y(l)),r.$$.dirty&5120){let b="grey";c.mode=="edit-form"?t(2,_=["case",["==",["id"],c.id],s,b]):c.mode=="list"?t(2,_=s):c.mode=="split-route"?t(2,_=["case",["==","intervention_type","route"],s,b]):t(2,_=b)}},[p,h,_,o,i,n,m,v,d,E,s,l,c,g]}class w1 extends Z{constructor(e){super(),Q(this,e,b1,v1,K,{cfg:0,gjSchemes:1})}}function $1(r){let e,t,n,i,o,s;const l=[le(r[0],"edit-polygon-fill"),{filter:xt},{paint:{"fill-color":"red","fill-opacity":["case",["boolean",["get","hover"],"false"],1,.5]}}];let a={};for(let p=0;p<l.length;p+=1)a=de(a,l[p]);e=new bn({props:a});const u=[le(r[0],"edit-polygon-lines"),{filter:gn},{paint:{"line-color":"black","line-width":8,"line-opacity":.5}}];let f={};for(let p=0;p<u.length;p+=1)f=de(f,u[p]);n=new br({props:f});const c=[le(r[0],"edit-polygon-vertices"),{filter:hn},{paint:{"circle-color":sn.hovering,"circle-opacity":["case",["has","hovered"],1,.5],"circle-radius":Ii}}];let g={};for(let p=0;p<c.length;p+=1)g=de(g,c[p]);return o=new wr({props:g}),{c(){L(e.$$.fragment),t=O(),L(n.$$.fragment),i=O(),L(o.$$.fragment)},m(p,h){A(e,p,h),w(p,t,h),A(n,p,h),w(p,i,h),A(o,p,h),s=!0},p(p,h){const m=h&1?$e(l,[De(le(p[0],"edit-polygon-fill")),l[1],l[2]]):{};e.$set(m);const v=h&1?$e(u,[De(le(p[0],"edit-polygon-lines")),u[1],u[2]]):{};n.$set(v);const _=h&1?$e(c,[De(le(p[0],"edit-polygon-vertices")),c[1],c[2]]):{};o.$set(_)},i(p){s||(S(e.$$.fragment,p),S(n.$$.fragment,p),S(o.$$.fragment,p),s=!0)},o(p){k(e.$$.fragment,p),k(n.$$.fragment,p),k(o.$$.fragment,p),s=!1},d(p){p&&($(t),$(i)),C(e,p),C(n,p),C(o,p)}}}function S1(r){let e,t;return e=new ir({props:{data:r[1],$$slots:{default:[$1]},$$scope:{ctx:r}}}),{c(){L(e.$$.fragment)},m(n,i){A(e,n,i),t=!0},p(n,[i]){const o={};i&2&&(o.data=n[1]),i&5&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(S(e.$$.fragment,n),t=!0)},o(n){k(e.$$.fragment,n),t=!1},d(n){C(e,n)}}}function k1(r,e,t){let n;V(r,Dc,o=>t(1,n=o));let{cfg:i}=e;return r.$$set=o=>{"cfg"in o&&t(0,i=o.cfg)},[i,n]}class E1 extends Z{constructor(e){super(),Q(this,e,k1,S1,K,{cfg:0})}}function M1(r){let e,t,n,i,o,s;const l=[le(r[0],"route-points"),{filter:hn},{paint:{"circle-color":Vr(["get","type"],{"snapped-waypoint":"red","free-waypoint":"blue"},"black"),"circle-opacity":["case",["has","hovered"],.5,1],"circle-radius":Vr(["get","type"],{node:Tn/2},Tn)}}];let a={};for(let p=0;p<l.length;p+=1)a=de(a,l[p]);e=new wr({props:a});const u=[le(r[0],"route-lines"),{filter:gn},{paint:{"line-color":["case",["get","snapped"],"red","blue"],"line-width":2.5}}];let f={};for(let p=0;p<u.length;p+=1)f=de(f,u[p]);n=new br({props:f});const c=[le(r[0],"route-polygons"),{filter:xt},{paint:{"fill-color":"black","fill-opacity":.5}}];let g={};for(let p=0;p<c.length;p+=1)g=de(g,c[p]);return o=new bn({props:g}),{c(){L(e.$$.fragment),t=O(),L(n.$$.fragment),i=O(),L(o.$$.fragment)},m(p,h){A(e,p,h),w(p,t,h),A(n,p,h),w(p,i,h),A(o,p,h),s=!0},p(p,h){const m=h&1?$e(l,[h&1&&De(le(p[0],"route-points")),l[1],h&0&&{paint:{"circle-color":Vr(["get","type"],{"snapped-waypoint":"red","free-waypoint":"blue"},"black"),"circle-opacity":["case",["has","hovered"],.5,1],"circle-radius":Vr(["get","type"],{node:Tn/2},Tn)}}]):{};e.$set(m);const v=h&1?$e(u,[De(le(p[0],"route-lines")),u[1],u[2]]):{};n.$set(v);const _=h&1?$e(c,[De(le(p[0],"route-polygons")),c[1],c[2]]):{};o.$set(_)},i(p){s||(S(e.$$.fragment,p),S(n.$$.fragment,p),S(o.$$.fragment,p),s=!0)},o(p){k(e.$$.fragment,p),k(n.$$.fragment,p),k(o.$$.fragment,p),s=!1},d(p){p&&($(t),$(i)),C(e,p),C(n,p),C(o,p)}}}function P1(r){let e,t=Ou(r[3])+"",n;return{c(){e=N("div"),n=U(t),ye(e,"font-size","30px"),ye(e,"background","white"),ye(e,"padding","16px"),ye(e,"border-radius","50%")},m(i,o){w(i,e,o),D(e,n)},p(i,o){o&8&&t!==(t=Ou(i[3])+"")&&me(n,t)},d(i){i&&$(e)}}}function L1(r){let e,t;return e=new eh({props:{$$slots:{default:[P1,({feature:n})=>({3:n}),({feature:n})=>n?8:0]},$$scope:{ctx:r}}}),{c(){L(e.$$.fragment)},m(n,i){A(e,n,i),t=!0},p(n,i){const o={};i&24&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(S(e.$$.fragment,n),t=!0)},o(n){k(e.$$.fragment,n),t=!1},d(n){C(e,n)}}}function A1(r){let e,t,n,i;return e=new ir({props:{data:r[1],$$slots:{default:[M1]},$$scope:{ctx:r}}}),n=new ir({props:{data:r[2],$$slots:{default:[L1]},$$scope:{ctx:r}}}),{c(){L(e.$$.fragment),t=O(),L(n.$$.fragment)},m(o,s){A(e,o,s),w(o,t,s),A(n,o,s),i=!0},p(o,[s]){const l={};s&2&&(l.data=o[1]),s&17&&(l.$$scope={dirty:s,ctx:o}),e.$set(l);const a={};s&4&&(a.data=o[2]),s&16&&(a.$$scope={dirty:s,ctx:o}),n.$set(a)},i(o){i||(S(e.$$.fragment,o),S(n.$$.fragment,o),i=!0)},o(o){k(e.$$.fragment,o),k(n.$$.fragment,o),i=!1},d(o){o&&$(t),C(e,o),C(n,o)}}}const Tn=10;function Ou(r){var e;return(e=r.properties)==null?void 0:e.number}function C1(r,e,t){let n,i;V(r,np,s=>t(1,n=s)),V(r,ri,s=>t(2,i=s));let{cfg:o}=e;return r.$$set=s=>{"cfg"in s&&t(0,o=s.cfg)},[o,n,i]}class F1 extends Z{constructor(e){super(),Q(this,e,C1,A1,K,{cfg:0})}}var O1=Object.defineProperty,Xt=(r,e)=>O1(r,"name",{value:e,configurable:!0});function Or(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return[...r.geometry.coordinates];if(r.type==="Point")return[...r.coordinates]}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return[...r];throw new Error("coord must be GeoJSON Point or an Array of numbers")}Xt(Or,"getCoord");function lp(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}Xt(lp,"getCoords");function ap(r){if(r.length>1&&Mr(r[0])&&Mr(r[1]))return!0;if(Array.isArray(r[0])&&r[0].length)return ap(r[0]);throw new Error("coordinates must only contain numbers")}Xt(ap,"containsNumber");function R1(r,e,t){if(!e||!t)throw new Error("type and name required");if(!r||r.type!==e)throw new Error("Invalid input to "+t+": must be a "+e+", given "+r.type)}Xt(R1,"geojsonType");function I1(r,e,t){if(!r)throw new Error("No feature passed");if(!t)throw new Error(".featureOf() requires a name");if(!r||r.type!=="Feature"||!r.geometry)throw new Error("Invalid input to "+t+", Feature with geometry required");if(!r.geometry||r.geometry.type!==e)throw new Error("Invalid input to "+t+": must be a "+e+", given "+r.geometry.type)}Xt(I1,"featureOf");function B1(r,e,t){if(!r)throw new Error("No featureCollection passed");if(!t)throw new Error(".collectionOf() requires a name");if(!r||r.type!=="FeatureCollection")throw new Error("Invalid input to "+t+", FeatureCollection required");for(const n of r.features){if(!n||n.type!=="Feature"||!n.geometry)throw new Error("Invalid input to "+t+", Feature with geometry required");if(!n.geometry||n.geometry.type!==e)throw new Error("Invalid input to "+t+": must be a "+e+", given "+n.geometry.type)}}Xt(B1,"collectionOf");function N1(r){return r.type==="Feature"?r.geometry:r}Xt(N1,"getGeom");function T1(r,e){return r.type==="FeatureCollection"?"FeatureCollection":r.type==="GeometryCollection"?"GeometryCollection":r.type==="Feature"&&r.geometry!==null?r.geometry.type:r.type}Xt(T1,"getType");var D1=Object.defineProperty,up=(r,e)=>D1(r,"name",{value:e,configurable:!0});function Gs(r,e,t={}){if(t.final===!0)return fp(r,e);const n=Or(r),i=Or(e),o=ut(n[0]),s=ut(i[0]),l=ut(n[1]),a=ut(i[1]),u=Math.sin(s-o)*Math.cos(a),f=Math.cos(l)*Math.sin(a)-Math.sin(l)*Math.cos(a)*Math.cos(s-o);return fn(Math.atan2(u,f))}up(Gs,"bearing");function fp(r,e){let t=Gs(e,r);return t=(t+180)%360,t}up(fp,"calculateFinalBearing");var j1=Object.defineProperty,G1=(r,e)=>j1(r,"name",{value:e,configurable:!0});function mr(r,e,t={}){var n=Or(r),i=Or(e),o=ut(i[1]-n[1]),s=ut(i[0]-n[0]),l=ut(n[1]),a=ut(i[1]),u=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(l)*Math.cos(a);return Os(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)),t.units)}G1(mr,"distance");var U1=Object.defineProperty,q1=(r,e)=>U1(r,"name",{value:e,configurable:!0});function as(r,e,t,n={}){const i=Or(r),o=ut(i[0]),s=ut(i[1]),l=ut(t),a=Gi(e,n.units),u=Math.asin(Math.sin(s)*Math.cos(a)+Math.cos(s)*Math.sin(a)*Math.cos(l)),f=o+Math.atan2(Math.sin(l)*Math.sin(a)*Math.cos(s),Math.cos(a)-Math.sin(s)*Math.sin(u)),c=fn(f),g=fn(u);return tt([c,g],n.properties)}q1(as,"destination");class cp{constructor(e=[],t=z1){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:n}=this,i=t[e];for(;e>0;){const o=e-1>>1,s=t[o];if(n(i,s)>=0)break;t[e]=s,e=o}t[e]=i}_down(e){const{data:t,compare:n}=this,i=this.length>>1,o=t[e];for(;e<i;){let s=(e<<1)+1,l=t[s];const a=s+1;if(a<this.length&&n(t[a],l)<0&&(s=a,l=t[a]),n(l,o)>=0)break;t[e]=l,e=s}t[e]=o}}function z1(r,e){return r<e?-1:r>e?1:0}function pp(r,e){return r.p.x>e.p.x?1:r.p.x<e.p.x?-1:r.p.y!==e.p.y?r.p.y>e.p.y?1:-1:1}function W1(r,e){return r.rightSweepEvent.p.x>e.rightSweepEvent.p.x?1:r.rightSweepEvent.p.x<e.rightSweepEvent.p.x?-1:r.rightSweepEvent.p.y!==e.rightSweepEvent.p.y?r.rightSweepEvent.p.y<e.rightSweepEvent.p.y?1:-1:1}class Ru{constructor(e,t,n,i){this.p={x:e[0],y:e[1]},this.featureId=t,this.ringId=n,this.eventId=i,this.otherEvent=null,this.isLeftEndpoint=null}isSamePoint(e){return this.p.x===e.p.x&&this.p.y===e.p.y}}function H1(r,e){if(r.type==="FeatureCollection"){const t=r.features;for(let n=0;n<t.length;n++)Iu(t[n],e)}else Iu(r,e)}let Dn=0,jn=0,Gn=0;function Iu(r,e){const t=r.type==="Feature"?r.geometry:r;let n=t.coordinates;(t.type==="Polygon"||t.type==="MultiLineString")&&(n=[n]),t.type==="LineString"&&(n=[[n]]);for(let i=0;i<n.length;i++)for(let o=0;o<n[i].length;o++){let s=n[i][o][0],l=null;jn=jn+1;for(let a=0;a<n[i][o].length-1;a++){l=n[i][o][a+1];const u=new Ru(s,Dn,jn,Gn),f=new Ru(l,Dn,jn,Gn+1);u.otherEvent=f,f.otherEvent=u,pp(u,f)>0?(f.isLeftEndpoint=!0,u.isLeftEndpoint=!1):(u.isLeftEndpoint=!0,f.isLeftEndpoint=!1),e.push(u),e.push(f),s=l,Gn=Gn+1}}Dn=Dn+1}class J1{constructor(e){this.leftSweepEvent=e,this.rightSweepEvent=e.otherEvent}}function V1(r,e){if(r===null||e===null||r.leftSweepEvent.ringId===e.leftSweepEvent.ringId&&(r.rightSweepEvent.isSamePoint(e.leftSweepEvent)||r.rightSweepEvent.isSamePoint(e.leftSweepEvent)||r.rightSweepEvent.isSamePoint(e.rightSweepEvent)||r.leftSweepEvent.isSamePoint(e.leftSweepEvent)||r.leftSweepEvent.isSamePoint(e.rightSweepEvent)))return!1;const t=r.leftSweepEvent.p.x,n=r.leftSweepEvent.p.y,i=r.rightSweepEvent.p.x,o=r.rightSweepEvent.p.y,s=e.leftSweepEvent.p.x,l=e.leftSweepEvent.p.y,a=e.rightSweepEvent.p.x,u=e.rightSweepEvent.p.y,f=(u-l)*(i-t)-(a-s)*(o-n),c=(a-s)*(n-l)-(u-l)*(t-s),g=(i-t)*(n-l)-(o-n)*(t-s);if(f===0)return!1;const p=c/f,h=g/f;if(p>=0&&p<=1&&h>=0&&h<=1){const m=t+p*(i-t),v=n+p*(o-n);return[m,v]}return!1}function Y1(r,e){e=e||!1;const t=[],n=new cp([],W1);for(;r.length;){const i=r.pop();if(i.isLeftEndpoint){const o=new J1(i);for(let s=0;s<n.data.length;s++){const l=n.data[s];if(e&&l.leftSweepEvent.featureId===i.featureId)continue;const a=V1(o,l);a!==!1&&t.push(a)}n.push(o)}else i.isLeftEndpoint===!1&&n.pop()}return t}function X1(r,e){const t=new cp([],pp);return H1(r,t),Y1(t,e)}var K1=Object.defineProperty,Z1=(r,e)=>K1(r,"name",{value:e,configurable:!0}),Q1=X1;function gp(r,e,t={}){const{removeDuplicates:n=!0,ignoreSelfIntersections:i=!1}=t;let o=[];r.type==="FeatureCollection"?o=o.concat(r.features):r.type==="Feature"?o.push(r):(r.type==="LineString"||r.type==="Polygon"||r.type==="MultiLineString"||r.type==="MultiPolygon")&&o.push(ft(r)),e.type==="FeatureCollection"?o=o.concat(e.features):e.type==="Feature"?o.push(e):(e.type==="LineString"||e.type==="Polygon"||e.type==="MultiLineString"||e.type==="MultiPolygon")&&o.push(ft(e));const s=Q1(Er(o),i);let l=[];if(n){const a={};s.forEach(u=>{const f=u.join(",");a[f]||(a[f]=!0,l.push(u))})}else l=s;return Er(l.map(a=>tt(a)))}Z1(gp,"lineIntersect");var x1=Object.defineProperty,je=(r,e)=>x1(r,"name",{value:e,configurable:!0});function Pn(r,e,t){if(r!==null)for(var n,i,o,s,l,a,u,f=0,c=0,g,p=r.type,h=p==="FeatureCollection",m=p==="Feature",v=h?r.features.length:1,_=0;_<v;_++){u=h?r.features[_].geometry:m?r.geometry:r,g=u?u.type==="GeometryCollection":!1,l=g?u.geometries.length:1;for(var y=0;y<l;y++){var d=0,E=0;if(s=g?u.geometries[y]:u,s!==null){a=s.coordinates;var b=s.type;switch(f=t&&(b==="Polygon"||b==="MultiPolygon")?1:0,b){case null:break;case"Point":if(e(a,c,_,d,E)===!1)return!1;c++,d++;break;case"LineString":case"MultiPoint":for(n=0;n<a.length;n++){if(e(a[n],c,_,d,E)===!1)return!1;c++,b==="MultiPoint"&&d++}b==="LineString"&&d++;break;case"Polygon":case"MultiLineString":for(n=0;n<a.length;n++){for(i=0;i<a[n].length-f;i++){if(e(a[n][i],c,_,d,E)===!1)return!1;c++}b==="MultiLineString"&&d++,b==="Polygon"&&E++}b==="Polygon"&&d++;break;case"MultiPolygon":for(n=0;n<a.length;n++){for(E=0,i=0;i<a[n].length;i++){for(o=0;o<a[n][i].length-f;o++){if(e(a[n][i][o],c,_,d,E)===!1)return!1;c++}E++}d++}break;case"GeometryCollection":for(n=0;n<s.geometries.length;n++)if(Pn(s.geometries[n],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}je(Pn,"coordEach");function ew(r,e,t,n){var i=t;return Pn(r,function(o,s,l,a,u){s===0&&t===void 0?i=o:i=e(i,o,s,l,a,u)},n),i}je(ew,"coordReduce");function hp(r,e){var t;switch(r.type){case"FeatureCollection":for(t=0;t<r.features.length&&e(r.features[t].properties,t)!==!1;t++);break;case"Feature":e(r.properties,0);break}}je(hp,"propEach");function tw(r,e,t){var n=t;return hp(r,function(i,o){o===0&&t===void 0?n=i:n=e(n,i,o)}),n}je(tw,"propReduce");function mp(r,e){if(r.type==="Feature")e(r,0);else if(r.type==="FeatureCollection")for(var t=0;t<r.features.length&&e(r.features[t],t)!==!1;t++);}je(mp,"featureEach");function rw(r,e,t){var n=t;return mp(r,function(i,o){o===0&&t===void 0?n=i:n=e(n,i,o)}),n}je(rw,"featureReduce");function nw(r){var e=[];return Pn(r,function(t){e.push(t)}),e}je(nw,"coordAll");function Us(r,e){var t,n,i,o,s,l,a,u,f,c,g=0,p=r.type==="FeatureCollection",h=r.type==="Feature",m=p?r.features.length:1;for(t=0;t<m;t++){for(l=p?r.features[t].geometry:h?r.geometry:r,u=p?r.features[t].properties:h?r.properties:{},f=p?r.features[t].bbox:h?r.bbox:void 0,c=p?r.features[t].id:h?r.id:void 0,a=l?l.type==="GeometryCollection":!1,s=a?l.geometries.length:1,i=0;i<s;i++){if(o=a?l.geometries[i]:l,o===null){if(e(null,g,u,f,c)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(o,g,u,f,c)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<o.geometries.length;n++)if(e(o.geometries[n],g,u,f,c)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}g++}}je(Us,"geomEach");function iw(r,e,t){var n=t;return Us(r,function(i,o,s,l,a){o===0&&t===void 0?n=i:n=e(n,i,o,s,l,a)}),n}je(iw,"geomReduce");function Ln(r,e){Us(r,function(t,n,i,o,s){var l=t===null?null:t.type;switch(l){case null:case"Point":case"LineString":case"Polygon":return e(ft(t,i,{bbox:o,id:s}),n,0)===!1?!1:void 0}var a;switch(l){case"MultiPoint":a="Point";break;case"MultiLineString":a="LineString";break;case"MultiPolygon":a="Polygon";break}for(var u=0;u<t.coordinates.length;u++){var f=t.coordinates[u],c={type:a,coordinates:f};if(e(ft(c,i),n,u)===!1)return!1}})}je(Ln,"flattenEach");function ow(r,e,t){var n=t;return Ln(r,function(i,o,s){o===0&&s===0&&t===void 0?n=i:n=e(n,i,o,s)}),n}je(ow,"flattenReduce");function dp(r,e){Ln(r,function(t,n,i){var o=0;if(t.geometry){var s=t.geometry.type;if(!(s==="Point"||s==="MultiPoint")){var l,a=0,u=0,f=0;if(Pn(t,function(c,g,p,h,m){if(l===void 0||n>a||h>u||m>f){l=c,a=n,u=h,f=m,o=0;return}var v=ht([l,c],t.properties);if(e(v,n,i,m,o)===!1)return!1;o++,l=c})===!1)return!1}}})}je(dp,"segmentEach");function sw(r,e,t){var n=t,i=!1;return dp(r,function(o,s,l,a,u){i===!1&&t===void 0?n=o:n=e(n,o,s,l,a,u),i=!0}),n}je(sw,"segmentReduce");function yp(r,e){if(!r)throw new Error("geojson is required");Ln(r,function(t,n,i){if(t.geometry!==null){var o=t.geometry.type,s=t.geometry.coordinates;switch(o){case"LineString":if(e(t,n,i,0,0)===!1)return!1;break;case"Polygon":for(var l=0;l<s.length;l++)if(e(ht(s[l],t.properties),n,i,l)===!1)return!1;break}}})}je(yp,"lineEach");function lw(r,e,t){var n=t;return yp(r,function(i,o,s,l){o===0&&t===void 0?n=i:n=e(n,i,o,s,l)}),n}je(lw,"lineReduce");function aw(r,e){if(e=e||{},!Rs(e))throw new Error("options is invalid");var t=e.featureIndex||0,n=e.multiFeatureIndex||0,i=e.geometryIndex||0,o=e.segmentIndex||0,s=e.properties,l;switch(r.type){case"FeatureCollection":t<0&&(t=r.features.length+t),s=s||r.features[t].properties,l=r.features[t].geometry;break;case"Feature":s=s||r.properties,l=r.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":l=r;break;default:throw new Error("geojson is invalid")}if(l===null)return null;var a=l.coordinates;switch(l.type){case"Point":case"MultiPoint":return null;case"LineString":return o<0&&(o=a.length+o-1),ht([a[o],a[o+1]],s,e);case"Polygon":return i<0&&(i=a.length+i),o<0&&(o=a[i].length+o-1),ht([a[i][o],a[i][o+1]],s,e);case"MultiLineString":return n<0&&(n=a.length+n),o<0&&(o=a[n].length+o-1),ht([a[n][o],a[n][o+1]],s,e);case"MultiPolygon":return n<0&&(n=a.length+n),i<0&&(i=a[n].length+i),o<0&&(o=a[n][i].length-o-1),ht([a[n][i][o],a[n][i][o+1]],s,e)}throw new Error("geojson is invalid")}je(aw,"findSegment");function uw(r,e){if(e=e||{},!Rs(e))throw new Error("options is invalid");var t=e.featureIndex||0,n=e.multiFeatureIndex||0,i=e.geometryIndex||0,o=e.coordIndex||0,s=e.properties,l;switch(r.type){case"FeatureCollection":t<0&&(t=r.features.length+t),s=s||r.features[t].properties,l=r.features[t].geometry;break;case"Feature":s=s||r.properties,l=r.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":l=r;break;default:throw new Error("geojson is invalid")}if(l===null)return null;var a=l.coordinates;switch(l.type){case"Point":return tt(a,s,e);case"MultiPoint":return n<0&&(n=a.length+n),tt(a[n],s,e);case"LineString":return o<0&&(o=a.length+o),tt(a[o],s,e);case"Polygon":return i<0&&(i=a.length+i),o<0&&(o=a[i].length+o),tt(a[i][o],s,e);case"MultiLineString":return n<0&&(n=a.length+n),o<0&&(o=a[n].length+o),tt(a[n][o],s,e);case"MultiPolygon":return n<0&&(n=a.length+n),i<0&&(i=a[n].length+i),o<0&&(o=a[n][i].length-o),tt(a[n][i][o],s,e)}throw new Error("geojson is invalid")}je(uw,"findPoint");var vp=Object.defineProperty,fw=Object.defineProperties,cw=Object.getOwnPropertyDescriptors,Bu=Object.getOwnPropertySymbols,pw=Object.prototype.hasOwnProperty,gw=Object.prototype.propertyIsEnumerable,Nu=(r,e,t)=>e in r?vp(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Kt=(r,e)=>{for(var t in e||(e={}))pw.call(e,t)&&Nu(r,t,e[t]);if(Bu)for(var t of Bu(e))gw.call(e,t)&&Nu(r,t,e[t]);return r},Zt=(r,e)=>fw(r,cw(e)),hw=(r,e)=>vp(r,"name",{value:e,configurable:!0});function _p(r,e,t={}){if(!r||!e)throw new Error("lines and pt are required arguments");let n=tt([1/0,1/0],{dist:1/0,index:-1,location:-1}),i=0;return Ln(r,function(o){const s=lp(o);for(let l=0;l<s.length-1;l++){const a=tt(s[l]);a.properties.dist=mr(e,a,t);const u=tt(s[l+1]);u.properties.dist=mr(e,u,t);const f=mr(a,u,t),c=Math.max(a.properties.dist,u.properties.dist),g=Gs(a,u),p=as(e,c,g+90,t),h=as(e,c,g-90,t),m=gp(ht([p.geometry.coordinates,h.geometry.coordinates]),ht([a.geometry.coordinates,u.geometry.coordinates]));let v;m.features.length>0&&m.features[0]&&(v=Zt(Kt({},m.features[0]),{properties:{dist:mr(e,m.features[0],t),location:i+mr(a,m.features[0],t)}})),a.properties.dist<n.properties.dist&&(n=Zt(Kt({},a),{properties:Zt(Kt({},a.properties),{index:l,location:i})})),u.properties.dist<n.properties.dist&&(n=Zt(Kt({},u),{properties:Zt(Kt({},u.properties),{index:l+1,location:i+f})})),v&&v.properties.dist<n.properties.dist&&(n=Zt(Kt({},v),{properties:Zt(Kt({},v.properties),{index:l})})),i+=f}}),n}hw(_p,"nearestPointOnLine");var mw=_p;const bp="/scheme-sketcher/assets/split_route-9e0ea2da.svg";function dw(r){let e,t;const n=[le(r[0],"draw-split-route"),{paint:{"circle-color":"black","circle-radius":Tu}}];let i={};for(let o=0;o<n.length;o+=1)i=de(i,n[o]);return e=new wr({props:i}),{c(){L(e.$$.fragment)},m(o,s){A(e,o,s),t=!0},p(o,s){const l=s&1?$e(n,[s&1&&De(le(o[0],"draw-split-route")),s&0&&{paint:{"circle-color":"black","circle-radius":Tu}}]):{};e.$set(l)},i(o){t||(S(e.$$.fragment,o),t=!0)},o(o){k(e.$$.fragment,o),t=!1},d(o){C(e,o)}}}function yw(r){let e,t,n,i,o,s;return e=new Ig({}),e.$on("mousemove",r[3]),e.$on("click",r[4]),n=new ir({props:{data:r[2],$$slots:{default:[dw]},$$scope:{ctx:r}}}),{c(){L(e.$$.fragment),t=O(),L(n.$$.fragment)},m(l,a){A(e,l,a),w(l,t,a),A(n,l,a),i=!0,o||(s=ne(window,"keydown",r[5]),o=!0)},p(l,[a]){const u={};a&4&&(u.data=l[2]),a&2049&&(u.$$scope={dirty:a,ctx:l}),n.$set(u)},i(l){i||(S(e.$$.fragment,l),S(n.$$.fragment,l),i=!0)},o(l){k(e.$$.fragment,l),k(n.$$.fragment,l),i=!1},d(l){l&&$(t),C(e,l),C(n,l),o=!1,s()}}}const Tu=10,vw=30;function _w(r,e,t){let n,i=ee,o=()=>(i(),i=bt(a,v=>t(8,n=v)),a),s;V(r,ot,v=>t(9,s=v)),r.$$.on_destroy.push(()=>i());let{cfg:l}=e,{gjSchemes:a}=e;o(),Nt(()=>{s&&(s.getCanvas().style.cursor=`url(${bp}), crosshair`)}),st(()=>{s&&(s.getCanvas().style.cursor="inherit")});let u=null,f=null,c=Pr();function g(v){if(!s)return;t(6,u=null),f=null;let _=m(v.detail.lngLat.toArray());const y=[v.detail.point.x-vw,v.detail.point.y],d=s.unproject(v.detail.point).distanceTo(s.unproject(y))/1e3;let E=[];for(let[b,M]of n.features.entries())if(M.geometry.type=="LineString"){let R=mw(M.geometry,_,{units:"kilometers"});R.properties.dist!=null&&R.properties.dist<=d&&E.push([b,R.geometry.coordinates,R.properties.dist])}E.sort((b,M)=>b[2]-M[2]),E.length>0&&(t(6,u=m(E[0][1])),f=E[0][0])}function p(){if(f==null){oe.set({mode:"list"});return}let v=ib(n.features[f],u);if(v!=null){let[_,y]=v;a.update(d=>(_.id=d.features[f].id,y.id=Mn(d),d.features.splice(f,1,_,y),d))}t(6,u=null),f=null}function h(v){v.key=="Escape"&&(v.stopPropagation(),oe.set({mode:"list"}))}function m(v){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:Qc(v)}}}return r.$$set=v=>{"cfg"in v&&t(0,l=v.cfg),"gjSchemes"in v&&o(t(1,a=v.gjSchemes))},r.$$.update=()=>{if(r.$$.dirty&64){let v=Pr();u&&v.features.push(u),t(2,c=v)}},[l,a,c,g,p,h,u]}class bw extends Z{constructor(e){super(),Q(this,e,_w,yw,K,{cfg:0,gjSchemes:1})}}function Du(r){let e,t;return e=new pe({props:{$$slots:{default:[ww]},$$scope:{ctx:r}}}),e.$on("click",r[5]),{c(){L(e.$$.fragment)},m(n,i){A(e,n,i),t=!0},p(n,i){const o={};i&128&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(S(e.$$.fragment,n),t=!0)},o(n){k(e.$$.fragment,n),t=!1},d(n){C(e,n)}}}function ww(r){let e;return{c(){e=U("X")},m(t,n){w(t,e,n)},d(t){t&&$(e)}}}function $w(r){let e,t,n,i,o,s,l,a,u,f,c=r[2]&&Du(r);const g=r[4].default,p=Ce(g,r,r[7],null);return{c(){e=N("div"),t=N("div"),n=N("div"),i=N("h1"),o=U(r[1]),s=O(),c&&c.c(),l=O(),p&&p.c(),B(i,"class","govuk-heading-l"),ye(n,"display","flex"),ye(n,"justify-content","space-between"),B(t,"class","content centered-fullscreen svelte-1st8ub0"),B(e,"class","background svelte-1st8ub0"),Gt(e,"open",r[0]),Gt(e,"closed",!r[0])},m(h,m){w(h,e,m),D(e,t),D(t,n),D(n,i),D(i,o),D(n,s),c&&c.m(n,null),D(t,l),p&&p.m(t,null),a=!0,u||(f=[ne(t,"click",Un(Sw)),ne(e,"click",r[6])],u=!0)},p(h,[m]){(!a||m&2)&&me(o,h[1]),h[2]?c?(c.p(h,m),m&4&&S(c,1)):(c=Du(h),c.c(),S(c,1),c.m(n,null)):c&&(ue(),k(c,1,1,()=>{c=null}),fe()),p&&p.p&&(!a||m&128)&&Fe(p,g,h,h[7],a?Re(g,h[7],m,null):Oe(h[7]),null),(!a||m&1)&&Gt(e,"open",h[0]),(!a||m&1)&&Gt(e,"closed",!h[0])},i(h){a||(S(c),S(p,h),a=!0)},o(h){k(c),k(p,h),a=!1},d(h){h&&$(e),c&&c.d(),p&&p.d(h),u=!1,It(f)}}}const Sw=()=>null;function kw(r,e,t){let{$$slots:n={},$$scope:i}=e,{title:o}=e,{open:s=!1}=e,{displayEscapeButton:l=!0}=e,{canCloseByClickingBackground:a=!0}=e;const u=()=>t(0,s=!1),f=()=>{a&&t(0,s=!1)};return r.$$set=c=>{"title"in c&&t(1,o=c.title),"open"in c&&t(0,s=c.open),"displayEscapeButton"in c&&t(2,l=c.displayEscapeButton),"canCloseByClickingBackground"in c&&t(3,a=c.canCloseByClickingBackground),"$$scope"in c&&t(7,i=c.$$scope)},[s,o,l,a,n,u,f,i]}class wp extends Z{constructor(e){super(),Q(this,e,kw,$w,K,{title:1,open:0,displayEscapeButton:2,canCloseByClickingBackground:3})}}function Ew(r){let e;return{c(){e=N("ul"),e.innerHTML=`<li><b>Click</b>
    on the map to open a new tab with a 3rd-party imagery provider</li> <li>Press <b>Escape</b>
    to exit this mode</li> <li>Cursor by <a href="https://icon-icons.com/icon/screenshot-cursor-camera/100181" target="_blank" rel="noreferrer">Luc Chaissac</a></li>`},m(t,n){w(t,e,n)},p:ee,i:ee,o:ee,d(t){t&&$(e)}}}class $p extends Z{constructor(e){super(),Q(this,e,null,Ew,K,{})}}const Mw="/scheme-sketcher/assets/camera_cursor-824d29b6.svg",{window:Pw}=sf;function ju(r){let e,t,n,i;const o=[Aw,Lw],s=[];function l(a,u){return a[0]?0:1}return e=l(r),t=s[e]=o[e](r),{c(){t.c(),n=ve()},m(a,u){s[e].m(a,u),w(a,n,u),i=!0},p(a,u){let f=e;e=l(a),e===f?s[e].p(a,u):(ue(),k(s[f],1,1,()=>{s[f]=null}),fe(),t=s[e],t?t.p(a,u):(t=s[e]=o[e](a),t.c()),S(t,1),t.m(n.parentNode,n))},i(a){i||(S(t),i=!0)},o(a){k(t),i=!1},d(a){a&&$(n),s[e].d(a)}}}function Lw(r){let e,t;return e=new pe({props:{$$slots:{default:[Cw]},$$scope:{ctx:r}}}),e.$on("click",r[8]),{c(){L(e.$$.fragment)},m(n,i){A(e,n,i),t=!0},p(n,i){const o={};i&8192&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(S(e.$$.fragment,n),t=!0)},o(n){k(e.$$.fragment,n),t=!1},d(n){C(e,n)}}}function Aw(r){let e,t,n,i,o,s,l;e=new pe({props:{$$slots:{default:[Fw]},$$scope:{ctx:r}}}),e.$on("click",r[6]);function a(f){r[7](f)}let u={legend:"Source",choices:[["google","Google Street View"],["bing","Bing Streetside"]]};return r[2].streetViewImagery!==void 0&&(u.value=r[2].streetViewImagery),n=new cf({props:u}),be.push(()=>Se(n,"value",a)),s=new ng({props:{label:"Help",$$slots:{default:[Ow]},$$scope:{ctx:r}}}),{c(){L(e.$$.fragment),t=O(),L(n.$$.fragment),o=O(),L(s.$$.fragment)},m(f,c){A(e,f,c),w(f,t,c),A(n,f,c),w(f,o,c),A(s,f,c),l=!0},p(f,c){const g={};c&8192&&(g.$$scope={dirty:c,ctx:f}),e.$set(g);const p={};!i&&c&4&&(i=!0,p.value=f[2].streetViewImagery,Ee(()=>i=!1)),n.$set(p);const h={};c&8192&&(h.$$scope={dirty:c,ctx:f}),s.$set(h)},i(f){l||(S(e.$$.fragment,f),S(n.$$.fragment,f),S(s.$$.fragment,f),l=!0)},o(f){k(e.$$.fragment,f),k(n.$$.fragment,f),k(s.$$.fragment,f),l=!1},d(f){f&&($(t),$(o)),C(e,f),C(n,f),C(s,f)}}}function Cw(r){let e;return{c(){e=U("Enable Street View")},m(t,n){w(t,e,n)},d(t){t&&$(e)}}}function Fw(r){let e;return{c(){e=U("Disable Street View")},m(t,n){w(t,e,n)},d(t){t&&$(e)}}}function Ow(r){let e,t;return e=new $p({}),{c(){L(e.$$.fragment)},m(n,i){A(e,n,i),t=!0},i(n){t||(S(e.$$.fragment,n),t=!0)},o(n){k(e.$$.fragment,n),t=!1},d(n){C(e,n)}}}function Rw(r){let e,t,n,i,o=r[1]&&ju(r);return{c(){o&&o.c(),e=ve()},m(s,l){o&&o.m(s,l),w(s,e,l),t=!0,n||(i=ne(Pw,"keydown",r[3]),n=!0)},p(s,[l]){s[1]?o?(o.p(s,l),l&2&&S(o,1)):(o=ju(s),o.c(),S(o,1),o.m(e.parentNode,e)):o&&(ue(),k(o,1,1,()=>{o=null}),fe())},i(s){t||(S(o),t=!0)},o(s){k(o),t=!1},d(s){s&&$(e),o&&o.d(s),n=!1,i()}}}function Iw(r,e,t){let n;V(r,sr,v=>t(2,n=v));let{cfg:i}=e,{map:o}=e,{enabled:s}=e,{showControls:l=!0}=e,a=[];function u(){if(o){o.on("click",c),o.getCanvas().style.cursor=`url(${Mw}), auto`;for(let v of i.getStreetViewRoadLayerNames(o))a.push([v,o.getPaintProperty(v,"line-color")]),o.setPaintProperty(v,"line-color","cyan")}}function f(){if(o){o.off("click",c),o.getCanvas().style.cursor="inherit";for(let[v,_]of a)o.setPaintProperty(v,"line-color",_);a=[]}}st(f);function c(v){if(!s)return;let _=v.lngLat.lng,y=v.lngLat.lat;n.streetViewImagery=="google"?window.open(`http://maps.google.com/maps?q=&layer=c&cbll=${y},${_}&cbp=11,0,0,0,0`,"_blank"):n.streetViewImagery=="bing"&&window.open(`https://www.bing.com/maps?cp=${y}~${_}&style=x`,"_blank")}function g(v){s&&v.key=="Escape"&&(v.stopPropagation(),t(0,s=!1))}const p=()=>t(0,s=!1);function h(v){r.$$.not_equal(n.streetViewImagery,v)&&(n.streetViewImagery=v,sr.set(n))}const m=()=>t(0,s=!0);return r.$$set=v=>{"cfg"in v&&t(4,i=v.cfg),"map"in v&&t(5,o=v.map),"enabled"in v&&t(0,s=v.enabled),"showControls"in v&&t(1,l=v.showControls)},r.$$.update=()=>{r.$$.dirty&1&&(s?u():f())},[s,l,n,g,i,o,p,h,m]}class Bw extends Z{constructor(e){super(),Q(this,e,Iw,Rw,K,{cfg:4,map:5,enabled:0,showControls:1})}}const Nw="/scheme-sketcher/assets/warning-81bba3f6.svg";function Tw(r){let e,t;return{c(){e=N("img"),nt(e.src,t=Nw)||B(e,"src",t),B(e,"title",r[0]),B(e,"alt",r[0])},m(n,i){w(n,e,i)},p(n,[i]){i&1&&B(e,"title",n[0]),i&1&&B(e,"alt",n[0])},i:ee,o:ee,d(n){n&&$(e)}}}function Dw(r,e,t){let{text:n}=e;return r.$$set=i=>{"text"in i&&t(0,n=i.text)},[n]}class jw extends Z{constructor(e){super(),Q(this,e,Dw,Tw,K,{text:0})}}async function Gw(r,e){let t=await fetch(r),n=t.body.getReader(),i=t.headers.get("Content-Length");if(!i)throw new Error(`No Content-Length header from ${r}`);let o=parseInt(i),s=0,l=[];for(;;){let{done:f,value:c}=await n.read();if(f)break;c&&(l.push(c),s+=c.length,e(100*s/o))}let a=new Uint8Array(s),u=0;for(let f of l)a.set(f,u),u+=f.length;return a}function Uw(r){let e;return{c(){e=U("Finish")},m(t,n){w(t,e,n)},d(t){t&&$(e)}}}function qw(r){let e,t,n,i,o,s,l,a,u,f;function c(m){r[4](m)}let g={cfg:r[0],map:r[2],showControls:!1};r[1]!==void 0&&(g.enabled=r[1]),e=new Bw({props:g}),be.push(()=>Se(e,"enabled",c)),i=new Tt({props:{$$slots:{default:[Uw]},$$scope:{ctx:r}}}),i.$on("click",r[5]);function p(m){r[6](m)}let h={legend:"Source",choices:[["google","Google Street View"],["bing","Bing Streetside"]],inlineSmall:!0};return r[3].streetViewImagery!==void 0&&(h.value=r[3].streetViewImagery),s=new cf({props:h}),be.push(()=>Se(s,"value",p)),u=new $p({}),{c(){L(e.$$.fragment),n=O(),L(i.$$.fragment),o=O(),L(s.$$.fragment),a=O(),L(u.$$.fragment)},m(m,v){A(e,m,v),w(m,n,v),A(i,m,v),w(m,o,v),A(s,m,v),w(m,a,v),A(u,m,v),f=!0},p(m,[v]){const _={};v&1&&(_.cfg=m[0]),v&4&&(_.map=m[2]),!t&&v&2&&(t=!0,_.enabled=m[1],Ee(()=>t=!1)),e.$set(_);const y={};v&128&&(y.$$scope={dirty:v,ctx:m}),i.$set(y);const d={};!l&&v&8&&(l=!0,d.value=m[3].streetViewImagery,Ee(()=>l=!1)),s.$set(d)},i(m){f||(S(e.$$.fragment,m),S(i.$$.fragment,m),S(s.$$.fragment,m),S(u.$$.fragment,m),f=!0)},o(m){k(e.$$.fragment,m),k(i.$$.fragment,m),k(s.$$.fragment,m),k(u.$$.fragment,m),f=!1},d(m){m&&($(n),$(o),$(a)),C(e,m),C(i,m),C(s,m),C(u,m)}}}function zw(r,e,t){let n,i;V(r,ot,f=>t(2,n=f)),V(r,sr,f=>t(3,i=f));let{cfg:o}=e,s=!0;function l(f){s=f,t(1,s)}const a=()=>t(1,s=!1);function u(f){r.$$.not_equal(i.streetViewImagery,f)&&(i.streetViewImagery=f,sr.set(i))}return r.$$set=f=>{"cfg"in f&&t(0,o=f.cfg)},r.$$.update=()=>{r.$$.dirty&2&&(s||oe.set({mode:"list"}))},[o,s,n,i,l,a,u]}class Ww extends Z{constructor(e){super(),Q(this,e,zw,qw,K,{cfg:0})}}const Hw="/scheme-sketcher/assets/image-3e3a13e8.svg",Jw="/scheme-sketcher/assets/point-276f4055.svg",Vw="/scheme-sketcher/assets/polygon_freehand-cf965967.svg",Yw="/scheme-sketcher/assets/polygon_snapped-18efbbea.svg",Xw="/scheme-sketcher/assets/route-d3c0ebad.svg",Kw="/scheme-sketcher/assets/street_view-48580b6a.svg";function Zw(r){let e,t,n;return{c(){e=N("img"),n=U(`
    New point`),nt(e.src,t=Jw)||B(e,"src",t),B(e,"alt","New point")},m(i,o){w(i,e,o),w(i,n,o)},p:ee,d(i){i&&($(e),$(n))}}}function Qw(r){let e,t,n;return{c(){e=N("img"),n=U(`
    New route`),nt(e.src,t=Xw)||B(e,"src",t),B(e,"alt","New route")},m(i,o){w(i,e,o),w(i,n,o)},p:ee,d(i){i&&($(e),$(n))}}}function xw(r){let e,t,n;return{c(){e=N("img"),n=U(`
    New polygon (freehand)`),nt(e.src,t=Vw)||B(e,"src",t),B(e,"alt","New polygon (freehand)")},m(i,o){w(i,e,o),w(i,n,o)},p:ee,d(i){i&&($(e),$(n))}}}function e$(r){let e,t,n;return{c(){e=N("img"),n=U(`
    New polygon (snapped)`),nt(e.src,t=Yw)||B(e,"src",t),B(e,"alt","New polygon (snapped)")},m(i,o){w(i,e,o),w(i,n,o)},p:ee,d(i){i&&($(e),$(n))}}}function t$(r){let e,t,n;return{c(){e=N("img"),n=U(`
    Split route`),nt(e.src,t=bp)||B(e,"src",t),B(e,"alt","Split route")},m(i,o){w(i,e,o),w(i,n,o)},p:ee,d(i){i&&($(e),$(n))}}}function r$(r){let e,t,n;return{c(){e=N("img"),n=U(`
    Georeference image`),nt(e.src,t=Hw)||B(e,"src",t),B(e,"alt","Georeference image")},m(i,o){w(i,e,o),w(i,n,o)},p:ee,d(i){i&&($(e),$(n))}}}function n$(r){let e,t,n;return{c(){e=N("img"),n=U(`
    StreetView`),nt(e.src,t=Kw)||B(e,"src",t),B(e,"alt","StreetView")},m(i,o){w(i,e,o),w(i,n,o)},p:ee,d(i){i&&($(e),$(n))}}}function i$(r){let e,t,n,i,o,s,l,a,u,f,c,g,p,h,m,v,_;return e=new f1({props:{cfg:r[0],gjSchemes:r[1]}}),i=new pe({props:{disabled:!r[2],$$slots:{default:[Zw]},$$scope:{ctx:r}}}),i.$on("click",r[5]),s=new pe({props:{disabled:!r[3],$$slots:{default:[Qw]},$$scope:{ctx:r}}}),s.$on("click",r[6]),a=new pe({props:{disabled:!r[4],$$slots:{default:[xw]},$$scope:{ctx:r}}}),a.$on("click",r[7]),f=new pe({props:{disabled:!r[3],$$slots:{default:[e$]},$$scope:{ctx:r}}}),f.$on("click",r[8]),g=new pe({props:{$$slots:{default:[t$]},$$scope:{ctx:r}}}),g.$on("click",r[9]),h=new pe({props:{$$slots:{default:[r$]},$$scope:{ctx:r}}}),h.$on("click",r[10]),v=new pe({props:{$$slots:{default:[n$]},$$scope:{ctx:r}}}),v.$on("click",r[11]),{c(){L(e.$$.fragment),t=O(),n=N("div"),L(i.$$.fragment),o=O(),L(s.$$.fragment),l=O(),L(a.$$.fragment),u=O(),L(f.$$.fragment),c=O(),L(g.$$.fragment),p=O(),L(h.$$.fragment),m=O(),L(v.$$.fragment),B(n,"class","top govuk-prose svelte-1kai3ke")},m(y,d){A(e,y,d),w(y,t,d),w(y,n,d),A(i,n,null),D(n,o),A(s,n,null),D(n,l),A(a,n,null),D(n,u),A(f,n,null),D(n,c),A(g,n,null),D(n,p),A(h,n,null),D(n,m),A(v,n,null),_=!0},p(y,[d]){const E={};d&1&&(E.cfg=y[0]),d&2&&(E.gjSchemes=y[1]),e.$set(E);const b={};d&4&&(b.disabled=!y[2]),d&4096&&(b.$$scope={dirty:d,ctx:y}),i.$set(b);const M={};d&8&&(M.disabled=!y[3]),d&4096&&(M.$$scope={dirty:d,ctx:y}),s.$set(M);const R={};d&16&&(R.disabled=!y[4]),d&4096&&(R.$$scope={dirty:d,ctx:y}),a.$set(R);const j={};d&8&&(j.disabled=!y[3]),d&4096&&(j.$$scope={dirty:d,ctx:y}),f.$set(j);const z={};d&4096&&(z.$$scope={dirty:d,ctx:y}),g.$set(z);const G={};d&4096&&(G.$$scope={dirty:d,ctx:y}),h.$set(G);const F={};d&4096&&(F.$$scope={dirty:d,ctx:y}),v.$set(F)},i(y){_||(S(e.$$.fragment,y),S(i.$$.fragment,y),S(s.$$.fragment,y),S(a.$$.fragment,y),S(f.$$.fragment,y),S(g.$$.fragment,y),S(h.$$.fragment,y),S(v.$$.fragment,y),_=!0)},o(y){k(e.$$.fragment,y),k(i.$$.fragment,y),k(s.$$.fragment,y),k(a.$$.fragment,y),k(f.$$.fragment,y),k(g.$$.fragment,y),k(h.$$.fragment,y),k(v.$$.fragment,y),_=!1},d(y){y&&($(t),$(n)),C(e,y),C(i),C(s),C(a),C(f),C(g),C(h),C(v)}}}function o$(r,e,t){let n,i,o;V(r,_n,m=>t(2,n=m)),V(r,Ct,m=>t(3,i=m)),V(r,Fr,m=>t(4,o=m));let{cfg:s}=e,{gjSchemes:l}=e;const a=()=>oe.set({mode:"new-point"}),u=()=>oe.set({mode:"new-route"}),f=()=>oe.set({mode:"new-freehand-polygon"}),c=()=>oe.set({mode:"new-snapped-polygon"}),g=()=>oe.set({mode:"split-route"}),p=()=>oe.set({mode:"set-image"}),h=()=>oe.set({mode:"streetview"});return r.$$set=m=>{"cfg"in m&&t(0,s=m.cfg),"gjSchemes"in m&&t(1,l=m.gjSchemes)},[s,l,n,i,o,a,u,f,c,g,p,h]}class s$ extends Z{constructor(e){super(),Q(this,e,o$,i$,K,{cfg:0,gjSchemes:1})}}function l$(r){let e;return{c(){e=U("Save")},m(t,n){w(t,e,n)},d(t){t&&$(e)}}}function a$(r){let e;return{c(){e=U("Edit geometry")},m(t,n){w(t,e,n)},d(t){t&&$(e)}}}function u$(r){let e;return{c(){e=U("Delete")},m(t,n){w(t,e,n)},d(t){t&&$(e)}}}function f$(r){let e,t,n,i,o,s;return e=new Tt({props:{$$slots:{default:[l$]},$$scope:{ctx:r}}}),e.$on("click",r[5]),n=new pe({props:{$$slots:{default:[a$]},$$scope:{ctx:r}}}),n.$on("click",r[6]),o=new Br({props:{$$slots:{default:[u$]},$$scope:{ctx:r}}}),o.$on("click",r[7]),{c(){L(e.$$.fragment),t=O(),L(n.$$.fragment),i=O(),L(o.$$.fragment)},m(l,a){A(e,l,a),w(l,t,a),A(n,l,a),w(l,i,a),A(o,l,a),s=!0},p(l,a){const u={};a&8192&&(u.$$scope={dirty:a,ctx:l}),e.$set(u);const f={};a&8192&&(f.$$scope={dirty:a,ctx:l}),n.$set(f);const c={};a&8192&&(c.$$scope={dirty:a,ctx:l}),o.$set(c)},i(l){s||(S(e.$$.fragment,l),S(n.$$.fragment,l),S(o.$$.fragment,l),s=!0)},o(l){k(e.$$.fragment,l),k(n.$$.fragment,l),k(o.$$.fragment,l),s=!1},d(l){l&&($(t),$(i)),C(e,l),C(n,l),C(o,l)}}}function c$(r){let e,t,n=r[0].interventionName(r[3])+"",i,o,s,l,a,u,f,c,g,p,h,m;s=new Jt({props:{$$slots:{default:[f$]},$$scope:{ctx:r}}}),a=new Bt({props:{errorMessage:r[0].interventionWarning(r[3])}});function v(d){r[8](d)}var _=r[0].editFeatureForm;function y(d,E){let b={cfg:d[0],gjSchemes:d[1],id:d[2]};return d[3].properties!==void 0&&(b.props=d[3].properties),{props:b}}return _&&(f=oi(_,y(r)),be.push(()=>Se(f,"props",v))),{c(){e=N("h2"),t=U("Editing "),i=U(n),o=O(),L(s.$$.fragment),l=O(),L(a.$$.fragment),u=O(),f&&L(f.$$.fragment),g=ve()},m(d,E){w(d,e,E),D(e,t),D(e,i),w(d,o,E),A(s,d,E),w(d,l,E),A(a,d,E),w(d,u,E),f&&A(f,d,E),w(d,g,E),p=!0,h||(m=ne(window,"keydown",r[4]),h=!0)},p(d,[E]){(!p||E&9)&&n!==(n=d[0].interventionName(d[3])+"")&&me(i,n);const b={};E&8198&&(b.$$scope={dirty:E,ctx:d}),s.$set(b);const M={};if(E&9&&(M.errorMessage=d[0].interventionWarning(d[3])),a.$set(M),E&1&&_!==(_=d[0].editFeatureForm)){if(f){ue();const R=f;k(R.$$.fragment,1,0,()=>{C(R,1)}),fe()}_?(f=oi(_,y(d)),be.push(()=>Se(f,"props",v)),L(f.$$.fragment),S(f.$$.fragment,1),A(f,g.parentNode,g)):f=null}else if(_){const R={};E&1&&(R.cfg=d[0]),E&2&&(R.gjSchemes=d[1]),E&4&&(R.id=d[2]),!c&&E&8&&(c=!0,R.props=d[3].properties,Ee(()=>c=!1)),f.$set(R)}},i(d){p||(S(s.$$.fragment,d),S(a.$$.fragment,d),f&&S(f.$$.fragment,d),p=!0)},o(d){k(s.$$.fragment,d),k(a.$$.fragment,d),f&&k(f.$$.fragment,d),p=!1},d(d){d&&($(e),$(o),$(l),$(u),$(g)),C(s,d),C(a,d),f&&C(f,d),h=!1,m()}}}function p$(r,e,t){let n,i,o=ee,s=()=>(o(),o=bt(a,y=>t(10,i=y)),a);V(r,ot,y=>t(9,n=y)),r.$$.on_destroy.push(()=>o());let{cfg:l}=e,{gjSchemes:a}=e;s();let{id:u}=e,f=i.features.find(y=>y.id==u);function c(y){a.set(i)}Nt(()=>{n==null||n.on("click",g)}),st(()=>{n==null||n.off("click",g)});function g(y){for(let d of n.queryRenderedFeatures(y.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]}))if(d.id==u)return;oe.set({mode:"list"})}function p(y){if(y.key=="Escape"){y.stopPropagation(),oe.set({mode:"list"});return}if(y.key=="Delete"){const d=y.target.tagName;if(d=="INPUT"||d=="TEXTAREA")return;y.stopPropagation(),Su(a,u)}if(y.key=="e"){const d=y.target.tagName;if(d=="INPUT"||d=="TEXTAREA")return;y.stopPropagation(),oe.set({mode:"edit-geometry",id:u})}}const h=()=>oe.set({mode:"list"}),m=()=>oe.set({mode:"edit-geometry",id:u}),v=()=>Su(a,u);function _(y){r.$$.not_equal(f.properties,y)&&(f.properties=y,t(3,f))}return r.$$set=y=>{"cfg"in y&&t(0,l=y.cfg),"gjSchemes"in y&&s(t(1,a=y.gjSchemes)),"id"in y&&t(2,u=y.id)},r.$$.update=()=>{r.$$.dirty&8&&c()},[l,a,u,f,p,h,m,v,_]}class g$ extends Z{constructor(e){super(),Q(this,e,p$,c$,K,{cfg:0,gjSchemes:1,id:2})}}const h$="/scheme-sketcher/assets/delete-3c023172.svg";function Gu(r,e,t){const n=r.slice();n[29]=e[t];const i=n[0].interventionWarning(n[29]);return n[30]=i,n}function m$(r){let e,t,n;return{c(){e=N("img"),n=U(`
    Delete`),nt(e.src,t=h$)||B(e,"src",t),B(e,"alt","Delete scheme")},m(i,o){w(i,e,o),w(i,n,o)},p:ee,d(i){i&&($(e),$(n))}}}function d$(r){let e;return{c(){e=U("Show")},m(t,n){w(t,e,n)},d(t){t&&$(e)}}}function y$(r){let e,t;return e=new Bt({props:{errorMessage:"There's a problem with "+r[8]+" interventions below"}}),{c(){L(e.$$.fragment)},m(n,i){A(e,n,i),t=!0},p(n,i){const o={};i[0]&256&&(o.errorMessage="There's a problem with "+n[8]+" interventions below"),e.$set(o)},i(n){t||(S(e.$$.fragment,n),t=!0)},o(n){k(e.$$.fragment,n),t=!1},d(n){C(e,n)}}}function v$(r){let e,t;return e=new Bt({props:{errorMessage:"There's a problem with one intervention below"}}),{c(){L(e.$$.fragment)},m(n,i){A(e,n,i),t=!0},p:ee,i(n){t||(S(e.$$.fragment,n),t=!0)},o(n){k(e.$$.fragment,n),t=!1},d(n){C(e,n)}}}function Uu(r){let e,t;return e=new jw({props:{text:r[30]}}),{c(){L(e.$$.fragment)},m(n,i){A(e,n,i),t=!0},p(n,i){const o={};i[0]&13&&(o.text=n[30]),e.$set(o)},i(n){t||(S(e.$$.fragment,n),t=!0)},o(n){k(e.$$.fragment,n),t=!1},d(n){C(e,n)}}}function qu(r,e){let t,n,i,o=e[0].interventionName(e[29])+"",s,l,a,u,f,c=e[30]&&Uu(e);function g(...m){return e[20](e[29],...m)}function p(){return e[21](e[29])}function h(){return e[22](e[29])}return{key:r,first:null,c(){t=N("li"),n=N("a"),c&&c.c(),i=O(),s=U(o),l=O(),B(n,"href","#"),this.first=t},m(m,v){w(m,t,v),D(t,n),c&&c.m(n,null),D(n,i),D(n,s),D(t,l),a=!0,u||(f=[ne(n,"click",g),ne(n,"mouseenter",p),ne(n,"mouseleave",h)],u=!0)},p(m,v){e=m,e[30]?c?(c.p(e,v),v[0]&13&&S(c,1)):(c=Uu(e),c.c(),S(c,1),c.m(n,i)):c&&(ue(),k(c,1,1,()=>{c=null}),fe()),(!a||v[0]&13)&&o!==(o=e[0].interventionName(e[29])+"")&&me(s,o)},i(m){a||(S(c),a=!0)},o(m){k(c),a=!1},d(m){m&&$(t),c&&c.d(),u=!1,It(f)}}}function zu(r){let e,t,n,i,o=r[7]==1?"intervention":"interventions",s,l,a,u,f,c;function g(h){r[23](h)}let p={label:"Move interventions to another scheme",choices:r[13]()};return r[5]!==void 0&&(p.value=r[5]),u=new bo({props:p}),be.push(()=>Se(u,"value",g)),u.$on("change",r[12]),{c(){e=N("p"),t=U("Do you want to first move "),n=U(r[7]),i=O(),s=U(o),l=U(" to another scheme?"),a=O(),L(u.$$.fragment)},m(h,m){w(h,e,m),D(e,t),D(e,n),D(e,i),D(e,s),D(e,l),w(h,a,m),A(u,h,m),c=!0},p(h,m){(!c||m[0]&128)&&me(n,h[7]),(!c||m[0]&128)&&o!==(o=h[7]==1?"intervention":"interventions")&&me(s,o);const v={};!f&&m[0]&32&&(f=!0,v.value=h[5],Ee(()=>f=!1)),u.$set(v)},i(h){c||(S(u.$$.fragment,h),c=!0)},o(h){k(u.$$.fragment,h),c=!1},d(h){h&&($(e),$(a)),C(u,h)}}}function _$(r){let e;return{c(){e=U("Delete scheme")},m(t,n){w(t,e,n)},d(t){t&&$(e)}}}function b$(r){let e;return{c(){e=U("Cancel")},m(t,n){w(t,e,n)},d(t){t&&$(e)}}}function w$(r){let e,t,n,i;return e=new Br({props:{$$slots:{default:[_$]},$$scope:{ctx:r}}}),e.$on("click",r[11]),n=new pe({props:{$$slots:{default:[b$]},$$scope:{ctx:r}}}),n.$on("click",r[24]),{c(){L(e.$$.fragment),t=O(),L(n.$$.fragment)},m(o,s){A(e,o,s),w(o,t,s),A(n,o,s),i=!0},p(o,s){const l={};s[0]&67108864&&(l.$$scope={dirty:s,ctx:o}),e.$set(l);const a={};s[0]&67108864&&(a.$$scope={dirty:s,ctx:o}),n.$set(a)},i(o){i||(S(e.$$.fragment,o),S(n.$$.fragment,o),i=!0)},o(o){k(e.$$.fragment,o),k(n.$$.fragment,o),i=!1},d(o){o&&$(t),C(e,o),C(n,o)}}}function $$(r){let e=r[7]>0&&r[13]().length>0,t,n,i,o=e&&zu(r);return n=new Jt({props:{$$slots:{default:[w$]},$$scope:{ctx:r}}}),{c(){o&&o.c(),t=O(),L(n.$$.fragment)},m(s,l){o&&o.m(s,l),w(s,t,l),A(n,s,l),i=!0},p(s,l){l[0]&128&&(e=s[7]>0&&s[13]().length>0),e?o?(o.p(s,l),l[0]&128&&S(o,1)):(o=zu(s),o.c(),S(o,1),o.m(t.parentNode,t)):o&&(ue(),k(o,1,1,()=>{o=null}),fe());const a={};l[0]&67108880&&(a.$$scope={dirty:l,ctx:s}),n.$set(a)},i(s){i||(S(o),S(n.$$.fragment,s),i=!0)},o(s){k(o),k(n.$$.fragment,s),i=!1},d(s){s&&$(t),o&&o.d(s),C(n,s)}}}function S$(r){let e,t=r[0].schemeName(r[3].schemes[r[2]])+"",n,i,o,s,l,a,u,f,c,g,p,h,m,v,_,y,d=[],E=new Map,b,M,R,j,z,G;l=new Br({props:{$$slots:{default:[m$]},$$scope:{ctx:r}}}),l.$on("click",r[17]);function F(W){r[18](W)}let P={$$slots:{default:[d$]},$$scope:{ctx:r}};r[6]!==void 0&&(P.checked=r[6]),u=new _o({props:P}),be.push(()=>Se(u,"checked",F)),u.$on("change",r[14]);const I=r[15].default,q=Ce(I,r,r[26],null);var ie=r[0].editSchemeForm;function X(W,x){return{props:{gjSchemes:W[1],scheme_reference:W[2]}}}ie&&(p=oi(ie,X(r)));const H=[v$,y$],T=[];function te(W,x){return W[8]==1?0:W[8]>0?1:-1}~(m=te(r))&&(v=T[m]=H[m](r));let ce=rt(r[3].features.filter(r[19]));const We=W=>W[29].id;for(let W=0;W<ce.length;W+=1){let x=Gu(r,ce,W),lt=We(x);E.set(lt,d[W]=qu(lt,x))}function Pe(W){r[25](W)}let we={title:"Delete this scheme?",displayEscapeButton:!1,$$slots:{default:[$$]},$$scope:{ctx:r}};return r[4]!==void 0&&(we.open=r[4]),M=new wp({props:we}),be.push(()=>Se(M,"open",Pe)),{c(){e=N("h3"),n=U(t),i=O(),o=N("input"),s=O(),L(l.$$.fragment),a=O(),L(u.$$.fragment),c=O(),q&&q.c(),g=O(),p&&L(p.$$.fragment),h=O(),v&&v.c(),_=O(),y=N("ol");for(let W=0;W<d.length;W+=1)d[W].c();b=O(),L(M.$$.fragment),B(o,"type","color"),B(y,"class","govuk-list govuk-list--number")},m(W,x){w(W,e,x),D(e,n),D(e,i),D(e,o),Xe(o,r[3].schemes[r[2]].color),D(e,s),A(l,e,null),w(W,a,x),A(u,W,x),w(W,c,x),q&&q.m(W,x),w(W,g,x),p&&A(p,W,x),w(W,h,x),~m&&T[m].m(W,x),w(W,_,x),w(W,y,x);for(let lt=0;lt<d.length;lt+=1)d[lt]&&d[lt].m(y,null);w(W,b,x),A(M,W,x),j=!0,z||(G=ne(o,"input",r[16]),z=!0)},p(W,x){(!j||x[0]&13)&&t!==(t=W[0].schemeName(W[3].schemes[W[2]])+"")&&me(n,t),x[0]&12&&Xe(o,W[3].schemes[W[2]].color);const lt={};x[0]&67108864&&(lt.$$scope={dirty:x,ctx:W}),l.$set(lt);const J={};if(x[0]&67108864&&(J.$$scope={dirty:x,ctx:W}),!f&&x[0]&64&&(f=!0,J.checked=W[6],Ee(()=>f=!1)),u.$set(J),q&&q.p&&(!j||x[0]&67108864)&&Fe(q,I,W,W[26],j?Re(I,W[26],x,null):Oe(W[26]),null),x[0]&1&&ie!==(ie=W[0].editSchemeForm)){if(p){ue();const Ge=p;k(Ge.$$.fragment,1,0,()=>{C(Ge,1)}),fe()}ie?(p=oi(ie,X(W)),L(p.$$.fragment),S(p.$$.fragment,1),A(p,h.parentNode,h)):p=null}else if(ie){const Ge={};x[0]&2&&(Ge.gjSchemes=W[1]),x[0]&4&&(Ge.scheme_reference=W[2]),p.$set(Ge)}let Le=m;m=te(W),m===Le?~m&&T[m].p(W,x):(v&&(ue(),k(T[Le],1,1,()=>{T[Le]=null}),fe()),~m?(v=T[m],v?v.p(W,x):(v=T[m]=H[m](W),v.c()),S(v,1),v.m(_.parentNode,_)):v=null),x[0]&1549&&(ce=rt(W[3].features.filter(W[19])),ue(),d=fs(d,x,We,1,W,ce,E,y,cs,qu,null,Gu),fe());const ur={};x[0]&67109040&&(ur.$$scope={dirty:x,ctx:W}),!R&&x[0]&16&&(R=!0,ur.open=W[4],Ee(()=>R=!1)),M.$set(ur)},i(W){if(!j){S(l.$$.fragment,W),S(u.$$.fragment,W),S(q,W),p&&S(p.$$.fragment,W),S(v);for(let x=0;x<ce.length;x+=1)S(d[x]);S(M.$$.fragment,W),j=!0}},o(W){k(l.$$.fragment,W),k(u.$$.fragment,W),k(q,W),p&&k(p.$$.fragment,W),k(v);for(let x=0;x<d.length;x+=1)k(d[x]);k(M.$$.fragment,W),j=!1},d(W){W&&($(e),$(a),$(c),$(g),$(h),$(_),$(y),$(b)),C(l),C(u,W),q&&q.d(W),p&&C(p,W),~m&&T[m].d(W);for(let x=0;x<d.length;x+=1)d[x].d();C(M,W),z=!1,G()}}}function k$(r,e,t){let n,i,o,s,l=ee,a=()=>(l(),l=bt(p,T=>t(3,s=T)),p),u;V(r,ti,T=>t(27,o=T)),V(r,ot,T=>t(28,u=T)),r.$$.on_destroy.push(()=>l());let{$$slots:f={},$$scope:c}=e,{cfg:g}=e,{gjSchemes:p}=e;a();let{scheme_reference:h}=e,m=!1;st(()=>{ln.set(null)});function v(T,te){T.preventDefault();let ce=s.features.find(We=>We.id==te);ce.geometry.type=="Point"?u==null||u.flyTo({center:ce.geometry.coordinates,duration:500}):u==null||u.fitBounds(Ec(ce),{padding:200,duration:500}),oe.set({mode:"edit-form",id:te})}function _(T){ln.update(te=>te==T?null:te)}function y(){p.update(T=>(T.features=T.features.filter(te=>te.properties.scheme_reference!=h),delete T.schemes[h],Object.keys(T.schemes).length==0&&(T=xc(g)),T)),ti.update(T=>(T.delete(h),T)),t(4,m=!1)}let d="";function E(){d&&p.update(T=>{for(let te of T.features)te.properties.scheme_reference==h&&(te.properties.scheme_reference=d);return T})}function b(){return Object.values(s.schemes).filter(T=>T.scheme_reference!=h).map(T=>[T.scheme_reference,g.schemeName(T)])}let M=!o.has(h);function R(){ti.update(T=>(M?T.delete(h):T.add(h),T))}function j(){s.schemes[h].color=this.value,p.set(s)}const z=()=>t(4,m=!0);function G(T){M=T,t(6,M)}const F=T=>T.properties.scheme_reference==h,P=(T,te)=>v(te,T.id),I=T=>ln.set(T.id),q=T=>_(T.id);function ie(T){d=T,t(5,d)}const X=()=>t(4,m=!1);function H(T){m=T,t(4,m)}return r.$$set=T=>{"cfg"in T&&t(0,g=T.cfg),"gjSchemes"in T&&a(t(1,p=T.gjSchemes)),"scheme_reference"in T&&t(2,h=T.scheme_reference),"$$scope"in T&&t(26,c=T.$$scope)},r.$$.update=()=>{r.$$.dirty[0]&13&&t(8,n=s.features.filter(T=>T.properties.scheme_reference==h&&g.interventionWarning(T)!=null).length),r.$$.dirty[0]&12&&t(7,i=s.features.filter(T=>T.properties.scheme_reference==h).length)},[g,p,h,s,m,d,M,i,n,v,_,y,E,b,R,f,j,z,G,F,P,I,q,ie,X,H,c]}class E$ extends Z{constructor(e){super(),Q(this,e,k$,S$,K,{cfg:0,gjSchemes:1,scheme_reference:2},null,[-1,-1])}}function Wu(r,e,t){const n=r.slice();return n[9]=e[t],n[11]=t,n}function M$(r){let e;return{c(){e=U("Add new blank scheme")},m(t,n){w(t,e,n)},d(t){t&&$(e)}}}function Hu(r){let e,t,n,i;function o(){return r[7](r[9])}e=new pe({props:{disabled:r[11]==0,$$slots:{default:[P$]},$$scope:{ctx:r}}}),e.$on("click",o);function s(){return r[8](r[9])}return n=new pe({props:{disabled:r[11]==Object.keys(r[3].schemes).length-1,$$slots:{default:[L$]},$$scope:{ctx:r}}}),n.$on("click",s),{c(){L(e.$$.fragment),t=O(),L(n.$$.fragment)},m(l,a){A(e,l,a),w(l,t,a),A(n,l,a),i=!0},p(l,a){r=l;const u={};a&8&&(u.disabled=r[11]==0),a&4096&&(u.$$scope={dirty:a,ctx:r}),e.$set(u);const f={};a&8&&(f.disabled=r[11]==Object.keys(r[3].schemes).length-1),a&4096&&(f.$$scope={dirty:a,ctx:r}),n.$set(f)},i(l){i||(S(e.$$.fragment,l),S(n.$$.fragment,l),i=!0)},o(l){k(e.$$.fragment,l),k(n.$$.fragment,l),i=!1},d(l){l&&$(t),C(e,l),C(n,l)}}}function P$(r){let e;return{c(){e=U("Move up")},m(t,n){w(t,e,n)},d(t){t&&$(e)}}}function L$(r){let e;return{c(){e=U("Move down")},m(t,n){w(t,e,n)},d(t){t&&$(e)}}}function A$(r){let e=Object.keys(r[3].schemes).length>1,t,n,i=e&&Hu(r);return{c(){i&&i.c(),t=ve()},m(o,s){i&&i.m(o,s),w(o,t,s),n=!0},p(o,s){s&8&&(e=Object.keys(o[3].schemes).length>1),e?i?(i.p(o,s),s&8&&S(i,1)):(i=Hu(o),i.c(),S(i,1),i.m(t.parentNode,t)):i&&(ue(),k(i,1,1,()=>{i=null}),fe())},i(o){n||(S(i),n=!0)},o(o){k(i),n=!1},d(o){o&&$(t),i&&i.d(o)}}}function Ju(r,e){let t,n,i,o,s;return n=new E$({props:{cfg:e[0],gjSchemes:e[1],scheme_reference:e[9],$$slots:{default:[A$]},$$scope:{ctx:e}}}),{key:r,first:null,c(){t=ve(),L(n.$$.fragment),i=O(),o=N("hr"),this.first=t},m(l,a){w(l,t,a),A(n,l,a),w(l,i,a),w(l,o,a),s=!0},p(l,a){e=l;const u={};a&1&&(u.cfg=e[0]),a&2&&(u.gjSchemes=e[1]),a&8&&(u.scheme_reference=e[9]),a&4104&&(u.$$scope={dirty:a,ctx:e}),n.$set(u)},i(l){s||(S(n.$$.fragment,l),s=!0)},o(l){k(n.$$.fragment,l),s=!1},d(l){l&&($(t),$(i),$(o)),C(n,l)}}}function C$(r){let e,t,n,i,o,s,l,a,u=[],f=new Map,c,g;e=new pe({props:{$$slots:{default:[M$]},$$scope:{ctx:r}}}),e.$on("click",r[4]),n=new ff({props:{label:"Add scheme from file",onLoad:r[5]}}),o=new Bt({props:{errorMessage:r[2]}});let p=rt(Object.keys(r[3].schemes));const h=m=>m[9];for(let m=0;m<p.length;m+=1){let v=Wu(r,p,m),_=h(v);f.set(_,u[m]=Ju(_,v))}return{c(){L(e.$$.fragment),t=O(),L(n.$$.fragment),i=O(),L(o.$$.fragment),s=O(),l=N("hr"),a=O();for(let m=0;m<u.length;m+=1)u[m].c();c=ve()},m(m,v){A(e,m,v),w(m,t,v),A(n,m,v),w(m,i,v),A(o,m,v),w(m,s,v),w(m,l,v),w(m,a,v);for(let _=0;_<u.length;_+=1)u[_]&&u[_].m(m,v);w(m,c,v),g=!0},p(m,[v]){const _={};v&4096&&(_.$$scope={dirty:v,ctx:m}),e.$set(_);const y={};v&4&&(y.errorMessage=m[2]),o.$set(y),v&75&&(p=rt(Object.keys(m[3].schemes)),ue(),u=fs(u,v,h,1,m,p,f,c.parentNode,cs,Ju,c,Wu),fe())},i(m){if(!g){S(e.$$.fragment,m),S(n.$$.fragment,m),S(o.$$.fragment,m);for(let v=0;v<p.length;v+=1)S(u[v]);g=!0}},o(m){k(e.$$.fragment,m),k(n.$$.fragment,m),k(o.$$.fragment,m);for(let v=0;v<u.length;v+=1)k(u[v]);g=!1},d(m){m&&($(t),$(i),$(s),$(l),$(a),$(c)),C(e,m),C(n,m),C(o,m);for(let v=0;v<u.length;v+=1)u[v].d(m)}}}function F$(r,e,t){[r[e],r[t]]=[r[t],r[e]]}function O$(r,e){const t={};return r.forEach(n=>{t[n]=e[n]}),t}function R$(r,e,t){let n,i=ee,o=()=>(i(),i=bt(l,h=>t(3,n=h)),l);r.$$.on_destroy.push(()=>i());let{cfg:s}=e,{gjSchemes:l}=e;o();function a(){ep(s,n),l.set(n)}let u="";function f(h,m){try{let v=s.backfill(JSON.parse(m));for(let y of Object.values(v.schemes)){if(y.scheme_reference in n.schemes)throw new Error("The file you're loading seems to contain duplicate data. Are you merging in the same file accidentally?");Te(l,n.schemes[y.scheme_reference]=y,n)}Te(l,n.features=n.features.concat(v.features),n);let _=1;n.features.forEach(y=>{y.id=_++}),l.set(n),t(2,u="")}catch(v){t(2,u=`Couldn't load scheme from a file: ${v}`)}}function c(h,m){const v=JSON.parse(JSON.stringify(Object.keys(n.schemes))),_=v.indexOf(h);if(_+m>=0&&_+m<v.length){F$(v,_,_+m);const y=O$(v,n.schemes);Te(l,n.schemes=y,n),l.set(n)}}const g=h=>c(h,-1),p=h=>c(h,1);return r.$$set=h=>{"cfg"in h&&t(0,s=h.cfg),"gjSchemes"in h&&o(t(1,l=h.gjSchemes))},[s,l,u,n,a,f,c,g,p]}class I$ extends Z{constructor(e){super(),Q(this,e,R$,C$,K,{cfg:0,gjSchemes:1})}}function B$(r){let e;return{c(){e=U("Save")},m(t,n){w(t,e,n)},d(t){t&&$(e)}}}function N$(r){let e;return{c(){e=U("Delete")},m(t,n){w(t,e,n)},d(t){t&&$(e)}}}function T$(r){let e,t,n,i;return e=new Tt({props:{$$slots:{default:[B$]},$$scope:{ctx:r}}}),e.$on("click",r[6]),n=new Br({props:{disabled:!r[2],$$slots:{default:[N$]},$$scope:{ctx:r}}}),n.$on("click",r[4]),{c(){L(e.$$.fragment),t=O(),L(n.$$.fragment)},m(o,s){A(e,o,s),w(o,t,s),A(n,o,s),i=!0},p(o,s){const l={};s&512&&(l.$$scope={dirty:s,ctx:o}),e.$set(l);const a={};s&4&&(a.disabled=!o[2]),s&512&&(a.$$scope={dirty:s,ctx:o}),n.$set(a)},i(o){i||(S(e.$$.fragment,o),S(n.$$.fragment,o),i=!0)},o(o){k(e.$$.fragment,o),k(n.$$.fragment,o),i=!1},d(o){o&&$(t),C(e,o),C(n,o)}}}function D$(r){let e,t,n;return{c(){e=N("input"),B(e,"class","govuk-file-upload"),B(e,"id","load-image"),B(e,"type","file")},m(i,o){w(i,e,o),r[7](e),t||(n=ne(e,"change",r[3]),t=!0)},p:ee,d(i){i&&$(e),r[7](null),t=!1,n()}}}function Vu(r){let e,t,n,i,o,s,l,a;return{c(){e=N("div"),t=N("label"),n=N("input"),i=U(`
      Opacity: `),o=U(r[1]),s=U("%"),B(n,"type","range"),B(n,"min","0"),B(n,"max","100")},m(u,f){w(u,e,f),D(e,t),D(t,n),Xe(n,r[1]),D(t,i),D(t,o),D(t,s),l||(a=[ne(n,"change",r[8]),ne(n,"input",r[8])],l=!0)},p(u,f){f&2&&Xe(n,u[1]),f&2&&me(o,u[1])},d(u){u&&$(e),l=!1,It(a)}}}function j$(r){let e,t,n,i,o,s,l,a,u;e=new Jt({props:{$$slots:{default:[T$]},$$scope:{ctx:r}}}),n=new Ir({props:{label:"Load an image",id:"load-image",$$slots:{default:[D$]},$$scope:{ctx:r}}});let f=r[2]&&Vu(r);return{c(){L(e.$$.fragment),t=O(),L(n.$$.fragment),i=O(),f&&f.c(),o=O(),s=N("p"),s.textContent=`Note this image isn't saved as part of this scheme. When you close this page,
  it'll be lost.`},m(c,g){A(e,c,g),w(c,t,g),A(n,c,g),w(c,i,g),f&&f.m(c,g),w(c,o,g),w(c,s,g),l=!0,a||(u=ne(window,"keydown",r[5]),a=!0)},p(c,[g]){const p={};g&516&&(p.$$scope={dirty:g,ctx:c}),e.$set(p);const h={};g&513&&(h.$$scope={dirty:g,ctx:c}),n.$set(h),c[2]?f?f.p(c,g):(f=Vu(c),f.c(),f.m(o.parentNode,o)):f&&(f.d(1),f=null)},i(c){l||(S(e.$$.fragment,c),S(n.$$.fragment,c),l=!0)},o(c){k(e.$$.fragment,c),k(n.$$.fragment,c),l=!1},d(c){c&&($(t),$(i),$(o),$(s)),C(e,c),C(n,c),f&&f.d(c),a=!1,u()}}}function G$(r,e,t){let n,i;V(r,ii,g=>t(1,n=g)),V(r,ni,g=>t(2,i=g));let o;async function s(g){let p=await o.files[0].arrayBuffer(),h=new Blob([new Uint8Array(p)]);Te(ni,i=URL.createObjectURL(h),i)}function l(){Te(ni,i=null,i),Te(ii,n=100,n)}function a(g){g.key=="Escape"&&(g.stopPropagation(),oe.set({mode:"list"}))}const u=()=>oe.set({mode:"list"});function f(g){be[g?"unshift":"push"](()=>{o=g,t(0,o)})}function c(){n=jp(this.value),ii.set(n)}return[o,n,i,s,l,a,u,f,c]}class U$ extends Z{constructor(e){super(),Q(this,e,G$,j$,K,{})}}function q$(r){let e;return{c(){e=U("Cancel")},m(t,n){w(t,e,n)},d(t){t&&$(e)}}}function z$(r){let e,t,n,i;return e=new pe({props:{$$slots:{default:[q$]},$$scope:{ctx:r}}}),e.$on("click",r[0]),n=new tp({props:{editingExisting:!1}}),{c(){L(e.$$.fragment),t=O(),L(n.$$.fragment)},m(o,s){A(e,o,s),w(o,t,s),A(n,o,s),i=!0},p(o,[s]){const l={};s&32&&(l.$$scope={dirty:s,ctx:o}),e.$set(l)},i(o){i||(S(e.$$.fragment,o),S(n.$$.fragment,o),i=!0)},o(o){k(e.$$.fragment,o),k(n.$$.fragment,o),i=!1},d(o){o&&$(t),C(e,o),C(n,o)}}}function W$(r,e,t){let n;V(r,_n,a=>t(3,n=a));let{cfg:i}=e,{gjSchemes:o}=e;Nt(()=>{n.start(),n.addEventListenerSuccess(s),n.addEventListenerFailure(l)}),st(()=>{n.stop(),n.clearEventListeners()});function s(a){a.properties||(a.properties={});let u=a;o.update(f=>(u.id=Mn(f),u.properties.scheme_reference=zi(f),i.newPointFeature(u),f.features.push(u),f)),oe.set({mode:"edit-form",id:u.id})}function l(){oe.set({mode:"list"})}return r.$$set=a=>{"cfg"in a&&t(1,i=a.cfg),"gjSchemes"in a&&t(2,o=a.gjSchemes)},[l,i,o]}class H$ extends Z{constructor(e){super(),Q(this,e,W$,z$,K,{cfg:1,gjSchemes:2})}}function J$(r){let e;return{c(){e=U("Finish")},m(t,n){w(t,e,n)},d(t){t&&$(e)}}}function V$(r){let e;return{c(){e=U("Cancel")},m(t,n){w(t,e,n)},d(t){t&&$(e)}}}function Y$(r){let e,t,n,i;return e=new Tt({props:{$$slots:{default:[J$]},$$scope:{ctx:r}}}),e.$on("click",r[1]),n=new pe({props:{$$slots:{default:[V$]},$$scope:{ctx:r}}}),n.$on("click",r[0]),{c(){L(e.$$.fragment),t=O(),L(n.$$.fragment)},m(o,s){A(e,o,s),w(o,t,s),A(n,o,s),i=!0},p(o,s){const l={};s&64&&(l.$$scope={dirty:s,ctx:o}),e.$set(l);const a={};s&64&&(a.$$scope={dirty:s,ctx:o}),n.$set(a)},i(o){i||(S(e.$$.fragment,o),S(n.$$.fragment,o),i=!0)},o(o){k(e.$$.fragment,o),k(n.$$.fragment,o),i=!1},d(o){o&&$(t),C(e,o),C(n,o)}}}function X$(r){let e,t,n,i;return e=new Jt({props:{$$slots:{default:[Y$]},$$scope:{ctx:r}}}),n=new rp({}),{c(){L(e.$$.fragment),t=O(),L(n.$$.fragment)},m(o,s){A(e,o,s),w(o,t,s),A(n,o,s),i=!0},p(o,[s]){const l={};s&64&&(l.$$scope={dirty:s,ctx:o}),e.$set(l)},i(o){i||(S(e.$$.fragment,o),S(n.$$.fragment,o),i=!0)},o(o){k(e.$$.fragment,o),k(n.$$.fragment,o),i=!1},d(o){o&&$(t),C(e,o),C(n,o)}}}function K$(r,e,t){let n;V(r,Fr,u=>t(4,n=u));let{cfg:i}=e,{gjSchemes:o}=e;Nt(()=>{n.startNew(),n.addEventListenerSuccess(s),n.addEventListenerFailure(l)}),st(()=>{n.stop(),n.clearEventListeners()});function s(u){u.properties||(u.properties={});let f=u;o.update(c=>(f.id=Mn(c),f.properties.scheme_reference=zi(c),i.newPolygonFeature(f),c.features.push(f),c)),oe.set({mode:"edit-form",id:f.id})}function l(){oe.set({mode:"list"})}function a(){n.finish()}return r.$$set=u=>{"cfg"in u&&t(2,i=u.cfg),"gjSchemes"in u&&t(3,o=u.gjSchemes)},[l,a,i,o]}class Z$ extends Z{constructor(e){super(),Q(this,e,K$,X$,K,{cfg:2,gjSchemes:3})}}function Q$(r){let e;return{c(){e=U("Finish")},m(t,n){w(t,e,n)},d(t){t&&$(e)}}}function x$(r){let e;return{c(){e=U("Cancel")},m(t,n){w(t,e,n)},d(t){t&&$(e)}}}function eS(r){let e,t,n,i;return e=new Tt({props:{$$slots:{default:[Q$]},$$scope:{ctx:r}}}),e.$on("click",r[2]),n=new pe({props:{$$slots:{default:[x$]},$$scope:{ctx:r}}}),n.$on("click",r[1]),{c(){L(e.$$.fragment),t=O(),L(n.$$.fragment)},m(o,s){A(e,o,s),w(o,t,s),A(n,o,s),i=!0},p(o,s){const l={};s&64&&(l.$$scope={dirty:s,ctx:o}),e.$set(l);const a={};s&64&&(a.$$scope={dirty:s,ctx:o}),n.$set(a)},i(o){i||(S(e.$$.fragment,o),S(n.$$.fragment,o),i=!0)},o(o){k(e.$$.fragment,o),k(n.$$.fragment,o),i=!1},d(o){o&&$(t),C(e,o),C(n,o)}}}function tS(r){let e,t,n,i;return e=new Jt({props:{$$slots:{default:[eS]},$$scope:{ctx:r}}}),n=new op({props:{cfg:r[0],extendRoute:!0}}),{c(){L(e.$$.fragment),t=O(),L(n.$$.fragment)},m(o,s){A(e,o,s),w(o,t,s),A(n,o,s),i=!0},p(o,[s]){const l={};s&64&&(l.$$scope={dirty:s,ctx:o}),e.$set(l);const a={};s&1&&(a.cfg=o[0]),n.$set(a)},i(o){i||(S(e.$$.fragment,o),S(n.$$.fragment,o),i=!0)},o(o){k(e.$$.fragment,o),k(n.$$.fragment,o),i=!1},d(o){o&&$(t),C(e,o),C(n,o)}}}function rS(r,e,t){let n;V(r,Ct,u=>t(4,n=u));let{cfg:i}=e,{gjSchemes:o}=e;Nt(()=>{n.startRoute(),n.addEventListenerSuccess(s),n.addEventListenerFailure(l)}),st(()=>{n.stop(),n.clearEventListeners()});function s(u){let f=u;o.update(c=>(f.id=Mn(c),f.properties.scheme_reference=zi(c),i.newLineStringFeature(f),c.features.push(f),c)),oe.set({mode:"edit-form",id:f.id})}function l(){oe.set({mode:"list"})}function a(){n.finish()}return r.$$set=u=>{"cfg"in u&&t(0,i=u.cfg),"gjSchemes"in u&&t(3,o=u.gjSchemes)},[i,l,a,o]}class nS extends Z{constructor(e){super(),Q(this,e,rS,tS,K,{cfg:0,gjSchemes:3})}}function iS(r){let e,t;return e=new Bt({props:{errorMessage:"Failed to load route snapper"}}),{c(){L(e.$$.fragment)},m(n,i){A(e,n,i),t=!0},p:ee,i(n){t||(S(e.$$.fragment,n),t=!0)},o(n){k(e.$$.fragment,n),t=!1},d(n){C(e,n)}}}function oS(r){let e,t,n;return{c(){e=N("label"),e.textContent="Route data unpacking",t=O(),n=N("progress"),B(e,"for","route-unpacking"),B(n,"id","route-unpacking"),B(n,"class","svelte-q3473n")},m(i,o){w(i,e,o),w(i,t,o),w(i,n,o)},p:ee,i:ee,o:ee,d(i){i&&($(e),$(t),$(n))}}}function sS(r){let e,t,n;return{c(){e=N("label"),e.textContent="Route tool loading",t=O(),n=N("progress"),B(e,"for","route-loading"),B(n,"id","route-loading"),n.value=r[0],B(n,"class","svelte-q3473n")},m(i,o){w(i,e,o),w(i,t,o),w(i,n,o)},p(i,o){o&1&&(n.value=i[0])},i:ee,o:ee,d(i){i&&($(e),$(t),$(n))}}}function lS(r){let e,t,n,i;const o=[sS,oS,iS],s=[];function l(a,u){return!a[1]&&!a[2]&&!a[3]?0:a[3]&&!a[1]&&!a[2]?1:a[2]?2:-1}return~(e=l(r))&&(t=s[e]=o[e](r)),{c(){t&&t.c(),n=ve()},m(a,u){~e&&s[e].m(a,u),w(a,n,u),i=!0},p(a,[u]){let f=e;e=l(a),e===f?~e&&s[e].p(a,u):(t&&(ue(),k(s[f],1,1,()=>{s[f]=null}),fe()),~e?(t=s[e],t?t.p(a,u):(t=s[e]=o[e](a),t.c()),S(t,1),t.m(n.parentNode,n)):t=null)},i(a){i||(S(t),i=!0)},o(a){k(t),i=!1},d(a){a&&$(n),~e&&s[e].d(a)}}}function aS(r,e,t){let n,i;V(r,ot,u=>t(5,i=u));let{url:o}=e,s=0,l=!1,a=!1;return Nt(async()=>{await Uc(),console.log(`Grabbing ${o}`);try{const u=await Gw(o,f=>{t(0,s=f)});Ct.set(new lb(i,u,np,ip,js)),t(0,s=100),t(1,l=!0)}catch(u){console.log(`Route tool broke: ${u}`),t(2,a=!0)}}),r.$$set=u=>{"url"in u&&t(4,o=u.url)},r.$$.update=()=>{r.$$.dirty&1&&t(3,n=s>=100)},[s,l,a,n,o]}class uS extends Z{constructor(e){super(),Q(this,e,aS,lS,K,{url:4})}}function fS(r){let e;return{c(){e=U("Finish")},m(t,n){w(t,e,n)},d(t){t&&$(e)}}}function cS(r){let e;return{c(){e=U("Cancel")},m(t,n){w(t,e,n)},d(t){t&&$(e)}}}function pS(r){let e,t,n,i;return e=new Tt({props:{$$slots:{default:[fS]},$$scope:{ctx:r}}}),e.$on("click",r[1]),n=new pe({props:{$$slots:{default:[cS]},$$scope:{ctx:r}}}),n.$on("click",r[0]),{c(){L(e.$$.fragment),t=O(),L(n.$$.fragment)},m(o,s){A(e,o,s),w(o,t,s),A(n,o,s),i=!0},p(o,s){const l={};s&64&&(l.$$scope={dirty:s,ctx:o}),e.$set(l);const a={};s&64&&(a.$$scope={dirty:s,ctx:o}),n.$set(a)},i(o){i||(S(e.$$.fragment,o),S(n.$$.fragment,o),i=!0)},o(o){k(e.$$.fragment,o),k(n.$$.fragment,o),i=!1},d(o){o&&$(t),C(e,o),C(n,o)}}}function gS(r){let e,t,n,i;return e=new Jt({props:{$$slots:{default:[pS]},$$scope:{ctx:r}}}),n=new sp({}),{c(){L(e.$$.fragment),t=O(),L(n.$$.fragment)},m(o,s){A(e,o,s),w(o,t,s),A(n,o,s),i=!0},p(o,[s]){const l={};s&64&&(l.$$scope={dirty:s,ctx:o}),e.$set(l)},i(o){i||(S(e.$$.fragment,o),S(n.$$.fragment,o),i=!0)},o(o){k(e.$$.fragment,o),k(n.$$.fragment,o),i=!1},d(o){o&&$(t),C(e,o),C(n,o)}}}function hS(r,e,t){let n;V(r,Ct,u=>t(4,n=u));let{cfg:i}=e,{gjSchemes:o}=e;Nt(()=>{n.startArea(),n.addEventListenerSuccess(s),n.addEventListenerFailure(l)}),st(()=>{n.stop(),n.clearEventListeners()});function s(u){let f=u;o.update(c=>(f.id=Mn(c),f.properties.scheme_reference=zi(c),i.newPolygonFeature(f),c.features.push(f),c)),oe.set({mode:"edit-form",id:f.id})}function l(){oe.set({mode:"list"})}function a(){n.finish()}return r.$$set=u=>{"cfg"in u&&t(2,i=u.cfg),"gjSchemes"in u&&t(3,o=u.gjSchemes)},[l,a,i,o]}class mS extends Z{constructor(e){super(),Q(this,e,hS,gS,K,{cfg:2,gjSchemes:3})}}function Yu(r){let e,t;return e=new uS({props:{url:r[2]}}),{c(){L(e.$$.fragment)},m(n,i){A(e,n,i),t=!0},p(n,i){const o={};i&4&&(o.url=n[2]),e.$set(o)},i(n){t||(S(e.$$.fragment,n),t=!0)},o(n){k(e.$$.fragment,n),t=!1},d(n){C(e,n)}}}function dS(r){let e,t,n,i;return n=new Ww({props:{cfg:r[0]}}),{c(){e=N("h2"),e.textContent="StreetView",t=O(),L(n.$$.fragment)},m(o,s){w(o,e,s),w(o,t,s),A(n,o,s),i=!0},p(o,s){const l={};s&1&&(l.cfg=o[0]),n.$set(l)},i(o){i||(S(n.$$.fragment,o),i=!0)},o(o){k(n.$$.fragment,o),i=!1},d(o){o&&($(e),$(t)),C(n,o)}}}function yS(r){let e,t,n,i;return n=new U$({}),{c(){e=N("h2"),e.textContent="Georeference image",t=O(),L(n.$$.fragment)},m(o,s){w(o,e,s),w(o,t,s),A(n,o,s),i=!0},p:ee,i(o){i||(S(n.$$.fragment,o),i=!0)},o(o){k(n.$$.fragment,o),i=!1},d(o){o&&($(e),$(t)),C(n,o)}}}function vS(r){let e,t,n,i,o,s;return n=new Tt({props:{$$slots:{default:[MS]},$$scope:{ctx:r}}}),n.$on("click",r[7]),{c(){e=N("h2"),e.textContent="Split route",t=O(),L(n.$$.fragment),i=O(),o=N("ul"),o.innerHTML=`<li><b>Click</b>
      on a route to split it</li> <li><b>Click</b>
      on the map or press
      <b>Escape</b>
      to cancel</li>`},m(l,a){w(l,e,a),w(l,t,a),A(n,l,a),w(l,i,a),w(l,o,a),s=!0},p(l,a){const u={};a&512&&(u.$$scope={dirty:a,ctx:l}),n.$set(u)},i(l){s||(S(n.$$.fragment,l),s=!0)},o(l){k(n.$$.fragment,l),s=!1},d(l){l&&($(e),$(t),$(i),$(o)),C(n,l)}}}function _S(r){let e,t,n,i;return n=new mS({props:{cfg:r[0],gjSchemes:r[1]}}),{c(){e=N("h2"),e.textContent="New polygon (snapped)",t=O(),L(n.$$.fragment)},m(o,s){w(o,e,s),w(o,t,s),A(n,o,s),i=!0},p(o,s){const l={};s&1&&(l.cfg=o[0]),s&2&&(l.gjSchemes=o[1]),n.$set(l)},i(o){i||(S(n.$$.fragment,o),i=!0)},o(o){k(n.$$.fragment,o),i=!1},d(o){o&&($(e),$(t)),C(n,o)}}}function bS(r){let e,t,n,i;return n=new Z$({props:{cfg:r[0],gjSchemes:r[1]}}),{c(){e=N("h2"),e.textContent="New polygon (freehand)",t=O(),L(n.$$.fragment)},m(o,s){w(o,e,s),w(o,t,s),A(n,o,s),i=!0},p(o,s){const l={};s&1&&(l.cfg=o[0]),s&2&&(l.gjSchemes=o[1]),n.$set(l)},i(o){i||(S(n.$$.fragment,o),i=!0)},o(o){k(n.$$.fragment,o),i=!1},d(o){o&&($(e),$(t)),C(n,o)}}}function wS(r){let e,t,n,i;return n=new nS({props:{cfg:r[0],gjSchemes:r[1]}}),{c(){e=N("h2"),e.textContent="New route",t=O(),L(n.$$.fragment)},m(o,s){w(o,e,s),w(o,t,s),A(n,o,s),i=!0},p(o,s){const l={};s&1&&(l.cfg=o[0]),s&2&&(l.gjSchemes=o[1]),n.$set(l)},i(o){i||(S(n.$$.fragment,o),i=!0)},o(o){k(n.$$.fragment,o),i=!1},d(o){o&&($(e),$(t)),C(n,o)}}}function $S(r){let e,t,n,i;return n=new H$({props:{cfg:r[0],gjSchemes:r[1]}}),{c(){e=N("h2"),e.textContent="New point",t=O(),L(n.$$.fragment)},m(o,s){w(o,e,s),w(o,t,s),A(n,o,s),i=!0},p(o,s){const l={};s&1&&(l.cfg=o[0]),s&2&&(l.gjSchemes=o[1]),n.$set(l)},i(o){i||(S(n.$$.fragment,o),i=!0)},o(o){k(n.$$.fragment,o),i=!1},d(o){o&&($(e),$(t)),C(n,o)}}}function SS(r){let e,t;return e=new e1({props:{cfg:r[0],gjSchemes:r[1],id:r[4].id}}),{c(){L(e.$$.fragment)},m(n,i){A(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.cfg=n[0]),i&2&&(o.gjSchemes=n[1]),i&16&&(o.id=n[4].id),e.$set(o)},i(n){t||(S(e.$$.fragment,n),t=!0)},o(n){k(e.$$.fragment,n),t=!1},d(n){C(e,n)}}}function kS(r){let e,t;return e=new g$({props:{cfg:r[0],gjSchemes:r[1],id:r[4].id}}),{c(){L(e.$$.fragment)},m(n,i){A(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.cfg=n[0]),i&2&&(o.gjSchemes=n[1]),i&16&&(o.id=n[4].id),e.$set(o)},i(n){t||(S(e.$$.fragment,n),t=!0)},o(n){k(e.$$.fragment,n),t=!1},d(n){C(e,n)}}}function ES(r){let e,t;return e=new I$({props:{cfg:r[0],gjSchemes:r[1]}}),{c(){L(e.$$.fragment)},m(n,i){A(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.cfg=n[0]),i&2&&(o.gjSchemes=n[1]),e.$set(o)},i(n){t||(S(e.$$.fragment,n),t=!0)},o(n){k(e.$$.fragment,n),t=!1},d(n){C(e,n)}}}function MS(r){let e;return{c(){e=U("Finish")},m(t,n){w(t,e,n)},d(t){t&&$(e)}}}function PS(r){let e,t,n,i,o,s,l=r[3]&&Yu(r);const a=[ES,kS,SS,$S,wS,bS,_S,vS,yS,dS],u=[];function f(c,g){return c[4].mode=="list"?0:c[4].mode=="edit-form"?1:c[4].mode=="edit-geometry"?2:c[4].mode=="new-point"?3:c[4].mode=="new-route"?4:c[4].mode=="new-freehand-polygon"?5:c[4].mode=="new-snapped-polygon"?6:c[4].mode=="split-route"?7:c[4].mode=="set-image"?8:c[4].mode=="streetview"?9:-1}return~(n=f(r))&&(i=u[n]=a[n](r)),{c(){e=N("div"),l&&l.c(),t=O(),i&&i.c(),o=ve(),ye(e,"visibility",r[4].mode=="list"?"visible":"hidden")},m(c,g){w(c,e,g),l&&l.m(e,null),w(c,t,g),~n&&u[n].m(c,g),w(c,o,g),s=!0},p(c,[g]){c[3]?l?(l.p(c,g),g&8&&S(l,1)):(l=Yu(c),l.c(),S(l,1),l.m(e,null)):l&&(ue(),k(l,1,1,()=>{l=null}),fe()),g&16&&ye(e,"visibility",c[4].mode=="list"?"visible":"hidden");let p=n;n=f(c),n===p?~n&&u[n].p(c,g):(i&&(ue(),k(u[p],1,1,()=>{u[p]=null}),fe()),~n?(i=u[n],i?i.p(c,g):(i=u[n]=a[n](c),i.c()),S(i,1),i.m(o.parentNode,o)):i=null)},i(c){s||(S(l),S(i),s=!0)},o(c){k(l),k(i),s=!1},d(c){c&&($(e),$(t),$(o)),l&&l.d(),~n&&u[n].d(c)}}}function LS(r,e,t){let n,i,o,s,l;V(r,Ct,g=>t(8,n=g)),V(r,Fr,g=>t(5,i=g)),V(r,_n,g=>t(6,o=g)),V(r,ot,g=>t(3,s=g)),V(r,oe,g=>t(4,l=g));let{cfg:a}=e,{gjSchemes:u}=e,{routeSnapperUrl:f}=e;st(()=>{o==null||o.tearDown(),i==null||i.tearDown(),n==null||n.tearDown()});const c=()=>oe.set({mode:"list"});return r.$$set=g=>{"cfg"in g&&t(0,a=g.cfg),"gjSchemes"in g&&t(1,u=g.gjSchemes),"routeSnapperUrl"in g&&t(2,f=g.routeSnapperUrl)},r.$$.update=()=>{r.$$.dirty&72&&s&&!o&&_n.set(new W_(s)),r.$$.dirty&40&&s&&!i&&Fr.set(new b0(s))},[a,u,f,s,l,i,o,c]}class AS extends Z{constructor(e){super(),Q(this,e,LS,PS,K,{cfg:0,gjSchemes:1,routeSnapperUrl:2})}}function Xu(r){let e;return{c(){e=N("div"),e.textContent="If transcribing from a document, use the route name there if possible",B(e,"class","govuk-hint")},m(t,n){w(t,e,n)},d(t){t&&$(e)}}}function Ku(r){let e,t;return e=new pe({props:{disabled:!r[3],$$slots:{default:[CS]},$$scope:{ctx:r}}}),e.$on("click",r[9]),{c(){L(e.$$.fragment)},m(n,i){A(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.disabled=!n[3]),i&32768&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(S(e.$$.fragment,n),t=!0)},o(n){k(e.$$.fragment,n),t=!1},d(n){C(e,n)}}}function CS(r){let e;return{c(){e=U("Auto-fill with street names")},m(t,n){w(t,e,n)},d(t){t&&$(e)}}}function FS(r){let e,t,n,i,o,s,l,a=r[0].length_meters&&Xu(),u=r[0].length_meters&&Ku(r);return{c(){a&&a.c(),e=O(),t=N("input"),n=O(),u&&u.c(),i=ve(),B(t,"type","text"),B(t,"class","govuk-input"),B(t,"id",r[6])},m(f,c){a&&a.m(f,c),w(f,e,c),w(f,t,c),Xe(t,r[0].name),w(f,n,c),u&&u.m(f,c),w(f,i,c),o=!0,s||(l=ne(t,"input",r[8]),s=!0)},p(f,c){f[0].length_meters?a||(a=Xu(),a.c(),a.m(e.parentNode,e)):a&&(a.d(1),a=null),c&1&&t.value!==f[0].name&&Xe(t,f[0].name),f[0].length_meters?u?(u.p(f,c),c&1&&S(u,1)):(u=Ku(f),u.c(),S(u,1),u.m(i.parentNode,i)):u&&(ue(),k(u,1,1,()=>{u=null}),fe())},i(f){o||(S(u),o=!0)},o(f){k(u),o=!1},d(f){f&&($(e),$(t),$(n),$(i)),a&&a.d(f),u&&u.d(f),s=!1,l()}}}function OS(r){let e,t,n,i,o,s,l,a,u,f,c;e=new Ir({props:{label:"Name",id:r[6],$$slots:{default:[FS]},$$scope:{ctx:r}}});function g(y){r[11](y)}let p={label:"Scheme",choices:Object.values(r[4].schemes).map(r[10])};r[0].scheme_reference!==void 0&&(p.value=r[0].scheme_reference),n=new bo({props:p}),be.push(()=>Se(n,"value",g));function h(y){r[12](y)}let m={label:"Infrastructure type",choices:[["mixed-traffic-street","Mixed Traffic Street"],["detached-cycle-track","Detached or Remote Cycle Track"],["carriageway-cycle-track","Cycle Track at Carriageway Level"],["stepped-cycle-track","Stepped or Footway Level Cycle Track"],["light-segregation","Light Segregation"],["cycle-lane","Cycle Lane"],["","Unknown"]]};r[0].infrastructure_type!==void 0&&(m.value=r[0].infrastructure_type),s=new bo({props:m}),be.push(()=>Se(s,"value",h));function v(y){r[13](y)}let _={label:"Description"};return r[0].description!==void 0&&(_.value=r[0].description),u=new wg({props:_}),be.push(()=>Se(u,"value",v)),{c(){L(e.$$.fragment),t=O(),L(n.$$.fragment),o=O(),L(s.$$.fragment),a=O(),L(u.$$.fragment)},m(y,d){A(e,y,d),w(y,t,d),A(n,y,d),w(y,o,d),A(s,y,d),w(y,a,d),A(u,y,d),c=!0},p(y,[d]){const E={};d&32777&&(E.$$scope={dirty:d,ctx:y}),e.$set(E);const b={};d&18&&(b.choices=Object.values(y[4].schemes).map(y[10])),!i&&d&1&&(i=!0,b.value=y[0].scheme_reference,Ee(()=>i=!1)),n.$set(b);const M={};!l&&d&1&&(l=!0,M.value=y[0].infrastructure_type,Ee(()=>l=!1)),s.$set(M);const R={};!f&&d&1&&(f=!0,R.value=y[0].description,Ee(()=>f=!1)),u.$set(R)},i(y){c||(S(e.$$.fragment,y),S(n.$$.fragment,y),S(s.$$.fragment,y),S(u.$$.fragment,y),c=!0)},o(y){k(e.$$.fragment,y),k(n.$$.fragment,y),k(s.$$.fragment,y),k(u.$$.fragment,y),c=!1},d(y){y&&($(t),$(o),$(a)),C(e,y),C(n,y),C(s,y),C(u,y)}}}function RS(r,e,t){let n,i,o=ee,s=()=>(o(),o=bt(a,d=>t(4,i=d)),a);V(r,Ct,d=>t(3,n=d)),r.$$.on_destroy.push(()=>o());let{cfg:l}=e,{gjSchemes:a}=e;s();let{id:u}=e,{props:f}=e;function c(){try{t(0,f.name=n.inner.routeNameForWaypoints(f.waypoints),f)}catch(d){window.alert(`Couldn't auto-name route: ${d}`)}}let g=Zc();function p(){f.name=this.value,t(0,f)}const h=()=>c(),m=d=>[d.scheme_reference,l.schemeName(d)];function v(d){r.$$.not_equal(f.scheme_reference,d)&&(f.scheme_reference=d,t(0,f))}function _(d){r.$$.not_equal(f.infrastructure_type,d)&&(f.infrastructure_type=d,t(0,f))}function y(d){r.$$.not_equal(f.description,d)&&(f.description=d,t(0,f))}return r.$$set=d=>{"cfg"in d&&t(1,l=d.cfg),"gjSchemes"in d&&s(t(2,a=d.gjSchemes)),"id"in d&&t(7,u=d.id),"props"in d&&t(0,f=d.props)},[f,l,a,n,i,c,g,u,p,h,m,v,_,y]}class IS extends Z{constructor(e){super(),Q(this,e,RS,OS,K,{cfg:1,gjSchemes:2,id:7,props:0})}}function BS(r){let e,t,n;function i(s){r[3](s)}let o={label:"Scheme name",required:!0};return r[2].schemes[r[1]].scheme_name!==void 0&&(o.value=r[2].schemes[r[1]].scheme_name),e=new pf({props:o}),be.push(()=>Se(e,"value",i)),{c(){L(e.$$.fragment)},m(s,l){A(e,s,l),n=!0},p(s,[l]){const a={};!t&&l&6&&(t=!0,a.value=s[2].schemes[s[1]].scheme_name,Ee(()=>t=!1)),e.$set(a)},i(s){n||(S(e.$$.fragment,s),n=!0)},o(s){k(e.$$.fragment,s),n=!1},d(s){C(e,s)}}}function NS(r,e,t){let n,i=ee,o=()=>(i(),i=bt(s,u=>t(2,n=u)),s);r.$$.on_destroy.push(()=>i());let{gjSchemes:s}=e;o();let{scheme_reference:l}=e;function a(u){r.$$.not_equal(n.schemes[l].scheme_name,u)&&(n.schemes[l].scheme_name=u,s.set(n))}return r.$$set=u=>{"gjSchemes"in u&&o(t(0,s=u.gjSchemes)),"scheme_reference"in u&&t(1,l=u.scheme_reference)},[s,l,n,a]}class TS extends Z{constructor(e){super(),Q(this,e,NS,BS,K,{gjSchemes:0,scheme_reference:1})}}let kt={interventionName:DS,schemeName:r=>r.scheme_name,backfill:r=>r,initializeEmptyScheme:r=>{let e=r;return e.scheme_name="",e},interventionWarning:r=>null,editFeatureForm:IS,editSchemeForm:TS,newPointFeature:r=>{r.properties.infrastructure_type=""},newPolygonFeature:r=>{r.properties.infrastructure_type=""},newLineStringFeature:r=>{r.properties.infrastructure_type=""},updateFeature:(r,e)=>{},maptilerApiKey:"MZEJTanw3WpxRvt7qDfo",getStreetViewRoadLayerNames:r=>r.getStyle().layers.filter(e=>e["source-layer"]=="roads"&&e.type=="line").map(e=>e.id),layerZorder:["interventions-polygons","interventions-polygons-outlines","hover-polygons","hover-lines","interventions-lines","interventions-lines-endpoints","hover-points","interventions-points","edit-polygon-fill","edit-polygon-lines","edit-polygon-vertices","draw-split-route","route-points","route-lines","route-polygons","Road labels","boundary","georeferenced-image"]};function DS(r){return r.properties.name?r.properties.name:r.geometry.type=="Point"?"untitled point":r.geometry.type=="LineString"?"untitled route":"untitled area"}function jS(r){}function GS(r){let e=r.features.length==1?"":"s",t=Object.keys(r.schemes).length==1?"":"s";return`${r.features.length} intervention${e} in ${Object.keys(r.schemes).length} scheme${t}`}const US="/scheme-sketcher/assets/folder-939a38b7.svg",qS="/scheme-sketcher/assets/edit-03d80762.svg",zS="/scheme-sketcher/assets/delete-faeeebbe.svg",WS="/scheme-sketcher/assets/download-cb1570fd.svg",HS="/scheme-sketcher/assets/right_arrow-8cdce849.svg";function JS(r){let e,t,n,i,o,s,l,a,u,f,c,g,p;const h=r[3].default,m=Ce(h,r,r[2],null);return{c(){e=N("button"),t=N("div"),n=N("span"),i=U(r[0]),o=O(),s=N("img"),u=O(),f=N("div"),m&&m.c(),B(s,"class","arrow svelte-ovh7qa"),nt(s.src,l=HS)||B(s,"src",l),B(s,"alt",a="Select "+r[0]),B(t,"class","top-section section svelte-ovh7qa"),B(f,"class","section svelte-ovh7qa"),B(e,"class","clickable-card govuk-button govuk-button--secondary svelte-ovh7qa"),e.disabled=r[1]},m(v,_){w(v,e,_),D(e,t),D(t,n),D(n,i),D(t,o),D(t,s),D(e,u),D(e,f),m&&m.m(f,null),c=!0,g||(p=[ne(e,"click",r[4]),ne(e,"mouseenter",r[5]),ne(e,"mouseleave",r[6])],g=!0)},p(v,[_]){(!c||_&1)&&me(i,v[0]),(!c||_&1&&a!==(a="Select "+v[0]))&&B(s,"alt",a),m&&m.p&&(!c||_&4)&&Fe(m,h,v,v[2],c?Re(h,v[2],_,null):Oe(v[2]),null),(!c||_&2)&&(e.disabled=v[1])},i(v){c||(S(m,v),c=!0)},o(v){k(m,v),c=!1},d(v){v&&$(e),m&&m.d(v),g=!1,It(p)}}}function VS(r,e,t){let{$$slots:n={},$$scope:i}=e,{name:o}=e,{disabled:s=!1}=e;function l(f){_e.call(this,r,f)}function a(f){_e.call(this,r,f)}function u(f){_e.call(this,r,f)}return r.$$set=f=>{"name"in f&&t(0,o=f.name),"disabled"in f&&t(1,s=f.disabled),"$$scope"in f&&t(2,i=f.$$scope)},[o,s,i,n,l,a,u]}class YS extends Z{constructor(e){super(),Q(this,e,VS,JS,K,{name:0,disabled:1})}}function Zu(r,e,t){const n=r.slice();return n[19]=e[t],n}function XS(r){let e,t,n;return{c(){e=N("img"),n=U(`
      Rename this file`),nt(e.src,t=qS)||B(e,"src",t),B(e,"alt","Rename this file"),B(e,"class","svelte-v2g1wg")},m(i,o){w(i,e,o),w(i,n,o)},p:ee,d(i){i&&($(e),$(n))}}}function KS(r){let e,t,n,i,o;return{c(){e=N("img"),i=U(`
      Export .`),o=U(r[3]),nt(e.src,t=WS)||B(e,"src",t),B(e,"alt",n="Export ."+r[3]),B(e,"class","svelte-v2g1wg")},m(s,l){w(s,e,l),w(s,i,l),w(s,o,l)},p(s,l){l&8&&n!==(n="Export ."+s[3])&&B(e,"alt",n),l&8&&me(o,s[3])},d(s){s&&($(e),$(i),$(o))}}}function ZS(r){let e,t,n;return{c(){e=N("img"),n=U(`
      Delete this file`),nt(e.src,t=zS)||B(e,"src",t),B(e,"alt","Delete this file"),B(e,"class","svelte-v2g1wg")},m(i,o){w(i,e,o),w(i,n,o)},p:ee,d(i){i&&($(e),$(n))}}}function QS(r){let e,t,n,i,o,s;return e=new pe({props:{$$slots:{default:[XS]},$$scope:{ctx:r}}}),e.$on("click",r[7]),n=new pe({props:{$$slots:{default:[KS]},$$scope:{ctx:r}}}),n.$on("click",r[8]),o=new Br({props:{$$slots:{default:[ZS]},$$scope:{ctx:r}}}),o.$on("click",r[14]),{c(){L(e.$$.fragment),t=O(),L(n.$$.fragment),i=O(),L(o.$$.fragment)},m(l,a){A(e,l,a),w(l,t,a),A(n,l,a),w(l,i,a),A(o,l,a),s=!0},p(l,a){const u={};a&131072&&(u.$$scope={dirty:a,ctx:l}),e.$set(u);const f={};a&131080&&(f.$$scope={dirty:a,ctx:l}),n.$set(f);const c={};a&131072&&(c.$$scope={dirty:a,ctx:l}),o.$set(c)},i(l){s||(S(e.$$.fragment,l),S(n.$$.fragment,l),S(o.$$.fragment,l),s=!0)},o(l){k(e.$$.fragment,l),k(n.$$.fragment,l),k(o.$$.fragment,l),s=!1},d(l){l&&($(t),$(i)),C(e,l),C(n,l),C(o,l)}}}function xS(r){let e;return{c(){e=U("New blank file")},m(t,n){w(t,e,n)},d(t){t&&$(e)}}}function ek(r){let e=(r[19]==r[6]?"Currently open":r[0].describeFile(r[19]))+"",t;return{c(){t=U(e)},m(n,i){w(n,t,i)},p(n,i){i&97&&e!==(e=(n[19]==n[6]?"Currently open":n[0].describeFile(n[19]))+"")&&me(t,e)},d(n){n&&$(t)}}}function tk(r){let e,t;function n(){return r[16](r[19])}return e=new Br({props:{$$slots:{default:[nk]},$$scope:{ctx:r}}}),e.$on("click",n),{c(){L(e.$$.fragment)},m(i,o){A(e,i,o),t=!0},p(i,o){r=i;const s={};o&131072&&(s.$$scope={dirty:o,ctx:r}),e.$set(s)},i(i){t||(S(e.$$.fragment,i),t=!0)},o(i){k(e.$$.fragment,i),t=!1},d(i){C(e,i)}}}function rk(r){let e,t;return e=new Tt({props:{$$slots:{default:[ik]},$$scope:{ctx:r}}}),e.$on("click",function(){of(r[4])&&r[4].apply(this,arguments)}),{c(){L(e.$$.fragment)},m(n,i){A(e,n,i),t=!0},p(n,i){r=n;const o={};i&131072&&(o.$$scope={dirty:i,ctx:r}),e.$set(o)},i(n){t||(S(e.$$.fragment,n),t=!0)},o(n){k(e.$$.fragment,n),t=!1},d(n){C(e,n)}}}function nk(r){let e;return{c(){e=U("Delete")},m(t,n){w(t,e,n)},d(t){t&&$(e)}}}function ik(r){let e;return{c(){e=U("Start")},m(t,n){w(t,e,n)},d(t){t&&$(e)}}}function Qu(r){let e,t,n,i,o,s,l;function a(){return r[15](r[19])}t=new YS({props:{name:`File name: ${r[19]}`,disabled:r[19]===r[6],$$slots:{default:[ek]},$$scope:{ctx:r}}}),t.$on("click",a);const u=[rk,tk],f=[];function c(g,p){return g[19]==g[6]?0:1}return i=c(r),o=f[i]=u[i](r),{c(){e=N("div"),L(t.$$.fragment),n=O(),o.c(),s=O(),ye(e,"display","flex"),ye(e,"justify-content","space-between")},m(g,p){w(g,e,p),A(t,e,null),D(e,n),f[i].m(e,null),D(e,s),l=!0},p(g,p){r=g;const h={};p&32&&(h.name=`File name: ${r[19]}`),p&96&&(h.disabled=r[19]===r[6]),p&131169&&(h.$$scope={dirty:p,ctx:r}),t.$set(h);let m=i;i=c(r),i===m?f[i].p(r,p):(ue(),k(f[m],1,1,()=>{f[m]=null}),fe(),o=f[i],o?o.p(r,p):(o=f[i]=u[i](r),o.c()),S(o,1),o.m(e,s))},i(g){l||(S(t.$$.fragment,g),S(o),l=!0)},o(g){k(t.$$.fragment,g),k(o),l=!1},d(g){g&&$(e),C(t),f[i].d()}}}function ok(r){let e,t,n,i,o,s,l,a,u,f,c,g,p,h,m,v,_,y,d,E,b,M,R,j,z,G,F,P;f=new Jt({props:{$$slots:{default:[QS]},$$scope:{ctx:r}}});const I=r[13].default,q=Ce(I,r,r[17],null);d=new pe({props:{$$slots:{default:[xS]},$$scope:{ctx:r}}}),d.$on("click",r[10]),R=new ff({props:{label:"Import from a ."+r[3]+" file",onLoad:r[11]}});let ie=rt(r[5]),X=[];for(let T=0;T<ie.length;T+=1)X[T]=Qu(Zu(r,ie,T));const H=T=>k(X[T],1,1,()=>{X[T]=null});return{c(){e=N("div"),t=N("p"),t.textContent=`All files are auto-saved in your browser's local storage. You can close your
    browser and resume later. You can export the file to your computer to share
    with someone else, and import from a file below.`,n=O(),i=N("p"),o=U("You're currently editing "),s=N("u"),l=U(r[6]),a=U(`
    .`),u=O(),L(f.$$.fragment),c=O(),q&&q.c(),g=O(),p=N("hr"),h=O(),m=N("div"),v=N("div"),_=N("h2"),_.textContent="Create or import a file",y=O(),L(d.$$.fragment),E=O(),b=N("hr"),M=O(),L(R.$$.fragment),j=O(),z=N("div"),G=N("h2"),G.textContent="Load a saved file",F=O();for(let T=0;T<X.length;T+=1)X[T].c();B(v,"class","govuk-grid-column-one-half"),B(z,"class","govuk-grid-column-one-half"),B(m,"class","govuk-grid-row"),B(e,"class","govuk-width-container")},m(T,te){w(T,e,te),D(e,t),D(e,n),D(e,i),D(i,o),D(i,s),D(s,l),D(i,a),D(e,u),A(f,e,null),D(e,c),q&&q.m(e,null),D(e,g),D(e,p),D(e,h),D(e,m),D(m,v),D(v,_),D(v,y),A(d,v,null),D(v,E),D(v,b),D(v,M),A(R,v,null),D(m,j),D(m,z),D(z,G),D(z,F);for(let ce=0;ce<X.length;ce+=1)X[ce]&&X[ce].m(z,null);P=!0},p(T,[te]){(!P||te&64)&&me(l,T[6]);const ce={};te&131144&&(ce.$$scope={dirty:te,ctx:T}),f.$set(ce),q&&q.p&&(!P||te&131072)&&Fe(q,I,T,T[17],P?Re(I,T[17],te,null):Oe(T[17]),null);const We={};te&131072&&(We.$$scope={dirty:te,ctx:T}),d.$set(We);const Pe={};if(te&8&&(Pe.label="Import from a ."+T[3]+" file"),R.$set(Pe),te&4721){ie=rt(T[5]);let we;for(we=0;we<ie.length;we+=1){const W=Zu(T,ie,we);X[we]?(X[we].p(W,te),S(X[we],1)):(X[we]=Qu(W),X[we].c(),S(X[we],1),X[we].m(z,null))}for(ue(),we=ie.length;we<X.length;we+=1)H(we);fe()}},i(T){if(!P){S(f.$$.fragment,T),S(q,T),S(d.$$.fragment,T),S(R.$$.fragment,T);for(let te=0;te<ie.length;te+=1)S(X[te]);P=!0}},o(T){k(f.$$.fragment,T),k(q,T),k(d.$$.fragment,T),k(R.$$.fragment,T),X=X.filter(Boolean);for(let te=0;te<X.length;te+=1)k(X[te]);P=!1},d(T){T&&$(e),C(f),q&&q.d(T),C(d),C(R),Bi(X,T)}}}function xu(r,e){let t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),t.setAttribute("download",r),document.body.appendChild(t),t.click(),document.body.removeChild(t)}function sk(r,e,t){let n,i=ee,o=()=>(i(),i=bt(p,G=>t(18,n=G)),p),s,l=ee,a=()=>(l(),l=bt(g,G=>t(6,s=G)),g);r.$$.on_destroy.push(()=>i()),r.$$.on_destroy.push(()=>l());let{$$slots:u={},$$scope:f}=e,{files:c}=e,{currentFile:g}=e;a();let{state:p}=e;o();let{fileSuffix:h}=e,{onStart:m}=e,v=c.getFileList();function _(){let G=window.prompt(`Rename file ${s} to what?`,s);if(G){let F=c.key(s),P=window.localStorage.getItem(F);window.localStorage.setItem(c.key(G),P),window.localStorage.removeItem(F),Te(g,s=G,s),t(5,v=c.getFileList())}}function y(){xu(s+`.${h}`,JSON.stringify(n))}function d(G){if(window.confirm(`Really delete file ${G}? You can't undo this. (If you delete, a copy will still be downloaded to your browser's download folder, in case you make a mistake.)`)){let F=c.key(G);xu(`${G}.${h}`,window.localStorage.getItem(F)),window.localStorage.removeItem(F),G==s?E():t(5,v=c.saveAndGetFileList(s,n))}}function E(){Te(g,s=c.newFilename(),s),Te(p,n=c.emptyState(),n),t(5,v=c.saveAndGetFileList(s,n))}function b(G,F){let P=uk(G,`.${h}`);try{let I=JSON.parse(F);c.validate(I),t(5,v=c.saveAndGetFileList(P,I)),M(P)}catch(I){window.alert(`Couldn't load ${P}: ${I}`)}}function M(G){try{let F=c.loadFile(G);Te(g,s=G,s),Te(p,n=F,n)}catch(F){window.alert(`Couldn't load ${G}: ${F}`)}}const R=()=>d(s),j=G=>M(G),z=G=>d(G);return r.$$set=G=>{"files"in G&&t(0,c=G.files),"currentFile"in G&&a(t(1,g=G.currentFile)),"state"in G&&o(t(2,p=G.state)),"fileSuffix"in G&&t(3,h=G.fileSuffix),"onStart"in G&&t(4,m=G.onStart),"$$scope"in G&&t(17,f=G.$$scope)},[c,g,p,h,m,v,s,_,y,d,E,b,M,u,R,j,z,f]}class lk extends Z{constructor(e){super(),Q(this,e,sk,ok,K,{files:0,currentFile:1,state:2,fileSuffix:3,onStart:4})}}class ak{constructor(e,t,n,i,o,s){ae(this,"prefix");ae(this,"emptyState");ae(this,"validate");ae(this,"describe");ae(this,"state");ae(this,"currentFile");this.prefix=e,this.emptyState=t,this.validate=n,this.describe=i,this.state=o,this.currentFile=s,this.initialLoad(),this.state.subscribe(l=>{let a=uf(this.currentFile);a&&window.localStorage.setItem(this.key(a),JSON.stringify(l))}),this.currentFile.subscribe(l=>{l&&window.localStorage.setItem(this.key("last-opened-file"),l)})}key(e){return`${this.prefix}${e}`}loadFile(e){console.log(`Loading ${e}`);let t=window.localStorage.getItem(this.key(e));if(!t)throw new Error(`Key not in local storage: ${e}`);let n=JSON.parse(t);return this.validate(n),n}newFilename(){let e=this.getFileList();for(let t=1;t<=e.length+1;t++){let n=`untitled${t}`;if(!e.includes(n))return n}throw new Error("Couldn't make a new filename; this shouldn't be possible")}getFileList(){let e=[];for(let t=0;t<window.localStorage.length;t++){let n=window.localStorage.key(t);n.startsWith(this.prefix)&&n!=this.key("last-opened-file")&&e.push(n.slice(this.prefix.length))}return e.sort(),e}saveAndGetFileList(e,t){return window.localStorage.setItem(this.key(e),JSON.stringify(t)),this.getFileList()}describeFile(e){let t=window.localStorage.getItem(this.key(e));if(!t)return"Error: missing";try{let n=JSON.parse(t);return this.validate(n),JSON.stringify(n)==JSON.stringify(this.emptyState())?"Empty":this.describe(n)}catch{return"Error: invalid or broken file"}}initialLoad(){if(typeof window>"u"){console.log("Running outside of a browser, in test mode -- not loading from local storage");return}console.log("Initial load; trying to open last opened file");let e=window.localStorage.getItem(this.key("last-opened-file"));if(e)try{let n=this.loadFile(e);this.currentFile.set(e),this.state.set(n);return}catch(n){window.alert(`The last opened file ${e} has a problem: ${n}`)}console.log("Starting with a new file");let t=this.newFilename();this.currentFile.set(t),this.state.set(this.emptyState())}}function uk(r,e){return r.endsWith(e)?r.slice(0,-e.length):r}function fk(r){let e,t;return e=new lk({props:{files:r[0],currentFile:r[1],state:r[2],fileSuffix:"geojson",onStart:r[5]}}),{c(){L(e.$$.fragment)},m(n,i){A(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.files=n[0]),i&2&&(o.currentFile=n[1]),i&4&&(o.state=n[2]),i&8&&(o.onStart=n[5]),e.$set(o)},i(n){t||(S(e.$$.fragment,n),t=!0)},o(n){k(e.$$.fragment,n),t=!1},d(n){C(e,n)}}}function ck(r){let e,t,n;return{c(){e=N("img"),n=U(`
    Manage files`),nt(e.src,t=US)||B(e,"src",t),B(e,"alt","Manage files"),ye(e,"vertical-align","middle")},m(i,o){w(i,e,o),w(i,n,o)},p:ee,d(i){i&&($(e),$(n))}}}function pk(r){let e,t,n,i,o,s,l,a,u,f,c;function g(h){r[6](h)}let p={title:"Files",$$slots:{default:[fk]},$$scope:{ctx:r}};return r[3]!==void 0&&(p.open=r[3]),e=new wp({props:p}),be.push(()=>Se(e,"open",g)),o=new pe({props:{$$slots:{default:[ck]},$$scope:{ctx:r}}}),o.$on("click",r[7]),{c(){L(e.$$.fragment),n=O(),i=N("div"),L(o.$$.fragment),s=O(),l=N("span"),a=U("Editing file "),u=N("u"),f=U(r[4]),B(l,"class","govuk-body")},m(h,m){A(e,h,m),w(h,n,m),w(h,i,m),A(o,i,null),D(i,s),D(i,l),D(l,a),D(l,u),D(u,f),c=!0},p(h,[m]){const v={};m&271&&(v.$$scope={dirty:m,ctx:h}),!t&&m&8&&(t=!0,v.open=h[3],Ee(()=>t=!1)),e.$set(v);const _={};m&256&&(_.$$scope={dirty:m,ctx:h}),o.$set(_),(!c||m&16)&&me(f,h[4])},i(h){c||(S(e.$$.fragment,h),S(o.$$.fragment,h),c=!0)},o(h){k(e.$$.fragment,h),k(o.$$.fragment,h),c=!1},d(h){h&&($(n),$(i)),C(e,h),C(o)}}}function gk(r,e,t){let n,i=ee,o=()=>(i(),i=bt(l,p=>t(4,n=p)),l);r.$$.on_destroy.push(()=>i());let{files:s}=e,{currentFile:l}=e;o();let{gjSchemes:a}=e,u=!1;const f=()=>t(3,u=!1);function c(p){u=p,t(3,u)}const g=()=>t(3,u=!0);return r.$$set=p=>{"files"in p&&t(0,s=p.files),"currentFile"in p&&o(t(1,l=p.currentFile)),"gjSchemes"in p&&t(2,a=p.gjSchemes)},[s,l,a,u,n,f,c,g]}class hk extends Z{constructor(e){super(),Q(this,e,gk,pk,K,{files:0,currentFile:1,gjSchemes:2})}}function ef(r){let e,t,n,i,o,s,l,a,u,f,c,g;return u=new hk({props:{files:r[8],currentFile:r[7],gjSchemes:r[6]}}),{c(){e=N("h2"),e.textContent="NPT Scheme Sketcher",t=O(),n=N("p"),i=U(r[3]),o=U(` (
        `),s=N("a"),s.textContent="Change area",l=U(`
        )`),a=O(),L(u.$$.fragment),f=O(),c=N("hr"),B(s,"href","index.html")},m(p,h){w(p,e,h),w(p,t,h),w(p,n,h),D(n,i),D(n,o),D(n,s),D(n,l),w(p,a,h),A(u,p,h),w(p,f,h),w(p,c,h),g=!0},p:ee,i(p){g||(S(u.$$.fragment,p),g=!0)},o(p){k(u.$$.fragment,p),g=!1},d(p){p&&($(e),$(t),$(n),$(a),$(f),$(c)),C(u,p)}}}function mk(r){let e,t;return e=new bw({props:{cfg:kt,gjSchemes:r[6]}}),{c(){L(e.$$.fragment)},m(n,i){A(e,n,i),t=!0},p:ee,i(n){t||(S(e.$$.fragment,n),t=!0)},o(n){k(e.$$.fragment,n),t=!1},d(n){C(e,n)}}}function dk(r){let e,t;return e=new s$({props:{cfg:kt,gjSchemes:r[6]}}),{c(){L(e.$$.fragment)},m(n,i){A(e,n,i),t=!0},p:ee,i(n){t||(S(e.$$.fragment,n),t=!0)},o(n){k(e.$$.fragment,n),t=!1},d(n){C(e,n)}}}function yk(r){let e,t,n,i,o,s,l,a,u,f,c,g,p;e=new z_({props:{cfg:kt,boundaryGeojson:r[0],fitBoundsAtStart:r[4]}}),n=new w1({props:{cfg:kt,gjSchemes:r[6]}}),o=new s1({props:{cfg:kt}});const h=[dk,mk],m=[];function v(_,y){return _[1].mode=="list"?0:_[1].mode=="split-route"?1:-1}return~(l=v(r))&&(a=m[l]=h[l](r)),f=new F1({props:{cfg:kt}}),g=new E1({props:{cfg:kt}}),{c(){L(e.$$.fragment),t=O(),L(n.$$.fragment),i=O(),L(o.$$.fragment),s=O(),a&&a.c(),u=O(),L(f.$$.fragment),c=O(),L(g.$$.fragment)},m(_,y){A(e,_,y),w(_,t,y),A(n,_,y),w(_,i,y),A(o,_,y),w(_,s,y),~l&&m[l].m(_,y),w(_,u,y),A(f,_,y),w(_,c,y),A(g,_,y),p=!0},p(_,y){const d={};y&1&&(d.boundaryGeojson=_[0]),e.$set(d);let E=l;l=v(_),l===E?~l&&m[l].p(_,y):(a&&(ue(),k(m[E],1,1,()=>{m[E]=null}),fe()),~l?(a=m[l],a?a.p(_,y):(a=m[l]=h[l](_),a.c()),S(a,1),a.m(u.parentNode,u)):a=null)},i(_){p||(S(e.$$.fragment,_),S(n.$$.fragment,_),S(o.$$.fragment,_),S(a),S(f.$$.fragment,_),S(g.$$.fragment,_),p=!0)},o(_){k(e.$$.fragment,_),k(n.$$.fragment,_),k(o.$$.fragment,_),k(a),k(f.$$.fragment,_),k(g.$$.fragment,_),p=!1},d(_){_&&($(t),$(i),$(s),$(u),$(c)),C(e,_),C(n,_),C(o,_),~l&&m[l].d(_),C(f,_),C(g,_)}}}function vk(r){let e,t,n,i,o,s,l,a,u,f=r[1].mode=="list"&&ef(r);i=new AS({props:{cfg:kt,gjSchemes:r[6],routeSnapperUrl:r[5]}});function c(p){r[9](p)}let g={style:"https://api.maptiler.com/maps/uk-openzoomstack-light/style.json?key="+kt.maptilerApiKey,standardControls:!0,hash:!0,$$slots:{default:[yk]},$$scope:{ctx:r}};return r[2]!==void 0&&(g.map=r[2]),l=new Gp({props:g}),be.push(()=>Se(l,"map",c)),l.$on("error",r[10]),{c(){e=N("div"),t=N("div"),f&&f.c(),n=O(),L(i.$$.fragment),o=O(),s=N("div"),L(l.$$.fragment),B(t,"class","sidebar svelte-1j3l30i"),B(s,"class","map svelte-1j3l30i"),ye(e,"display","flex"),ye(e,"height","100vh")},m(p,h){w(p,e,h),D(e,t),f&&f.m(t,null),D(t,n),A(i,t,null),D(e,o),D(e,s),A(l,s,null),u=!0},p(p,[h]){p[1].mode=="list"?f?(f.p(p,h),h&2&&S(f,1)):(f=ef(p),f.c(),S(f,1),f.m(t,n)):f&&(ue(),k(f,1,1,()=>{f=null}),fe());const m={};h&8195&&(m.$$scope={dirty:h,ctx:p}),!a&&h&4&&(a=!0,m.map=p[2],Ee(()=>a=!1)),l.$set(m)},i(p){u||(S(f),S(i.$$.fragment,p),S(l.$$.fragment,p),u=!0)},o(p){k(f),k(i.$$.fragment,p),k(l.$$.fragment,p),u=!1},d(p){p&&$(e),f&&f.d(),C(i),C(l)}}}function tf(r,e){return r.startsWith(e)?r.slice(e.length):r}function _k(r,e,t){let n,i;V(r,oe,v=>t(1,n=v)),V(r,ot,v=>t(2,i=v));let s=new URLSearchParams(window.location.search).get("boundary"),l=!window.location.hash,a={type:"FeatureCollection",features:[]};Nt(async()=>{Up();let _=await(await fetch(qp)).json();_.features=_.features.filter(y=>y.properties.LAD23NM==tf(s,"LAD_")),_.features.length===0&&(window.location.href=`index.html?error=Boundary name not found: ${s}`),t(0,a=_)});let u=`https://atip.uk/npt_tmp/${tf(s,"LAD_")}.bin.gz`,f=Ie(p()),c=Ie(""),g=new ak(`npt_ss/${s}/`,p,jS,GS,f,c);function p(){let v=xc(kt);return v.boundary=s,v}function h(v){i=v,ot.set(i)}return[a,n,i,s,l,u,f,c,g,h,v=>{console.log(v.detail.error)}]}class bk extends Z{constructor(e){super(),Q(this,e,_k,vk,K,{})}}document.body.className+=" js-enabled"+("noModule"in HTMLScriptElement.prototype?" govuk-frontend-supported":"");new bk({target:document.getElementById("app")});
