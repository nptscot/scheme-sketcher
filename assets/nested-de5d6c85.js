var dp=Object.defineProperty;var yp=(r,e,t)=>e in r?dp(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var ce=(r,e,t)=>(yp(r,typeof e!="symbol"?e+"":e,t),t);import{S as Z,i as Q,s as K,w as Ne,a as T,d as N,f as w,x as Te,y as De,z as je,t as $,h as E,j as S,g as j,b as B,A as ve,B as ne,C as qt,D as vp,H as be,n as z,p as de,I as he,J as yr,K as vr,c as L,m as A,k as C,N as _e,E as Ot,e as at,O as Nt,l as ls,Q as _p,R as Ve,v as me,T as bp,U as qs,V as wp,W as Qu,X as $e,Y as Pe,Z as Bi,_ as ue,$ as fe,a0 as Sp,a1 as J,a2 as tt,a3 as $p,a4 as st,a5 as kp,a6 as Ep,a7 as x,a8 as us,a9 as xu,aa as zs,ab as Gn,ac as Mp,ad as Pp,ae as Lp,F as vn,af as Ap,ag as fs,ah as cs,ai as Cp,aj as ef,ak as Oe,al as tf,am as sn,an as rf,ao as Op,G as rr,ap as Fp,o as Ft,L as _r,aq as zt,P as ps,ar as Rt,as as ii,at as Rp,M as Bp,q as Ip,r as Np}from"./boundaries-b5bc10c3.js";function we(r,e){const t={},n={},i={$$scope:1};let o=r.length;for(;o--;){const s=r[o],a=e[o];if(a){for(const l in s)l in a||(n[l]=1);for(const l in a)i[l]||(t[l]=a[l],i[l]=1);r[o]=a}else for(const l in s)i[l]=1}for(const s in n)s in t||(t[s]=void 0);return t}function Ce(r){return typeof r=="object"&&r!==null?r:{}}function Tp(r){let e,t;const n=r[1].default,i=Ne(n,r,r[0],null);return{c(){e=T("div"),i&&i.c(),N(e,"class","govuk-button-group")},m(o,s){w(o,e,s),i&&i.m(e,null),t=!0},p(o,[s]){i&&i.p&&(!t||s&1)&&Te(i,n,o,o[0],t?je(n,o[0],s,null):De(o[0]),null)},i(o){t||($(i,o),t=!0)},o(o){E(i,o),t=!1},d(o){o&&S(e),i&&i.d(o)}}}function Dp(r,e,t){let{$$slots:n={},$$scope:i}=e;return r.$$set=o=>{"$$scope"in o&&t(0,i=o.$$scope)},[i,n]}class or extends Z{constructor(e){super(),Q(this,e,Dp,Tp,K,{})}}function jp(r){let e,t,n;const i=r[3].default,o=Ne(i,r,r[2],null);return{c(){e=T("fieldset"),t=T("div"),o&&o.c(),N(t,"class",r[0]),N(t,"data-module","govuk-checkboxes"),N(e,"class","govuk-fieldset")},m(s,a){w(s,e,a),j(e,t),o&&o.m(t,null),n=!0},p(s,[a]){o&&o.p&&(!n||a&4)&&Te(o,i,s,s[2],n?je(i,s[2],a,null):De(s[2]),null)},i(s){n||($(o,s),n=!0)},o(s){E(o,s),n=!1},d(s){s&&S(e),o&&o.d(s)}}}function Gp(r,e,t){let{$$slots:n={},$$scope:i}=e,{small:o=!1}=e,s=o?"govuk-checkboxes--small":"govuk-checkboxes";return r.$$set=a=>{"small"in a&&t(1,o=a.small),"$$scope"in a&&t(2,i=a.$$scope)},[s,o,i,n]}class Up extends Z{constructor(e){super(),Q(this,e,Gp,jp,K,{small:1})}}let Ln;const qp=new Uint8Array(16);function zp(){if(!Ln&&(Ln=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Ln))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Ln(qp)}const Le=[];for(let r=0;r<256;++r)Le.push((r+256).toString(16).slice(1));function Wp(r,e=0){return Le[r[e+0]]+Le[r[e+1]]+Le[r[e+2]]+Le[r[e+3]]+"-"+Le[r[e+4]]+Le[r[e+5]]+"-"+Le[r[e+6]]+Le[r[e+7]]+"-"+Le[r[e+8]]+Le[r[e+9]]+"-"+Le[r[e+10]]+Le[r[e+11]]+Le[r[e+12]]+Le[r[e+13]]+Le[r[e+14]]+Le[r[e+15]]}const Hp=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Ws={randomUUID:Hp};function Fr(r,e,t){if(Ws.randomUUID&&!e&&!r)return Ws.randomUUID();r=r||{};const n=r.random||(r.rng||zp)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,e){t=t||0;for(let i=0;i<16;++i)e[t+i]=n[i];return e}return Wp(n)}const Vp=r=>({}),Hs=r=>({});function Jp(r){let e,t,n,i,o,s,a,l,u;const f=r[5].default,c=Ne(f,r,r[4],null),h=r[5].right,p=Ne(h,r,r[4],Hs);return{c(){e=T("div"),t=T("input"),n=B(),i=T("label"),c&&c.c(),o=B(),s=T("span"),p&&p.c(),N(t,"type","checkbox"),N(t,"class","govuk-checkboxes__input"),N(t,"id",r[3]),N(i,"class","govuk-label govuk-checkboxes__label"),N(i,"for",r[3]),N(i,"title",r[1]),ve(s,"float","right"),N(e,"class","govuk-checkboxes__item"),N(e,"style",r[2])},m(g,m){w(g,e,m),j(e,t),t.checked=r[0],j(e,n),j(e,i),c&&c.m(i,null),j(e,o),j(e,s),p&&p.m(s,null),a=!0,l||(u=[ne(t,"change",r[7]),ne(t,"change",r[6])],l=!0)},p(g,[m]){m&1&&(t.checked=g[0]),c&&c.p&&(!a||m&16)&&Te(c,f,g,g[4],a?je(f,g[4],m,null):De(g[4]),null),(!a||m&2)&&N(i,"title",g[1]),p&&p.p&&(!a||m&16)&&Te(p,h,g,g[4],a?je(h,g[4],m,Vp):De(g[4]),Hs)},i(g){a||($(c,g),$(p,g),a=!0)},o(g){E(c,g),E(p,g),a=!1},d(g){g&&S(e),c&&c.d(g),p&&p.d(g),l=!1,qt(u)}}}function Yp(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=vp(n);let{checked:s}=e,{hint:a=null}=e,u=o.right!==void 0?"float: none":"",f=Fr();function c(p){be.call(this,r,p)}function h(){s=this.checked,t(0,s)}return r.$$set=p=>{"checked"in p&&t(0,s=p.checked),"hint"in p&&t(1,a=p.hint),"$$scope"in p&&t(4,i=p.$$scope)},[s,a,u,f,i,n,c,h]}class vo extends Z{constructor(e){super(),Q(this,e,Yp,Jp,K,{checked:0,hint:1})}}function Xp(r){let e,t,n,i,o,s,a;const l=r[3].default,u=Ne(l,r,r[2],null);return{c(){e=T("details"),t=T("summary"),n=T("span"),i=z(r[0]),o=B(),s=T("div"),u&&u.c(),N(n,"class","govuk-details__summary-text"),N(t,"class","govuk-details__summary"),N(s,"class","govuk-details__text"),e.open=r[1],N(e,"class","govuk-details"),N(e,"data-module","govuk-details")},m(f,c){w(f,e,c),j(e,t),j(t,n),j(n,i),j(e,o),j(e,s),u&&u.m(s,null),a=!0},p(f,[c]){(!a||c&1)&&de(i,f[0]),u&&u.p&&(!a||c&4)&&Te(u,l,f,f[2],a?je(l,f[2],c,null):De(f[2]),null),(!a||c&2)&&(e.open=f[1])},i(f){a||($(u,f),a=!0)},o(f){E(u,f),a=!1},d(f){f&&S(e),u&&u.d(f)}}}function Kp(r,e,t){let{$$slots:n={},$$scope:i}=e,{label:o}=e,{open:s=!1}=e;return r.$$set=a=>{"label"in a&&t(0,o=a.label),"open"in a&&t(1,s=a.open),"$$scope"in a&&t(2,i=a.$$scope)},[o,s,i,n]}class Zp extends Z{constructor(e){super(),Q(this,e,Kp,Xp,K,{label:0,open:1})}}function Qp(r){let e,t,n,i;const o=r[2].default,s=Ne(o,r,r[1],null);let a=[{type:"button"},{class:"govuk-button"},{"data-module":"govuk-button"},r[0]],l={};for(let u=0;u<a.length;u+=1)l=he(l,a[u]);return{c(){e=T("button"),s&&s.c(),yr(e,l)},m(u,f){w(u,e,f),s&&s.m(e,null),e.autofocus&&e.focus(),t=!0,n||(i=ne(e,"click",r[3]),n=!0)},p(u,[f]){s&&s.p&&(!t||f&2)&&Te(s,o,u,u[1],t?je(o,u[1],f,null):De(u[1]),null),yr(e,l=we(a,[{type:"button"},{class:"govuk-button"},{"data-module":"govuk-button"},f&1&&u[0]]))},i(u){t||($(s,u),t=!0)},o(u){E(s,u),t=!1},d(u){u&&S(e),s&&s.d(u),n=!1,i()}}}function xp(r,e,t){let{$$slots:n={},$$scope:i}=e;function o(s){be.call(this,r,s)}return r.$$set=s=>{t(0,e=he(he({},e),vr(s))),"$$scope"in s&&t(1,i=s.$$scope)},e=vr(e),[e,i,n,o]}class Wt extends Z{constructor(e){super(),Q(this,e,xp,Qp,K,{})}}function eh(r){let e,t,n;return{c(){e=T("input"),e.disabled=r[1],N(e,"class","govuk-file-upload"),N(e,"id",r[4]),N(e,"type","file")},m(i,o){w(i,e,o),r[6](e),t||(n=ne(e,"change",r[3]),t=!0)},p(i,o){o&2&&(e.disabled=i[1])},d(i){i&&S(e),r[6](null),t=!1,n()}}}function th(r){let e,t;return e=new Rr({props:{label:r[0],id:r[4],$$slots:{default:[eh]},$$scope:{ctx:r}}}),{c(){L(e.$$.fragment)},m(n,i){A(e,n,i),t=!0},p(n,[i]){const o={};i&1&&(o.label=n[0]),i&134&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){E(e.$$.fragment,n),t=!1},d(n){C(e,n)}}}function rh(r,e,t){let{label:n}=e,{onLoad:i}=e,{disabled:o=!1}=e,s;async function a(f){let c=s.files[0].name,h=await s.files[0].text();i(c,h)}let l=Fr();function u(f){_e[f?"unshift":"push"](()=>{s=f,t(2,s)})}return r.$$set=f=>{"label"in f&&t(0,n=f.label),"onLoad"in f&&t(5,i=f.onLoad),"disabled"in f&&t(1,o=f.disabled)},[n,o,s,a,l,i,u]}class nh extends Z{constructor(e){super(),Q(this,e,rh,th,K,{label:0,onLoad:5,disabled:1})}}function ih(r){let e,t,n,i,o;const s=r[3].default,a=Ne(s,r,r[2],null);return{c(){e=T("div"),t=T("label"),n=z(r[0]),i=B(),a&&a.c(),N(t,"class","govuk-label govuk-label--s"),N(t,"for",r[1]),N(e,"class","govuk-form-group")},m(l,u){w(l,e,u),j(e,t),j(t,n),j(e,i),a&&a.m(e,null),o=!0},p(l,[u]){(!o||u&1)&&de(n,l[0]),(!o||u&2)&&N(t,"for",l[1]),a&&a.p&&(!o||u&4)&&Te(a,s,l,l[2],o?je(s,l[2],u,null):De(l[2]),null)},i(l){o||($(a,l),o=!0)},o(l){E(a,l),o=!1},d(l){l&&S(e),a&&a.d(l)}}}function oh(r,e,t){let{$$slots:n={},$$scope:i}=e,{label:o}=e,{id:s}=e;return r.$$set=a=>{"label"in a&&t(0,o=a.label),"id"in a&&t(1,s=a.id),"$$scope"in a&&t(2,i=a.$$scope)},[o,s,i,n]}class Rr extends Z{constructor(e){super(),Q(this,e,oh,ih,K,{label:0,id:1})}}function Vs(r,e,t){const n=r.slice();return n[10]=e[t][0],n[11]=e[t][1],n}function Js(r){let e,t,n,i,o=!1,s,a,l=r[11]+"",u,f,c,h,p,g;return h=_p(r[9][0]),{c(){e=T("div"),t=T("input"),s=B(),a=T("label"),u=z(l),c=B(),N(t,"class","govuk-radios__input"),N(t,"id",n=r[5]+r[10]),N(t,"type","radio"),t.__value=i=r[10],Ve(t,t.__value),N(a,"class","govuk-label govuk-radios__label"),N(a,"for",f=r[5]+r[10]),N(e,"class","govuk-radios__item"),h.p(t)},m(m,v){w(m,e,v),j(e,t),t.checked=t.__value===r[0],j(e,s),j(e,a),j(a,u),j(e,c),p||(g=[ne(t,"change",r[8]),ne(t,"change",r[7])],p=!0)},p(m,v){v&4&&n!==(n=m[5]+m[10])&&N(t,"id",n),v&4&&i!==(i=m[10])&&(t.__value=i,Ve(t,t.__value),o=!0),(o||v&5)&&(t.checked=t.__value===m[0]),v&4&&l!==(l=m[11]+"")&&de(u,l),v&4&&f!==(f=m[5]+m[10])&&N(a,"for",f)},d(m){m&&S(e),h.r(),p=!1,qt(g)}}}function sh(r){let e,t,n,i,o,s,a,l,u;s=new Ot({props:{errorMessage:r[4]}});let f=at(r[2]),c=[];for(let h=0;h<f.length;h+=1)c[h]=Js(Vs(r,f,h));return{c(){e=T("div"),t=T("fieldset"),n=T("legend"),i=z(r[1]),o=B(),L(s.$$.fragment),a=B(),l=T("div");for(let h=0;h<c.length;h+=1)c[h].c();N(n,"class","govuk-fieldset__legend govuk-label--s"),N(l,"class","govuk-radios"),N(l,"data-module","govuk-radios"),Nt(l,"govuk-radios--inline",r[3]),Nt(l,"govuk-radios--small",r[3]),N(t,"class","govuk-fieldset"),N(e,"class","govuk-form-group")},m(h,p){w(h,e,p),j(e,t),j(t,n),j(n,i),j(t,o),A(s,t,null),j(t,a),j(t,l);for(let g=0;g<c.length;g+=1)c[g]&&c[g].m(l,null);u=!0},p(h,[p]){(!u||p&2)&&de(i,h[1]);const g={};if(p&16&&(g.errorMessage=h[4]),s.$set(g),p&37){f=at(h[2]);let m;for(m=0;m<f.length;m+=1){const v=Vs(h,f,m);c[m]?c[m].p(v,p):(c[m]=Js(v),c[m].c(),c[m].m(l,null))}for(;m<c.length;m+=1)c[m].d(1);c.length=f.length}(!u||p&8)&&Nt(l,"govuk-radios--inline",h[3]),(!u||p&8)&&Nt(l,"govuk-radios--small",h[3])},i(h){u||($(s.$$.fragment,h),u=!0)},o(h){E(s.$$.fragment,h),u=!1},d(h){h&&S(e),C(s),ls(c,h)}}}function ah(r,e,t){let n,{legend:i}=e,{choices:o}=e,{inlineSmall:s=!1}=e,{required:a=!1}=e,{value:l}=e,u=Fr();const f=[[]];function c(p){be.call(this,r,p)}function h(){l=this.__value,t(0,l)}return r.$$set=p=>{"legend"in p&&t(1,i=p.legend),"choices"in p&&t(2,o=p.choices),"inlineSmall"in p&&t(3,s=p.inlineSmall),"required"in p&&t(6,a=p.required),"value"in p&&t(0,l=p.value)},r.$$.update=()=>{r.$$.dirty&65&&t(4,n=a&&l==""?"Required":"")},[l,i,o,s,n,u,a,c,h,f]}class nf extends Z{constructor(e){super(),Q(this,e,ah,sh,K,{legend:1,choices:2,inlineSmall:3,required:6,value:0})}}function lh(r){let e,t,n,i;const o=r[2].default,s=Ne(o,r,r[1],null);let a=[{type:"button"},{class:"govuk-button govuk-button--secondary"},{"data-module":"govuk-button"},r[0]],l={};for(let u=0;u<a.length;u+=1)l=he(l,a[u]);return{c(){e=T("button"),s&&s.c(),yr(e,l)},m(u,f){w(u,e,f),s&&s.m(e,null),e.autofocus&&e.focus(),t=!0,n||(i=[ne(e,"click",r[3]),ne(e,"mouseenter",r[4]),ne(e,"mouseleave",r[5])],n=!0)},p(u,[f]){s&&s.p&&(!t||f&2)&&Te(s,o,u,u[1],t?je(o,u[1],f,null):De(u[1]),null),yr(e,l=we(a,[{type:"button"},{class:"govuk-button govuk-button--secondary"},{"data-module":"govuk-button"},f&1&&u[0]]))},i(u){t||($(s,u),t=!0)},o(u){E(s,u),t=!1},d(u){u&&S(e),s&&s.d(u),n=!1,qt(i)}}}function uh(r,e,t){let{$$slots:n={},$$scope:i}=e;function o(l){be.call(this,r,l)}function s(l){be.call(this,r,l)}function a(l){be.call(this,r,l)}return r.$$set=l=>{t(0,e=he(he({},e),vr(l))),"$$scope"in l&&t(1,i=l.$$scope)},e=vr(e),[e,i,n,o,s,a]}class pe extends Z{constructor(e){super(),Q(this,e,uh,lh,K,{})}}function Ys(r,e,t){const n=r.slice();return n[10]=e[t][0],n[11]=e[t][1],n}function Xs(r){let e,t;return{c(){e=T("div"),t=z(r[2]),N(e,"class","govuk-hint")},m(n,i){w(n,e,i),j(e,t)},p(n,i){i&4&&de(t,n[2])},d(n){n&&S(e)}}}function Ks(r){let e;return{c(){e=T("option"),e.__value="",Ve(e,e.__value)},m(t,n){w(t,e,n)},d(t){t&&S(e)}}}function Zs(r){let e,t=r[11]+"",n,i;return{c(){e=T("option"),n=z(t),e.__value=i=r[10],Ve(e,e.__value)},m(o,s){w(o,e,s),j(e,n)},p(o,s){s&8&&t!==(t=o[11]+"")&&de(n,t),s&8&&i!==(i=o[10])&&(e.__value=i,Ve(e,e.__value))},d(o){o&&S(e)}}}function fh(r){let e,t,n,i,o,s,a,l;e=new Ot({props:{errorMessage:r[6]}});let u=r[2]&&Xs(r),f=r[4]&&Ks(),c=at(r[3]),h=[];for(let p=0;p<c.length;p+=1)h[p]=Zs(Ys(r,c,p));return{c(){L(e.$$.fragment),t=B(),u&&u.c(),n=B(),i=T("select"),f&&f.c(),o=me();for(let p=0;p<h.length;p+=1)h[p].c();N(i,"class","govuk-select"),N(i,"id",r[7]),i.disabled=r[5],r[0]===void 0&&bp(()=>r[9].call(i))},m(p,g){A(e,p,g),w(p,t,g),u&&u.m(p,g),w(p,n,g),w(p,i,g),f&&f.m(i,null),j(i,o);for(let m=0;m<h.length;m+=1)h[m]&&h[m].m(i,null);qs(i,r[0],!0),s=!0,a||(l=[ne(i,"change",r[9]),ne(i,"change",r[8])],a=!0)},p(p,g){const m={};if(g&64&&(m.errorMessage=p[6]),e.$set(m),p[2]?u?u.p(p,g):(u=Xs(p),u.c(),u.m(n.parentNode,n)):u&&(u.d(1),u=null),p[4]?f||(f=Ks(),f.c(),f.m(i,o)):f&&(f.d(1),f=null),g&8){c=at(p[3]);let v;for(v=0;v<c.length;v+=1){const b=Ys(p,c,v);h[v]?h[v].p(b,g):(h[v]=Zs(b),h[v].c(),h[v].m(i,null))}for(;v<h.length;v+=1)h[v].d(1);h.length=c.length}(!s||g&32)&&(i.disabled=p[5]),g&9&&qs(i,p[0])},i(p){s||($(e.$$.fragment,p),s=!0)},o(p){E(e.$$.fragment,p),s=!1},d(p){p&&(S(t),S(n),S(i)),C(e,p),u&&u.d(p),f&&f.d(),ls(h,p),a=!1,qt(l)}}}function ch(r){let e,t;return e=new Rr({props:{label:r[1],id:r[7],$$slots:{default:[fh]},$$scope:{ctx:r}}}),{c(){L(e.$$.fragment)},m(n,i){A(e,n,i),t=!0},p(n,[i]){const o={};i&2&&(o.label=n[1]),i&16509&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){E(e.$$.fragment,n),t=!1},d(n){C(e,n)}}}function ph(r,e,t){let{label:n}=e,{hint:i=""}=e,{choices:o}=e,{emptyOption:s=!1}=e,{disabled:a=!1}=e,{errorMessage:l=""}=e,{value:u}=e,f=Fr();function c(p){be.call(this,r,p)}function h(){u=wp(this),t(0,u),t(3,o)}return r.$$set=p=>{"label"in p&&t(1,n=p.label),"hint"in p&&t(2,i=p.hint),"choices"in p&&t(3,o=p.choices),"emptyOption"in p&&t(4,s=p.emptyOption),"disabled"in p&&t(5,a=p.disabled),"errorMessage"in p&&t(6,l=p.errorMessage),"value"in p&&t(0,u=p.value)},[u,n,i,o,s,a,l,f,c,h]}class _o extends Z{constructor(e){super(),Q(this,e,ph,ch,K,{label:1,hint:2,choices:3,emptyOption:4,disabled:5,errorMessage:6,value:0})}}function Qs(r){let e,t;return{c(){e=T("div"),t=z(r[2]),N(e,"class","govuk-hint")},m(n,i){w(n,e,i),j(e,t)},p(n,i){i&4&&de(t,n[2])},d(n){n&&S(e)}}}function hh(r){let e,t,n,i,o,s,a;e=new Ot({props:{errorMessage:r[4]}});let l=r[2]&&Qs(r);return{c(){L(e.$$.fragment),t=B(),l&&l.c(),n=B(),i=T("textarea"),N(i,"class","govuk-textarea"),N(i,"id",r[5]),N(i,"rows",r[3])},m(u,f){A(e,u,f),w(u,t,f),l&&l.m(u,f),w(u,n,f),w(u,i,f),Ve(i,r[0]),o=!0,s||(a=ne(i,"input",r[6]),s=!0)},p(u,f){const c={};f&16&&(c.errorMessage=u[4]),e.$set(c),u[2]?l?l.p(u,f):(l=Qs(u),l.c(),l.m(n.parentNode,n)):l&&(l.d(1),l=null),(!o||f&8)&&N(i,"rows",u[3]),f&1&&Ve(i,u[0])},i(u){o||($(e.$$.fragment,u),o=!0)},o(u){E(e.$$.fragment,u),o=!1},d(u){u&&(S(t),S(n),S(i)),C(e,u),l&&l.d(u),s=!1,a()}}}function gh(r){let e,t;return e=new Rr({props:{label:r[1],id:r[5],$$slots:{default:[hh]},$$scope:{ctx:r}}}),{c(){L(e.$$.fragment)},m(n,i){A(e,n,i),t=!0},p(n,[i]){const o={};i&2&&(o.label=n[1]),i&157&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){E(e.$$.fragment,n),t=!1},d(n){C(e,n)}}}function mh(r,e,t){let{label:n}=e,{hint:i=""}=e,{value:o}=e,{rows:s=5}=e,{errorMessage:a=""}=e,l=Fr();function u(){o=this.value,t(0,o)}return r.$$set=f=>{"label"in f&&t(1,n=f.label),"hint"in f&&t(2,i=f.hint),"value"in f&&t(0,o=f.value),"rows"in f&&t(3,s=f.rows),"errorMessage"in f&&t(4,a=f.errorMessage)},[o,n,i,s,a,l,u]}class dh extends Z{constructor(e){super(),Q(this,e,mh,gh,K,{label:1,hint:2,value:0,rows:3,errorMessage:4})}}function yh(r){let e,t,n,i,o,s;return e=new Ot({props:{errorMessage:r[2]}}),{c(){L(e.$$.fragment),t=B(),n=T("input"),N(n,"type","text"),N(n,"class","govuk-input"),N(n,"id",r[3])},m(a,l){A(e,a,l),w(a,t,l),w(a,n,l),Ve(n,r[0]),i=!0,o||(s=ne(n,"input",r[5]),o=!0)},p(a,l){const u={};l&4&&(u.errorMessage=a[2]),e.$set(u),l&1&&n.value!==a[0]&&Ve(n,a[0])},i(a){i||($(e.$$.fragment,a),i=!0)},o(a){E(e.$$.fragment,a),i=!1},d(a){a&&(S(t),S(n)),C(e,a),o=!1,s()}}}function vh(r){let e,t;return e=new Rr({props:{label:r[1],id:r[3],$$slots:{default:[yh]},$$scope:{ctx:r}}}),{c(){L(e.$$.fragment)},m(n,i){A(e,n,i),t=!0},p(n,[i]){const o={};i&2&&(o.label=n[1]),i&69&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){E(e.$$.fragment,n),t=!1},d(n){C(e,n)}}}function _h(r,e,t){let n,{label:i}=e,{value:o}=e,{required:s=!1}=e,a=Fr();function l(){o=this.value,t(0,o)}return r.$$set=u=>{"label"in u&&t(1,i=u.label),"value"in u&&t(0,o=u.value),"required"in u&&t(4,s=u.required)},r.$$.update=()=>{r.$$.dirty&17&&t(2,n=s&&(o==null||o=="")?"Required":"")},[o,i,n,a,s,l]}class of extends Z{constructor(e){super(),Q(this,e,_h,vh,K,{label:1,value:0,required:4})}}function bh(r){let e,t,n,i;const o=r[2].default,s=Ne(o,r,r[1],null);let a=[{type:"button"},{class:"govuk-button govuk-button--warning"},{"data-module":"govuk-button"},r[0]],l={};for(let u=0;u<a.length;u+=1)l=he(l,a[u]);return{c(){e=T("button"),s&&s.c(),yr(e,l)},m(u,f){w(u,e,f),s&&s.m(e,null),e.autofocus&&e.focus(),t=!0,n||(i=ne(e,"click",r[3]),n=!0)},p(u,[f]){s&&s.p&&(!t||f&2)&&Te(s,o,u,u[1],t?je(o,u[1],f,null):De(u[1]),null),yr(e,l=we(a,[{type:"button"},{class:"govuk-button govuk-button--warning"},{"data-module":"govuk-button"},f&1&&u[0]]))},i(u){t||($(s,u),t=!0)},o(u){E(s,u),t=!1},d(u){u&&S(e),s&&s.d(u),n=!1,i()}}}function wh(r,e,t){let{$$slots:n={},$$scope:i}=e;function o(s){be.call(this,r,s)}return r.$$set=s=>{t(0,e=he(he({},e),vr(s))),"$$scope"in s&&t(1,i=s.$$scope)},e=vr(e),[e,i,n,o]}class Ii extends Z{constructor(e){super(),Q(this,e,wh,bh,K,{})}}function Sh(r){let e;const t=r[16].default,n=Ne(t,r,r[24],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&16777216)&&Te(n,t,i,i[24],e?je(t,i[24],o,null):De(i[24]),null)},i(i){e||($(n,i),e=!0)},o(i){E(n,i),e=!1},d(i){n&&n.d(i)}}}function $h(r){let e,t,n;function i(s){r[17](s)}let o={id:r[1],type:"circle",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[Sh]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new Qu({props:o}),_e.push(()=>$e(e,"hovered",i)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){L(e.$$.fragment)},m(s,a){A(e,s,a),n=!0},p(s,[a]){const l={};a&2&&(l.id=s[1]),a&4&&(l.source=s[2]),a&8&&(l.sourceLayer=s[3]),a&16&&(l.beforeId=s[4]),a&32&&(l.beforeLayerType=s[5]),a&64&&(l.paint=s[6]),a&128&&(l.layout=s[7]),a&256&&(l.filter=s[8]),a&512&&(l.applyToClusters=s[9]),a&1024&&(l.minzoom=s[10]),a&2048&&(l.maxzoom=s[11]),a&4096&&(l.hoverCursor=s[12]),a&8192&&(l.manageHoverState=s[13]),a&16384&&(l.eventsIfTopMost=s[14]),a&32768&&(l.interactive=s[15]),a&16777216&&(l.$$scope={dirty:a,ctx:s}),!t&&a&1&&(t=!0,l.hovered=s[0],Pe(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){E(e.$$.fragment,s),n=!1},d(s){C(e,s)}}}function kh(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=Bi("circle")}=e,{source:s=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:l=void 0}=e,{beforeLayerType:u=void 0}=e,{paint:f}=e,{layout:c=void 0}=e,{filter:h=void 0}=e,{applyToClusters:p=void 0}=e,{minzoom:g=void 0}=e,{maxzoom:m=void 0}=e,{hoverCursor:v=void 0}=e,{manageHoverState:b=!1}=e,{hovered:d=null}=e,{eventsIfTopMost:y=!1}=e,{interactive:k=!0}=e;function _(P){d=P,t(0,d)}function M(P){be.call(this,r,P)}function F(P){be.call(this,r,P)}function I(P){be.call(this,r,P)}function U(P){be.call(this,r,P)}function W(P){be.call(this,r,P)}function O(P){be.call(this,r,P)}return r.$$set=P=>{"id"in P&&t(1,o=P.id),"source"in P&&t(2,s=P.source),"sourceLayer"in P&&t(3,a=P.sourceLayer),"beforeId"in P&&t(4,l=P.beforeId),"beforeLayerType"in P&&t(5,u=P.beforeLayerType),"paint"in P&&t(6,f=P.paint),"layout"in P&&t(7,c=P.layout),"filter"in P&&t(8,h=P.filter),"applyToClusters"in P&&t(9,p=P.applyToClusters),"minzoom"in P&&t(10,g=P.minzoom),"maxzoom"in P&&t(11,m=P.maxzoom),"hoverCursor"in P&&t(12,v=P.hoverCursor),"manageHoverState"in P&&t(13,b=P.manageHoverState),"hovered"in P&&t(0,d=P.hovered),"eventsIfTopMost"in P&&t(14,y=P.eventsIfTopMost),"interactive"in P&&t(15,k=P.interactive),"$$scope"in P&&t(24,i=P.$$scope)},[d,o,s,a,l,u,f,c,h,p,g,m,v,b,y,k,n,_,M,F,I,U,W,O,i]}class br extends Z{constructor(e){super(),Q(this,e,kh,$h,K,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function xs(r){let e=r[0],t,n,i=ea(r);return{c(){i.c(),t=me()},m(o,s){i.m(o,s),w(o,t,s),n=!0},p(o,s){s&1&&K(e,e=o[0])?(ue(),E(i,1,1,x),fe(),i=ea(o),i.c(),$(i,1),i.m(t.parentNode,t)):i.p(o,s)},i(o){n||($(i),n=!0)},o(o){E(i),n=!1},d(o){o&&S(t),i.d(o)}}}function ea(r){let e;const t=r[10].default,n=Ne(t,r,r[9],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&512)&&Te(n,t,i,i[9],e?je(t,i[9],o,null):De(i[9]),null)},i(i){e||($(n,i),e=!0)},o(i){E(n,i),e=!1},d(i){n&&n.d(i)}}}function Eh(r){let e,t,n=r[0]&&xs(r);return{c(){n&&n.c(),e=me()},m(i,o){n&&n.m(i,o),w(i,e,o),t=!0},p(i,[o]){i[0]?n?(n.p(i,o),o&1&&$(n,1)):(n=xs(i),n.c(),$(n,1),n.m(e.parentNode,e)):n&&(ue(),E(n,1,1,()=>{n=null}),fe())},i(i){t||($(n),t=!0)},o(i){E(n),t=!1},d(i){i&&S(e),n&&n.d(i)}}}function Mh(r,e,t){let n,i,{$$slots:o={},$$scope:s}=e,{id:a=Bi("image")}=e,{url:l}=e,{coordinates:u}=e;const{map:f,self:c}=Sp();J(r,f,g=>t(8,i=g)),J(r,c,g=>t(0,n=g));let h,p=!0;return tt(()=>{n&&i&&($p(f,n,h),st(c,n=null,n),t(6,h=void 0))}),r.$$set=g=>{"id"in g&&t(3,a=g.id),"url"in g&&t(4,l=g.url),"coordinates"in g&&t(5,u=g.coordinates),"$$scope"in g&&t(9,s=g.$$scope)},r.$$.update=()=>{r.$$.dirty&313&&i&&n!==a&&(st(c,n=a,n),kp(i,n,Ep({type:"image",url:l,coordinates:u}),g=>i&&g===n,()=>{n&&(t(6,h=i==null?void 0:i.getSource(n)),t(7,p=!0))})),r.$$.dirty&264&&(i==null||i.on("style.load",()=>{t(6,h=i==null?void 0:i.getSource(a))})),r.$$.dirty&224&&h&&(p?t(7,p=!1):h.setCoordinates(u))},[n,f,c,a,l,u,h,p,i,s,o]}class Ph extends Z{constructor(e){super(),Q(this,e,Mh,Eh,K,{id:3,url:4,coordinates:5})}}function Lh(r,e,t){let n;const i=us();let{layer:o=void 0}=e;const{map:s}=xu();J(r,s,f=>t(2,n=f));function a(f){i(f.type,{...f,map:s})}const l=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","contextmenu","mouseover","mouseout"],u=["click","dblclick","contextmenu","mousemove","movestart","moveend","zoomstart","zoom","zoomend"];return tt(()=>{if(n)if(o)for(const f of l)n.off(f,o,a);else for(const f of u)n.off(f,a)}),r.$$set=f=>{"layer"in f&&t(1,o=f.layer)},r.$$.update=()=>{if(r.$$.dirty&6&&n)if(o)for(const f of l)n.on(f,o,a);else for(const f of u)n.on(f,a)},[s,o,n]}class Ah extends Z{constructor(e){super(),Q(this,e,Lh,null,K,{layer:1})}}const Ch=r=>({marker:r&8}),ta=r=>({marker:r[3]});function Oh(r){let e,t,n,i,o,s,a;const l=r[19].default,u=Ne(l,r,r[18],ta);return{c(){e=T("div"),u&&u.c(),N(e,"tabindex",t=r[1]?0:void 0),N(e,"role",n=r[1]?"button":void 0),ve(e,"z-index",r[2])},m(f,c){w(f,e,c),u&&u.m(e,null),o=!0,s||(a=[zs(r[7].call(null,e)),zs(i=Fh.call(null,e,r[0])),ne(e,"click",Gn(r[20])),ne(e,"dblclick",Gn(r[21])),ne(e,"contextmenu",Gn(r[22])),ne(e,"mouseenter",r[23]),ne(e,"mouseleave",r[24]),ne(e,"mousemove",r[25]),ne(e,"keydown",r[8])],s=!0)},p(f,[c]){u&&u.p&&(!o||c&262152)&&Te(u,l,f,f[18],o?je(l,f[18],c,Ch):De(f[18]),ta),(!o||c&2&&t!==(t=f[1]?0:void 0))&&N(e,"tabindex",t),(!o||c&2&&n!==(n=f[1]?"button":void 0))&&N(e,"role",n),i&&Mp(i.update)&&c&1&&i.update.call(null,f[0]),c&4&&ve(e,"z-index",f[2])},i(f){o||($(u,f),o=!0)},o(f){E(u,f),o=!1},d(f){f&&S(e),u&&u.d(f),s=!1,qt(a)}}}function Fh(r,e){const t=r.className;function n(i){i?r.className=`${t} ${i}`:r.className=t}return n(e),{update:n}}function Rh(r,e,t){let n,i,o,{$$slots:s={},$$scope:a}=e,{marker:l=void 0}=e,{lngLat:u}=e,{class:f=void 0}=e,{interactive:c=!0}=e,{asButton:h=!1}=e,{draggable:p=!1}=e,{feature:g=null}=e,{offset:m=void 0}=e,{zIndex:v=void 0}=e,{rotation:b=0}=e,{opacity:d=1}=e;const y=us(),{map:k,layerEvent:_,self:M}=Pp();J(r,k,H=>t(27,o=H)),J(r,_,H=>t(26,n=H)),J(r,M,H=>t(3,i=H));function F(H){st(M,i=new Lp.Marker({element:H,rotation:b,draggable:p,offset:m,opacity:d.toString()}).setLngLat(u).addTo(o),i),t(11,l=i);const D=()=>W("dragstart"),ge=()=>{I(),W("drag")},ye=()=>{I(),W("dragend")};return p&&(i.on("dragstart",D),i.on("drag",ge),i.on("dragend",ye)),{destroy(){p&&(i==null||i.off("dragstart",D),i==null||i.off("drag",ge),i==null||i.off("dragend",ye)),t(11,l=void 0),i==null||i.remove()}}}function I(){let H=i==null?void 0:i.getLngLat();H&&(Array.isArray(u)?t(10,u=[H.lng,H.lat]):u&&"lon"in u?t(10,u={lon:H.lng,lat:H.lat}):t(10,u=H))}function U(H){H.key===" "&&(H.preventDefault(),H.stopPropagation(),W("click"))}function W(H){if(!c)return;let D=i==null?void 0:i.getLngLat();if(!D)return;const ge=[D.lng,D.lat];let ye={map:o,marker:i,lngLat:ge,features:[{type:"Feature",properties:(g==null?void 0:g.properties)??{},geometry:{type:"Point",coordinates:ge}}]};st(_,n={...ye,layerType:"marker",type:H},n),y(H,ye)}const O=()=>W("click"),P=()=>W("dblclick"),R=()=>W("contextmenu"),q=H=>{W("mouseenter")},se=()=>{W("mouseleave")},ie=()=>W("mousemove");return r.$$set=H=>{"marker"in H&&t(11,l=H.marker),"lngLat"in H&&t(10,u=H.lngLat),"class"in H&&t(0,f=H.class),"interactive"in H&&t(12,c=H.interactive),"asButton"in H&&t(1,h=H.asButton),"draggable"in H&&t(13,p=H.draggable),"feature"in H&&t(14,g=H.feature),"offset"in H&&t(15,m=H.offset),"zIndex"in H&&t(2,v=H.zIndex),"rotation"in H&&t(16,b=H.rotation),"opacity"in H&&t(17,d=H.opacity),"$$scope"in H&&t(18,a=H.$$scope)},r.$$.update=()=>{r.$$.dirty&1032&&(i==null||i.setLngLat(u)),r.$$.dirty&32776&&(i==null||i.setOffset(m??[0,0])),r.$$.dirty&65544&&(i==null||i.setRotation(b)),r.$$.dirty&131080&&(i==null||i.setOpacity(d.toString()))},[f,h,v,i,k,_,M,F,U,W,u,l,c,p,g,m,b,d,a,s,O,P,R,q,se,ie]}class bo extends Z{constructor(e){super(),Q(this,e,Rh,Oh,K,{marker:11,lngLat:10,class:0,interactive:12,asButton:1,draggable:13,feature:14,offset:15,zIndex:2,rotation:16,opacity:17})}}class zi{constructor(){this._partials=new Float64Array(32),this._n=0}add(e){const t=this._partials;let n=0;for(let i=0;i<this._n&&i<32;i++){const o=t[i],s=e+o,a=Math.abs(e)<Math.abs(o)?e-(s-o):o-(s-e);a&&(t[n++]=a),e=s}return t[n]=e,this._n=n+1,this}valueOf(){const e=this._partials;let t=this._n,n,i,o,s=0;if(t>0){for(s=e[--t];t>0&&(n=s,i=e[--t],s=n+i,o=i-(s-n),!o););t>0&&(o<0&&e[t-1]<0||o>0&&e[t-1]>0)&&(i=o*2,n=s+i,i==n-s&&(s=n))}return s}}var Bh=1e-6,ra=1e-12,hs=Math.PI,na=hs/2,ia=180/hs,St=hs/180,sf=Math.atan2,$t=Math.cos,wo=Math.hypot,kt=Math.sin,Ih=Math.sqrt;function af(r){return r>1?na:r<-1?-na:Math.asin(r)}function Nh(){}function oi(r,e){r&&sa.hasOwnProperty(r.type)&&sa[r.type](r,e)}var oa={Feature:function(r,e){oi(r.geometry,e)},FeatureCollection:function(r,e){for(var t=r.features,n=-1,i=t.length;++n<i;)oi(t[n].geometry,e)}},sa={Sphere:function(r,e){e.sphere()},Point:function(r,e){r=r.coordinates,e.point(r[0],r[1],r[2])},MultiPoint:function(r,e){for(var t=r.coordinates,n=-1,i=t.length;++n<i;)r=t[n],e.point(r[0],r[1],r[2])},LineString:function(r,e){So(r.coordinates,e,0)},MultiLineString:function(r,e){for(var t=r.coordinates,n=-1,i=t.length;++n<i;)So(t[n],e,0)},Polygon:function(r,e){aa(r.coordinates,e)},MultiPolygon:function(r,e){for(var t=r.coordinates,n=-1,i=t.length;++n<i;)aa(t[n],e)},GeometryCollection:function(r,e){for(var t=r.geometries,n=-1,i=t.length;++n<i;)oi(t[n],e)}};function So(r,e,t){var n=-1,i=r.length-t,o;for(e.lineStart();++n<i;)o=r[n],e.point(o[0],o[1],o[2]);e.lineEnd()}function aa(r,e){var t=-1,n=r.length;for(e.polygonStart();++t<n;)So(r[t],e,1);e.polygonEnd()}function Th(r,e){r&&oa.hasOwnProperty(r.type)?oa[r.type](r,e):oi(r,e)}var zr,si,ai,li,ui,fi,ci,pi,$o,ko,Eo,lf,uf,ze,We,He,ct={sphere:Nh,point:gs,lineStart:la,lineEnd:ua,polygonStart:function(){ct.lineStart=Gh,ct.lineEnd=Uh},polygonEnd:function(){ct.lineStart=la,ct.lineEnd=ua}};function gs(r,e){r*=St,e*=St;var t=$t(e);_n(t*$t(r),t*kt(r),kt(e))}function _n(r,e,t){++zr,ai+=(r-ai)/zr,li+=(e-li)/zr,ui+=(t-ui)/zr}function la(){ct.point=Dh}function Dh(r,e){r*=St,e*=St;var t=$t(e);ze=t*$t(r),We=t*kt(r),He=kt(e),ct.point=jh,_n(ze,We,He)}function jh(r,e){r*=St,e*=St;var t=$t(e),n=t*$t(r),i=t*kt(r),o=kt(e),s=sf(Ih((s=We*o-He*i)*s+(s=He*n-ze*o)*s+(s=ze*i-We*n)*s),ze*n+We*i+He*o);si+=s,fi+=s*(ze+(ze=n)),ci+=s*(We+(We=i)),pi+=s*(He+(He=o)),_n(ze,We,He)}function ua(){ct.point=gs}function Gh(){ct.point=qh}function Uh(){ff(lf,uf),ct.point=gs}function qh(r,e){lf=r,uf=e,r*=St,e*=St,ct.point=ff;var t=$t(e);ze=t*$t(r),We=t*kt(r),He=kt(e),_n(ze,We,He)}function ff(r,e){r*=St,e*=St;var t=$t(e),n=t*$t(r),i=t*kt(r),o=kt(e),s=We*o-He*i,a=He*n-ze*o,l=ze*i-We*n,u=wo(s,a,l),f=af(u),c=u&&-f/u;$o.add(c*s),ko.add(c*a),Eo.add(c*l),si+=f,fi+=f*(ze+(ze=n)),ci+=f*(We+(We=i)),pi+=f*(He+(He=o)),_n(ze,We,He)}function zh(r){zr=si=ai=li=ui=fi=ci=pi=0,$o=new zi,ko=new zi,Eo=new zi,Th(r,ct);var e=+$o,t=+ko,n=+Eo,i=wo(e,t,n);return i<ra&&(e=fi,t=ci,n=pi,si<Bh&&(e=ai,t=li,n=ui),i=wo(e,t,n),i<ra)?[NaN,NaN]:[sf(t,e)*ia,af(n/i)*ia]}const{Map:Wh}=ef;function fa(r,e,t){const n=r.slice();n[40]=e[t];const i=n[1](n[40]);n[41]=i;const o=typeof n[7]=="function"?n[7](n[40]):n[7];return n[42]=o,n}const Hh=r=>({feature:r[0]&1024,position:r[0]&1026}),ca=r=>({feature:r[40],position:r[41]});function pa(r){let e=[],t=new Wh,n,i,o=at(r[10]);const s=a=>a[40].id;for(let a=0;a<o.length;a+=1){let l=fa(r,o,a),u=s(l);t.set(u,e[a]=ha(u,l))}return{c(){for(let a=0;a<e.length;a+=1)e[a].c();n=me()},m(a,l){for(let u=0;u<e.length;u+=1)e[u]&&e[u].m(a,l);w(a,n,l),i=!0},p(a,l){l[0]&264095|l[1]&4&&(o=at(a[10]),ue(),e=fs(e,l,s,1,a,o,t,n.parentNode,cs,ha,n,fa),fe())},i(a){if(!i){for(let l=0;l<o.length;l+=1)$(e[l]);i=!0}},o(a){for(let l=0;l<e.length;l+=1)E(e[l]);i=!1},d(a){a&&S(n);for(let l=0;l<e.length;l+=1)e[l].d(a)}}}function Vh(r){let e,t;const n=r[24].default,i=Ne(n,r,r[33],ca);return{c(){i&&i.c(),e=B()},m(o,s){i&&i.m(o,s),w(o,e,s),t=!0},p(o,s){i&&i.p&&(!t||s[0]&1026|s[1]&4)&&Te(i,n,o,o[33],t?je(n,o[33],s,Hh):De(o[33]),ca)},i(o){t||($(i,o),t=!0)},o(o){E(i,o),t=!1},d(o){o&&S(e),i&&i.d(o)}}}function ha(r,e){let t,n,i;function o(){return e[25](e[40])}function s(){return e[26](e[40])}function a(...p){return e[27](e[40],...p)}function l(...p){return e[28](e[40],...p)}function u(...p){return e[29](e[40],...p)}function f(...p){return e[30](e[40],...p)}function c(...p){return e[31](e[40],...p)}function h(...p){return e[32](e[40],...p)}return n=new bo({props:{asButton:e[3],interactive:e[2],draggable:e[4],class:e[8],zIndex:e[42],lngLat:e[41],$$slots:{default:[Vh]},$$scope:{ctx:e}}}),n.$on("mouseenter",o),n.$on("mouseleave",s),n.$on("dragstart",a),n.$on("drag",l),n.$on("dragend",u),n.$on("click",f),n.$on("dblclick",c),n.$on("contextmenu",h),{key:r,first:null,c(){t=me(),L(n.$$.fragment),this.first=t},m(p,g){w(p,t,g),A(n,p,g),i=!0},p(p,g){e=p;const m={};g[0]&8&&(m.asButton=e[3]),g[0]&4&&(m.interactive=e[2]),g[0]&16&&(m.draggable=e[4]),g[0]&256&&(m.class=e[8]),g[0]&1152&&(m.zIndex=e[42]),g[0]&1026&&(m.lngLat=e[41]),g[0]&1026|g[1]&4&&(m.$$scope={dirty:g,ctx:e}),n.$set(m)},i(p){i||($(n.$$.fragment,p),i=!0)},o(p){E(n.$$.fragment,p),i=!1},d(p){p&&S(t),C(n,p)}}}function Jh(r){let e,t,n,i;e=new vn({props:{minzoom:r[5],maxzoom:r[6],paint:{"fill-opacity":0},beforeLayerType:"symbol"}});let o=r[11]>=r[13]&&r[11]<=r[12]&&pa(r);return{c(){L(e.$$.fragment),t=B(),o&&o.c(),n=me()},m(s,a){A(e,s,a),w(s,t,a),o&&o.m(s,a),w(s,n,a),i=!0},p(s,a){const l={};a[0]&32&&(l.minzoom=s[5]),a[0]&64&&(l.maxzoom=s[6]),e.$set(l),s[11]>=s[13]&&s[11]<=s[12]?o?(o.p(s,a),a[0]&14336&&$(o,1)):(o=pa(s),o.c(),$(o,1),o.m(n.parentNode,n)):o&&(ue(),E(o,1,1,()=>{o=null}),fe())},i(s){i||($(e.$$.fragment,s),$(o),i=!0)},o(s){E(e.$$.fragment,s),E(o),i=!1},d(s){s&&(S(t),S(n)),C(e,s),o&&o.d(s)}}}function Yh(r,e,t){let n,i,o,s,a,l,u,{$$slots:f={},$$scope:c}=e;const{map:h,source:p,minzoom:g,maxzoom:m}=xu();J(r,h,V=>t(21,s=V)),J(r,p,V=>t(9,a=V)),J(r,g,V=>t(23,u=V)),J(r,m,V=>t(22,l=V));const v=us();let{applyToClusters:b=void 0}=e,{filter:d=void 0}=e,{markerLngLat:y=zh}=e,{interactive:k=!0}=e,{asButton:_=!1}=e,{draggable:M=!1}=e,{minzoom:F=void 0}=e,{maxzoom:I=void 0}=e,{hovered:U=null}=e,{zIndex:W=void 0}=e,{class:O=void 0}=e,P=!1;function R(){s&&(P=!0,s.on("zoom",D),s.on("move",ie),s.on("moveend",ie),s.loaded()?s.once("load",ie):ie())}function q(V){V.sourceId===a&&V.isSourceLoaded&&(P?ie():R())}tt(()=>{s&&(s.off("zoom",D),s.off("move",ie),s.off("moveend",ie),s.off("sourcedata",q))});let se=[];function ie(){var lr;if(!s||!a)return;let V=s.querySourceFeatures(a,{filter:o}),Ee=new Map;for(let Re of V)Re.id||((lr=Re.properties)!=null&&lr.cluster_id?Re.id="autocluster_"+Re.properties.cluster_id:Re.id=Bi("autofeat")),Ee.set(Re.id,Re);t(10,se=[...Ee.values()].sort((Re,mp)=>Re.id.toString().localeCompare(mp.id.toString())))}let H=(s==null?void 0:s.getZoom())??0;function D(V){t(11,H=s.getZoom()),ie()}const ge=V=>{t(0,U=V)},ye=V=>{(U==null?void 0:U.id)===V.id&&t(0,U=null)},rt=(V,Ee)=>v("dragstart",{...Ee.detail,source:a,feature:V}),Ue=(V,Ee)=>v("drag",{...Ee.detail,source:a,feature:V}),Pn=(V,Ee)=>v("dragend",{...Ee.detail,source:a,feature:V}),G=(V,Ee)=>v("click",{...Ee.detail,source:a,feature:V}),X=(V,Ee)=>v("dblclick",{...Ee.detail,source:a,feature:V}),nt=(V,Ee)=>v("contextmenu",{...Ee.detail,source:a,feature:V});return r.$$set=V=>{"applyToClusters"in V&&t(19,b=V.applyToClusters),"filter"in V&&t(20,d=V.filter),"markerLngLat"in V&&t(1,y=V.markerLngLat),"interactive"in V&&t(2,k=V.interactive),"asButton"in V&&t(3,_=V.asButton),"draggable"in V&&t(4,M=V.draggable),"minzoom"in V&&t(5,F=V.minzoom),"maxzoom"in V&&t(6,I=V.maxzoom),"hovered"in V&&t(0,U=V.hovered),"zIndex"in V&&t(7,W=V.zIndex),"class"in V&&t(8,O=V.class),"$$scope"in V&&t(33,c=V.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&8388640&&t(13,n=F??u),r.$$.dirty[0]&4194368&&t(12,i=I??l),r.$$.dirty[0]&1572864&&(o=Ap("all",Cp(b),d)),r.$$.dirty[0]&2097664&&s&&a){let V=s.getSource(a);V!=null&&V.loaded()?R():s.on("sourcedata",q)}},[U,y,k,_,M,F,I,W,O,a,se,H,i,n,h,p,g,m,v,b,d,s,l,u,f,ge,ye,rt,Ue,Pn,G,X,nt,c]}class Xh extends Z{constructor(e){super(),Q(this,e,Yh,Jh,K,{applyToClusters:19,filter:20,markerLngLat:1,interactive:2,asButton:3,draggable:4,minzoom:5,maxzoom:6,hovered:0,zIndex:7,class:8},null,[-1,-1])}}function Kh(r){let e;const t=r[8].default,n=Ne(t,r,r[15],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&32768)&&Te(n,t,i,i[15],e?je(t,i[15],o,null):De(i[15]),null)},i(i){e||($(n,i),e=!0)},o(i){E(n,i),e=!1},d(i){n&&n.d(i)}}}function Zh(r){let e,t;return e=new Qu({props:{id:r[0],type:"raster",source:r[1],beforeId:r[2],beforeLayerType:r[3],paint:r[4],layout:r[5],minzoom:r[6],maxzoom:r[7],$$slots:{default:[Kh]},$$scope:{ctx:r}}}),e.$on("click",r[9]),e.$on("dblclick",r[10]),e.$on("contextmenu",r[11]),e.$on("mouseenter",r[12]),e.$on("mousemove",r[13]),e.$on("mouseleave",r[14]),{c(){L(e.$$.fragment)},m(n,i){A(e,n,i),t=!0},p(n,[i]){const o={};i&1&&(o.id=n[0]),i&2&&(o.source=n[1]),i&4&&(o.beforeId=n[2]),i&8&&(o.beforeLayerType=n[3]),i&16&&(o.paint=n[4]),i&32&&(o.layout=n[5]),i&64&&(o.minzoom=n[6]),i&128&&(o.maxzoom=n[7]),i&32768&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){E(e.$$.fragment,n),t=!1},d(n){C(e,n)}}}function Qh(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=Bi("raster-layer")}=e,{source:s=void 0}=e,{beforeId:a=void 0}=e,{beforeLayerType:l=void 0}=e,{paint:u}=e,{layout:f=void 0}=e,{minzoom:c=void 0}=e,{maxzoom:h=void 0}=e;function p(y){be.call(this,r,y)}function g(y){be.call(this,r,y)}function m(y){be.call(this,r,y)}function v(y){be.call(this,r,y)}function b(y){be.call(this,r,y)}function d(y){be.call(this,r,y)}return r.$$set=y=>{"id"in y&&t(0,o=y.id),"source"in y&&t(1,s=y.source),"beforeId"in y&&t(2,a=y.beforeId),"beforeLayerType"in y&&t(3,l=y.beforeLayerType),"paint"in y&&t(4,u=y.paint),"layout"in y&&t(5,f=y.layout),"minzoom"in y&&t(6,c=y.minzoom),"maxzoom"in y&&t(7,h=y.maxzoom),"$$scope"in y&&t(15,i=y.$$scope)},[o,s,a,l,u,f,c,h,n,p,g,m,v,b,d,i]}class xh extends Z{constructor(e){super(),Q(this,e,Qh,Zh,K,{id:0,source:1,beforeId:2,beforeLayerType:3,paint:4,layout:5,minzoom:6,maxzoom:7})}}let et=Oe(null);var ga=Object.prototype.toString,cf=function(e){var t=ga.call(e),n=t==="[object Arguments]";return n||(n=t!=="[object Array]"&&e!==null&&typeof e=="object"&&typeof e.length=="number"&&e.length>=0&&ga.call(e.callee)==="[object Function]"),n},Wi,ma;function eg(){if(ma)return Wi;ma=1;var r;if(!Object.keys){var e=Object.prototype.hasOwnProperty,t=Object.prototype.toString,n=cf,i=Object.prototype.propertyIsEnumerable,o=!i.call({toString:null},"toString"),s=i.call(function(){},"prototype"),a=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],l=function(h){var p=h.constructor;return p&&p.prototype===h},u={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},f=function(){if(typeof window>"u")return!1;for(var h in window)try{if(!u["$"+h]&&e.call(window,h)&&window[h]!==null&&typeof window[h]=="object")try{l(window[h])}catch{return!0}}catch{return!0}return!1}(),c=function(h){if(typeof window>"u"||!f)return l(h);try{return l(h)}catch{return!1}};r=function(p){var g=p!==null&&typeof p=="object",m=t.call(p)==="[object Function]",v=n(p),b=g&&t.call(p)==="[object String]",d=[];if(!g&&!m&&!v)throw new TypeError("Object.keys called on a non-object");var y=s&&m;if(b&&p.length>0&&!e.call(p,0))for(var k=0;k<p.length;++k)d.push(String(k));if(v&&p.length>0)for(var _=0;_<p.length;++_)d.push(String(_));else for(var M in p)!(y&&M==="prototype")&&e.call(p,M)&&d.push(String(M));if(o)for(var F=c(p),I=0;I<a.length;++I)!(F&&a[I]==="constructor")&&e.call(p,a[I])&&d.push(a[I]);return d}}return Wi=r,Wi}var tg=Array.prototype.slice,rg=cf,da=Object.keys,Un=da?function(e){return da(e)}:eg(),ya=Object.keys;Un.shim=function(){if(Object.keys){var e=function(){var t=Object.keys(arguments);return t&&t.length===arguments.length}(1,2);e||(Object.keys=function(n){return rg(n)?ya(tg.call(n)):ya(n)})}else Object.keys=Un;return Object.keys||Un};var ms=Un,ng=Error,ig=EvalError,og=RangeError,sg=ReferenceError,pf=SyntaxError,Ht=TypeError,ag=URIError,Ni=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var e={},t=Symbol("test"),n=Object(t);if(typeof t=="string"||Object.prototype.toString.call(t)!=="[object Symbol]"||Object.prototype.toString.call(n)!=="[object Symbol]")return!1;var i=42;e[t]=i;for(t in e)return!1;if(typeof Object.keys=="function"&&Object.keys(e).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(e).length!==0)return!1;var o=Object.getOwnPropertySymbols(e);if(o.length!==1||o[0]!==t||!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var s=Object.getOwnPropertyDescriptor(e,t);if(s.value!==i||s.enumerable!==!0)return!1}return!0},va=typeof Symbol<"u"&&Symbol,lg=Ni,ds=function(){return typeof va!="function"||typeof Symbol!="function"||typeof va("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:lg()},Hi={__proto__:null,foo:{}},ug=Object,fg=function(){return{__proto__:Hi}.foo===Hi.foo&&!(Hi instanceof ug)},cg="Function.prototype.bind called on incompatible ",pg=Object.prototype.toString,hg=Math.max,gg="[object Function]",_a=function(e,t){for(var n=[],i=0;i<e.length;i+=1)n[i]=e[i];for(var o=0;o<t.length;o+=1)n[o+e.length]=t[o];return n},mg=function(e,t){for(var n=[],i=t||0,o=0;i<e.length;i+=1,o+=1)n[o]=e[i];return n},dg=function(r,e){for(var t="",n=0;n<r.length;n+=1)t+=r[n],n+1<r.length&&(t+=e);return t},yg=function(e){var t=this;if(typeof t!="function"||pg.apply(t)!==gg)throw new TypeError(cg+t);for(var n=mg(arguments,1),i,o=function(){if(this instanceof i){var f=t.apply(this,_a(n,arguments));return Object(f)===f?f:this}return t.apply(e,_a(n,arguments))},s=hg(0,t.length-n.length),a=[],l=0;l<s;l++)a[l]="$"+l;if(i=Function("binder","return function ("+dg(a,",")+"){ return binder.apply(this,arguments); }")(o),t.prototype){var u=function(){};u.prototype=t.prototype,i.prototype=new u,u.prototype=null}return i},vg=yg,ys=Function.prototype.bind||vg,_g=Function.prototype.call,bg=Object.prototype.hasOwnProperty,wg=ys,hf=wg.call(_g,bg),re,Sg=ng,$g=ig,kg=og,Eg=sg,wr=pf,dr=Ht,Mg=ag,gf=Function,Vi=function(r){try{return gf('"use strict"; return ('+r+").constructor;")()}catch{}},Qt=Object.getOwnPropertyDescriptor;if(Qt)try{Qt({},"")}catch{Qt=null}var Ji=function(){throw new dr},Pg=Qt?function(){try{return arguments.callee,Ji}catch{try{return Qt(arguments,"callee").get}catch{return Ji}}}():Ji,ur=ds(),Lg=fg(),Me=Object.getPrototypeOf||(Lg?function(r){return r.__proto__}:null),hr={},Ag=typeof Uint8Array>"u"||!Me?re:Me(Uint8Array),xt={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?re:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?re:ArrayBuffer,"%ArrayIteratorPrototype%":ur&&Me?Me([][Symbol.iterator]()):re,"%AsyncFromSyncIteratorPrototype%":re,"%AsyncFunction%":hr,"%AsyncGenerator%":hr,"%AsyncGeneratorFunction%":hr,"%AsyncIteratorPrototype%":hr,"%Atomics%":typeof Atomics>"u"?re:Atomics,"%BigInt%":typeof BigInt>"u"?re:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?re:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?re:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?re:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Sg,"%eval%":eval,"%EvalError%":$g,"%Float32Array%":typeof Float32Array>"u"?re:Float32Array,"%Float64Array%":typeof Float64Array>"u"?re:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?re:FinalizationRegistry,"%Function%":gf,"%GeneratorFunction%":hr,"%Int8Array%":typeof Int8Array>"u"?re:Int8Array,"%Int16Array%":typeof Int16Array>"u"?re:Int16Array,"%Int32Array%":typeof Int32Array>"u"?re:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":ur&&Me?Me(Me([][Symbol.iterator]())):re,"%JSON%":typeof JSON=="object"?JSON:re,"%Map%":typeof Map>"u"?re:Map,"%MapIteratorPrototype%":typeof Map>"u"||!ur||!Me?re:Me(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?re:Promise,"%Proxy%":typeof Proxy>"u"?re:Proxy,"%RangeError%":kg,"%ReferenceError%":Eg,"%Reflect%":typeof Reflect>"u"?re:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?re:Set,"%SetIteratorPrototype%":typeof Set>"u"||!ur||!Me?re:Me(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?re:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":ur&&Me?Me(""[Symbol.iterator]()):re,"%Symbol%":ur?Symbol:re,"%SyntaxError%":wr,"%ThrowTypeError%":Pg,"%TypedArray%":Ag,"%TypeError%":dr,"%Uint8Array%":typeof Uint8Array>"u"?re:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?re:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?re:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?re:Uint32Array,"%URIError%":Mg,"%WeakMap%":typeof WeakMap>"u"?re:WeakMap,"%WeakRef%":typeof WeakRef>"u"?re:WeakRef,"%WeakSet%":typeof WeakSet>"u"?re:WeakSet};if(Me)try{null.error}catch(r){var Cg=Me(Me(r));xt["%Error.prototype%"]=Cg}var Og=function r(e){var t;if(e==="%AsyncFunction%")t=Vi("async function () {}");else if(e==="%GeneratorFunction%")t=Vi("function* () {}");else if(e==="%AsyncGeneratorFunction%")t=Vi("async function* () {}");else if(e==="%AsyncGenerator%"){var n=r("%AsyncGeneratorFunction%");n&&(t=n.prototype)}else if(e==="%AsyncIteratorPrototype%"){var i=r("%AsyncGenerator%");i&&Me&&(t=Me(i.prototype))}return xt[e]=t,t},ba={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},bn=ys,hi=hf,Fg=bn.call(Function.call,Array.prototype.concat),Rg=bn.call(Function.apply,Array.prototype.splice),wa=bn.call(Function.call,String.prototype.replace),gi=bn.call(Function.call,String.prototype.slice),Bg=bn.call(Function.call,RegExp.prototype.exec),Ig=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,Ng=/\\(\\)?/g,Tg=function(e){var t=gi(e,0,1),n=gi(e,-1);if(t==="%"&&n!=="%")throw new wr("invalid intrinsic syntax, expected closing `%`");if(n==="%"&&t!=="%")throw new wr("invalid intrinsic syntax, expected opening `%`");var i=[];return wa(e,Ig,function(o,s,a,l){i[i.length]=a?wa(l,Ng,"$1"):s||o}),i},Dg=function(e,t){var n=e,i;if(hi(ba,n)&&(i=ba[n],n="%"+i[0]+"%"),hi(xt,n)){var o=xt[n];if(o===hr&&(o=Og(n)),typeof o>"u"&&!t)throw new dr("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:i,name:n,value:o}}throw new wr("intrinsic "+e+" does not exist!")},Et=function(e,t){if(typeof e!="string"||e.length===0)throw new dr("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof t!="boolean")throw new dr('"allowMissing" argument must be a boolean');if(Bg(/^%?[^%]*%?$/,e)===null)throw new wr("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var n=Tg(e),i=n.length>0?n[0]:"",o=Dg("%"+i+"%",t),s=o.name,a=o.value,l=!1,u=o.alias;u&&(i=u[0],Rg(n,Fg([0,1],u)));for(var f=1,c=!0;f<n.length;f+=1){var h=n[f],p=gi(h,0,1),g=gi(h,-1);if((p==='"'||p==="'"||p==="`"||g==='"'||g==="'"||g==="`")&&p!==g)throw new wr("property names with quotes must have matching quotes");if((h==="constructor"||!c)&&(l=!0),i+="."+h,s="%"+i+"%",hi(xt,s))a=xt[s];else if(a!=null){if(!(h in a)){if(!t)throw new dr("base intrinsic for "+e+" exists, but the property is not available.");return}if(Qt&&f+1>=n.length){var m=Qt(a,h);c=!!m,c&&"get"in m&&!("originalValue"in m.get)?a=m.get:a=a[h]}else c=hi(a,h),a=a[h];c&&!l&&(xt[s]=a)}}return a},Yi,Sa;function vs(){if(Sa)return Yi;Sa=1;var r=Et,e=r("%Object.defineProperty%",!0)||!1;if(e)try{e({},"a",{value:1})}catch{e=!1}return Yi=e,Yi}var jg=Et,qn=jg("%Object.getOwnPropertyDescriptor%",!0);if(qn)try{qn([],"length")}catch{qn=null}var _s=qn,$a=vs(),Gg=pf,fr=Ht,ka=_s,bs=function(e,t,n){if(!e||typeof e!="object"&&typeof e!="function")throw new fr("`obj` must be an object or a function`");if(typeof t!="string"&&typeof t!="symbol")throw new fr("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new fr("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new fr("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new fr("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new fr("`loose`, if provided, must be a boolean");var i=arguments.length>3?arguments[3]:null,o=arguments.length>4?arguments[4]:null,s=arguments.length>5?arguments[5]:null,a=arguments.length>6?arguments[6]:!1,l=!!ka&&ka(e,t);if($a)$a(e,t,{configurable:s===null&&l?l.configurable:!s,enumerable:i===null&&l?l.enumerable:!i,value:n,writable:o===null&&l?l.writable:!o});else if(a||!i&&!o&&!s)e[t]=n;else throw new Gg("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},Mo=vs(),mf=function(){return!!Mo};mf.hasArrayLengthDefineBug=function(){if(!Mo)return null;try{return Mo([],"length",{value:1}).length!==1}catch{return!0}};var ws=mf,Ug=ms,qg=typeof Symbol=="function"&&typeof Symbol("foo")=="symbol",zg=Object.prototype.toString,Wg=Array.prototype.concat,Ea=bs,Hg=function(r){return typeof r=="function"&&zg.call(r)==="[object Function]"},df=ws(),Vg=function(r,e,t,n){if(e in r){if(n===!0){if(r[e]===t)return}else if(!Hg(n)||!n())return}df?Ea(r,e,t,!0):Ea(r,e,t)},yf=function(r,e){var t=arguments.length>2?arguments[2]:{},n=Ug(e);qg&&(n=Wg.call(n,Object.getOwnPropertySymbols(e)));for(var i=0;i<n.length;i+=1)Vg(r,n[i],e[n[i]],t[n[i]])};yf.supportsDescriptors=!!df;var sr=yf,vf={exports:{}},Jg=Et,Ma=bs,Yg=ws(),Pa=_s,La=Ht,Xg=Jg("%Math.floor%"),Kg=function(e,t){if(typeof e!="function")throw new La("`fn` is not a function");if(typeof t!="number"||t<0||t>4294967295||Xg(t)!==t)throw new La("`length` must be a positive 32-bit integer");var n=arguments.length>2&&!!arguments[2],i=!0,o=!0;if("length"in e&&Pa){var s=Pa(e,"length");s&&!s.configurable&&(i=!1),s&&!s.writable&&(o=!1)}return(i||o||!n)&&(Yg?Ma(e,"length",t,!0,!0):Ma(e,"length",t)),e};(function(r){var e=ys,t=Et,n=Kg,i=Ht,o=t("%Function.prototype.apply%"),s=t("%Function.prototype.call%"),a=t("%Reflect.apply%",!0)||e.call(s,o),l=vs(),u=t("%Math.max%");r.exports=function(h){if(typeof h!="function")throw new i("a function is required");var p=a(e,s,arguments);return n(p,1+u(0,h.length-(arguments.length-1)),!0)};var f=function(){return a(e,o,arguments)};l?l(r.exports,"apply",{value:f}):r.exports.apply=f})(vf);var Br=vf.exports,_f=Et,bf=Br,Zg=bf(_f("String.prototype.indexOf")),ut=function(e,t){var n=_f(e,!!t);return typeof n=="function"&&Zg(e,".prototype.")>-1?bf(n):n},Qg=ms,wf=Ni(),Sf=ut,Aa=Object,xg=Sf("Array.prototype.push"),Ca=Sf("Object.prototype.propertyIsEnumerable"),em=wf?Object.getOwnPropertySymbols:null,$f=function(e,t){if(e==null)throw new TypeError("target must be an object");var n=Aa(e);if(arguments.length===1)return n;for(var i=1;i<arguments.length;++i){var o=Aa(arguments[i]),s=Qg(o),a=wf&&(Object.getOwnPropertySymbols||em);if(a)for(var l=a(o),u=0;u<l.length;++u){var f=l[u];Ca(o,f)&&xg(s,f)}for(var c=0;c<s.length;++c){var h=s[c];if(Ca(o,h)){var p=o[h];n[h]=p}}}return n},Xi=$f,tm=function(){if(!Object.assign)return!1;for(var r="abcdefghijklmnopqrst",e=r.split(""),t={},n=0;n<e.length;++n)t[e[n]]=e[n];var i=Object.assign({},t),o="";for(var s in i)o+=s;return r!==o},rm=function(){if(!Object.assign||!Object.preventExtensions)return!1;var r=Object.preventExtensions({1:2});try{Object.assign(r,"xy")}catch{return r[1]==="y"}return!1},kf=function(){return!Object.assign||tm()||rm()?Xi:Object.assign},nm=sr,im=kf,om=function(){var e=im();return nm(Object,{assign:e},{assign:function(){return Object.assign!==e}}),e},sm=sr,am=Br,lm=$f,Ef=kf,um=om,fm=am.apply(Ef()),Mf=function(e,t){return fm(Object,arguments)};sm(Mf,{getPolyfill:Ef,implementation:lm,shim:um});var cm=Mf,an=function(){return typeof(function(){}).name=="string"},Xr=Object.getOwnPropertyDescriptor;if(Xr)try{Xr([],"length")}catch{Xr=null}an.functionsHaveConfigurableNames=function(){if(!an()||!Xr)return!1;var e=Xr(function(){},"name");return!!e&&!!e.configurable};var pm=Function.prototype.bind;an.boundFunctionsHaveNames=function(){return an()&&typeof pm=="function"&&(function(){}).bind().name!==""};var hm=an,Oa=bs,gm=ws(),mm=hm.functionsHaveConfigurableNames(),dm=Ht,ym=function(e,t){if(typeof e!="function")throw new dm("`fn` is not a function");var n=arguments.length>2&&!!arguments[2];return(!n||mm)&&(gm?Oa(e,"name",t,!0,!0):Oa(e,"name",t)),e},vm=ym,_m=Ht,bm=Object,Pf=vm(function(){if(this==null||this!==bm(this))throw new _m("RegExp.prototype.flags getter called on non-object");var e="";return this.hasIndices&&(e+="d"),this.global&&(e+="g"),this.ignoreCase&&(e+="i"),this.multiline&&(e+="m"),this.dotAll&&(e+="s"),this.unicode&&(e+="u"),this.unicodeSets&&(e+="v"),this.sticky&&(e+="y"),e},"get flags",!0),wm=Pf,Sm=sr.supportsDescriptors,$m=Object.getOwnPropertyDescriptor,Lf=function(){if(Sm&&/a/mig.flags==="gim"){var e=$m(RegExp.prototype,"flags");if(e&&typeof e.get=="function"&&typeof RegExp.prototype.dotAll=="boolean"&&typeof RegExp.prototype.hasIndices=="boolean"){var t="",n={};if(Object.defineProperty(n,"hasIndices",{get:function(){t+="d"}}),Object.defineProperty(n,"sticky",{get:function(){t+="y"}}),t==="dy")return e.get}}return wm},km=sr.supportsDescriptors,Em=Lf,Mm=Object.getOwnPropertyDescriptor,Pm=Object.defineProperty,Lm=TypeError,Fa=Object.getPrototypeOf,Am=/a/,Cm=function(){if(!km||!Fa)throw new Lm("RegExp.prototype.flags requires a true ES5 environment that supports property descriptors");var e=Em(),t=Fa(Am),n=Mm(t,"flags");return(!n||n.get!==e)&&Pm(t,"flags",{configurable:!0,enumerable:!1,get:e}),e},Om=sr,Fm=Br,Rm=Pf,Af=Lf,Bm=Cm,Cf=Fm(Af());Om(Cf,{getPolyfill:Af,implementation:Rm,shim:Bm});var Im=Cf,zn={exports:{}},Nm=Ni,ar=function(){return Nm()&&!!Symbol.toStringTag},Tm=ar(),Dm=ut,Po=Dm("Object.prototype.toString"),Ti=function(e){return Tm&&e&&typeof e=="object"&&Symbol.toStringTag in e?!1:Po(e)==="[object Arguments]"},Of=function(e){return Ti(e)?!0:e!==null&&typeof e=="object"&&typeof e.length=="number"&&e.length>=0&&Po(e)!=="[object Array]"&&Po(e.callee)==="[object Function]"},jm=function(){return Ti(arguments)}();Ti.isLegacyArguments=Of;var Ff=jm?Ti:Of;const Gm={},Um=Object.freeze(Object.defineProperty({__proto__:null,default:Gm},Symbol.toStringTag,{value:"Module"})),qm=tf(Um);var Ss=typeof Map=="function"&&Map.prototype,Ki=Object.getOwnPropertyDescriptor&&Ss?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,mi=Ss&&Ki&&typeof Ki.get=="function"?Ki.get:null,Ra=Ss&&Map.prototype.forEach,$s=typeof Set=="function"&&Set.prototype,Zi=Object.getOwnPropertyDescriptor&&$s?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,di=$s&&Zi&&typeof Zi.get=="function"?Zi.get:null,Ba=$s&&Set.prototype.forEach,zm=typeof WeakMap=="function"&&WeakMap.prototype,Kr=zm?WeakMap.prototype.has:null,Wm=typeof WeakSet=="function"&&WeakSet.prototype,Zr=Wm?WeakSet.prototype.has:null,Hm=typeof WeakRef=="function"&&WeakRef.prototype,Ia=Hm?WeakRef.prototype.deref:null,Vm=Boolean.prototype.valueOf,Jm=Object.prototype.toString,Ym=Function.prototype.toString,Xm=String.prototype.match,ks=String.prototype.slice,Tt=String.prototype.replace,Km=String.prototype.toUpperCase,Na=String.prototype.toLowerCase,Rf=RegExp.prototype.test,Ta=Array.prototype.concat,_t=Array.prototype.join,Zm=Array.prototype.slice,Da=Math.floor,Lo=typeof BigInt=="function"?BigInt.prototype.valueOf:null,Qi=Object.getOwnPropertySymbols,Ao=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,Sr=typeof Symbol=="function"&&typeof Symbol.iterator=="object",Ge=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===Sr||"symbol")?Symbol.toStringTag:null,Bf=Object.prototype.propertyIsEnumerable,ja=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(r){return r.__proto__}:null);function Ga(r,e){if(r===1/0||r===-1/0||r!==r||r&&r>-1e3&&r<1e3||Rf.call(/e/,e))return e;var t=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof r=="number"){var n=r<0?-Da(-r):Da(r);if(n!==r){var i=String(n),o=ks.call(e,i.length+1);return Tt.call(i,t,"$&_")+"."+Tt.call(Tt.call(o,/([0-9]{3})/g,"$&_"),/_$/,"")}}return Tt.call(e,t,"$&_")}var Co=qm,Ua=Co.custom,qa=Nf(Ua)?Ua:null,Qm=function r(e,t,n,i){var o=t||{};if(Bt(o,"quoteStyle")&&o.quoteStyle!=="single"&&o.quoteStyle!=="double")throw new TypeError('option "quoteStyle" must be "single" or "double"');if(Bt(o,"maxStringLength")&&(typeof o.maxStringLength=="number"?o.maxStringLength<0&&o.maxStringLength!==1/0:o.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var s=Bt(o,"customInspect")?o.customInspect:!0;if(typeof s!="boolean"&&s!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(Bt(o,"indent")&&o.indent!==null&&o.indent!=="	"&&!(parseInt(o.indent,10)===o.indent&&o.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(Bt(o,"numericSeparator")&&typeof o.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var a=o.numericSeparator;if(typeof e>"u")return"undefined";if(e===null)return"null";if(typeof e=="boolean")return e?"true":"false";if(typeof e=="string")return Df(e,o);if(typeof e=="number"){if(e===0)return 1/0/e>0?"0":"-0";var l=String(e);return a?Ga(e,l):l}if(typeof e=="bigint"){var u=String(e)+"n";return a?Ga(e,u):u}var f=typeof o.depth>"u"?5:o.depth;if(typeof n>"u"&&(n=0),n>=f&&f>0&&typeof e=="object")return Oo(e)?"[Array]":"[Object]";var c=dd(o,n);if(typeof i>"u")i=[];else if(Tf(i,e)>=0)return"[Circular]";function h(R,q,se){if(q&&(i=Zm.call(i),i.push(q)),se){var ie={depth:o.depth};return Bt(o,"quoteStyle")&&(ie.quoteStyle=o.quoteStyle),r(R,ie,n+1,i)}return r(R,o,n+1,i)}if(typeof e=="function"&&!za(e)){var p=ad(e),g=An(e,h);return"[Function"+(p?": "+p:" (anonymous)")+"]"+(g.length>0?" { "+_t.call(g,", ")+" }":"")}if(Nf(e)){var m=Sr?Tt.call(String(e),/^(Symbol\(.*\))_[^)]*$/,"$1"):Ao.call(e);return typeof e=="object"&&!Sr?Nr(m):m}if(hd(e)){for(var v="<"+Na.call(String(e.nodeName)),b=e.attributes||[],d=0;d<b.length;d++)v+=" "+b[d].name+"="+If(xm(b[d].value),"double",o);return v+=">",e.childNodes&&e.childNodes.length&&(v+="..."),v+="</"+Na.call(String(e.nodeName))+">",v}if(Oo(e)){if(e.length===0)return"[]";var y=An(e,h);return c&&!md(y)?"["+Fo(y,c)+"]":"[ "+_t.call(y,", ")+" ]"}if(td(e)){var k=An(e,h);return!("cause"in Error.prototype)&&"cause"in e&&!Bf.call(e,"cause")?"{ ["+String(e)+"] "+_t.call(Ta.call("[cause]: "+h(e.cause),k),", ")+" }":k.length===0?"["+String(e)+"]":"{ ["+String(e)+"] "+_t.call(k,", ")+" }"}if(typeof e=="object"&&s){if(qa&&typeof e[qa]=="function"&&Co)return Co(e,{depth:f-n});if(s!=="symbol"&&typeof e.inspect=="function")return e.inspect()}if(ld(e)){var _=[];return Ra&&Ra.call(e,function(R,q){_.push(h(q,e,!0)+" => "+h(R,e))}),Wa("Map",mi.call(e),_,c)}if(cd(e)){var M=[];return Ba&&Ba.call(e,function(R){M.push(h(R,e))}),Wa("Set",di.call(e),M,c)}if(ud(e))return xi("WeakMap");if(pd(e))return xi("WeakSet");if(fd(e))return xi("WeakRef");if(nd(e))return Nr(h(Number(e)));if(od(e))return Nr(h(Lo.call(e)));if(id(e))return Nr(Vm.call(e));if(rd(e))return Nr(h(String(e)));if(typeof window<"u"&&e===window)return"{ [object Window] }";if(typeof globalThis<"u"&&e===globalThis||typeof sn<"u"&&e===sn)return"{ [object globalThis] }";if(!ed(e)&&!za(e)){var F=An(e,h),I=ja?ja(e)===Object.prototype:e instanceof Object||e.constructor===Object,U=e instanceof Object?"":"null prototype",W=!I&&Ge&&Object(e)===e&&Ge in e?ks.call(Vt(e),8,-1):U?"Object":"",O=I||typeof e.constructor!="function"?"":e.constructor.name?e.constructor.name+" ":"",P=O+(W||U?"["+_t.call(Ta.call([],W||[],U||[]),": ")+"] ":"");return F.length===0?P+"{}":c?P+"{"+Fo(F,c)+"}":P+"{ "+_t.call(F,", ")+" }"}return String(e)};function If(r,e,t){var n=(t.quoteStyle||e)==="double"?'"':"'";return n+r+n}function xm(r){return Tt.call(String(r),/"/g,"&quot;")}function Oo(r){return Vt(r)==="[object Array]"&&(!Ge||!(typeof r=="object"&&Ge in r))}function ed(r){return Vt(r)==="[object Date]"&&(!Ge||!(typeof r=="object"&&Ge in r))}function za(r){return Vt(r)==="[object RegExp]"&&(!Ge||!(typeof r=="object"&&Ge in r))}function td(r){return Vt(r)==="[object Error]"&&(!Ge||!(typeof r=="object"&&Ge in r))}function rd(r){return Vt(r)==="[object String]"&&(!Ge||!(typeof r=="object"&&Ge in r))}function nd(r){return Vt(r)==="[object Number]"&&(!Ge||!(typeof r=="object"&&Ge in r))}function id(r){return Vt(r)==="[object Boolean]"&&(!Ge||!(typeof r=="object"&&Ge in r))}function Nf(r){if(Sr)return r&&typeof r=="object"&&r instanceof Symbol;if(typeof r=="symbol")return!0;if(!r||typeof r!="object"||!Ao)return!1;try{return Ao.call(r),!0}catch{}return!1}function od(r){if(!r||typeof r!="object"||!Lo)return!1;try{return Lo.call(r),!0}catch{}return!1}var sd=Object.prototype.hasOwnProperty||function(r){return r in this};function Bt(r,e){return sd.call(r,e)}function Vt(r){return Jm.call(r)}function ad(r){if(r.name)return r.name;var e=Xm.call(Ym.call(r),/^function\s*([\w$]+)/);return e?e[1]:null}function Tf(r,e){if(r.indexOf)return r.indexOf(e);for(var t=0,n=r.length;t<n;t++)if(r[t]===e)return t;return-1}function ld(r){if(!mi||!r||typeof r!="object")return!1;try{mi.call(r);try{di.call(r)}catch{return!0}return r instanceof Map}catch{}return!1}function ud(r){if(!Kr||!r||typeof r!="object")return!1;try{Kr.call(r,Kr);try{Zr.call(r,Zr)}catch{return!0}return r instanceof WeakMap}catch{}return!1}function fd(r){if(!Ia||!r||typeof r!="object")return!1;try{return Ia.call(r),!0}catch{}return!1}function cd(r){if(!di||!r||typeof r!="object")return!1;try{di.call(r);try{mi.call(r)}catch{return!0}return r instanceof Set}catch{}return!1}function pd(r){if(!Zr||!r||typeof r!="object")return!1;try{Zr.call(r,Zr);try{Kr.call(r,Kr)}catch{return!0}return r instanceof WeakSet}catch{}return!1}function hd(r){return!r||typeof r!="object"?!1:typeof HTMLElement<"u"&&r instanceof HTMLElement?!0:typeof r.nodeName=="string"&&typeof r.getAttribute=="function"}function Df(r,e){if(r.length>e.maxStringLength){var t=r.length-e.maxStringLength,n="... "+t+" more character"+(t>1?"s":"");return Df(ks.call(r,0,e.maxStringLength),e)+n}var i=Tt.call(Tt.call(r,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,gd);return If(i,"single",e)}function gd(r){var e=r.charCodeAt(0),t={8:"b",9:"t",10:"n",12:"f",13:"r"}[e];return t?"\\"+t:"\\x"+(e<16?"0":"")+Km.call(e.toString(16))}function Nr(r){return"Object("+r+")"}function xi(r){return r+" { ? }"}function Wa(r,e,t,n){var i=n?Fo(t,n):_t.call(t,", ");return r+" ("+e+") {"+i+"}"}function md(r){for(var e=0;e<r.length;e++)if(Tf(r[e],`
`)>=0)return!1;return!0}function dd(r,e){var t;if(r.indent==="	")t="	";else if(typeof r.indent=="number"&&r.indent>0)t=_t.call(Array(r.indent+1)," ");else return null;return{base:t,prev:_t.call(Array(e+1),t)}}function Fo(r,e){if(r.length===0)return"";var t=`
`+e.prev+e.base;return t+_t.call(r,","+t)+`
`+e.prev}function An(r,e){var t=Oo(r),n=[];if(t){n.length=r.length;for(var i=0;i<r.length;i++)n[i]=Bt(r,i)?e(r[i],r):""}var o=typeof Qi=="function"?Qi(r):[],s;if(Sr){s={};for(var a=0;a<o.length;a++)s["$"+o[a]]=o[a]}for(var l in r)Bt(r,l)&&(t&&String(Number(l))===l&&l<r.length||Sr&&s["$"+l]instanceof Symbol||(Rf.call(/[^\w$]/,l)?n.push(e(l,r)+": "+e(r[l],r)):n.push(l+": "+e(r[l],r))));if(typeof Qi=="function")for(var u=0;u<o.length;u++)Bf.call(r,o[u])&&n.push("["+e(o[u])+"]: "+e(r[o[u]],r));return n}var jf=Et,Ir=ut,yd=Qm,vd=Ht,Cn=jf("%WeakMap%",!0),On=jf("%Map%",!0),_d=Ir("WeakMap.prototype.get",!0),bd=Ir("WeakMap.prototype.set",!0),wd=Ir("WeakMap.prototype.has",!0),Sd=Ir("Map.prototype.get",!0),$d=Ir("Map.prototype.set",!0),kd=Ir("Map.prototype.has",!0),Es=function(r,e){for(var t=r,n;(n=t.next)!==null;t=n)if(n.key===e)return t.next=n.next,n.next=r.next,r.next=n,n},Ed=function(r,e){var t=Es(r,e);return t&&t.value},Md=function(r,e,t){var n=Es(r,e);n?n.value=t:r.next={key:e,next:r.next,value:t}},Pd=function(r,e){return!!Es(r,e)},Gf=function(){var e,t,n,i={assert:function(o){if(!i.has(o))throw new vd("Side channel does not contain "+yd(o))},get:function(o){if(Cn&&o&&(typeof o=="object"||typeof o=="function")){if(e)return _d(e,o)}else if(On){if(t)return Sd(t,o)}else if(n)return Ed(n,o)},has:function(o){if(Cn&&o&&(typeof o=="object"||typeof o=="function")){if(e)return wd(e,o)}else if(On){if(t)return kd(t,o)}else if(n)return Pd(n,o);return!1},set:function(o,s){Cn&&o&&(typeof o=="object"||typeof o=="function")?(e||(e=new Cn),bd(e,o,s)):On?(t||(t=new On),$d(t,o,s)):(n||(n={key:{},next:null}),Md(n,o,s))}};return i},Ld=hf,Tr=Gf(),Lt=Ht,Ms={assert:function(r,e){if(!r||typeof r!="object"&&typeof r!="function")throw new Lt("`O` is not an object");if(typeof e!="string")throw new Lt("`slot` must be a string");if(Tr.assert(r),!Ms.has(r,e))throw new Lt("`"+e+"` is not present on `O`")},get:function(r,e){if(!r||typeof r!="object"&&typeof r!="function")throw new Lt("`O` is not an object");if(typeof e!="string")throw new Lt("`slot` must be a string");var t=Tr.get(r);return t&&t["$"+e]},has:function(r,e){if(!r||typeof r!="object"&&typeof r!="function")throw new Lt("`O` is not an object");if(typeof e!="string")throw new Lt("`slot` must be a string");var t=Tr.get(r);return!!t&&Ld(t,"$"+e)},set:function(r,e,t){if(!r||typeof r!="object"&&typeof r!="function")throw new Lt("`O` is not an object");if(typeof e!="string")throw new Lt("`slot` must be a string");var n=Tr.get(r);n||(n={},Tr.set(r,n)),n["$"+e]=t}};Object.freeze&&Object.freeze(Ms);var Ad=Ms,Dr=Ad,Cd=SyntaxError,Ha=typeof StopIteration=="object"?StopIteration:null,Od=function(e){if(!Ha)throw new Cd("this environment lacks StopIteration");Dr.set(e,"[[Done]]",!1);var t={next:function(){var i=Dr.get(this,"[[Iterator]]"),o=Dr.get(i,"[[Done]]");try{return{done:o,value:o?void 0:i.next()}}catch(s){if(Dr.set(i,"[[Done]]",!0),s!==Ha)throw s;return{done:!0,value:void 0}}}};return Dr.set(t,"[[Iterator]]",e),t},Fd={}.toString,Uf=Array.isArray||function(r){return Fd.call(r)=="[object Array]"},Rd=String.prototype.valueOf,Bd=function(e){try{return Rd.call(e),!0}catch{return!1}},Id=Object.prototype.toString,Nd="[object String]",Td=ar(),qf=function(e){return typeof e=="string"?!0:typeof e!="object"?!1:Td?Bd(e):Id.call(e)===Nd},Ps=typeof Map=="function"&&Map.prototype?Map:null,Dd=typeof Set=="function"&&Set.prototype?Set:null,yi;Ps||(yi=function(e){return!1});var zf=Ps?Map.prototype.has:null,Va=Dd?Set.prototype.has:null;!yi&&!zf&&(yi=function(e){return!1});var Wf=yi||function(e){if(!e||typeof e!="object")return!1;try{if(zf.call(e),Va)try{Va.call(e)}catch{return!0}return e instanceof Ps}catch{}return!1},jd=typeof Map=="function"&&Map.prototype?Map:null,Ls=typeof Set=="function"&&Set.prototype?Set:null,vi;Ls||(vi=function(e){return!1});var Ja=jd?Map.prototype.has:null,Hf=Ls?Set.prototype.has:null;!vi&&!Hf&&(vi=function(e){return!1});var Vf=vi||function(e){if(!e||typeof e!="object")return!1;try{if(Hf.call(e),Ja)try{Ja.call(e)}catch{return!0}return e instanceof Ls}catch{}return!1},Ya=Ff,Xa=Od;if(ds()||Ni()){var eo=Symbol.iterator;zn.exports=function(e){if(e!=null&&typeof e[eo]<"u")return e[eo]();if(Ya(e))return Array.prototype[eo].call(e)}}else{var Gd=Uf,Ud=qf,Ka=Et,qd=Ka("%Map%",!0),zd=Ka("%Set%",!0),ft=ut,Za=ft("Array.prototype.push"),Qa=ft("String.prototype.charCodeAt"),Wd=ft("String.prototype.slice"),Hd=function(e,t){var n=e.length;if(t+1>=n)return t+1;var i=Qa(e,t);if(i<55296||i>56319)return t+1;var o=Qa(e,t+1);return o<56320||o>57343?t+1:t+2},to=function(e){var t=0;return{next:function(){var i=t>=e.length,o;return i||(o=e[t],t+=1),{done:i,value:o}}}},xa=function(e,t){if(Gd(e)||Ya(e))return to(e);if(Ud(e)){var n=0;return{next:function(){var o=Hd(e,n),s=Wd(e,n,o);return n=o,{done:o>e.length,value:s}}}}if(t&&typeof e["_es6-shim iterator_"]<"u")return e["_es6-shim iterator_"]()};if(!qd&&!zd)zn.exports=function(e){if(e!=null)return xa(e,!0)};else{var Vd=Wf,Jd=Vf,el=ft("Map.prototype.forEach",!0),tl=ft("Set.prototype.forEach",!0);if(typeof process>"u"||!process.versions||!process.versions.node)var rl=ft("Map.prototype.iterator",!0),nl=ft("Set.prototype.iterator",!0);var il=ft("Map.prototype.@@iterator",!0)||ft("Map.prototype._es6-shim iterator_",!0),ol=ft("Set.prototype.@@iterator",!0)||ft("Set.prototype._es6-shim iterator_",!0),Yd=function(e){if(Vd(e)){if(rl)return Xa(rl(e));if(il)return il(e);if(el){var t=[];return el(e,function(i,o){Za(t,[o,i])}),to(t)}}if(Jd(e)){if(nl)return Xa(nl(e));if(ol)return ol(e);if(tl){var n=[];return tl(e,function(i){Za(n,i)}),to(n)}}};zn.exports=function(e){return Yd(e)||xa(e)}}}var Xd=zn.exports,sl=function(r){return r!==r},Jf=function(e,t){return e===0&&t===0?1/e===1/t:!!(e===t||sl(e)&&sl(t))},Kd=Jf,Yf=function(){return typeof Object.is=="function"?Object.is:Kd},Zd=Yf,Qd=sr,xd=function(){var e=Zd();return Qd(Object,{is:e},{is:function(){return Object.is!==e}}),e},ey=sr,ty=Br,ry=Jf,Xf=Yf,ny=xd,Kf=ty(Xf(),Object);ey(Kf,{getPolyfill:Xf,implementation:ry,shim:ny});var iy=Kf,oy=Br,Zf=ut,sy=Et,Ro=sy("%ArrayBuffer%",!0),Wn=Zf("ArrayBuffer.prototype.byteLength",!0),ay=Zf("Object.prototype.toString"),al=!!Ro&&!Wn&&new Ro(0).slice,ll=!!al&&oy(al),Qf=Wn||ll?function(e){if(!e||typeof e!="object")return!1;try{return Wn?Wn(e):ll(e,0),!0}catch{return!1}}:Ro?function(e){return ay(e)==="[object ArrayBuffer]"}:function(e){return!1},ly=Date.prototype.getDay,uy=function(e){try{return ly.call(e),!0}catch{return!1}},fy=Object.prototype.toString,cy="[object Date]",py=ar(),hy=function(e){return typeof e!="object"||e===null?!1:py?uy(e):fy.call(e)===cy},Bo=ut,xf=ar(),ec,tc,Io,No;if(xf){ec=Bo("Object.prototype.hasOwnProperty"),tc=Bo("RegExp.prototype.exec"),Io={};var ro=function(){throw Io};No={toString:ro,valueOf:ro},typeof Symbol.toPrimitive=="symbol"&&(No[Symbol.toPrimitive]=ro)}var gy=Bo("Object.prototype.toString"),my=Object.getOwnPropertyDescriptor,dy="[object RegExp]",yy=xf?function(e){if(!e||typeof e!="object")return!1;var t=my(e,"lastIndex"),n=t&&ec(t,"value");if(!n)return!1;try{tc(e,No)}catch(i){return i===Io}}:function(e){return!e||typeof e!="object"&&typeof e!="function"?!1:gy(e)===dy},vy=ut,ul=vy("SharedArrayBuffer.prototype.byteLength",!0),_y=ul?function(e){if(!e||typeof e!="object")return!1;try{return ul(e),!0}catch{return!1}}:function(e){return!1},by=Number.prototype.toString,wy=function(e){try{return by.call(e),!0}catch{return!1}},Sy=Object.prototype.toString,$y="[object Number]",ky=ar(),Ey=function(e){return typeof e=="number"?!0:typeof e!="object"?!1:ky?wy(e):Sy.call(e)===$y},rc=ut,My=rc("Boolean.prototype.toString"),Py=rc("Object.prototype.toString"),Ly=function(e){try{return My(e),!0}catch{return!1}},Ay="[object Boolean]",Cy=ar(),Oy=function(e){return typeof e=="boolean"?!0:e===null||typeof e!="object"?!1:Cy&&Symbol.toStringTag in e?Ly(e):Py(e)===Ay},To={exports:{}},Fy=Object.prototype.toString,Ry=ds();if(Ry){var By=Symbol.prototype.toString,Iy=/^Symbol\(.*\)$/,Ny=function(e){return typeof e.valueOf()!="symbol"?!1:Iy.test(By.call(e))};To.exports=function(e){if(typeof e=="symbol")return!0;if(Fy.call(e)!=="[object Symbol]")return!1;try{return Ny(e)}catch{return!1}}}else To.exports=function(e){return!1};var Ty=To.exports,Do={exports:{}},fl=typeof BigInt<"u"&&BigInt,Dy=function(){return typeof fl=="function"&&typeof BigInt=="function"&&typeof fl(42)=="bigint"&&typeof BigInt(42)=="bigint"},jy=Dy();if(jy){var Gy=BigInt.prototype.valueOf,Uy=function(e){try{return Gy.call(e),!0}catch{}return!1};Do.exports=function(e){return e===null||typeof e>"u"||typeof e=="boolean"||typeof e=="string"||typeof e=="number"||typeof e=="symbol"||typeof e=="function"?!1:typeof e=="bigint"?!0:Uy(e)}}else Do.exports=function(e){return!1};var qy=Do.exports,zy=qf,Wy=Ey,Hy=Oy,Vy=Ty,Jy=qy,Yy=function(e){if(e==null||typeof e!="object"&&typeof e!="function")return null;if(zy(e))return"String";if(Wy(e))return"Number";if(Hy(e))return"Boolean";if(Vy(e))return"Symbol";if(Jy(e))return"BigInt"},_i=typeof WeakMap=="function"&&WeakMap.prototype?WeakMap:null,cl=typeof WeakSet=="function"&&WeakSet.prototype?WeakSet:null,bi;_i||(bi=function(e){return!1});var jo=_i?_i.prototype.has:null,no=cl?cl.prototype.has:null;!bi&&!jo&&(bi=function(e){return!1});var Xy=bi||function(e){if(!e||typeof e!="object")return!1;try{if(jo.call(e,jo),no)try{no.call(e,no)}catch{return!0}return e instanceof _i}catch{}return!1},Go={exports:{}},Ky=Et,nc=ut,Zy=Ky("%WeakSet%",!0),io=nc("WeakSet.prototype.has",!0);if(io){var oo=nc("WeakMap.prototype.has",!0);Go.exports=function(e){if(!e||typeof e!="object")return!1;try{if(io(e,io),oo)try{oo(e,oo)}catch{return!0}return e instanceof Zy}catch{}return!1}}else Go.exports=function(e){return!1};var Qy=Go.exports,xy=Wf,ev=Vf,tv=Xy,rv=Qy,nv=function(e){if(e&&typeof e=="object"){if(xy(e))return"Map";if(ev(e))return"Set";if(tv(e))return"WeakMap";if(rv(e))return"WeakSet"}return!1},ic=Function.prototype.toString,mr=typeof Reflect=="object"&&Reflect!==null&&Reflect.apply,Uo,Hn;if(typeof mr=="function"&&typeof Object.defineProperty=="function")try{Uo=Object.defineProperty({},"length",{get:function(){throw Hn}}),Hn={},mr(function(){throw 42},null,Uo)}catch(r){r!==Hn&&(mr=null)}else mr=null;var iv=/^\s*class\b/,qo=function(e){try{var t=ic.call(e);return iv.test(t)}catch{return!1}},so=function(e){try{return qo(e)?!1:(ic.call(e),!0)}catch{return!1}},Vn=Object.prototype.toString,ov="[object Object]",sv="[object Function]",av="[object GeneratorFunction]",lv="[object HTMLAllCollection]",uv="[object HTML document.all class]",fv="[object HTMLCollection]",cv=typeof Symbol=="function"&&!!Symbol.toStringTag,pv=!(0 in[,]),zo=function(){return!1};if(typeof document=="object"){var hv=document.all;Vn.call(hv)===Vn.call(document.all)&&(zo=function(e){if((pv||!e)&&(typeof e>"u"||typeof e=="object"))try{var t=Vn.call(e);return(t===lv||t===uv||t===fv||t===ov)&&e("")==null}catch{}return!1})}var gv=mr?function(e){if(zo(e))return!0;if(!e||typeof e!="function"&&typeof e!="object")return!1;try{mr(e,null,Uo)}catch(t){if(t!==Hn)return!1}return!qo(e)&&so(e)}:function(e){if(zo(e))return!0;if(!e||typeof e!="function"&&typeof e!="object")return!1;if(cv)return so(e);if(qo(e))return!1;var t=Vn.call(e);return t!==sv&&t!==av&&!/^\[object HTML/.test(t)?!1:so(e)},mv=gv,dv=Object.prototype.toString,oc=Object.prototype.hasOwnProperty,yv=function(e,t,n){for(var i=0,o=e.length;i<o;i++)oc.call(e,i)&&(n==null?t(e[i],i,e):t.call(n,e[i],i,e))},vv=function(e,t,n){for(var i=0,o=e.length;i<o;i++)n==null?t(e.charAt(i),i,e):t.call(n,e.charAt(i),i,e)},_v=function(e,t,n){for(var i in e)oc.call(e,i)&&(n==null?t(e[i],i,e):t.call(n,e[i],i,e))},bv=function(e,t,n){if(!mv(t))throw new TypeError("iterator must be a function");var i;arguments.length>=3&&(i=n),dv.call(e)==="[object Array]"?yv(e,t,i):typeof e=="string"?vv(e,t,i):_v(e,t,i)},wv=bv,Sv=["Float32Array","Float64Array","Int8Array","Int16Array","Int32Array","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","BigInt64Array","BigUint64Array"],ao=Sv,$v=typeof globalThis>"u"?sn:globalThis,kv=function(){for(var e=[],t=0;t<ao.length;t++)typeof $v[ao[t]]=="function"&&(e[e.length]=ao[t]);return e},wi=wv,Ev=kv,pl=Br,As=ut,Jn=_s,Mv=As("Object.prototype.toString"),sc=ar(),hl=typeof globalThis>"u"?sn:globalThis,Wo=Ev(),Cs=As("String.prototype.slice"),lo=Object.getPrototypeOf,Pv=As("Array.prototype.indexOf",!0)||function(e,t){for(var n=0;n<e.length;n+=1)if(e[n]===t)return n;return-1},Si={__proto__:null};sc&&Jn&&lo?wi(Wo,function(r){var e=new hl[r];if(Symbol.toStringTag in e){var t=lo(e),n=Jn(t,Symbol.toStringTag);if(!n){var i=lo(t);n=Jn(i,Symbol.toStringTag)}Si["$"+r]=pl(n.get)}}):wi(Wo,function(r){var e=new hl[r],t=e.slice||e.set;t&&(Si["$"+r]=pl(t))});var Lv=function(e){var t=!1;return wi(Si,function(n,i){if(!t)try{"$"+n(e)===i&&(t=Cs(i,1))}catch{}}),t},Av=function(e){var t=!1;return wi(Si,function(n,i){if(!t)try{n(e),t=Cs(i,1)}catch{}}),t},Cv=function(e){if(!e||typeof e!="object")return!1;if(!sc){var t=Cs(Mv(e),8,-1);return Pv(Wo,t)>-1?t:t!=="Object"?!1:Av(e)}return Jn?Lv(e):null},Ov=ut,gl=Ov("ArrayBuffer.prototype.byteLength",!0),Fv=Qf,Rv=function(e){return Fv(e)?gl?gl(e):e.byteLength:NaN},ac=cm,Mt=ut,ml=Im,Bv=Et,$r=Xd,Iv=Gf,dl=iy,yl=Ff,vl=Uf,_l=Qf,bl=hy,wl=yy,Sl=_y,$l=ms,kl=Yy,El=nv,Ml=Cv,Pl=Rv,Ll=Mt("SharedArrayBuffer.prototype.byteLength",!0),Al=Mt("Date.prototype.getTime"),uo=Object.getPrototypeOf,Cl=Mt("Object.prototype.toString"),$i=Bv("%Set%",!0),Ho=Mt("Map.prototype.has",!0),ki=Mt("Map.prototype.get",!0),Ol=Mt("Map.prototype.size",!0),Ei=Mt("Set.prototype.add",!0),lc=Mt("Set.prototype.delete",!0),Mi=Mt("Set.prototype.has",!0),Yn=Mt("Set.prototype.size",!0);function Fl(r,e,t,n){for(var i=$r(r),o;(o=i.next())&&!o.done;)if(yt(e,o.value,t,n))return lc(r,o.value),!0;return!1}function uc(r){if(typeof r>"u")return null;if(typeof r!="object")return typeof r=="symbol"?!1:typeof r=="string"||typeof r=="number"?+r==+r:!0}function Nv(r,e,t,n,i,o){var s=uc(t);if(s!=null)return s;var a=ki(e,s),l=ac({},i,{strict:!1});return typeof a>"u"&&!Ho(e,s)||!yt(n,a,l,o)?!1:!Ho(r,s)&&yt(n,a,l,o)}function Tv(r,e,t){var n=uc(t);return n??(Mi(e,n)&&!Mi(r,n))}function Rl(r,e,t,n,i,o){for(var s=$r(r),a,l;(a=s.next())&&!a.done;)if(l=a.value,yt(t,l,i,o)&&yt(n,ki(e,l),i,o))return lc(r,l),!0;return!1}function yt(r,e,t,n){var i=t||{};if(i.strict?dl(r,e):r===e)return!0;var o=kl(r),s=kl(e);if(o!==s)return!1;if(!r||!e||typeof r!="object"&&typeof e!="object")return i.strict?dl(r,e):r==e;var a=n.has(r),l=n.has(e),u;if(a&&l){if(n.get(r)===n.get(e))return!0}else u={};return a||n.set(r,u),l||n.set(e,u),Gv(r,e,i,n)}function Bl(r){return!r||typeof r!="object"||typeof r.length!="number"||typeof r.copy!="function"||typeof r.slice!="function"||r.length>0&&typeof r[0]!="number"?!1:!!(r.constructor&&r.constructor.isBuffer&&r.constructor.isBuffer(r))}function Dv(r,e,t,n){if(Yn(r)!==Yn(e))return!1;for(var i=$r(r),o=$r(e),s,a,l;(s=i.next())&&!s.done;)if(s.value&&typeof s.value=="object")l||(l=new $i),Ei(l,s.value);else if(!Mi(e,s.value)){if(t.strict||!Tv(r,e,s.value))return!1;l||(l=new $i),Ei(l,s.value)}if(l){for(;(a=o.next())&&!a.done;)if(a.value&&typeof a.value=="object"){if(!Fl(l,a.value,t.strict,n))return!1}else if(!t.strict&&!Mi(r,a.value)&&!Fl(l,a.value,t.strict,n))return!1;return Yn(l)===0}return!0}function jv(r,e,t,n){if(Ol(r)!==Ol(e))return!1;for(var i=$r(r),o=$r(e),s,a,l,u,f,c;(s=i.next())&&!s.done;)if(u=s.value[0],f=s.value[1],u&&typeof u=="object")l||(l=new $i),Ei(l,u);else if(c=ki(e,u),typeof c>"u"&&!Ho(e,u)||!yt(f,c,t,n)){if(t.strict||!Nv(r,e,u,f,t,n))return!1;l||(l=new $i),Ei(l,u)}if(l){for(;(a=o.next())&&!a.done;)if(u=a.value[0],c=a.value[1],u&&typeof u=="object"){if(!Rl(l,r,u,c,t,n))return!1}else if(!t.strict&&(!r.has(u)||!yt(ki(r,u),c,t,n))&&!Rl(l,r,u,c,ac({},t,{strict:!1}),n))return!1;return Yn(l)===0}return!0}function Gv(r,e,t,n){var i,o;if(typeof r!=typeof e||r==null||e==null||Cl(r)!==Cl(e)||yl(r)!==yl(e))return!1;var s=vl(r),a=vl(e);if(s!==a)return!1;var l=r instanceof Error,u=e instanceof Error;if(l!==u||(l||u)&&(r.name!==e.name||r.message!==e.message))return!1;var f=wl(r),c=wl(e);if(f!==c||(f||c)&&(r.source!==e.source||ml(r)!==ml(e)))return!1;var h=bl(r),p=bl(e);if(h!==p||(h||p)&&Al(r)!==Al(e)||t.strict&&uo&&uo(r)!==uo(e))return!1;var g=Ml(r),m=Ml(e);if(g!==m)return!1;if(g||m){if(r.length!==e.length)return!1;for(i=0;i<r.length;i++)if(r[i]!==e[i])return!1;return!0}var v=Bl(r),b=Bl(e);if(v!==b)return!1;if(v||b){if(r.length!==e.length)return!1;for(i=0;i<r.length;i++)if(r[i]!==e[i])return!1;return!0}var d=_l(r),y=_l(e);if(d!==y)return!1;if(d||y)return Pl(r)!==Pl(e)?!1:typeof Uint8Array=="function"&&yt(new Uint8Array(r),new Uint8Array(e),t,n);var k=Sl(r),_=Sl(e);if(k!==_)return!1;if(k||_)return Ll(r)!==Ll(e)?!1:typeof Uint8Array=="function"&&yt(new Uint8Array(r),new Uint8Array(e),t,n);if(typeof r!=typeof e)return!1;var M=$l(r),F=$l(e);if(M.length!==F.length)return!1;for(M.sort(),F.sort(),i=M.length-1;i>=0;i--)if(M[i]!=F[i])return!1;for(i=M.length-1;i>=0;i--)if(o=M[i],!yt(r[o],e[o],t,n))return!1;var I=El(r),U=El(e);return I!==U?!1:I==="Set"||U==="Set"?Dv(r,e,t,n):I==="Map"?jv(r,e,t,n):!0}var Uv=function(e,t,n){return yt(e,t,n,Iv())};const qv=rf(Uv);var zv=Object.defineProperty,ae=(r,e)=>zv(r,"name",{value:e,configurable:!0}),Wv=class{constructor(e){this.direction=!1,this.compareProperties=!0;var t,n,i;this.precision=10**-((t=e==null?void 0:e.precision)!=null?t:17),this.direction=(n=e==null?void 0:e.direction)!=null?n:!1,this.compareProperties=(i=e==null?void 0:e.compareProperties)!=null?i:!0}compare(e,t){if(e.type!==t.type||!Wr(e,t))return!1;switch(e.type){case"Point":return this.compareCoord(e.coordinates,t.coordinates);case"LineString":return this.compareLine(e.coordinates,t.coordinates);case"Polygon":return this.comparePolygon(e,t);case"GeometryCollection":return this.compareGeometryCollection(e,t);case"Feature":return this.compareFeature(e,t);case"FeatureCollection":return this.compareFeatureCollection(e,t);default:if(e.type.startsWith("Multi")){const n=Vo(e),i=Vo(t);return n.every(o=>i.some(s=>this.compare(o,s)))}}return!1}compareCoord(e,t){return e.length===t.length&&e.every((n,i)=>Math.abs(n-t[i])<this.precision)}compareLine(e,t,n=0,i=!1){if(!Wr(e,t))return!1;const o=e;let s=t;if(i&&!this.compareCoord(o[0],s[0])){const l=this.fixStartIndex(s,o);if(l)s=l;else return!1}const a=this.compareCoord(o[n],s[n]);return this.direction||a?this.comparePath(o,s):this.compareCoord(o[n],s[s.length-(1+n)])?this.comparePath(o.slice().reverse(),s):!1}fixStartIndex(e,t){let n,i=-1;for(let o=0;o<e.length;o++)if(this.compareCoord(e[o],t[0])){i=o;break}return i>=0&&(n=[].concat(e.slice(i,e.length),e.slice(1,i+1))),n}comparePath(e,t){return e.every((n,i)=>this.compareCoord(n,t[i]))}comparePolygon(e,t){if(this.compareLine(e.coordinates[0],t.coordinates[0],1,!0)){const n=e.coordinates.slice(1,e.coordinates.length),i=t.coordinates.slice(1,t.coordinates.length);return n.every(o=>i.some(s=>this.compareLine(o,s,1,!0)))}return!1}compareGeometryCollection(e,t){return Wr(e.geometries,t.geometries)&&this.compareBBox(e,t)&&e.geometries.every((n,i)=>this.compare(n,t.geometries[i]))}compareFeature(e,t){return e.id===t.id&&(this.compareProperties?qv(e.properties,t.properties):!0)&&this.compareBBox(e,t)&&this.compare(e.geometry,t.geometry)}compareFeatureCollection(e,t){return Wr(e.features,t.features)&&this.compareBBox(e,t)&&e.features.every((n,i)=>this.compare(n,t.features[i]))}compareBBox(e,t){return!e.bbox&&!t.bbox||(e.bbox&&t.bbox?this.compareCoord(e.bbox,t.bbox):!1)}};ae(Wv,"GeojsonEquality");function Wr(r,e){return r.coordinates?r.coordinates.length===e.coordinates.length:r.length===e.length}ae(Wr,"sameLength");function Vo(r){return r.coordinates.map(e=>({type:r.type.replace("Multi",""),coordinates:e}))}ae(Vo,"explode");var xe=63710088e-1,fc={centimeters:xe*100,centimetres:xe*100,degrees:360/(2*Math.PI),feet:xe*3.28084,inches:xe*39.37,kilometers:xe/1e3,kilometres:xe/1e3,meters:xe,metres:xe,miles:xe/1609.344,millimeters:xe*1e3,millimetres:xe*1e3,nauticalmiles:xe/1852,radians:1,yards:xe*1.0936},Il={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,nauticalmiles:29155334959812285e-23,millimeters:1e6,millimetres:1e6,yards:1.195990046};function lt(r,e,t={}){const n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=r,n}ae(lt,"feature");function Hv(r,e,t={}){switch(r){case"Point":return Qe(e).geometry;case"LineString":return pt(e).geometry;case"Polygon":return Di(e).geometry;case"MultiPoint":return pc(e).geometry;case"MultiLineString":return cc(e).geometry;case"MultiPolygon":return Os(e).geometry;default:throw new Error(r+" is invalid")}}ae(Hv,"geometry");function Qe(r,e,t={}){if(!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Er(r[0])||!Er(r[1]))throw new Error("coordinates must contain numbers");return lt({type:"Point",coordinates:r},e,t)}ae(Qe,"point");function Vv(r,e,t={}){return kr(r.map(n=>Qe(n,e)),t)}ae(Vv,"points");function Di(r,e,t={}){for(const i of r){if(i.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(i[i.length-1].length!==i[0].length)throw new Error("First and last Position are not equivalent.");for(let o=0;o<i[i.length-1].length;o++)if(i[i.length-1][o]!==i[0][o])throw new Error("First and last Position are not equivalent.")}return lt({type:"Polygon",coordinates:r},e,t)}ae(Di,"polygon");function Jv(r,e,t={}){return kr(r.map(n=>Di(n,e)),t)}ae(Jv,"polygons");function pt(r,e,t={}){if(r.length<2)throw new Error("coordinates must be an array of two or more positions");return lt({type:"LineString",coordinates:r},e,t)}ae(pt,"lineString");function Yv(r,e,t={}){return kr(r.map(n=>pt(n,e)),t)}ae(Yv,"lineStrings");function kr(r,e={}){const t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=r,t}ae(kr,"featureCollection");function cc(r,e,t={}){return lt({type:"MultiLineString",coordinates:r},e,t)}ae(cc,"multiLineString");function pc(r,e,t={}){return lt({type:"MultiPoint",coordinates:r},e,t)}ae(pc,"multiPoint");function Os(r,e,t={}){return lt({type:"MultiPolygon",coordinates:r},e,t)}ae(Os,"multiPolygon");function Xv(r,e,t={}){return lt({type:"GeometryCollection",geometries:r},e,t)}ae(Xv,"geometryCollection");function Kv(r,e=0){if(e&&!(e>=0))throw new Error("precision must be a positive number");const t=Math.pow(10,e||0);return Math.round(r*t)/t}ae(Kv,"round");function Fs(r,e="kilometers"){const t=fc[e];if(!t)throw new Error(e+" units is invalid");return r*t}ae(Fs,"radiansToLength");function ji(r,e="kilometers"){const t=fc[e];if(!t)throw new Error(e+" units is invalid");return r/t}ae(ji,"lengthToRadians");function Zv(r,e){return ln(ji(r,e))}ae(Zv,"lengthToDegrees");function Qv(r){let e=r%360;return e<0&&(e+=360),e}ae(Qv,"bearingToAzimuth");function ln(r){return r%(2*Math.PI)*180/Math.PI}ae(ln,"radiansToDegrees");function ot(r){return r%360*Math.PI/180}ae(ot,"degreesToRadians");function xv(r,e="kilometers",t="kilometers"){if(!(r>=0))throw new Error("length must be a positive number");return Fs(ji(r,e),t)}ae(xv,"convertLength");function e_(r,e="meters",t="kilometers"){if(!(r>=0))throw new Error("area must be a positive number");const n=Il[e];if(!n)throw new Error("invalid original units");const i=Il[t];if(!i)throw new Error("invalid final units");return r/n*i}ae(e_,"convertArea");function Er(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}ae(Er,"isNumber");function Rs(r){return r!==null&&typeof r=="object"&&!Array.isArray(r)}ae(Rs,"isObject");function t_(r){if(!r)throw new Error("bbox is required");if(!Array.isArray(r))throw new Error("bbox must be an Array");if(r.length!==4&&r.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");r.forEach(e=>{if(!Er(e))throw new Error("bbox must only contain numbers")})}ae(t_,"validateBBox");function r_(r){if(!r)throw new Error("id is required");if(["string","number"].indexOf(typeof r)===-1)throw new Error("id must be a number or a string")}ae(r_,"validateId");/**
 * splaytree v3.1.2
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function n_(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(u){return function(f){return l([u,f])}}function l(u){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=u[0]&2?i.return:u[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,u[1])).done)return o;switch(i=0,o&&(u=[u[0]&2,o.value]),u[0]){case 0:case 1:o=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,i=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!o||u[1]>o[0]&&u[1]<o[3])){t.label=u[1];break}if(u[0]===6&&t.label<o[1]){t.label=o[1],o=u;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(u);break}o[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(r,t)}catch(f){u=[6,f],i=0}finally{n=o=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}var Ut=function(){function r(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null}return r}();function i_(r,e){return r>e?1:r<e?-1:0}function It(r,e,t){for(var n=new Ut(null,null),i=n,o=n;;){var s=t(r,e.key);if(s<0){if(e.left===null)break;if(t(r,e.left.key)<0){var a=e.left;if(e.left=a.right,a.right=e,e=a,e.left===null)break}o.left=e,o=e,e=e.left}else if(s>0){if(e.right===null)break;if(t(r,e.right.key)>0){var a=e.right;if(e.right=a.left,a.left=e,e=a,e.right===null)break}i.right=e,i=e,e=e.right}else break}return i.right=e.left,o.left=e.right,e.left=n.right,e.right=n.left,e}function fo(r,e,t,n){var i=new Ut(r,e);if(t===null)return i.left=i.right=null,i;t=It(r,t,n);var o=n(r,t.key);return o<0?(i.left=t.left,i.right=t,t.left=null):o>=0&&(i.right=t.right,i.left=t,t.right=null),i}function Nl(r,e,t){var n=null,i=null;if(e){e=It(r,e,t);var o=t(e.key,r);o===0?(n=e.left,i=e.right):o<0?(i=e.right,e.right=null,n=e):(n=e.left,e.left=null,i=e)}return{left:n,right:i}}function o_(r,e,t){return e===null?r:(r===null||(e=It(r.key,e,t),e.left=r),e)}function Jo(r,e,t,n,i){if(r){n(""+e+(t?"└── ":"├── ")+i(r)+`
`);var o=e+(t?"    ":"│   ");r.left&&Jo(r.left,o,!1,n,i),r.right&&Jo(r.right,o,!0,n,i)}}var Bs=function(){function r(e){e===void 0&&(e=i_),this._root=null,this._size=0,this._comparator=e}return r.prototype.insert=function(e,t){return this._size++,this._root=fo(e,t,this._root,this._comparator)},r.prototype.add=function(e,t){var n=new Ut(e,t);this._root===null&&(n.left=n.right=null,this._size++,this._root=n);var i=this._comparator,o=It(e,this._root,i),s=i(e,o.key);return s===0?this._root=o:(s<0?(n.left=o.left,n.right=o,o.left=null):s>0&&(n.right=o.right,n.left=o,o.right=null),this._size++,this._root=n),this._root},r.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},r.prototype._remove=function(e,t,n){var i;if(t===null)return null;t=It(e,t,n);var o=n(e,t.key);return o===0?(t.left===null?i=t.right:(i=It(e,t.left,n),i.right=t.right),this._size--,i):t},r.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=It(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},r.prototype.findStatic=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return t;i<0?t=t.left:t=t.right}return null},r.prototype.find=function(e){return this._root&&(this._root=It(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},r.prototype.contains=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return!0;i<0?t=t.left:t=t.right}return!1},r.prototype.forEach=function(e,t){for(var n=this._root,i=[],o=!1;!o;)n!==null?(i.push(n),n=n.left):i.length!==0?(n=i.pop(),e.call(t,n),n=n.right):o=!0;return this},r.prototype.range=function(e,t,n,i){for(var o=[],s=this._comparator,a=this._root,l;o.length!==0||a;)if(a)o.push(a),a=a.left;else{if(a=o.pop(),l=s(a.key,t),l>0)break;if(s(a.key,e)>=0&&n.call(i,a))return this;a=a.right}return this},r.prototype.keys=function(){var e=[];return this.forEach(function(t){var n=t.key;return e.push(n)}),e},r.prototype.values=function(){var e=[];return this.forEach(function(t){var n=t.data;return e.push(n)}),e},r.prototype.min=function(){return this._root?this.minNode(this._root).key:null},r.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},r.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},r.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},r.prototype.at=function(e){for(var t=this._root,n=!1,i=0,o=[];!n;)if(t)o.push(t),t=t.left;else if(o.length>0){if(t=o.pop(),i===e)return t;i++,t=t.right}else n=!0;return null},r.prototype.next=function(e){var t=this._root,n=null;if(e.right){for(n=e.right;n.left;)n=n.left;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?(n=t,t=t.left):t=t.right}return n},r.prototype.prev=function(e){var t=this._root,n=null;if(e.left!==null){for(n=e.left;n.right;)n=n.right;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?t=t.left:(n=t,t=t.right)}return n},r.prototype.clear=function(){return this._root=null,this._size=0,this},r.prototype.toList=function(){return a_(this._root)},r.prototype.load=function(e,t,n){t===void 0&&(t=[]),n===void 0&&(n=!1);var i=e.length,o=this._comparator;if(n&&Ko(e,t,0,i-1,o),this._root===null)this._root=Yo(e,t,0,i),this._size=i;else{var s=l_(this.toList(),s_(e,t),o);i=this._size+i,this._root=Xo({head:s},0,i)}return this},r.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(r.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),r.prototype.toString=function(e){e===void 0&&(e=function(n){return String(n.key)});var t=[];return Jo(this._root,"",!0,function(n){return t.push(n)},e),t.join("")},r.prototype.update=function(e,t,n){var i=this._comparator,o=Nl(e,this._root,i),s=o.left,a=o.right;i(e,t)<0?a=fo(t,n,a,i):s=fo(t,n,s,i),this._root=o_(s,a,i)},r.prototype.split=function(e){return Nl(e,this._root,this._comparator)},r.prototype[Symbol.iterator]=function(){var e,t,n;return n_(this,function(i){switch(i.label){case 0:e=this._root,t=[],n=!1,i.label=1;case 1:return n?[3,6]:e===null?[3,2]:(t.push(e),e=e.left,[3,5]);case 2:return t.length===0?[3,4]:(e=t.pop(),[4,e]);case 3:return i.sent(),e=e.right,[3,5];case 4:n=!0,i.label=5;case 5:return[3,1];case 6:return[2]}})},r}();function Yo(r,e,t,n){var i=n-t;if(i>0){var o=t+Math.floor(i/2),s=r[o],a=e[o],l=new Ut(s,a);return l.left=Yo(r,e,t,o),l.right=Yo(r,e,o+1,n),l}return null}function s_(r,e){for(var t=new Ut(null,null),n=t,i=0;i<r.length;i++)n=n.next=new Ut(r[i],e[i]);return n.next=null,t.next}function a_(r){for(var e=r,t=[],n=!1,i=new Ut(null,null),o=i;!n;)e?(t.push(e),e=e.left):t.length>0?(e=o=o.next=t.pop(),e=e.right):n=!0;return o.next=null,i.next}function Xo(r,e,t){var n=t-e;if(n>0){var i=e+Math.floor(n/2),o=Xo(r,e,i),s=r.head;return s.left=o,r.head=r.head.next,s.right=Xo(r,i+1,t),s}return null}function l_(r,e,t){for(var n=new Ut(null,null),i=n,o=r,s=e;o!==null&&s!==null;)t(o.key,s.key)<0?(i.next=o,o=o.next):(i.next=s,s=s.next),i=i.next;return o!==null?i.next=o:s!==null&&(i.next=s),n.next}function Ko(r,e,t,n,i){if(!(t>=n)){for(var o=r[t+n>>1],s=t-1,a=n+1;;){do s++;while(i(r[s],o)<0);do a--;while(i(r[a],o)>0);if(s>=a)break;var l=r[s];r[s]=r[a],r[a]=l,l=e[s],e[s]=e[a],e[a]=l}Ko(r,e,t,a,i),Ko(r,e,a+1,n,i)}}const Ct=11102230246251565e-32,Be=134217729,u_=(3+8*Ct)*Ct;function co(r,e,t,n,i){let o,s,a,l,u=e[0],f=n[0],c=0,h=0;f>u==f>-u?(o=u,u=e[++c]):(o=f,f=n[++h]);let p=0;if(c<r&&h<t)for(f>u==f>-u?(s=u+o,a=o-(s-u),u=e[++c]):(s=f+o,a=o-(s-f),f=n[++h]),o=s,a!==0&&(i[p++]=a);c<r&&h<t;)f>u==f>-u?(s=o+u,l=s-o,a=o-(s-l)+(u-l),u=e[++c]):(s=o+f,l=s-o,a=o-(s-l)+(f-l),f=n[++h]),o=s,a!==0&&(i[p++]=a);for(;c<r;)s=o+u,l=s-o,a=o-(s-l)+(u-l),u=e[++c],o=s,a!==0&&(i[p++]=a);for(;h<t;)s=o+f,l=s-o,a=o-(s-l)+(f-l),f=n[++h],o=s,a!==0&&(i[p++]=a);return(o!==0||p===0)&&(i[p++]=o),p}function f_(r,e){let t=e[0];for(let n=1;n<r;n++)t+=e[n];return t}function wn(r){return new Float64Array(r)}const c_=(3+16*Ct)*Ct,p_=(2+12*Ct)*Ct,h_=(9+64*Ct)*Ct*Ct,cr=wn(4),Tl=wn(8),Dl=wn(12),jl=wn(16),qe=wn(4);function g_(r,e,t,n,i,o,s){let a,l,u,f,c,h,p,g,m,v,b,d,y,k,_,M,F,I;const U=r-i,W=t-i,O=e-o,P=n-o;k=U*P,h=Be*U,p=h-(h-U),g=U-p,h=Be*P,m=h-(h-P),v=P-m,_=g*v-(k-p*m-g*m-p*v),M=O*W,h=Be*O,p=h-(h-O),g=O-p,h=Be*W,m=h-(h-W),v=W-m,F=g*v-(M-p*m-g*m-p*v),b=_-F,c=_-b,cr[0]=_-(b+c)+(c-F),d=k+b,c=d-k,y=k-(d-c)+(b-c),b=y-M,c=y-b,cr[1]=y-(b+c)+(c-M),I=d+b,c=I-d,cr[2]=d-(I-c)+(b-c),cr[3]=I;let R=f_(4,cr),q=p_*s;if(R>=q||-R>=q||(c=r-U,a=r-(U+c)+(c-i),c=t-W,u=t-(W+c)+(c-i),c=e-O,l=e-(O+c)+(c-o),c=n-P,f=n-(P+c)+(c-o),a===0&&l===0&&u===0&&f===0)||(q=h_*s+u_*Math.abs(R),R+=U*f+P*a-(O*u+W*l),R>=q||-R>=q))return R;k=a*P,h=Be*a,p=h-(h-a),g=a-p,h=Be*P,m=h-(h-P),v=P-m,_=g*v-(k-p*m-g*m-p*v),M=l*W,h=Be*l,p=h-(h-l),g=l-p,h=Be*W,m=h-(h-W),v=W-m,F=g*v-(M-p*m-g*m-p*v),b=_-F,c=_-b,qe[0]=_-(b+c)+(c-F),d=k+b,c=d-k,y=k-(d-c)+(b-c),b=y-M,c=y-b,qe[1]=y-(b+c)+(c-M),I=d+b,c=I-d,qe[2]=d-(I-c)+(b-c),qe[3]=I;const se=co(4,cr,4,qe,Tl);k=U*f,h=Be*U,p=h-(h-U),g=U-p,h=Be*f,m=h-(h-f),v=f-m,_=g*v-(k-p*m-g*m-p*v),M=O*u,h=Be*O,p=h-(h-O),g=O-p,h=Be*u,m=h-(h-u),v=u-m,F=g*v-(M-p*m-g*m-p*v),b=_-F,c=_-b,qe[0]=_-(b+c)+(c-F),d=k+b,c=d-k,y=k-(d-c)+(b-c),b=y-M,c=y-b,qe[1]=y-(b+c)+(c-M),I=d+b,c=I-d,qe[2]=d-(I-c)+(b-c),qe[3]=I;const ie=co(se,Tl,4,qe,Dl);k=a*f,h=Be*a,p=h-(h-a),g=a-p,h=Be*f,m=h-(h-f),v=f-m,_=g*v-(k-p*m-g*m-p*v),M=l*u,h=Be*l,p=h-(h-l),g=l-p,h=Be*u,m=h-(h-u),v=u-m,F=g*v-(M-p*m-g*m-p*v),b=_-F,c=_-b,qe[0]=_-(b+c)+(c-F),d=k+b,c=d-k,y=k-(d-c)+(b-c),b=y-M,c=y-b,qe[1]=y-(b+c)+(c-M),I=d+b,c=I-d,qe[2]=d-(I-c)+(b-c),qe[3]=I;const H=co(ie,Dl,4,qe,jl);return jl[H-1]}function m_(r,e,t,n,i,o){const s=(e-o)*(t-i),a=(r-i)*(n-o),l=s-a,u=Math.abs(s+a);return Math.abs(l)>=c_*u?l:-g_(r,e,t,n,i,o,u)}const jr=(r,e)=>r.ll.x<=e.x&&e.x<=r.ur.x&&r.ll.y<=e.y&&e.y<=r.ur.y,Zo=(r,e)=>{if(e.ur.x<r.ll.x||r.ur.x<e.ll.x||e.ur.y<r.ll.y||r.ur.y<e.ll.y)return null;const t=r.ll.x<e.ll.x?e.ll.x:r.ll.x,n=r.ur.x<e.ur.x?r.ur.x:e.ur.x,i=r.ll.y<e.ll.y?e.ll.y:r.ll.y,o=r.ur.y<e.ur.y?r.ur.y:e.ur.y;return{ll:{x:t,y:i},ur:{x:n,y:o}}};let Dt=Number.EPSILON;Dt===void 0&&(Dt=Math.pow(2,-52));const d_=Dt*Dt,Gl=(r,e)=>{if(-Dt<r&&r<Dt&&-Dt<e&&e<Dt)return 0;const t=r-e;return t*t<d_*r*e?0:r<e?-1:1};class y_{constructor(){this.reset()}reset(){this.xRounder=new Ul,this.yRounder=new Ul}round(e,t){return{x:this.xRounder.round(e),y:this.yRounder.round(t)}}}class Ul{constructor(){this.tree=new Bs,this.round(0)}round(e){const t=this.tree.add(e),n=this.tree.prev(t);if(n!==null&&Gl(t.key,n.key)===0)return this.tree.remove(e),n.key;const i=this.tree.next(t);return i!==null&&Gl(t.key,i.key)===0?(this.tree.remove(e),i.key):e}}const un=new y_,Xn=(r,e)=>r.x*e.y-r.y*e.x,hc=(r,e)=>r.x*e.x+r.y*e.y,ql=(r,e,t)=>{const n=m_(r.x,r.y,e.x,e.y,t.x,t.y);return n>0?-1:n<0?1:0},Pi=r=>Math.sqrt(hc(r,r)),v_=(r,e,t)=>{const n={x:e.x-r.x,y:e.y-r.y},i={x:t.x-r.x,y:t.y-r.y};return Xn(i,n)/Pi(i)/Pi(n)},__=(r,e,t)=>{const n={x:e.x-r.x,y:e.y-r.y},i={x:t.x-r.x,y:t.y-r.y};return hc(i,n)/Pi(i)/Pi(n)},zl=(r,e,t)=>e.y===0?null:{x:r.x+e.x/e.y*(t-r.y),y:t},Wl=(r,e,t)=>e.x===0?null:{x:t,y:r.y+e.y/e.x*(t-r.x)},b_=(r,e,t,n)=>{if(e.x===0)return Wl(t,n,r.x);if(n.x===0)return Wl(r,e,t.x);if(e.y===0)return zl(t,n,r.y);if(n.y===0)return zl(r,e,t.y);const i=Xn(e,n);if(i==0)return null;const o={x:t.x-r.x,y:t.y-r.y},s=Xn(o,e)/i,a=Xn(o,n)/i,l=r.x+a*e.x,u=t.x+s*n.x,f=r.y+a*e.y,c=t.y+s*n.y,h=(l+u)/2,p=(f+c)/2;return{x:h,y:p}};class it{static compare(e,t){const n=it.comparePoints(e.point,t.point);return n!==0?n:(e.point!==t.point&&e.link(t),e.isLeft!==t.isLeft?e.isLeft?1:-1:Li.compare(e.segment,t.segment))}static comparePoints(e,t){return e.x<t.x?-1:e.x>t.x?1:e.y<t.y?-1:e.y>t.y?1:0}constructor(e,t){e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}link(e){if(e.point===this.point)throw new Error("Tried to link already linked events");const t=e.point.events;for(let n=0,i=t.length;n<i;n++){const o=t[n];this.point.events.push(o),o.point=this.point}this.checkForConsuming()}checkForConsuming(){const e=this.point.events.length;for(let t=0;t<e;t++){const n=this.point.events[t];if(n.segment.consumedBy===void 0)for(let i=t+1;i<e;i++){const o=this.point.events[i];o.consumedBy===void 0&&n.otherSE.point.events===o.otherSE.point.events&&n.segment.consume(o.segment)}}}getAvailableLinkedEvents(){const e=[];for(let t=0,n=this.point.events.length;t<n;t++){const i=this.point.events[t];i!==this&&!i.segment.ringOut&&i.segment.isInResult()&&e.push(i)}return e}getLeftmostComparator(e){const t=new Map,n=i=>{const o=i.otherSE;t.set(i,{sine:v_(this.point,e.point,o.point),cosine:__(this.point,e.point,o.point)})};return(i,o)=>{t.has(i)||n(i),t.has(o)||n(o);const{sine:s,cosine:a}=t.get(i),{sine:l,cosine:u}=t.get(o);return s>=0&&l>=0?a<u?1:a>u?-1:0:s<0&&l<0?a<u?-1:a>u?1:0:l<s?-1:l>s?1:0}}}let w_=0,Li=class Kn{static compare(e,t){const n=e.leftSE.point.x,i=t.leftSE.point.x,o=e.rightSE.point.x,s=t.rightSE.point.x;if(s<n)return 1;if(o<i)return-1;const a=e.leftSE.point.y,l=t.leftSE.point.y,u=e.rightSE.point.y,f=t.rightSE.point.y;if(n<i){if(l<a&&l<u)return 1;if(l>a&&l>u)return-1;const c=e.comparePoint(t.leftSE.point);if(c<0)return 1;if(c>0)return-1;const h=t.comparePoint(e.rightSE.point);return h!==0?h:-1}if(n>i){if(a<l&&a<f)return-1;if(a>l&&a>f)return 1;const c=t.comparePoint(e.leftSE.point);if(c!==0)return c;const h=e.comparePoint(t.rightSE.point);return h<0?1:h>0?-1:1}if(a<l)return-1;if(a>l)return 1;if(o<s){const c=t.comparePoint(e.rightSE.point);if(c!==0)return c}if(o>s){const c=e.comparePoint(t.rightSE.point);if(c<0)return 1;if(c>0)return-1}if(o!==s){const c=u-a,h=o-n,p=f-l,g=s-i;if(c>h&&p<g)return 1;if(c<h&&p>g)return-1}return o>s?1:o<s||u<f?-1:u>f?1:e.id<t.id?-1:e.id>t.id?1:0}constructor(e,t,n,i){this.id=++w_,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=n,this.windings=i}static fromRing(e,t,n){let i,o,s;const a=it.comparePoints(e,t);if(a<0)i=e,o=t,s=1;else if(a>0)i=t,o=e,s=-1;else throw new Error(`Tried to create degenerate segment at [${e.x}, ${e.y}]`);const l=new it(i,!0),u=new it(o,!1);return new Kn(l,u,[n],[s])}replaceRightSE(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const e=this.leftSE.point.y,t=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e<t?e:t},ur:{x:this.rightSE.point.x,y:e>t?e:t}}}vector(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}isAnEndpoint(e){return e.x===this.leftSE.point.x&&e.y===this.leftSE.point.y||e.x===this.rightSE.point.x&&e.y===this.rightSE.point.y}comparePoint(e){if(this.isAnEndpoint(e))return 0;const t=this.leftSE.point,n=this.rightSE.point,i=this.vector();if(t.x===n.x)return e.x===t.x?0:e.x<t.x?1:-1;const o=(e.y-t.y)/i.y,s=t.x+o*i.x;if(e.x===s)return 0;const a=(e.x-t.x)/i.x,l=t.y+a*i.y;return e.y===l?0:e.y<l?-1:1}getIntersection(e){const t=this.bbox(),n=e.bbox(),i=Zo(t,n);if(i===null)return null;const o=this.leftSE.point,s=this.rightSE.point,a=e.leftSE.point,l=e.rightSE.point,u=jr(t,a)&&this.comparePoint(a)===0,f=jr(n,o)&&e.comparePoint(o)===0,c=jr(t,l)&&this.comparePoint(l)===0,h=jr(n,s)&&e.comparePoint(s)===0;if(f&&u)return h&&!c?s:!h&&c?l:null;if(f)return c&&o.x===l.x&&o.y===l.y?null:o;if(u)return h&&s.x===a.x&&s.y===a.y?null:a;if(h&&c)return null;if(h)return s;if(c)return l;const p=b_(o,this.vector(),a,e.vector());return p===null||!jr(i,p)?null:un.round(p.x,p.y)}split(e){const t=[],n=e.events!==void 0,i=new it(e,!0),o=new it(e,!1),s=this.rightSE;this.replaceRightSE(o),t.push(o),t.push(i);const a=new Kn(i,s,this.rings.slice(),this.windings.slice());return it.comparePoints(a.leftSE.point,a.rightSE.point)>0&&a.swapEvents(),it.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),n&&(i.checkForConsuming(),o.checkForConsuming()),t}swapEvents(){const e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let t=0,n=this.windings.length;t<n;t++)this.windings[t]*=-1}consume(e){let t=this,n=e;for(;t.consumedBy;)t=t.consumedBy;for(;n.consumedBy;)n=n.consumedBy;const i=Kn.compare(t,n);if(i!==0){if(i>0){const o=t;t=n,n=o}if(t.prev===n){const o=t;t=n,n=o}for(let o=0,s=n.rings.length;o<s;o++){const a=n.rings[o],l=n.windings[o],u=t.rings.indexOf(a);u===-1?(t.rings.push(a),t.windings.push(l)):t.windings[u]+=l}n.rings=null,n.windings=null,n.consumedBy=t,n.leftSE.consumedBy=t.leftSE,n.rightSE.consumedBy=t.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const e=this.prev.consumedBy||this.prev;this._beforeState=e.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};const t=this._afterState.rings,n=this._afterState.windings,i=this._afterState.multiPolys;for(let a=0,l=this.rings.length;a<l;a++){const u=this.rings[a],f=this.windings[a],c=t.indexOf(u);c===-1?(t.push(u),n.push(f)):n[c]+=f}const o=[],s=[];for(let a=0,l=t.length;a<l;a++){if(n[a]===0)continue;const u=t[a],f=u.poly;if(s.indexOf(f)===-1)if(u.isExterior)o.push(f);else{s.indexOf(f)===-1&&s.push(f);const c=o.indexOf(u.poly);c!==-1&&o.splice(c,1)}}for(let a=0,l=o.length;a<l;a++){const u=o[a].multiPoly;i.indexOf(u)===-1&&i.push(u)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const e=this.beforeState().multiPolys,t=this.afterState().multiPolys;switch(ht.type){case"union":{const n=e.length===0,i=t.length===0;this._isInResult=n!==i;break}case"intersection":{let n,i;e.length<t.length?(n=e.length,i=t.length):(n=t.length,i=e.length),this._isInResult=i===ht.numMultiPolys&&n<i;break}case"xor":{const n=Math.abs(e.length-t.length);this._isInResult=n%2===1;break}case"difference":{const n=i=>i.length===1&&i[0].isSubject;this._isInResult=n(e)!==n(t);break}default:throw new Error(`Unrecognized operation type found ${ht.type}`)}return this._isInResult}};class Hl{constructor(e,t,n){if(!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=n,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const i=un.round(e[0][0],e[0][1]);this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};let o=i;for(let s=1,a=e.length;s<a;s++){if(typeof e[s][0]!="number"||typeof e[s][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let l=un.round(e[s][0],e[s][1]);l.x===o.x&&l.y===o.y||(this.segments.push(Li.fromRing(o,l,this)),l.x<this.bbox.ll.x&&(this.bbox.ll.x=l.x),l.y<this.bbox.ll.y&&(this.bbox.ll.y=l.y),l.x>this.bbox.ur.x&&(this.bbox.ur.x=l.x),l.y>this.bbox.ur.y&&(this.bbox.ur.y=l.y),o=l)}(i.x!==o.x||i.y!==o.y)&&this.segments.push(Li.fromRing(o,i,this))}getSweepEvents(){const e=[];for(let t=0,n=this.segments.length;t<n;t++){const i=this.segments[t];e.push(i.leftSE),e.push(i.rightSE)}return e}}class S_{constructor(e,t){if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new Hl(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let n=1,i=e.length;n<i;n++){const o=new Hl(e[n],this,!1);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.interiorRings.push(o)}this.multiPoly=t}getSweepEvents(){const e=this.exteriorRing.getSweepEvents();for(let t=0,n=this.interiorRings.length;t<n;t++){const i=this.interiorRings[t].getSweepEvents();for(let o=0,s=i.length;o<s;o++)e.push(i[o])}return e}}class Vl{constructor(e,t){if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(let n=0,i=e.length;n<i;n++){const o=new S_(e[n],this);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.polys.push(o)}this.isSubject=t}getSweepEvents(){const e=[];for(let t=0,n=this.polys.length;t<n;t++){const i=this.polys[t].getSweepEvents();for(let o=0,s=i.length;o<s;o++)e.push(i[o])}return e}}class Ai{static factory(e){const t=[];for(let n=0,i=e.length;n<i;n++){const o=e[n];if(!o.isInResult()||o.ringOut)continue;let s=null,a=o.leftSE,l=o.rightSE;const u=[a],f=a.point,c=[];for(;s=a,a=l,u.push(a),a.point!==f;)for(;;){const h=a.getAvailableLinkedEvents();if(h.length===0){const m=u[0].point,v=u[u.length-1].point;throw new Error(`Unable to complete output ring starting at [${m.x}, ${m.y}]. Last matching segment found ends at [${v.x}, ${v.y}].`)}if(h.length===1){l=h[0].otherSE;break}let p=null;for(let m=0,v=c.length;m<v;m++)if(c[m].point===a.point){p=m;break}if(p!==null){const m=c.splice(p)[0],v=u.splice(m.index);v.unshift(v[0].otherSE),t.push(new Ai(v.reverse()));continue}c.push({index:u.length,point:a.point});const g=a.getLeftmostComparator(s);l=h.sort(g)[0].otherSE;break}t.push(new Ai(u))}return t}constructor(e){this.events=e;for(let t=0,n=e.length;t<n;t++)e[t].segment.ringOut=this;this.poly=null}getGeom(){let e=this.events[0].point;const t=[e];for(let u=1,f=this.events.length-1;u<f;u++){const c=this.events[u].point,h=this.events[u+1].point;ql(c,e,h)!==0&&(t.push(c),e=c)}if(t.length===1)return null;const n=t[0],i=t[1];ql(n,e,i)===0&&t.shift(),t.push(t[0]);const o=this.isExteriorRing()?1:-1,s=this.isExteriorRing()?0:t.length-1,a=this.isExteriorRing()?t.length:-1,l=[];for(let u=s;u!=a;u+=o)l.push([t[u].x,t[u].y]);return l}isExteriorRing(){if(this._isExteriorRing===void 0){const e=this.enclosingRing();this._isExteriorRing=e?!e.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let e=this.events[0];for(let i=1,o=this.events.length;i<o;i++){const s=this.events[i];it.compare(e,s)>0&&(e=s)}let t=e.segment.prevInResult(),n=t?t.prevInResult():null;for(;;){if(!t)return null;if(!n)return t.ringOut;if(n.ringOut!==t.ringOut)return n.ringOut.enclosingRing()!==t.ringOut?t.ringOut:t.ringOut.enclosingRing();t=n.prevInResult(),n=t?t.prevInResult():null}}}class Jl{constructor(e){this.exteriorRing=e,e.poly=this,this.interiorRings=[]}addInterior(e){this.interiorRings.push(e),e.poly=this}getGeom(){const e=[this.exteriorRing.getGeom()];if(e[0]===null)return null;for(let t=0,n=this.interiorRings.length;t<n;t++){const i=this.interiorRings[t].getGeom();i!==null&&e.push(i)}return e}}class $_{constructor(e){this.rings=e,this.polys=this._composePolys(e)}getGeom(){const e=[];for(let t=0,n=this.polys.length;t<n;t++){const i=this.polys[t].getGeom();i!==null&&e.push(i)}return e}_composePolys(e){const t=[];for(let n=0,i=e.length;n<i;n++){const o=e[n];if(!o.poly)if(o.isExteriorRing())t.push(new Jl(o));else{const s=o.enclosingRing();s.poly||t.push(new Jl(s)),s.poly.addInterior(o)}}return t}}class k_{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Li.compare;this.queue=e,this.tree=new Bs(t),this.segments=[]}process(e){const t=e.segment,n=[];if(e.consumedBy)return e.isLeft?this.queue.remove(e.otherSE):this.tree.remove(t),n;const i=e.isLeft?this.tree.add(t):this.tree.find(t);if(!i)throw new Error(`Unable to find segment #${t.id} [${t.leftSE.point.x}, ${t.leftSE.point.y}] -> [${t.rightSE.point.x}, ${t.rightSE.point.y}] in SweepLine tree.`);let o=i,s=i,a,l;for(;a===void 0;)o=this.tree.prev(o),o===null?a=null:o.key.consumedBy===void 0&&(a=o.key);for(;l===void 0;)s=this.tree.next(s),s===null?l=null:s.key.consumedBy===void 0&&(l=s.key);if(e.isLeft){let u=null;if(a){const c=a.getIntersection(t);if(c!==null&&(t.isAnEndpoint(c)||(u=c),!a.isAnEndpoint(c))){const h=this._splitSafely(a,c);for(let p=0,g=h.length;p<g;p++)n.push(h[p])}}let f=null;if(l){const c=l.getIntersection(t);if(c!==null&&(t.isAnEndpoint(c)||(f=c),!l.isAnEndpoint(c))){const h=this._splitSafely(l,c);for(let p=0,g=h.length;p<g;p++)n.push(h[p])}}if(u!==null||f!==null){let c=null;u===null?c=f:f===null?c=u:c=it.comparePoints(u,f)<=0?u:f,this.queue.remove(t.rightSE),n.push(t.rightSE);const h=t.split(c);for(let p=0,g=h.length;p<g;p++)n.push(h[p])}n.length>0?(this.tree.remove(t),n.push(e)):(this.segments.push(t),t.prev=a)}else{if(a&&l){const u=a.getIntersection(l);if(u!==null){if(!a.isAnEndpoint(u)){const f=this._splitSafely(a,u);for(let c=0,h=f.length;c<h;c++)n.push(f[c])}if(!l.isAnEndpoint(u)){const f=this._splitSafely(l,u);for(let c=0,h=f.length;c<h;c++)n.push(f[c])}}}this.tree.remove(t)}return n}_splitSafely(e,t){this.tree.remove(e);const n=e.rightSE;this.queue.remove(n);const i=e.split(t);return i.push(n),e.consumedBy===void 0&&this.tree.add(e),i}}const Yl=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,E_=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6;class M_{run(e,t,n){ht.type=e,un.reset();const i=[new Vl(t,!0)];for(let c=0,h=n.length;c<h;c++)i.push(new Vl(n[c],!1));if(ht.numMultiPolys=i.length,ht.type==="difference"){const c=i[0];let h=1;for(;h<i.length;)Zo(i[h].bbox,c.bbox)!==null?h++:i.splice(h,1)}if(ht.type==="intersection")for(let c=0,h=i.length;c<h;c++){const p=i[c];for(let g=c+1,m=i.length;g<m;g++)if(Zo(p.bbox,i[g].bbox)===null)return[]}const o=new Bs(it.compare);for(let c=0,h=i.length;c<h;c++){const p=i[c].getSweepEvents();for(let g=0,m=p.length;g<m;g++)if(o.insert(p[g]),o.size>Yl)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big).")}const s=new k_(o);let a=o.size,l=o.pop();for(;l;){const c=l.key;if(o.size===a){const p=c.segment;throw new Error(`Unable to pop() ${c.isLeft?"left":"right"} SweepEvent [${c.point.x}, ${c.point.y}] from segment #${p.id} [${p.leftSE.point.x}, ${p.leftSE.point.y}] -> [${p.rightSE.point.x}, ${p.rightSE.point.y}] from queue.`)}if(o.size>Yl)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big).");if(s.segments.length>E_)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments).");const h=s.process(c);for(let p=0,g=h.length;p<g;p++){const m=h[p];m.consumedBy===void 0&&o.insert(m)}a=o.size,l=o.pop()}un.reset();const u=Ai.factory(s.segments);return new $_(u).getGeom()}}const ht=new M_,P_=function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return ht.run("union",r,t)},L_=function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return ht.run("intersection",r,t)},A_=function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return ht.run("xor",r,t)},C_=function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return ht.run("difference",r,t)};var Zn={union:P_,intersection:L_,xor:A_,difference:C_},O_=Object.defineProperty,Gi=(r,e)=>O_(r,"name",{value:e,configurable:!0});function gc(r,e){var t=dc(e),n=null;return r.type==="FeatureCollection"?n=mc(r):n=Is(Zn.union(r.geometry.coordinates)),n.geometry.coordinates.forEach(function(i){t.geometry.coordinates.push(i[0])}),t}Gi(gc,"mask");function mc(r){var e=r.features.length===2?Zn.union(r.features[0].geometry.coordinates,r.features[1].geometry.coordinates):Zn.union.apply(Zn,r.features.map(function(t){return t.geometry.coordinates}));return Is(e)}Gi(mc,"unionFc");function Is(r){return Os(r)}Gi(Is,"createGeomFromPolygonClippingOutput");function dc(r){var e=[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]],t=r&&r.geometry.coordinates||e;return Di(t)}Gi(dc,"createMask");var Xl=gc;function oe(r,e){return{id:e,beforeId:F_(r,e)}}function F_(r,e){let t=Op(et);if(!t){console.warn(`getBeforeId(${e}) called before map is ready. Z-ordering may be incorrect.`);return}let n,i=!1;for(let o=r.layerZorder.length-1;o>=0;o--){let s=r.layerZorder[o];if(s==e){i=!0;break}t.getLayer(s)&&(n=s)}if(!i)throw new Error(`Layer ID ${e} not defined in layerZorder`);return n}function yc(r,e,t){if(r!==null)for(var n,i,o,s,a,l,u,f=0,c=0,h,p=r.type,g=p==="FeatureCollection",m=p==="Feature",v=g?r.features.length:1,b=0;b<v;b++){u=g?r.features[b].geometry:m?r.geometry:r,h=u?u.type==="GeometryCollection":!1,a=h?u.geometries.length:1;for(var d=0;d<a;d++){var y=0,k=0;if(s=h?u.geometries[d]:u,s!==null){l=s.coordinates;var _=s.type;switch(f=t&&(_==="Polygon"||_==="MultiPolygon")?1:0,_){case null:break;case"Point":if(e(l,c,b,y,k)===!1)return!1;c++,y++;break;case"LineString":case"MultiPoint":for(n=0;n<l.length;n++){if(e(l[n],c,b,y,k)===!1)return!1;c++,_==="MultiPoint"&&y++}_==="LineString"&&y++;break;case"Polygon":case"MultiLineString":for(n=0;n<l.length;n++){for(i=0;i<l[n].length-f;i++){if(e(l[n][i],c,b,y,k)===!1)return!1;c++}_==="MultiLineString"&&y++,_==="Polygon"&&k++}_==="Polygon"&&y++;break;case"MultiPolygon":for(n=0;n<l.length;n++){for(k=0,i=0;i<l[n].length;i++){for(o=0;o<l[n][i].length-f;o++){if(e(l[n][i][o],c,b,y,k)===!1)return!1;c++}k++}y++}break;case"GeometryCollection":for(n=0;n<s.geometries.length;n++)if(yc(s.geometries[n],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function fn(r){var e=[1/0,1/0,-1/0,-1/0];return yc(r,function(t){e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])}),e}fn.default=fn;const R_=Object.freeze(Object.defineProperty({__proto__:null,default:fn},Symbol.toStringTag,{value:"Module"})),Zt=["==",["geometry-type"],"Polygon"],cn=["==",["geometry-type"],"LineString"],pn=["==",["geometry-type"],"Point"];function Mr(){return{type:"FeatureCollection",features:[]}}function Hr(r,e,t){let n=["match",r];for(let[i,o]of Object.entries(e))n.push(i),n.push(o);return n.push(t),n}function vc(r){return fn(r)}function B_(r){var t,n;let e={type:"FeatureCollection",features:[]};for(let i of r.features)if(e.features.push(i),i.geometry.type=="LineString"&&!((t=i.properties)!=null&&t.hide_while_editing))for(let o of[i.geometry.coordinates[0],i.geometry.coordinates[i.geometry.coordinates.length-1]])e.features.push({type:"Feature",properties:{endpoint:!0,scheme_reference:(n=i.properties)==null?void 0:n.scheme_reference},geometry:{type:"Point",coordinates:o}});return e}function I_(r){let e,t;const n=[oe(r[0],"boundary"),{paint:{"fill-color":"black","fill-opacity":.5}}];let i={};for(let o=0;o<n.length;o+=1)i=he(i,n[o]);return e=new vn({props:i}),{c(){L(e.$$.fragment)},m(o,s){A(e,o,s),t=!0},p(o,s){const a=s&1?we(n,[Ce(oe(o[0],"boundary")),n[1]]):{};e.$set(a)},i(o){t||($(e.$$.fragment,o),t=!0)},o(o){E(e.$$.fragment,o),t=!1},d(o){C(e,o)}}}function N_(r){let e,t;return e=new rr({props:{data:Xl(r[1]),$$slots:{default:[I_]},$$scope:{ctx:r}}}),{c(){L(e.$$.fragment)},m(n,i){A(e,n,i),t=!0},p(n,[i]){const o={};i&2&&(o.data=Xl(n[1])),i&17&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){E(e.$$.fragment,n),t=!1},d(n){C(e,n)}}}function T_(r,e,t){let n;J(r,et,a=>t(3,n=a));let{cfg:i}=e,{boundaryGeojson:o}=e,{fitBoundsAtStart:s=!1}=e;return(Fp("setCamera")||s)&&(n==null||n.fitBounds(vc(o),{padding:20,animate:!1})),r.$$set=a=>{"cfg"in a&&t(0,i=a.cfg),"boundaryGeojson"in a&&t(1,o=a.boundaryGeojson),"fitBoundsAtStart"in a&&t(2,s=a.fitBoundsAtStart)},[i,o,s]}class D_ extends Z{constructor(e){super(),Q(this,e,T_,N_,K,{cfg:0,boundaryGeojson:1,fitBoundsAtStart:2})}}class j_{constructor(e){ce(this,"map");ce(this,"active");ce(this,"eventListenersSuccess");ce(this,"eventListenersFailure");ce(this,"cursor");ce(this,"onMouseMove",e=>{this.active&&(this.cursor={type:"Feature",properties:{},geometry:{type:"Point",coordinates:Hc(e.lngLat.toArray())}})});ce(this,"onClick",()=>{if(this.active&&this.cursor){for(let e of this.eventListenersSuccess)e(this.cursor);this.stop()}});ce(this,"onKeyDown",e=>{this.active&&e.key=="Escape"&&(e.stopPropagation(),this.cancel())});this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersFailure=[],this.cursor=null,this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),document.addEventListener("keydown",this.onKeyDown)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),document.removeEventListener("keydown",this.onKeyDown)}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersFailure=[]}start(){this.map.getCanvas().style.cursor="crosshair",this.active=!0}stop(){this.map.getCanvas().style.cursor="inherit",this.cursor=null,this.active=!1}}var Je=63710088e-1,_c={centimeters:Je*100,centimetres:Je*100,degrees:Je/111325,feet:Je*3.28084,inches:Je*39.37,kilometers:Je/1e3,kilometres:Je/1e3,meters:Je,metres:Je,miles:Je/1609.344,millimeters:Je*1e3,millimetres:Je*1e3,nauticalmiles:Je/1852,radians:1,yards:Je*1.0936};function Pr(r,e,t){t===void 0&&(t={});var n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=r,n}function Qr(r,e,t){if(t===void 0&&(t={}),!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Ql(r[0])||!Ql(r[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:r};return Pr(n,e,t)}function Kl(r,e,t){if(t===void 0&&(t={}),r.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:r};return Pr(n,e,t)}function Zl(r,e){e===void 0&&(e={});var t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=r,t}function G_(r,e){e===void 0&&(e="kilometers");var t=_c[e];if(!t)throw new Error(e+" units is invalid");return r*t}function U_(r,e){e===void 0&&(e="kilometers");var t=_c[e];if(!t)throw new Error(e+" units is invalid");return r/t}function Qo(r){var e=r%(2*Math.PI);return e*180/Math.PI}function gt(r){var e=r%360;return e*Math.PI/180}function Ql(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}function hn(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return r.geometry.coordinates;if(r.type==="Point")return r.coordinates}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return r;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Ci(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function bc(r,e,t){if(t===void 0&&(t={}),t.final===!0)return q_(r,e);var n=hn(r),i=hn(e),o=gt(n[0]),s=gt(i[0]),a=gt(n[1]),l=gt(i[1]),u=Math.sin(s-o)*Math.cos(l),f=Math.cos(a)*Math.sin(l)-Math.sin(a)*Math.cos(l)*Math.cos(s-o);return Qo(Math.atan2(u,f))}function q_(r,e){var t=bc(e,r);return t=(t+180)%360,t}function Gr(r,e,t){t===void 0&&(t={});var n=hn(r),i=hn(e),o=gt(i[1]-n[1]),s=gt(i[0]-n[0]),a=gt(n[1]),l=gt(i[1]),u=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(a)*Math.cos(l);return G_(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)),t.units)}function xl(r,e,t,n){n===void 0&&(n={});var i=hn(r),o=gt(i[0]),s=gt(i[1]),a=gt(t),l=U_(e,n.units),u=Math.asin(Math.sin(s)*Math.cos(l)+Math.cos(s)*Math.sin(l)*Math.cos(a)),f=o+Math.atan2(Math.sin(a)*Math.sin(l)*Math.cos(s),Math.cos(l)-Math.sin(s)*Math.sin(u)),c=Qo(f),h=Qo(u);return Qr([c,h],n.properties)}function xo(r,e,t){t===void 0&&(t={});var n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=r,n}function z_(r,e,t){if(t===void 0&&(t={}),r.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:r};return xo(n,e,t)}function W_(r,e){e===void 0&&(e={});var t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=r,t}function eu(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function H_(r,e){var t,n,i,o,s,a,l,u,f,c,h=0,p=r.type==="FeatureCollection",g=r.type==="Feature",m=p?r.features.length:1;for(t=0;t<m;t++){for(a=p?r.features[t].geometry:g?r.geometry:r,u=p?r.features[t].properties:g?r.properties:{},f=p?r.features[t].bbox:g?r.bbox:void 0,c=p?r.features[t].id:g?r.id:void 0,l=a?a.type==="GeometryCollection":!1,s=l?a.geometries.length:1,i=0;i<s;i++){if(o=l?a.geometries[i]:a,o===null){if(e(null,h,u,f,c)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(o,h,u,f,c)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<o.geometries.length;n++)if(e(o.geometries[n],h,u,f,c)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}h++}}function V_(r,e){H_(r,function(t,n,i,o,s){var a=t===null?null:t.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return e(xo(t,i,{bbox:o,id:s}),n,0)===!1?!1:void 0}var l;switch(a){case"MultiPoint":l="Point";break;case"MultiLineString":l="LineString";break;case"MultiPolygon":l="Polygon";break}for(var u=0;u<t.coordinates.length;u++){var f=t.coordinates[u],c={type:l,coordinates:f};if(e(xo(c,i),n,u)===!1)return!1}})}function nr(r){if(!r)throw new Error("geojson is required");var e=[];return V_(r,function(t){J_(t,e)}),W_(e)}function J_(r,e){var t=[],n=r.geometry;if(n!==null){switch(n.type){case"Polygon":t=eu(n);break;case"LineString":t=[eu(n)]}t.forEach(function(i){var o=Y_(i,r.properties);o.forEach(function(s){s.id=e.length,e.push(s)})})}}function Y_(r,e){var t=[];return r.reduce(function(n,i){var o=z_([n,i],e);return o.bbox=X_(n,i),t.push(o),i}),t}function X_(r,e){var t=r[0],n=r[1],i=e[0],o=e[1],s=t<i?t:i,a=n<o?n:o,l=t>i?t:i,u=n>o?n:o;return[s,a,l,u]}function tu(r,e){if(r.type==="Feature")e(r,0);else if(r.type==="FeatureCollection")for(var t=0;t<r.features.length&&e(r.features[t],t)!==!1;t++);}function K_(r,e){var t,n,i,o,s,a,l,u,f,c,h=0,p=r.type==="FeatureCollection",g=r.type==="Feature",m=p?r.features.length:1;for(t=0;t<m;t++){for(a=p?r.features[t].geometry:g?r.geometry:r,u=p?r.features[t].properties:g?r.properties:{},f=p?r.features[t].bbox:g?r.bbox:void 0,c=p?r.features[t].id:g?r.id:void 0,l=a?a.type==="GeometryCollection":!1,s=l?a.geometries.length:1,i=0;i<s;i++){if(o=l?a.geometries[i]:a,o===null){if(e(null,h,u,f,c)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(o,h,u,f,c)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<o.geometries.length;n++)if(e(o.geometries[n],h,u,f,c)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}h++}}function Z_(r,e){K_(r,function(t,n,i,o,s){var a=t===null?null:t.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return e(Pr(t,i,{bbox:o,id:s}),n,0)===!1?!1:void 0}var l;switch(a){case"MultiPoint":l="Point";break;case"MultiLineString":l="LineString";break;case"MultiPolygon":l="Polygon";break}for(var u=0;u<t.coordinates.length;u++){var f=t.coordinates[u],c={type:l,coordinates:f};if(e(Pr(c,i),n,u)===!1)return!1}})}var Ns={exports:{}},wc={exports:{}};(function(r,e){(function(t,n){r.exports=n()})(sn,function(){function t(d,y,k,_,M){(function F(I,U,W,O,P){for(;O>W;){if(O-W>600){var R=O-W+1,q=U-W+1,se=Math.log(R),ie=.5*Math.exp(2*se/3),H=.5*Math.sqrt(se*ie*(R-ie)/R)*(q-R/2<0?-1:1),D=Math.max(W,Math.floor(U-q*ie/R+H)),ge=Math.min(O,Math.floor(U+(R-q)*ie/R+H));F(I,U,D,ge,P)}var ye=I[U],rt=W,Ue=O;for(n(I,W,U),P(I[O],ye)>0&&n(I,W,O);rt<Ue;){for(n(I,rt,Ue),rt++,Ue--;P(I[rt],ye)<0;)rt++;for(;P(I[Ue],ye)>0;)Ue--}P(I[W],ye)===0?n(I,W,Ue):n(I,++Ue,O),Ue<=U&&(W=Ue+1),U<=Ue&&(O=Ue-1)}})(d,y,k||0,_||d.length-1,M||i)}function n(d,y,k){var _=d[y];d[y]=d[k],d[k]=_}function i(d,y){return d<y?-1:d>y?1:0}var o=function(d){d===void 0&&(d=9),this._maxEntries=Math.max(4,d),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function s(d,y,k){if(!k)return y.indexOf(d);for(var _=0;_<y.length;_++)if(k(d,y[_]))return _;return-1}function a(d,y){l(d,0,d.children.length,y,d)}function l(d,y,k,_,M){M||(M=v(null)),M.minX=1/0,M.minY=1/0,M.maxX=-1/0,M.maxY=-1/0;for(var F=y;F<k;F++){var I=d.children[F];u(M,d.leaf?_(I):I)}return M}function u(d,y){return d.minX=Math.min(d.minX,y.minX),d.minY=Math.min(d.minY,y.minY),d.maxX=Math.max(d.maxX,y.maxX),d.maxY=Math.max(d.maxY,y.maxY),d}function f(d,y){return d.minX-y.minX}function c(d,y){return d.minY-y.minY}function h(d){return(d.maxX-d.minX)*(d.maxY-d.minY)}function p(d){return d.maxX-d.minX+(d.maxY-d.minY)}function g(d,y){return d.minX<=y.minX&&d.minY<=y.minY&&y.maxX<=d.maxX&&y.maxY<=d.maxY}function m(d,y){return y.minX<=d.maxX&&y.minY<=d.maxY&&y.maxX>=d.minX&&y.maxY>=d.minY}function v(d){return{children:d,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function b(d,y,k,_,M){for(var F=[y,k];F.length;)if(!((k=F.pop())-(y=F.pop())<=_)){var I=y+Math.ceil((k-y)/_/2)*_;t(d,I,y,k,M),F.push(y,I,I,k)}}return o.prototype.all=function(){return this._all(this.data,[])},o.prototype.search=function(d){var y=this.data,k=[];if(!m(d,y))return k;for(var _=this.toBBox,M=[];y;){for(var F=0;F<y.children.length;F++){var I=y.children[F],U=y.leaf?_(I):I;m(d,U)&&(y.leaf?k.push(I):g(d,U)?this._all(I,k):M.push(I))}y=M.pop()}return k},o.prototype.collides=function(d){var y=this.data;if(!m(d,y))return!1;for(var k=[];y;){for(var _=0;_<y.children.length;_++){var M=y.children[_],F=y.leaf?this.toBBox(M):M;if(m(d,F)){if(y.leaf||g(d,F))return!0;k.push(M)}}y=k.pop()}return!1},o.prototype.load=function(d){if(!d||!d.length)return this;if(d.length<this._minEntries){for(var y=0;y<d.length;y++)this.insert(d[y]);return this}var k=this._build(d.slice(),0,d.length-1,0);if(this.data.children.length)if(this.data.height===k.height)this._splitRoot(this.data,k);else{if(this.data.height<k.height){var _=this.data;this.data=k,k=_}this._insert(k,this.data.height-k.height-1,!0)}else this.data=k;return this},o.prototype.insert=function(d){return d&&this._insert(d,this.data.height-1),this},o.prototype.clear=function(){return this.data=v([]),this},o.prototype.remove=function(d,y){if(!d)return this;for(var k,_,M,F=this.data,I=this.toBBox(d),U=[],W=[];F||U.length;){if(F||(F=U.pop(),_=U[U.length-1],k=W.pop(),M=!0),F.leaf){var O=s(d,F.children,y);if(O!==-1)return F.children.splice(O,1),U.push(F),this._condense(U),this}M||F.leaf||!g(F,I)?_?(k++,F=_.children[k],M=!1):F=null:(U.push(F),W.push(k),k=0,_=F,F=F.children[0])}return this},o.prototype.toBBox=function(d){return d},o.prototype.compareMinX=function(d,y){return d.minX-y.minX},o.prototype.compareMinY=function(d,y){return d.minY-y.minY},o.prototype.toJSON=function(){return this.data},o.prototype.fromJSON=function(d){return this.data=d,this},o.prototype._all=function(d,y){for(var k=[];d;)d.leaf?y.push.apply(y,d.children):k.push.apply(k,d.children),d=k.pop();return y},o.prototype._build=function(d,y,k,_){var M,F=k-y+1,I=this._maxEntries;if(F<=I)return a(M=v(d.slice(y,k+1)),this.toBBox),M;_||(_=Math.ceil(Math.log(F)/Math.log(I)),I=Math.ceil(F/Math.pow(I,_-1))),(M=v([])).leaf=!1,M.height=_;var U=Math.ceil(F/I),W=U*Math.ceil(Math.sqrt(I));b(d,y,k,W,this.compareMinX);for(var O=y;O<=k;O+=W){var P=Math.min(O+W-1,k);b(d,O,P,U,this.compareMinY);for(var R=O;R<=P;R+=U){var q=Math.min(R+U-1,P);M.children.push(this._build(d,R,q,_-1))}}return a(M,this.toBBox),M},o.prototype._chooseSubtree=function(d,y,k,_){for(;_.push(y),!y.leaf&&_.length-1!==k;){for(var M=1/0,F=1/0,I=void 0,U=0;U<y.children.length;U++){var W=y.children[U],O=h(W),P=(R=d,q=W,(Math.max(q.maxX,R.maxX)-Math.min(q.minX,R.minX))*(Math.max(q.maxY,R.maxY)-Math.min(q.minY,R.minY))-O);P<F?(F=P,M=O<M?O:M,I=W):P===F&&O<M&&(M=O,I=W)}y=I||y.children[0]}var R,q;return y},o.prototype._insert=function(d,y,k){var _=k?d:this.toBBox(d),M=[],F=this._chooseSubtree(_,this.data,y,M);for(F.children.push(d),u(F,_);y>=0&&M[y].children.length>this._maxEntries;)this._split(M,y),y--;this._adjustParentBBoxes(_,M,y)},o.prototype._split=function(d,y){var k=d[y],_=k.children.length,M=this._minEntries;this._chooseSplitAxis(k,M,_);var F=this._chooseSplitIndex(k,M,_),I=v(k.children.splice(F,k.children.length-F));I.height=k.height,I.leaf=k.leaf,a(k,this.toBBox),a(I,this.toBBox),y?d[y-1].children.push(I):this._splitRoot(k,I)},o.prototype._splitRoot=function(d,y){this.data=v([d,y]),this.data.height=d.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},o.prototype._chooseSplitIndex=function(d,y,k){for(var _,M,F,I,U,W,O,P=1/0,R=1/0,q=y;q<=k-y;q++){var se=l(d,0,q,this.toBBox),ie=l(d,q,k,this.toBBox),H=(M=se,F=ie,I=void 0,U=void 0,W=void 0,O=void 0,I=Math.max(M.minX,F.minX),U=Math.max(M.minY,F.minY),W=Math.min(M.maxX,F.maxX),O=Math.min(M.maxY,F.maxY),Math.max(0,W-I)*Math.max(0,O-U)),D=h(se)+h(ie);H<P?(P=H,_=q,R=D<R?D:R):H===P&&D<R&&(R=D,_=q)}return _||k-y},o.prototype._chooseSplitAxis=function(d,y,k){var _=d.leaf?this.compareMinX:f,M=d.leaf?this.compareMinY:c;this._allDistMargin(d,y,k,_)<this._allDistMargin(d,y,k,M)&&d.children.sort(_)},o.prototype._allDistMargin=function(d,y,k,_){d.children.sort(_);for(var M=this.toBBox,F=l(d,0,y,M),I=l(d,k-y,k,M),U=p(F)+p(I),W=y;W<k-y;W++){var O=d.children[W];u(F,d.leaf?M(O):O),U+=p(F)}for(var P=k-y-1;P>=y;P--){var R=d.children[P];u(I,d.leaf?M(R):R),U+=p(I)}return U},o.prototype._adjustParentBBoxes=function(d,y,k){for(var _=k;_>=0;_--)u(y[_],d)},o.prototype._condense=function(d){for(var y=d.length-1,k=void 0;y>=0;y--)d[y].children.length===0?y>0?(k=d[y-1].children).splice(k.indexOf(d[y]),1):this.clear():a(d[y],this.toBBox)},o})})(wc);var Q_=wc.exports,Ts={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.earthRadius=63710088e-1,r.factors={centimeters:r.earthRadius*100,centimetres:r.earthRadius*100,degrees:r.earthRadius/111325,feet:r.earthRadius*3.28084,inches:r.earthRadius*39.37,kilometers:r.earthRadius/1e3,kilometres:r.earthRadius/1e3,meters:r.earthRadius,metres:r.earthRadius,miles:r.earthRadius/1609.344,millimeters:r.earthRadius*1e3,millimetres:r.earthRadius*1e3,nauticalmiles:r.earthRadius/1852,radians:1,yards:r.earthRadius*1.0936},r.unitsFactors={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/r.earthRadius,yards:1.0936133},r.areaFactors={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function e(O,P,R){R===void 0&&(R={});var q={type:"Feature"};return(R.id===0||R.id)&&(q.id=R.id),R.bbox&&(q.bbox=R.bbox),q.properties=P||{},q.geometry=O,q}r.feature=e;function t(O,P,R){switch(O){case"Point":return n(P).geometry;case"LineString":return a(P).geometry;case"Polygon":return o(P).geometry;case"MultiPoint":return c(P).geometry;case"MultiLineString":return f(P).geometry;case"MultiPolygon":return h(P).geometry;default:throw new Error(O+" is invalid")}}r.geometry=t;function n(O,P,R){if(R===void 0&&(R={}),!O)throw new Error("coordinates is required");if(!Array.isArray(O))throw new Error("coordinates must be an Array");if(O.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!F(O[0])||!F(O[1]))throw new Error("coordinates must contain numbers");var q={type:"Point",coordinates:O};return e(q,P,R)}r.point=n;function i(O,P,R){return R===void 0&&(R={}),u(O.map(function(q){return n(q,P)}),R)}r.points=i;function o(O,P,R){R===void 0&&(R={});for(var q=0,se=O;q<se.length;q++){var ie=se[q];if(ie.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var H=0;H<ie[ie.length-1].length;H++)if(ie[ie.length-1][H]!==ie[0][H])throw new Error("First and last Position are not equivalent.")}var D={type:"Polygon",coordinates:O};return e(D,P,R)}r.polygon=o;function s(O,P,R){return R===void 0&&(R={}),u(O.map(function(q){return o(q,P)}),R)}r.polygons=s;function a(O,P,R){if(R===void 0&&(R={}),O.length<2)throw new Error("coordinates must be an array of two or more positions");var q={type:"LineString",coordinates:O};return e(q,P,R)}r.lineString=a;function l(O,P,R){return R===void 0&&(R={}),u(O.map(function(q){return a(q,P)}),R)}r.lineStrings=l;function u(O,P){P===void 0&&(P={});var R={type:"FeatureCollection"};return P.id&&(R.id=P.id),P.bbox&&(R.bbox=P.bbox),R.features=O,R}r.featureCollection=u;function f(O,P,R){R===void 0&&(R={});var q={type:"MultiLineString",coordinates:O};return e(q,P,R)}r.multiLineString=f;function c(O,P,R){R===void 0&&(R={});var q={type:"MultiPoint",coordinates:O};return e(q,P,R)}r.multiPoint=c;function h(O,P,R){R===void 0&&(R={});var q={type:"MultiPolygon",coordinates:O};return e(q,P,R)}r.multiPolygon=h;function p(O,P,R){R===void 0&&(R={});var q={type:"GeometryCollection",geometries:O};return e(q,P,R)}r.geometryCollection=p;function g(O,P){if(P===void 0&&(P=0),P&&!(P>=0))throw new Error("precision must be a positive number");var R=Math.pow(10,P||0);return Math.round(O*R)/R}r.round=g;function m(O,P){P===void 0&&(P="kilometers");var R=r.factors[P];if(!R)throw new Error(P+" units is invalid");return O*R}r.radiansToLength=m;function v(O,P){P===void 0&&(P="kilometers");var R=r.factors[P];if(!R)throw new Error(P+" units is invalid");return O/R}r.lengthToRadians=v;function b(O,P){return y(v(O,P))}r.lengthToDegrees=b;function d(O){var P=O%360;return P<0&&(P+=360),P}r.bearingToAzimuth=d;function y(O){var P=O%(2*Math.PI);return P*180/Math.PI}r.radiansToDegrees=y;function k(O){var P=O%360;return P*Math.PI/180}r.degreesToRadians=k;function _(O,P,R){if(P===void 0&&(P="kilometers"),R===void 0&&(R="kilometers"),!(O>=0))throw new Error("length must be a positive number");return m(v(O,P),R)}r.convertLength=_;function M(O,P,R){if(P===void 0&&(P="meters"),R===void 0&&(R="kilometers"),!(O>=0))throw new Error("area must be a positive number");var q=r.areaFactors[P];if(!q)throw new Error("invalid original units");var se=r.areaFactors[R];if(!se)throw new Error("invalid final units");return O/q*se}r.convertArea=M;function F(O){return!isNaN(O)&&O!==null&&!Array.isArray(O)}r.isNumber=F;function I(O){return!!O&&O.constructor===Object}r.isObject=I;function U(O){if(!O)throw new Error("bbox is required");if(!Array.isArray(O))throw new Error("bbox must be an Array");if(O.length!==4&&O.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");O.forEach(function(P){if(!F(P))throw new Error("bbox must only contain numbers")})}r.validateBBox=U;function W(O){if(!O)throw new Error("id is required");if(["string","number"].indexOf(typeof O)===-1)throw new Error("id must be a number or a string")}r.validateId=W})(Ts);var ke={};Object.defineProperty(ke,"__esModule",{value:!0});var Ie=Ts;function Sn(r,e,t){if(r!==null)for(var n,i,o,s,a,l,u,f=0,c=0,h,p=r.type,g=p==="FeatureCollection",m=p==="Feature",v=g?r.features.length:1,b=0;b<v;b++){u=g?r.features[b].geometry:m?r.geometry:r,h=u?u.type==="GeometryCollection":!1,a=h?u.geometries.length:1;for(var d=0;d<a;d++){var y=0,k=0;if(s=h?u.geometries[d]:u,s!==null){l=s.coordinates;var _=s.type;switch(f=t&&(_==="Polygon"||_==="MultiPolygon")?1:0,_){case null:break;case"Point":if(e(l,c,b,y,k)===!1)return!1;c++,y++;break;case"LineString":case"MultiPoint":for(n=0;n<l.length;n++){if(e(l[n],c,b,y,k)===!1)return!1;c++,_==="MultiPoint"&&y++}_==="LineString"&&y++;break;case"Polygon":case"MultiLineString":for(n=0;n<l.length;n++){for(i=0;i<l[n].length-f;i++){if(e(l[n][i],c,b,y,k)===!1)return!1;c++}_==="MultiLineString"&&y++,_==="Polygon"&&k++}_==="Polygon"&&y++;break;case"MultiPolygon":for(n=0;n<l.length;n++){for(k=0,i=0;i<l[n].length;i++){for(o=0;o<l[n][i].length-f;o++){if(e(l[n][i][o],c,b,y,k)===!1)return!1;c++}k++}y++}break;case"GeometryCollection":for(n=0;n<s.geometries.length;n++)if(Sn(s.geometries[n],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function x_(r,e,t,n){var i=t;return Sn(r,function(o,s,a,l,u){s===0&&t===void 0?i=o:i=e(i,o,s,a,l,u)},n),i}function Sc(r,e){var t;switch(r.type){case"FeatureCollection":for(t=0;t<r.features.length&&e(r.features[t].properties,t)!==!1;t++);break;case"Feature":e(r.properties,0);break}}function e0(r,e,t){var n=t;return Sc(r,function(i,o){o===0&&t===void 0?n=i:n=e(n,i,o)}),n}function $c(r,e){if(r.type==="Feature")e(r,0);else if(r.type==="FeatureCollection")for(var t=0;t<r.features.length&&e(r.features[t],t)!==!1;t++);}function t0(r,e,t){var n=t;return $c(r,function(i,o){o===0&&t===void 0?n=i:n=e(n,i,o)}),n}function r0(r){var e=[];return Sn(r,function(t){e.push(t)}),e}function Ds(r,e){var t,n,i,o,s,a,l,u,f,c,h=0,p=r.type==="FeatureCollection",g=r.type==="Feature",m=p?r.features.length:1;for(t=0;t<m;t++){for(a=p?r.features[t].geometry:g?r.geometry:r,u=p?r.features[t].properties:g?r.properties:{},f=p?r.features[t].bbox:g?r.bbox:void 0,c=p?r.features[t].id:g?r.id:void 0,l=a?a.type==="GeometryCollection":!1,s=l?a.geometries.length:1,i=0;i<s;i++){if(o=l?a.geometries[i]:a,o===null){if(e(null,h,u,f,c)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(o,h,u,f,c)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<o.geometries.length;n++)if(e(o.geometries[n],h,u,f,c)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}h++}}function n0(r,e,t){var n=t;return Ds(r,function(i,o,s,a,l){o===0&&t===void 0?n=i:n=e(n,i,o,s,a,l)}),n}function Ui(r,e){Ds(r,function(t,n,i,o,s){var a=t===null?null:t.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return e(Ie.feature(t,i,{bbox:o,id:s}),n,0)===!1?!1:void 0}var l;switch(a){case"MultiPoint":l="Point";break;case"MultiLineString":l="LineString";break;case"MultiPolygon":l="Polygon";break}for(var u=0;u<t.coordinates.length;u++){var f=t.coordinates[u],c={type:l,coordinates:f};if(e(Ie.feature(c,i),n,u)===!1)return!1}})}function i0(r,e,t){var n=t;return Ui(r,function(i,o,s){o===0&&s===0&&t===void 0?n=i:n=e(n,i,o,s)}),n}function kc(r,e){Ui(r,function(t,n,i){var o=0;if(t.geometry){var s=t.geometry.type;if(!(s==="Point"||s==="MultiPoint")){var a,l=0,u=0,f=0;if(Sn(t,function(c,h,p,g,m){if(a===void 0||n>l||g>u||m>f){a=c,l=n,u=g,f=m,o=0;return}var v=Ie.lineString([a,c],t.properties);if(e(v,n,i,m,o)===!1)return!1;o++,a=c})===!1)return!1}}})}function o0(r,e,t){var n=t,i=!1;return kc(r,function(o,s,a,l,u){i===!1&&t===void 0?n=o:n=e(n,o,s,a,l,u),i=!0}),n}function Ec(r,e){if(!r)throw new Error("geojson is required");Ui(r,function(t,n,i){if(t.geometry!==null){var o=t.geometry.type,s=t.geometry.coordinates;switch(o){case"LineString":if(e(t,n,i,0,0)===!1)return!1;break;case"Polygon":for(var a=0;a<s.length;a++)if(e(Ie.lineString(s[a],t.properties),n,i,a)===!1)return!1;break}}})}function s0(r,e,t){var n=t;return Ec(r,function(i,o,s,a){o===0&&t===void 0?n=i:n=e(n,i,o,s,a)}),n}function a0(r,e){if(e=e||{},!Ie.isObject(e))throw new Error("options is invalid");var t=e.featureIndex||0,n=e.multiFeatureIndex||0,i=e.geometryIndex||0,o=e.segmentIndex||0,s=e.properties,a;switch(r.type){case"FeatureCollection":t<0&&(t=r.features.length+t),s=s||r.features[t].properties,a=r.features[t].geometry;break;case"Feature":s=s||r.properties,a=r.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":a=r;break;default:throw new Error("geojson is invalid")}if(a===null)return null;var l=a.coordinates;switch(a.type){case"Point":case"MultiPoint":return null;case"LineString":return o<0&&(o=l.length+o-1),Ie.lineString([l[o],l[o+1]],s,e);case"Polygon":return i<0&&(i=l.length+i),o<0&&(o=l[i].length+o-1),Ie.lineString([l[i][o],l[i][o+1]],s,e);case"MultiLineString":return n<0&&(n=l.length+n),o<0&&(o=l[n].length+o-1),Ie.lineString([l[n][o],l[n][o+1]],s,e);case"MultiPolygon":return n<0&&(n=l.length+n),i<0&&(i=l[n].length+i),o<0&&(o=l[n][i].length-o-1),Ie.lineString([l[n][i][o],l[n][i][o+1]],s,e)}throw new Error("geojson is invalid")}function l0(r,e){if(e=e||{},!Ie.isObject(e))throw new Error("options is invalid");var t=e.featureIndex||0,n=e.multiFeatureIndex||0,i=e.geometryIndex||0,o=e.coordIndex||0,s=e.properties,a;switch(r.type){case"FeatureCollection":t<0&&(t=r.features.length+t),s=s||r.features[t].properties,a=r.features[t].geometry;break;case"Feature":s=s||r.properties,a=r.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":a=r;break;default:throw new Error("geojson is invalid")}if(a===null)return null;var l=a.coordinates;switch(a.type){case"Point":return Ie.point(l,s,e);case"MultiPoint":return n<0&&(n=l.length+n),Ie.point(l[n],s,e);case"LineString":return o<0&&(o=l.length+o),Ie.point(l[o],s,e);case"Polygon":return i<0&&(i=l.length+i),o<0&&(o=l[i].length+o),Ie.point(l[i][o],s,e);case"MultiLineString":return n<0&&(n=l.length+n),o<0&&(o=l[n].length+o),Ie.point(l[n][o],s,e);case"MultiPolygon":return n<0&&(n=l.length+n),i<0&&(i=l[n].length+i),o<0&&(o=l[n][i].length-o),Ie.point(l[n][i][o],s,e)}throw new Error("geojson is invalid")}ke.coordAll=r0;ke.coordEach=Sn;ke.coordReduce=x_;ke.featureEach=$c;ke.featureReduce=t0;ke.findPoint=l0;ke.findSegment=a0;ke.flattenEach=Ui;ke.flattenReduce=i0;ke.geomEach=Ds;ke.geomReduce=n0;ke.lineEach=Ec;ke.lineReduce=s0;ke.propEach=Sc;ke.propReduce=e0;ke.segmentEach=kc;ke.segmentReduce=o0;const u0=tf(R_);var vt=Q_,Mc=Ts,Pc=ke,pr=u0.default,f0=Pc.featureEach;Pc.coordEach;Mc.polygon;var ru=Mc.featureCollection;function Lc(r){var e=new vt(r);return e.insert=function(t){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:pr(t),vt.prototype.insert.call(this,t)},e.load=function(t){var n=[];return Array.isArray(t)?t.forEach(function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:pr(i),n.push(i)}):f0(t,function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:pr(i),n.push(i)}),vt.prototype.load.call(this,n)},e.remove=function(t,n){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:pr(t),vt.prototype.remove.call(this,t,n)},e.clear=function(){return vt.prototype.clear.call(this)},e.search=function(t){var n=vt.prototype.search.call(this,this.toBBox(t));return ru(n)},e.collides=function(t){return vt.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=vt.prototype.all.call(this);return ru(t)},e.toJSON=function(){return vt.prototype.toJSON.call(this)},e.fromJSON=function(t){return vt.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var n;if(t.bbox)n=t.bbox;else if(Array.isArray(t)&&t.length===4)n=t;else if(Array.isArray(t)&&t.length===6)n=[t[0],t[1],t[3],t[4]];else if(t.type==="Feature")n=pr(t);else if(t.type==="FeatureCollection")n=pr(t);else throw new Error("invalid geojson");return{minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]}},e}Ns.exports=Lc;Ns.exports.default=Lc;var c0=Ns.exports;const $n=rf(c0);function p0(r,e){var t={},n=[];if(r.type==="LineString"&&(r=Pr(r)),e.type==="LineString"&&(e=Pr(e)),r.type==="Feature"&&e.type==="Feature"&&r.geometry!==null&&e.geometry!==null&&r.geometry.type==="LineString"&&e.geometry.type==="LineString"&&r.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var i=nu(r,e);return i&&n.push(i),Zl(n)}var o=$n();return o.load(nr(e)),tu(nr(r),function(s){tu(o.search(s),function(a){var l=nu(s,a);if(l){var u=Ci(l).join(",");t[u]||(t[u]=!0,n.push(l))}})}),Zl(n)}function nu(r,e){var t=Ci(r),n=Ci(e);if(t.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(n.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var i=t[0][0],o=t[0][1],s=t[1][0],a=t[1][1],l=n[0][0],u=n[0][1],f=n[1][0],c=n[1][1],h=(c-u)*(s-i)-(f-l)*(a-o),p=(f-l)*(o-u)-(c-u)*(i-l),g=(s-i)*(o-u)-(a-o)*(i-l);if(h===0)return null;var m=p/h,v=g/h;if(m>=0&&m<=1&&v>=0&&v<=1){var b=i+m*(s-i),d=o+m*(a-o);return Qr([b,d])}return null}function h0(r,e,t){t===void 0&&(t={});var n=Qr([1/0,1/0],{dist:1/0}),i=0;return Z_(r,function(o){for(var s=Ci(o),a=0;a<s.length-1;a++){var l=Qr(s[a]);l.properties.dist=Gr(e,l,t);var u=Qr(s[a+1]);u.properties.dist=Gr(e,u,t);var f=Gr(l,u,t),c=Math.max(l.properties.dist,u.properties.dist),h=bc(l,u),p=xl(e,c,h+90,t),g=xl(e,c,h-90,t),m=p0(Kl([p.geometry.coordinates,g.geometry.coordinates]),Kl([l.geometry.coordinates,u.geometry.coordinates])),v=null;m.features.length>0&&(v=m.features[0],v.properties.dist=Gr(e,v,t),v.properties.location=i+Gr(l,v,t)),l.properties.dist<n.properties.dist&&(n=l,n.properties.index=a,n.properties.location=i),u.properties.dist<n.properties.dist&&(n=u,n.properties.index=a+1,n.properties.location=i+f),v&&v.properties.dist<n.properties.dist&&(n=v,n.properties.index=a),i+=f}}),n}function Ac(){return{type:"FeatureCollection",features:[]}}function po(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:Cc(r)}}}function Cc(r){return[Math.round(r[0]*1e7)/1e7,Math.round(r[1]*1e7)/1e7]}const Oc=Oe(Ac()),Fc=Oe(0),g0=100;class m0{constructor(e){ce(this,"map");ce(this,"active");ce(this,"eventListenersSuccess");ce(this,"eventListenersUpdated");ce(this,"eventListenersFailure");ce(this,"points");ce(this,"cursor");ce(this,"hover");ce(this,"dragFrom");ce(this,"previousStates");ce(this,"onMouseMove",e=>{if(this.active&&!this.dragFrom)this.recalculateHovering(e);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let t=this.dragFrom[0]-e.lngLat.lng,n=this.dragFrom[1]-e.lngLat.lat;for(let i of this.points)i[0]-=t,i[1]-=n}else this.points[this.hover]=e.lngLat.toArray();this.dragFrom=e.lngLat.toArray(),this.redraw()}});ce(this,"onClick",e=>{if(this.beforeUpdate(),this.active&&this.cursor){let t=[];if(iu(this.points).forEach((n,i)=>{t.push([i+1,h0(n,this.cursor).properties.dist])}),t.sort((n,i)=>n[1]-i[1]),t.length>0){let n=t[0][0];this.points.splice(n,0,this.cursor.geometry.coordinates),this.hover=n}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw(),this.pointsUpdated()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.pointsUpdated(),this.recalculateHovering(e))});ce(this,"onDoubleClick",e=>{this.active&&(e.preventDefault(),this.cursor=po(e.lngLat.toArray()),this.onClick(e),this.finish())});ce(this,"onMouseDown",e=>{this.active&&!this.dragFrom&&this.hover!=null&&(e.preventDefault(),this.cursor=null,this.dragFrom=e.lngLat.toArray(),this.beforeUpdate(),this.redraw())});ce(this,"onMouseUp",()=>{this.active&&this.dragFrom&&(this.dragFrom=null,this.redraw(),this.pointsUpdated())});ce(this,"onKeypress",e=>{this.active&&(e.key=="Enter"?(e.stopPropagation(),this.finish()):e.key=="z"&&e.ctrlKey&&this.undo())});ce(this,"onKeyDown",e=>{this.active&&e.key=="Escape"&&(e.stopPropagation(),this.cancel())});this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.previousStates=[],this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("mousedown",this.onMouseDown),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keypress",this.onKeypress),document.addEventListener("keydown",this.onKeyDown)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("mousedown",this.onMouseDown),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keypress",this.onKeypress),document.removeEventListener("keydown",this.onKeyDown)}finish(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersSuccess)t(e);else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}startNew(){this.active=!0,this.map.doubleClickZoom.disable()}editExisting(e){this.active=!0,this.map.doubleClickZoom.disable(),this.points=JSON.parse(JSON.stringify(e.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.map.doubleClickZoom.enable(),this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.previousStates=[],this.redraw(),this.map.getCanvas().style.cursor="inherit"}undo(){this.dragFrom!=null||this.previousStates.length==0||(this.points=this.previousStates.pop(),this.hover=null,this.redraw())}redraw(){let e=Ac();this.points.forEach((i,o)=>{let s=po(i);s.properties.hover=this.hover==o,s.properties.idx=o,e.features.push(s)}),e.features=e.features.concat(iu(this.points));let t=this.polygonFeature();t&&(t.properties.hover=this.hover=="polygon",e.features.push(t)),Oc.set(e);let n="crosshair";this.hover!=null&&(n=this.dragFrom?"grabbing":"pointer"),this.map.getCanvas().style.cursor=n,Fc.set(this.previousStates.length)}pointsUpdated(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersUpdated)t(e)}recalculateHovering(e){this.cursor=null,this.hover=null;for(let t of this.map.queryRenderedFeatures(e.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(t.geometry.type=="Polygon"){this.hover="polygon";break}else if(t.geometry.type=="Point"&&Object.hasOwn(t.properties,"idx")){this.hover=t.properties.idx;break}this.hover==null&&(this.cursor=po(e.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let e=this.points.map(Cc),t=[JSON.parse(JSON.stringify(e))];return t[0].push(JSON.parse(JSON.stringify(t[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:t},properties:{}}}beforeUpdate(){this.previousStates.push(JSON.parse(JSON.stringify(this.points))),this.previousStates.length>g0&&this.previousStates.shift()}}function iu(r){let e=[];for(let t=0;t<r.length-1;t++)e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[t],r[t+1]]},properties:{}});return r.length>=3&&e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[r.length-1],r[0]]},properties:{}}),e}let Y;const Rc=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&Rc.decode();let Vr=null;function xr(){return(Vr===null||Vr.byteLength===0)&&(Vr=new Uint8Array(Y.memory.buffer)),Vr}function bt(r,e){return r=r>>>0,Rc.decode(xr().subarray(r,r+e))}const At=new Array(128).fill(void 0);At.push(void 0,null,!0,!1);let en=At.length;function Se(r){en===At.length&&At.push(At.length+1);const e=en;return en=At[e],At[e]=r,e}function ee(r){return At[r]}function d0(r){r<132||(At[r]=en,en=r)}function Qn(r){const e=ee(r);return d0(r),e}function ho(r){return r==null}let Jr=null;function y0(){return(Jr===null||Jr.byteLength===0)&&(Jr=new Float64Array(Y.memory.buffer)),Jr}let Yr=null;function le(){return(Yr===null||Yr.byteLength===0)&&(Yr=new Int32Array(Y.memory.buffer)),Yr}let jt=0;const xn=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},v0=typeof xn.encodeInto=="function"?function(r,e){return xn.encodeInto(r,e)}:function(r,e){const t=xn.encode(r);return e.set(t),{read:r.length,written:t.length}};function Fn(r,e,t){if(t===void 0){const a=xn.encode(r),l=e(a.length,1)>>>0;return xr().subarray(l,l+a.length).set(a),jt=a.length,l}let n=r.length,i=e(n,1)>>>0;const o=xr();let s=0;for(;s<n;s++){const a=r.charCodeAt(s);if(a>127)break;o[i+s]=a}if(s!==n){s!==0&&(r=r.slice(s)),i=t(i,n,n=s+r.length*3,1)>>>0;const a=xr().subarray(i+s,i+n),l=v0(r,a);s+=l.written}return jt=s,i}function es(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const i=r.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=r.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(r)){const i=r.length;let o="[";i>0&&(o+=es(r[0]));for(let s=1;s<i;s++)o+=", "+es(r[s]);return o+="]",o}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function _0(r,e){const t=e(r.length*1,1)>>>0;return xr().set(r,t/1),jt=r.length,t}function go(r,e){try{return r.apply(this,e)}catch(t){Y.__wbindgen_exn_store(Se(t))}}class Oi{static __wrap(e){e=e>>>0;const t=Object.create(Oi.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();Y.__wbg_jsroutesnapper_free(e)}constructor(e){try{const o=Y.__wbindgen_add_to_stack_pointer(-16),s=_0(e,Y.__wbindgen_malloc),a=jt;Y.jsroutesnapper_new(o,s,a);var t=le()[o/4+0],n=le()[o/4+1],i=le()[o/4+2];if(i)throw Qn(n);return Oi.__wrap(t)}finally{Y.__wbindgen_add_to_stack_pointer(16)}}setRouteConfig(e){Y.jsroutesnapper_setRouteConfig(this.__wbg_ptr,Se(e))}setAreaMode(){Y.jsroutesnapper_setAreaMode(this.__wbg_ptr)}getConfig(){let e,t;try{const o=Y.__wbindgen_add_to_stack_pointer(-16);Y.jsroutesnapper_getConfig(o,this.__wbg_ptr);var n=le()[o/4+0],i=le()[o/4+1];return e=n,t=i,bt(n,i)}finally{Y.__wbindgen_add_to_stack_pointer(16),Y.__wbindgen_free(e,t,1)}}toFinalFeature(){try{const n=Y.__wbindgen_add_to_stack_pointer(-16);Y.jsroutesnapper_toFinalFeature(n,this.__wbg_ptr);var e=le()[n/4+0],t=le()[n/4+1];let i;return e!==0&&(i=bt(e,t).slice(),Y.__wbindgen_free(e,t*1)),i}finally{Y.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){let e,t;try{const o=Y.__wbindgen_add_to_stack_pointer(-16);Y.jsroutesnapper_renderGeojson(o,this.__wbg_ptr);var n=le()[o/4+0],i=le()[o/4+1];return e=n,t=i,bt(n,i)}finally{Y.__wbindgen_add_to_stack_pointer(16),Y.__wbindgen_free(e,t,1)}}toggleSnapMode(){Y.jsroutesnapper_toggleSnapMode(this.__wbg_ptr)}onMouseMove(e,t,n){return Y.jsroutesnapper_onMouseMove(this.__wbg_ptr,e,t,n)!==0}onClick(){Y.jsroutesnapper_onClick(this.__wbg_ptr)}onDragStart(){return Y.jsroutesnapper_onDragStart(this.__wbg_ptr)!==0}onMouseUp(){return Y.jsroutesnapper_onMouseUp(this.__wbg_ptr)!==0}clearState(){Y.jsroutesnapper_clearState(this.__wbg_ptr)}editExisting(e){try{const i=Y.__wbindgen_add_to_stack_pointer(-16);Y.jsroutesnapper_editExisting(i,this.__wbg_ptr,Se(e));var t=le()[i/4+0],n=le()[i/4+1];if(n)throw Qn(t)}finally{Y.__wbindgen_add_to_stack_pointer(16)}}debugRenderGraph(){let e,t;try{const o=Y.__wbindgen_add_to_stack_pointer(-16);Y.jsroutesnapper_debugRenderGraph(o,this.__wbg_ptr);var n=le()[o/4+0],i=le()[o/4+1];return e=n,t=i,bt(n,i)}finally{Y.__wbindgen_add_to_stack_pointer(16),Y.__wbindgen_free(e,t,1)}}debugSnappableNodes(){let e,t;try{const o=Y.__wbindgen_add_to_stack_pointer(-16);Y.jsroutesnapper_debugSnappableNodes(o,this.__wbg_ptr);var n=le()[o/4+0],i=le()[o/4+1];return e=n,t=i,bt(n,i)}finally{Y.__wbindgen_add_to_stack_pointer(16),Y.__wbindgen_free(e,t,1)}}routeNameForWaypoints(e){let t,n;try{const f=Y.__wbindgen_add_to_stack_pointer(-16);Y.jsroutesnapper_routeNameForWaypoints(f,this.__wbg_ptr,Se(e));var i=le()[f/4+0],o=le()[f/4+1],s=le()[f/4+2],a=le()[f/4+3],l=i,u=o;if(a)throw l=0,u=0,Qn(s);return t=l,n=u,bt(l,u)}finally{Y.__wbindgen_add_to_stack_pointer(16),Y.__wbindgen_free(t,n,1)}}addSnappedWaypoint(e,t){Y.jsroutesnapper_addSnappedWaypoint(this.__wbg_ptr,e,t)}undo(){Y.jsroutesnapper_undo(this.__wbg_ptr)}}async function b0(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function w0(){const r={};return r.wbg={},r.wbg.__wbindgen_string_new=function(e,t){const n=bt(e,t);return Se(n)},r.wbg.__wbindgen_object_drop_ref=function(e){Qn(e)},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(bt(e,t));return Se(n)},r.wbg.__wbindgen_is_object=function(e){const t=ee(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_is_undefined=function(e){return ee(e)===void 0},r.wbg.__wbindgen_in=function(e,t){return ee(e)in ee(t)},r.wbg.__wbindgen_number_get=function(e,t){const n=ee(t),i=typeof n=="number"?n:void 0;y0()[e/8+1]=ho(i)?0:i,le()[e/4+0]=!ho(i)},r.wbg.__wbindgen_boolean_get=function(e){const t=ee(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return ee(e)==ee(t)},r.wbg.__wbindgen_string_get=function(e,t){const n=ee(t),i=typeof n=="string"?n:void 0;var o=ho(i)?0:Fn(i,Y.__wbindgen_malloc,Y.__wbindgen_realloc),s=jt;le()[e/4+1]=s,le()[e/4+0]=o},r.wbg.__wbg_getwithrefkey_d1f0d12f1f1b63ea=function(e,t){const n=ee(e)[ee(t)];return Se(n)},r.wbg.__wbindgen_object_clone_ref=function(e){const t=ee(e);return Se(t)},r.wbg.__wbg_String_4370c5505c674d30=function(e,t){const n=String(ee(t)),i=Fn(n,Y.__wbindgen_malloc,Y.__wbindgen_realloc),o=jt;le()[e/4+1]=o,le()[e/4+0]=i},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return Se(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=ee(t).stack,i=Fn(n,Y.__wbindgen_malloc,Y.__wbindgen_realloc),o=jt;le()[e/4+1]=o,le()[e/4+0]=i},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let n,i;try{n=e,i=t,console.error(bt(e,t))}finally{Y.__wbindgen_free(n,i,1)}},r.wbg.__wbg_debug_9a6b3243fbbebb61=function(e){console.debug(ee(e))},r.wbg.__wbg_error_788ae33f81d3b84b=function(e){console.error(ee(e))},r.wbg.__wbg_info_2e30e8204b29d91d=function(e){console.info(ee(e))},r.wbg.__wbg_log_1d3ae0273d8f4f8a=function(e){console.log(ee(e))},r.wbg.__wbg_warn_d60e832f9882c1b2=function(e){console.warn(ee(e))},r.wbg.__wbg_get_44be0491f933a435=function(e,t){const n=ee(e)[t>>>0];return Se(n)},r.wbg.__wbg_length_fff51ee6522a1a18=function(e){return ee(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof ee(e)=="function"},r.wbg.__wbg_next_526fc47e980da008=function(e){const t=ee(e).next;return Se(t)},r.wbg.__wbg_next_ddb3312ca1c4e32a=function(){return go(function(e){const t=ee(e).next();return Se(t)},arguments)},r.wbg.__wbg_done_5c1f01fb660d73b5=function(e){return ee(e).done},r.wbg.__wbg_value_1695675138684bd5=function(e){const t=ee(e).value;return Se(t)},r.wbg.__wbg_iterator_97f0c81209c6c35a=function(){return Se(Symbol.iterator)},r.wbg.__wbg_get_97b561fb56f034b5=function(){return go(function(e,t){const n=Reflect.get(ee(e),ee(t));return Se(n)},arguments)},r.wbg.__wbg_call_cb65541d95d71282=function(){return go(function(e,t){const n=ee(e).call(ee(t));return Se(n)},arguments)},r.wbg.__wbg_isArray_4c24b343cb13cfb1=function(e){return Array.isArray(ee(e))},r.wbg.__wbg_instanceof_ArrayBuffer_39ac22089b74fddb=function(e){let t;try{t=ee(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_buffer_085ec1f694018c4f=function(e){const t=ee(e).buffer;return Se(t)},r.wbg.__wbg_new_8125e318e6245eed=function(e){const t=new Uint8Array(ee(e));return Se(t)},r.wbg.__wbg_set_5cf90238115182c3=function(e,t,n){ee(e).set(ee(t),n>>>0)},r.wbg.__wbg_length_72e2208bbc0efc61=function(e){return ee(e).length},r.wbg.__wbg_instanceof_Uint8Array_d8d9cb2b8e8ac1d4=function(e){let t;try{t=ee(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbindgen_debug_string=function(e,t){const n=es(ee(t)),i=Fn(n,Y.__wbindgen_malloc,Y.__wbindgen_realloc),o=jt;le()[e/4+1]=o,le()[e/4+0]=i},r.wbg.__wbindgen_throw=function(e,t){throw new Error(bt(e,t))},r.wbg.__wbindgen_memory=function(){const e=Y.memory;return Se(e)},r}function S0(r,e){return Y=r.exports,Bc.__wbindgen_wasm_module=e,Jr=null,Yr=null,Vr=null,Y}async function Bc(r){if(Y!==void 0)return Y;typeof r>"u"&&(r="/scheme-sketcher/assets/route_snapper_bg.wasm");const e=w0();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await b0(await r,e);return S0(t,n)}function $0(r,e,t){t===void 0&&(t={});var n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=r,n}function k0(r,e,t){if(t===void 0&&(t={}),!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!ou(r[0])||!ou(r[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:r};return $0(n,e,t)}function ou(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}var Ye=63710088e-1,E0={centimeters:Ye*100,centimetres:Ye*100,degrees:Ye/111325,feet:Ye*3.28084,inches:Ye*39.37,kilometers:Ye/1e3,kilometres:Ye/1e3,meters:Ye,metres:Ye,miles:Ye/1609.344,millimeters:Ye*1e3,millimetres:Ye*1e3,nauticalmiles:Ye/1852,radians:1,yards:Ye*1.0936};function ts(r,e,t){t===void 0&&(t={});var n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=r,n}function M0(r,e,t){if(t===void 0&&(t={}),r.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:r};return ts(n,e,t)}function P0(r,e){e===void 0&&(e="kilometers");var t=E0[e];if(!t)throw new Error(e+" units is invalid");return r*t}function Rn(r){var e=r%360;return e*Math.PI/180}function su(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return r.geometry.coordinates;if(r.type==="Point")return r.coordinates}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return r;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function L0(r,e,t){t===void 0&&(t={});var n=su(r),i=su(e),o=Rn(i[1]-n[1]),s=Rn(i[0]-n[0]),a=Rn(n[1]),l=Rn(i[1]),u=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(a)*Math.cos(l);return P0(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)),t.units)}function Ic(r,e,t){if(r!==null)for(var n,i,o,s,a,l,u,f=0,c=0,h,p=r.type,g=p==="FeatureCollection",m=p==="Feature",v=g?r.features.length:1,b=0;b<v;b++){u=g?r.features[b].geometry:m?r.geometry:r,h=u?u.type==="GeometryCollection":!1,a=h?u.geometries.length:1;for(var d=0;d<a;d++){var y=0,k=0;if(s=h?u.geometries[d]:u,s!==null){l=s.coordinates;var _=s.type;switch(f=t&&(_==="Polygon"||_==="MultiPolygon")?1:0,_){case null:break;case"Point":if(e(l,c,b,y,k)===!1)return!1;c++,y++;break;case"LineString":case"MultiPoint":for(n=0;n<l.length;n++){if(e(l[n],c,b,y,k)===!1)return!1;c++,_==="MultiPoint"&&y++}_==="LineString"&&y++;break;case"Polygon":case"MultiLineString":for(n=0;n<l.length;n++){for(i=0;i<l[n].length-f;i++){if(e(l[n][i],c,b,y,k)===!1)return!1;c++}_==="MultiLineString"&&y++,_==="Polygon"&&k++}_==="Polygon"&&y++;break;case"MultiPolygon":for(n=0;n<l.length;n++){for(k=0,i=0;i<l[n].length;i++){for(o=0;o<l[n][i].length-f;o++){if(e(l[n][i][o],c,b,y,k)===!1)return!1;c++}k++}y++}break;case"GeometryCollection":for(n=0;n<s.geometries.length;n++)if(Ic(s.geometries[n],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function A0(r,e){var t,n,i,o,s,a,l,u,f,c,h=0,p=r.type==="FeatureCollection",g=r.type==="Feature",m=p?r.features.length:1;for(t=0;t<m;t++){for(a=p?r.features[t].geometry:g?r.geometry:r,u=p?r.features[t].properties:g?r.properties:{},f=p?r.features[t].bbox:g?r.bbox:void 0,c=p?r.features[t].id:g?r.id:void 0,l=a?a.type==="GeometryCollection":!1,s=l?a.geometries.length:1,i=0;i<s;i++){if(o=l?a.geometries[i]:a,o===null){if(e(null,h,u,f,c)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(o,h,u,f,c)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<o.geometries.length;n++)if(e(o.geometries[n],h,u,f,c)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}h++}}function C0(r,e){A0(r,function(t,n,i,o,s){var a=t===null?null:t.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return e(ts(t,i,{bbox:o,id:s}),n,0)===!1?!1:void 0}var l;switch(a){case"MultiPoint":l="Point";break;case"MultiLineString":l="LineString";break;case"MultiPolygon":l="Polygon";break}for(var u=0;u<t.coordinates.length;u++){var f=t.coordinates[u],c={type:l,coordinates:f};if(e(ts(c,i),n,u)===!1)return!1}})}function O0(r,e){C0(r,function(t,n,i){var o=0;if(t.geometry){var s=t.geometry.type;if(!(s==="Point"||s==="MultiPoint")){var a,l=0,u=0,f=0;if(Ic(t,function(c,h,p,g,m){if(a===void 0||n>l||g>u||m>f){a=c,l=n,u=g,f=m,o=0;return}var v=M0([a,c],t.properties);if(e(v,n,i,m,o)===!1)return!1;o++,a=c})===!1)return!1}}})}function F0(r,e,t){var n=t,i=!1;return O0(r,function(o,s,a,l,u){i===!1&&t===void 0?n=o:n=e(n,o,s,a,l,u),i=!0}),n}function rs(r,e){return e===void 0&&(e={}),F0(r,function(t,n){var i=n.geometry.coordinates;return t+L0(i[0],i[1],e)},0)}var Xe=63710088e-1,Nc={centimeters:Xe*100,centimetres:Xe*100,degrees:Xe/111325,feet:Xe*3.28084,inches:Xe*39.37,kilometers:Xe/1e3,kilometres:Xe/1e3,meters:Xe,metres:Xe,miles:Xe/1609.344,millimeters:Xe*1e3,millimetres:Xe*1e3,nauticalmiles:Xe/1852,radians:1,yards:Xe*1.0936};function Lr(r,e,t){t===void 0&&(t={});var n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=r,n}function tn(r,e,t){if(t===void 0&&(t={}),!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!lu(r[0])||!lu(r[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:r};return Lr(n,e,t)}function ns(r,e,t){if(t===void 0&&(t={}),r.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:r};return Lr(n,e,t)}function au(r,e){e===void 0&&(e={});var t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=r,t}function R0(r,e){e===void 0&&(e="kilometers");var t=Nc[e];if(!t)throw new Error(e+" units is invalid");return r*t}function B0(r,e){e===void 0&&(e="kilometers");var t=Nc[e];if(!t)throw new Error(e+" units is invalid");return r/t}function is(r){var e=r%(2*Math.PI);return e*180/Math.PI}function mt(r){var e=r%360;return e*Math.PI/180}function lu(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}function gn(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return r.geometry.coordinates;if(r.type==="Point")return r.coordinates}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return r;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function mn(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function I0(r,e){return r.type==="FeatureCollection"?"FeatureCollection":r.type==="GeometryCollection"?"GeometryCollection":r.type==="Feature"&&r.geometry!==null?r.geometry.type:r.type}function Tc(r,e,t){if(t===void 0&&(t={}),t.final===!0)return N0(r,e);var n=gn(r),i=gn(e),o=mt(n[0]),s=mt(i[0]),a=mt(n[1]),l=mt(i[1]),u=Math.sin(s-o)*Math.cos(l),f=Math.cos(a)*Math.sin(l)-Math.sin(a)*Math.cos(l)*Math.cos(s-o);return is(Math.atan2(u,f))}function N0(r,e){var t=Tc(e,r);return t=(t+180)%360,t}function Ur(r,e,t){t===void 0&&(t={});var n=gn(r),i=gn(e),o=mt(i[1]-n[1]),s=mt(i[0]-n[0]),a=mt(n[1]),l=mt(i[1]),u=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(a)*Math.cos(l);return R0(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)),t.units)}function uu(r,e,t,n){n===void 0&&(n={});var i=gn(r),o=mt(i[0]),s=mt(i[1]),a=mt(t),l=B0(e,n.units),u=Math.asin(Math.sin(s)*Math.cos(l)+Math.cos(s)*Math.sin(l)*Math.cos(a)),f=o+Math.atan2(Math.sin(a)*Math.sin(l)*Math.cos(s),Math.cos(l)-Math.sin(s)*Math.sin(u)),c=is(f),h=is(u);return tn([c,h],n.properties)}function fu(r,e){if(r.type==="Feature")e(r,0);else if(r.type==="FeatureCollection")for(var t=0;t<r.features.length&&e(r.features[t],t)!==!1;t++);}function T0(r,e){var t,n,i,o,s,a,l,u,f,c,h=0,p=r.type==="FeatureCollection",g=r.type==="Feature",m=p?r.features.length:1;for(t=0;t<m;t++){for(a=p?r.features[t].geometry:g?r.geometry:r,u=p?r.features[t].properties:g?r.properties:{},f=p?r.features[t].bbox:g?r.bbox:void 0,c=p?r.features[t].id:g?r.id:void 0,l=a?a.type==="GeometryCollection":!1,s=l?a.geometries.length:1,i=0;i<s;i++){if(o=l?a.geometries[i]:a,o===null){if(e(null,h,u,f,c)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(o,h,u,f,c)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<o.geometries.length;n++)if(e(o.geometries[n],h,u,f,c)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}h++}}function D0(r,e){T0(r,function(t,n,i,o,s){var a=t===null?null:t.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return e(Lr(t,i,{bbox:o,id:s}),n,0)===!1?!1:void 0}var l;switch(a){case"MultiPoint":l="Point";break;case"MultiLineString":l="LineString";break;case"MultiPolygon":l="Polygon";break}for(var u=0;u<t.coordinates.length;u++){var f=t.coordinates[u],c={type:l,coordinates:f};if(e(Lr(c,i),n,u)===!1)return!1}})}function j0(r,e){var t={},n=[];if(r.type==="LineString"&&(r=Lr(r)),e.type==="LineString"&&(e=Lr(e)),r.type==="Feature"&&e.type==="Feature"&&r.geometry!==null&&e.geometry!==null&&r.geometry.type==="LineString"&&e.geometry.type==="LineString"&&r.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var i=cu(r,e);return i&&n.push(i),au(n)}var o=$n();return o.load(nr(e)),fu(nr(r),function(s){fu(o.search(s),function(a){var l=cu(s,a);if(l){var u=mn(l).join(",");t[u]||(t[u]=!0,n.push(l))}})}),au(n)}function cu(r,e){var t=mn(r),n=mn(e);if(t.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(n.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var i=t[0][0],o=t[0][1],s=t[1][0],a=t[1][1],l=n[0][0],u=n[0][1],f=n[1][0],c=n[1][1],h=(c-u)*(s-i)-(f-l)*(a-o),p=(f-l)*(o-u)-(c-u)*(i-l),g=(s-i)*(o-u)-(a-o)*(i-l);if(h===0)return null;var m=p/h,v=g/h;if(m>=0&&m<=1&&v>=0&&v<=1){var b=i+m*(s-i),d=o+m*(a-o);return tn([b,d])}return null}function pu(r,e,t){t===void 0&&(t={});var n=tn([1/0,1/0],{dist:1/0}),i=0;return D0(r,function(o){for(var s=mn(o),a=0;a<s.length-1;a++){var l=tn(s[a]);l.properties.dist=Ur(e,l,t);var u=tn(s[a+1]);u.properties.dist=Ur(e,u,t);var f=Ur(l,u,t),c=Math.max(l.properties.dist,u.properties.dist),h=Tc(l,u),p=uu(e,c,h+90,t),g=uu(e,c,h-90,t),m=j0(ns([p.geometry.coordinates,g.geometry.coordinates]),ns([l.geometry.coordinates,u.geometry.coordinates])),v=null;m.features.length>0&&(v=m.features[0],v.properties.dist=Ur(e,v,t),v.properties.location=i+Ur(l,v,t)),l.properties.dist<n.properties.dist&&(n=l,n.properties.index=a,n.properties.location=i),u.properties.dist<n.properties.dist&&(n=u,n.properties.index=a+1,n.properties.location=i+f),v&&v.properties.dist<n.properties.dist&&(n=v,n.properties.index=a),i+=f}}),n}function G0(r,e,t){var n=mn(t);if(I0(t)!=="LineString")throw new Error("line must be a LineString");var i=pu(t,r),o=pu(t,e),s;i.properties.index<=o.properties.index?s=[i,o]:s=[o,i];for(var a=[s[0].geometry.coordinates],l=s[0].properties.index+1;l<s[1].properties.index+1;l++)a.push(n[l]);return a.push(s[1].geometry.coordinates),ns(a,t.properties)}var Ke=63710088e-1,U0={centimeters:Ke*100,centimetres:Ke*100,degrees:Ke/111325,feet:Ke*3.28084,inches:Ke*39.37,kilometers:Ke/1e3,kilometres:Ke/1e3,meters:Ke,metres:Ke,miles:Ke/1609.344,millimeters:Ke*1e3,millimetres:Ke*1e3,nauticalmiles:Ke/1852,radians:1,yards:Ke*1.0936};function q0(r,e){e===void 0&&(e="kilometers");var t=U0[e];if(!t)throw new Error(e+" units is invalid");return r*t}function Bn(r){var e=r%360;return e*Math.PI/180}function hu(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return r.geometry.coordinates;if(r.type==="Point")return r.coordinates}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return r;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function gu(r,e,t){t===void 0&&(t={});var n=hu(r),i=hu(e),o=Bn(i[1]-n[1]),s=Bn(i[0]-n[0]),a=Bn(n[1]),l=Bn(i[1]),u=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(a)*Math.cos(l);return q0(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)),t.units)}function z0(r){var e=r[0],t=r[1],n=r[2],i=r[3],o=gu(r.slice(0,2),[n,t]),s=gu(r.slice(0,2),[e,i]);if(o>=s){var a=(t+i)/2;return[e,a-(n-e)/2,n,a+(n-e)/2]}else{var l=(e+n)/2;return[l-(i-t)/2,t,l+(i-t)/2,i]}}function Dc(r,e,t){if(r!==null)for(var n,i,o,s,a,l,u,f=0,c=0,h,p=r.type,g=p==="FeatureCollection",m=p==="Feature",v=g?r.features.length:1,b=0;b<v;b++){u=g?r.features[b].geometry:m?r.geometry:r,h=u?u.type==="GeometryCollection":!1,a=h?u.geometries.length:1;for(var d=0;d<a;d++){var y=0,k=0;if(s=h?u.geometries[d]:u,s!==null){l=s.coordinates;var _=s.type;switch(f=t&&(_==="Polygon"||_==="MultiPolygon")?1:0,_){case null:break;case"Point":if(e(l,c,b,y,k)===!1)return!1;c++,y++;break;case"LineString":case"MultiPoint":for(n=0;n<l.length;n++){if(e(l[n],c,b,y,k)===!1)return!1;c++,_==="MultiPoint"&&y++}_==="LineString"&&y++;break;case"Polygon":case"MultiLineString":for(n=0;n<l.length;n++){for(i=0;i<l[n].length-f;i++){if(e(l[n][i],c,b,y,k)===!1)return!1;c++}_==="MultiLineString"&&y++,_==="Polygon"&&k++}_==="Polygon"&&y++;break;case"MultiPolygon":for(n=0;n<l.length;n++){for(k=0,i=0;i<l[n].length;i++){for(o=0;o<l[n][i].length-f;o++){if(e(l[n][i][o],c,b,y,k)===!1)return!1;c++}k++}y++}break;case"GeometryCollection":for(n=0;n<s.geometries.length;n++)if(Dc(s.geometries[n],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function W0(r,e){e===void 0&&(e={});var t=e.precision,n=e.coordinates,i=e.mutate;if(t=t==null||isNaN(t)?6:t,n=n==null||isNaN(n)?3:n,!r)throw new Error("<geojson> is required");if(typeof t!="number")throw new Error("<precision> must be a number");if(typeof n!="number")throw new Error("<coordinates> must be a number");(i===!1||i===void 0)&&(r=JSON.parse(JSON.stringify(r)));var o=Math.pow(10,t);return Dc(r,function(s){H0(s,o,n)}),r}function H0(r,e,t){r.length>t&&r.splice(t,r.length);for(var n=0;n<r.length;n++)r[n]=Math.round(r[n]*e)/e;return r}var Ze=63710088e-1,jc={centimeters:Ze*100,centimetres:Ze*100,degrees:Ze/111325,feet:Ze*3.28084,inches:Ze*39.37,kilometers:Ze/1e3,kilometres:Ze/1e3,meters:Ze,metres:Ze,miles:Ze/1609.344,millimeters:Ze*1e3,millimetres:Ze*1e3,nauticalmiles:Ze/1852,radians:1,yards:Ze*1.0936};function Ar(r,e,t){t===void 0&&(t={});var n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=r,n}function rn(r,e,t){if(t===void 0&&(t={}),!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!mu(r[0])||!mu(r[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:r};return Ar(n,e,t)}function Fi(r,e,t){if(t===void 0&&(t={}),r.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:r};return Ar(n,e,t)}function er(r,e){e===void 0&&(e={});var t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=r,t}function V0(r,e){e===void 0&&(e="kilometers");var t=jc[e];if(!t)throw new Error(e+" units is invalid");return r*t}function J0(r,e){e===void 0&&(e="kilometers");var t=jc[e];if(!t)throw new Error(e+" units is invalid");return r/t}function os(r){var e=r%(2*Math.PI);return e*180/Math.PI}function dt(r){var e=r%360;return e*Math.PI/180}function mu(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}function Gt(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return r.geometry.coordinates;if(r.type==="Point")return r.coordinates}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return r;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function tr(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function du(r,e){return r.type==="FeatureCollection"?"FeatureCollection":r.type==="GeometryCollection"?"GeometryCollection":r.type==="Feature"&&r.geometry!==null?r.geometry.type:r.type}function dn(r,e){if(r.type==="Feature")e(r,0);else if(r.type==="FeatureCollection")for(var t=0;t<r.features.length&&e(r.features[t],t)!==!1;t++);}function Y0(r,e,t){var n=t;return dn(r,function(i,o){o===0&&t===void 0?n=i:n=e(n,i,o)}),n}function X0(r,e){var t,n,i,o,s,a,l,u,f,c,h=0,p=r.type==="FeatureCollection",g=r.type==="Feature",m=p?r.features.length:1;for(t=0;t<m;t++){for(a=p?r.features[t].geometry:g?r.geometry:r,u=p?r.features[t].properties:g?r.properties:{},f=p?r.features[t].bbox:g?r.bbox:void 0,c=p?r.features[t].id:g?r.id:void 0,l=a?a.type==="GeometryCollection":!1,s=l?a.geometries.length:1,i=0;i<s;i++){if(o=l?a.geometries[i]:a,o===null){if(e(null,h,u,f,c)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(o,h,u,f,c)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<o.geometries.length;n++)if(e(o.geometries[n],h,u,f,c)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}h++}}function Gc(r,e){X0(r,function(t,n,i,o,s){var a=t===null?null:t.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return e(Ar(t,i,{bbox:o,id:s}),n,0)===!1?!1:void 0}var l;switch(a){case"MultiPoint":l="Point";break;case"MultiLineString":l="LineString";break;case"MultiPolygon":l="Polygon";break}for(var u=0;u<t.coordinates.length;u++){var f=t.coordinates[u],c={type:l,coordinates:f};if(e(Ar(c,i),n,u)===!1)return!1}})}function Uc(r,e){var t={},n=[];if(r.type==="LineString"&&(r=Ar(r)),e.type==="LineString"&&(e=Ar(e)),r.type==="Feature"&&e.type==="Feature"&&r.geometry!==null&&e.geometry!==null&&r.geometry.type==="LineString"&&e.geometry.type==="LineString"&&r.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var i=yu(r,e);return i&&n.push(i),er(n)}var o=$n();return o.load(nr(e)),dn(nr(r),function(s){dn(o.search(s),function(a){var l=yu(s,a);if(l){var u=tr(l).join(",");t[u]||(t[u]=!0,n.push(l))}})}),er(n)}function yu(r,e){var t=tr(r),n=tr(e);if(t.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(n.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var i=t[0][0],o=t[0][1],s=t[1][0],a=t[1][1],l=n[0][0],u=n[0][1],f=n[1][0],c=n[1][1],h=(c-u)*(s-i)-(f-l)*(a-o),p=(f-l)*(o-u)-(c-u)*(i-l),g=(s-i)*(o-u)-(a-o)*(i-l);if(h===0)return null;var m=p/h,v=g/h;if(m>=0&&m<=1&&v>=0&&v<=1){var b=i+m*(s-i),d=o+m*(a-o);return rn([b,d])}return null}function qc(r,e,t){if(t===void 0&&(t={}),t.final===!0)return K0(r,e);var n=Gt(r),i=Gt(e),o=dt(n[0]),s=dt(i[0]),a=dt(n[1]),l=dt(i[1]),u=Math.sin(s-o)*Math.cos(l),f=Math.cos(a)*Math.sin(l)-Math.sin(a)*Math.cos(l)*Math.cos(s-o);return os(Math.atan2(u,f))}function K0(r,e){var t=qc(e,r);return t=(t+180)%360,t}function qr(r,e,t){t===void 0&&(t={});var n=Gt(r),i=Gt(e),o=dt(i[1]-n[1]),s=dt(i[0]-n[0]),a=dt(n[1]),l=dt(i[1]),u=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(a)*Math.cos(l);return V0(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)),t.units)}function vu(r,e,t,n){n===void 0&&(n={});var i=Gt(r),o=dt(i[0]),s=dt(i[1]),a=dt(t),l=J0(e,n.units),u=Math.asin(Math.sin(s)*Math.cos(l)+Math.cos(s)*Math.sin(l)*Math.cos(a)),f=o+Math.atan2(Math.sin(a)*Math.sin(l)*Math.cos(s),Math.cos(l)-Math.sin(s)*Math.sin(u)),c=os(f),h=os(u);return rn([c,h],n.properties)}function Z0(r,e,t){t===void 0&&(t={});var n=rn([1/0,1/0],{dist:1/0}),i=0;return Gc(r,function(o){for(var s=tr(o),a=0;a<s.length-1;a++){var l=rn(s[a]);l.properties.dist=qr(e,l,t);var u=rn(s[a+1]);u.properties.dist=qr(e,u,t);var f=qr(l,u,t),c=Math.max(l.properties.dist,u.properties.dist),h=qc(l,u),p=vu(e,c,h+90,t),g=vu(e,c,h-90,t),m=Uc(Fi([p.geometry.coordinates,g.geometry.coordinates]),Fi([l.geometry.coordinates,u.geometry.coordinates])),v=null;m.features.length>0&&(v=m.features[0],v.properties.dist=qr(e,v,t),v.properties.location=i+qr(l,v,t)),l.properties.dist<n.properties.dist&&(n=l,n.properties.index=a,n.properties.location=i),u.properties.dist<n.properties.dist&&(n=u,n.properties.index=a+1,n.properties.location=i+f),v&&v.properties.dist<n.properties.dist&&(n=v,n.properties.index=a),i+=f}}),n}function Q0(r,e){if(!r)throw new Error("line is required");if(!e)throw new Error("splitter is required");var t=du(r),n=du(e);if(t!=="LineString")throw new Error("line must be LineString");if(n==="FeatureCollection")throw new Error("splitter cannot be a FeatureCollection");if(n==="GeometryCollection")throw new Error("splitter cannot be a GeometryCollection");var i=W0(e,{precision:7});switch(n){case"Point":return ss(r,i);case"MultiPoint":return _u(r,i);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return _u(r,Uc(r,i))}}function _u(r,e){var t=[],n=$n();return Gc(e,function(i){if(t.forEach(function(a,l){a.id=l}),!t.length)t=ss(r,i).features,t.forEach(function(a){a.bbox||(a.bbox=z0(fn(a)))}),n.load(er(t));else{var o=n.search(i);if(o.features.length){var s=zc(i,o);t=t.filter(function(a){return a.id!==s.id}),n.remove(s),dn(ss(s,i),function(a){t.push(a),n.insert(a)})}}}),er(t)}function ss(r,e){var t=[],n=tr(r)[0],i=tr(r)[r.geometry.coordinates.length-1];if(mo(n,Gt(e))||mo(i,Gt(e)))return er([r]);var o=$n(),s=nr(r);o.load(s);var a=o.search(e);if(!a.features.length)return er([r]);var l=zc(e,a),u=[n],f=Y0(s,function(c,h,p){var g=tr(h)[1],m=Gt(e);return p===l.id?(c.push(m),t.push(Fi(c)),mo(m,g)?[m]:[m,g]):(c.push(g),c)},u);return f.length>1&&t.push(Fi(f)),er(t)}function zc(r,e){if(!e.features.length)throw new Error("lines must contain features");if(e.features.length===1)return e.features[0];var t,n=1/0;return dn(e,function(i){var o=Z0(i,r),s=o.properties.dist;s<n&&(t=i,n=s)}),t}function mo(r,e){return r[0]===e[0]&&r[1]===e[1]}function x0(r,e){let t=Q0(r,e);if(t.features.length!=2)return null;let n=t.features[0],i=t.features[1];return n.geometry.coordinates=n.geometry.coordinates.map(wu),i.geometry.coordinates=i.geometry.coordinates.map(wu),n.properties=JSON.parse(JSON.stringify(r.properties)),i.properties=JSON.parse(JSON.stringify(r.properties)),eb(r,n,i,e),[n,i]}function eb(r,e,t,n){e.properties.length_meters=rs(e,{units:"kilometers"})*1e3,t.properties.length_meters=rs(t,{units:"kilometers"})*1e3,e.properties.waypoints=[],t.properties.waypoints=[];let i=bu(r,n),o=!0,s=0;for(let a of r.properties.waypoints){let l=bu(r,k0([a.lon,a.lat]));if(o)if(l<i)e.properties.waypoints.push(a);else{let u=a.snapped&&r.properties.waypoints[s-1].snapped;e.properties.waypoints.push({lon:n.geometry.coordinates[0],lat:n.geometry.coordinates[1],snapped:u}),o=!1,t.properties.waypoints.push({lon:n.geometry.coordinates[0],lat:n.geometry.coordinates[1],snapped:u}),t.properties.waypoints.push(a)}else t.properties.waypoints.push(a);s++}}function bu(r,e){let t=r.geometry.coordinates[0],n=G0(t,e,r);return rs(n,{units:"kilometers"})*1e3}function wu(r){return[Math.round(r[0]*1e7)/1e7,Math.round(r[1]*1e7)/1e7]}const tb=30;class rb{constructor(e,t,n,i,o){this.onMouseMove=s=>{if(!this.active)return;const a=[s.point.x-tb,s.point.y],l=this.map.unproject(s.point).distanceTo(this.map.unproject(a));this.inner.onMouseMove(s.lngLat.lng,s.lngLat.lat,l)&&(this.redraw(),this.dataUpdated())},this.onClick=()=>{this.active&&(this.inner.onClick(),this.redraw(),this.dataUpdated())},this.onDoubleClick=s=>{this.active&&(s.preventDefault(),this.inner.onClick(),this.finish())},this.onDragStart=()=>{this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()},this.onMouseUp=()=>{this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()},this.onKeyDown=s=>{this.active&&s.key=="Escape"&&(s.stopPropagation(),this.cancel())},this.onKeyPress=s=>{this.active&&s.target.tagName!="INPUT"&&(s.key=="Enter"?(s.stopPropagation(),this.finish()):s.key=="s"||s.key=="S"?(s.stopPropagation(),this.inner.toggleSnapMode(),this.redraw()):s.key=="z"&&s.ctrlKey&&this.undo())},this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new Oi(t),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.routeToolGj=n,this.snapMode=i,this.undoLength=o,this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("dragstart",this.onDragStart),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keypress",this.onKeyPress)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("dragstart",this.onDragStart),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keypress",this.onKeyPress)}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}startArea(){this.active||(this.inner.setAreaMode(),this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable(),this.map.doubleClickZoom.enable()}editExistingRoute(e){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(e.properties.waypoints),this.redraw()}editExistingArea(e){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),e.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(e.properties.waypoints),this.redraw()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)for(let t of this.eventListenersSuccess)t(JSON.parse(e));else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(e){this.inner.setRouteConfig(e),this.redraw()}addSnappedWaypoint(e){this.inner.addSnappedWaypoint(e[0],e[1]),this.redraw()}undo(){this.inner.undo(),this.redraw()}toggleSnapMode(){this.inner.toggleSnapMode(),this.redraw()}redraw(){let e=JSON.parse(this.inner.renderGeojson());this.routeToolGj.set(e),this.map.getCanvas().style.cursor=e.cursor,this.snapMode.set(e.snap_mode),this.undoLength.set(e.undo_length)}dataUpdated(){let e=this.inner.toFinalFeature();if(e)for(let t of this.eventListenersUpdated)t(JSON.parse(e))}}function nb(r){return r=="google"||r=="bing"}var Ae=[];for(var yo=0;yo<256;++yo)Ae.push((yo+256).toString(16).slice(1));function ib(r,e=0){return(Ae[r[e+0]]+Ae[r[e+1]]+Ae[r[e+2]]+Ae[r[e+3]]+"-"+Ae[r[e+4]]+Ae[r[e+5]]+"-"+Ae[r[e+6]]+Ae[r[e+7]]+"-"+Ae[r[e+8]]+Ae[r[e+9]]+"-"+Ae[r[e+10]]+Ae[r[e+11]]+Ae[r[e+12]]+Ae[r[e+13]]+Ae[r[e+14]]+Ae[r[e+15]]).toLowerCase()}var In,ob=new Uint8Array(16);function sb(){if(!In&&(In=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!In))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return In(ob)}var ab=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const Su={randomUUID:ab};function Wc(r,e,t){if(Su.randomUUID&&!e&&!r)return Su.randomUUID();r=r||{};var n=r.random||(r.rng||sb)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,e){t=t||0;for(var i=0;i<16;++i)e[t+i]=n[i];return e}return ib(n)}const nn={hovering:"black",lineEndpointColor:"black"},Ri=10,Kt=10;function lb(){return ub(["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00"])}function ub(r){return r[Math.floor(Math.random()*r.length)]}const yn=Oe(null),Cr=Oe(null),Pt=Oe(null),ei=Oe(new Set),on=Oe(null),te=Oe({mode:"list"});function kn(r){let e=new Set;for(let n of r.features)e.add(n.id);let t=e.size+1;for(;e.has(t);)t++;return t}function $u(r,e){console.log(`Deleting intervention ${e}`),r.update(t=>(t.features=t.features.filter(n=>n.id!=e),t)),on.set(null),te.set({mode:"list"})}function qi(r){return Object.values(r.schemes)[0].scheme_reference}function Hc(r){return[Math.round(r[0]*1e7)/1e7,Math.round(r[1]*1e7)/1e7]}const ir=Oe(fb());ir.subscribe(r=>window.localStorage.setItem("userSettings",JSON.stringify(r)));function fb(){let r={streetViewImagery:"google",avoidDoublingBack:!1};try{let e=JSON.parse(window.localStorage.getItem("userSettings")||"{}");nb(e.streetViewImagery)&&(r.streetViewImagery=e.streetViewImagery),typeof e.avoidDoublingBack=="boolean"&&(r.avoidDoublingBack=e.avoidDoublingBack)}catch(e){console.log(`Couldn't parse userSettings from local storage: ${e}`)}return r}function Vc(r){let e={type:"FeatureCollection",features:[],schemes:{}};return Jc(r,e),e}function Jc(r,e){let t=Wc(),n=r.initializeEmptyScheme({scheme_reference:t,color:lb()});e.schemes[t]=n}function cb(r){let e;return{c(){e=T("li"),e.textContent="Click to add a new point"},m(t,n){w(t,e,n)},d(t){t&&S(e)}}}function pb(r){let e;return{c(){e=T("li"),e.textContent="Click to move the point here"},m(t,n){w(t,e,n)},d(t){t&&S(e)}}}function hb(r){let e,t,n;function i(a,l){return a[0]?pb:cb}let o=i(r),s=o(r);return{c(){e=T("ul"),s.c(),t=B(),n=T("li"),n.innerHTML=`Press <b>Escape</b>
    to cancel`},m(a,l){w(a,e,l),s.m(e,null),j(e,t),j(e,n)},p(a,[l]){o!==(o=i(a))&&(s.d(1),s=o(a),s&&(s.c(),s.m(e,t)))},i:x,o:x,d(a){a&&S(e),s.d()}}}function gb(r,e,t){let{editingExisting:n}=e;return r.$$set=i=>{"editingExisting"in i&&t(0,n=i.editingExisting)},[n]}class Yc extends Z{constructor(e){super(),Q(this,e,gb,hb,K,{editingExisting:0})}}function mb(r){let e,t,n;return{c(){e=z("Undo ("),t=z(r[0]),n=z(")")},m(i,o){w(i,e,o),w(i,t,o),w(i,n,o)},p(i,o){o&1&&de(t,i[0])},d(i){i&&(S(e),S(t),S(n))}}}function db(r){let e;return{c(){e=z("Undo")},m(t,n){w(t,e,n)},p:x,d(t){t&&S(e)}}}function yb(r){let e;function t(o,s){return o[0]==0?db:mb}let n=t(r),i=n(r);return{c(){i.c(),e=me()},m(o,s){i.m(o,s),w(o,e,s)},p(o,s){n===(n=t(o))&&i?i.p(o,s):(i.d(1),i=n(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){o&&S(e),i.d(o)}}}function vb(r){let e,t,n,i;return e=new pe({props:{disabled:r[0]==0,$$slots:{default:[yb]},$$scope:{ctx:r}}}),e.$on("click",r[1]),{c(){L(e.$$.fragment),t=B(),n=T("ul"),n.innerHTML=`<li><b>Click</b>
    the map to add a vertex</li> <li><b>Click</b>
    a vertex to delete it</li> <li><b>Drag</b>
    a vertex or the polygon to move it</li> <li>Press <b>Control+Z</b>
    to undo your last change</li> <li>Press <b>Enter</b>
    or
    <b>double click</b>
    to finish</li> <li>Press <b>Escape</b>
    to cancel</li>`},m(o,s){A(e,o,s),w(o,t,s),w(o,n,s),i=!0},p(o,[s]){const a={};s&1&&(a.disabled=o[0]==0),s&9&&(a.$$scope={dirty:s,ctx:o}),e.$set(a)},i(o){i||($(e.$$.fragment,o),i=!0)},o(o){E(e.$$.fragment,o),i=!1},d(o){o&&(S(t),S(n)),C(e,o)}}}function _b(r,e,t){let n,i;J(r,Cr,s=>t(2,n=s)),J(r,Fc,s=>t(0,i=s));function o(){n.undo()}return[i,o]}class Xc extends Z{constructor(e){super(),Q(this,e,_b,vb,K,{})}}const Kc=Oe(Mr()),ti=Oe(Mr()),Zc=Oe(!0),js=Oe(0);function ku(r,e,t){const n=r.slice();return n[9]=e[t],n}function Eu(r){let e,t,n=r[9].place_name+"",i,o,s;function a(...l){return r[5](r[9],...l)}return{c(){e=T("li"),t=T("a"),i=z(n),N(t,"href","#")},m(l,u){w(l,e,u),j(e,t),j(t,i),o||(s=ne(t,"click",a),o=!0)},p(l,u){r=l,u&2&&n!==(n=r[9].place_name+"")&&de(i,n)},d(l){l&&S(e),o=!1,s()}}}function bb(r){let e,t,n,i,o;function s(f){r[4](f)}let a={label:"Add waypoint by search"};r[0]!==void 0&&(a.value=r[0]),e=new of({props:a}),_e.push(()=>$e(e,"value",s));let l=at(r[1].features),u=[];for(let f=0;f<l.length;f+=1)u[f]=Eu(ku(r,l,f));return{c(){L(e.$$.fragment),n=B(),i=T("ol");for(let f=0;f<u.length;f+=1)u[f].c();N(i,"class","govuk-list govuk-list--number")},m(f,c){A(e,f,c),w(f,n,c),w(f,i,c);for(let h=0;h<u.length;h+=1)u[h]&&u[h].m(i,null);o=!0},p(f,[c]){const h={};if(!t&&c&1&&(t=!0,h.value=f[0],Pe(()=>t=!1)),e.$set(h),c&6){l=at(f[1].features);let p;for(p=0;p<l.length;p+=1){const g=ku(f,l,p);u[p]?u[p].p(g,c):(u[p]=Eu(g),u[p].c(),u[p].m(i,null))}for(;p<u.length;p+=1)u[p].d(1);u.length=l.length}},i(f){o||($(e.$$.fragment,f),o=!0)},o(f){E(e.$$.fragment,f),o=!1},d(f){f&&(S(n),S(i)),C(e,f),ls(u,f)}}}function wb(r,e,t){let n,i,o;J(r,Pt,h=>t(6,n=h)),J(r,ti,h=>t(1,i=h)),J(r,et,h=>t(7,o=h));let{cfg:s}=e,a="";async function l(h){if(!h){st(ti,i=Mr(),i);return}let p=new URLSearchParams({country:"gb",proximity:o.getCenter().toArray().join(","),fuzzyMatch:"true",key:s.maptilerApiKey}).toString(),g=`https://api.maptiler.com/geocoding/${h}.json?${p}`,v=await(await fetch(g)).json(),b=1;for(let d of v.features)d.properties.number=b++;st(ti,i=v,i)}function u(h,p){h.preventDefault(),n.addSnappedWaypoint(p),t(0,a="")}function f(h){a=h,t(0,a)}const c=(h,p)=>u(p,h.center);return r.$$set=h=>{"cfg"in h&&t(3,s=h.cfg)},r.$$.update=()=>{r.$$.dirty&1&&l(a)},[a,i,u,s,f,c]}class Sb extends Z{constructor(e){super(),Q(this,e,wb,bb,K,{cfg:3})}}function $b(r){let e,t,n;return{c(){e=z("Undo ("),t=z(r[3]),n=z(")")},m(i,o){w(i,e,o),w(i,t,o),w(i,n,o)},p(i,o){o&8&&de(t,i[3])},d(i){i&&(S(e),S(t),S(n))}}}function kb(r){let e;return{c(){e=z("Undo")},m(t,n){w(t,e,n)},p:x,d(t){t&&S(e)}}}function Eb(r){let e;function t(o,s){return o[3]==0?kb:$b}let n=t(r),i=n(r);return{c(){i.c(),e=me()},m(o,s){i.m(o,s),w(o,e,s)},p(o,s){n===(n=t(o))&&i?i.p(o,s):(i.d(1),i=n(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){o&&S(e),i.d(o)}}}function Mb(r){let e,t,n,i;return n=new pe({props:{$$slots:{default:[Lb]},$$scope:{ctx:r}}}),n.$on("click",r[6]),{c(){e=T("p"),e.innerHTML=`Drawing points anywhere. Press <b>s</b>
    or click below to snap to roads`,t=B(),L(n.$$.fragment),ve(e,"background","blue"),ve(e,"color","white"),ve(e,"padding","8px")},m(o,s){w(o,e,s),w(o,t,s),A(n,o,s),i=!0},p(o,s){const a={};s&1024&&(a.$$scope={dirty:s,ctx:o}),n.$set(a)},i(o){i||($(n.$$.fragment,o),i=!0)},o(o){E(n.$$.fragment,o),i=!1},d(o){o&&(S(e),S(t)),C(n,o)}}}function Pb(r){let e,t,n,i;return n=new pe({props:{$$slots:{default:[Ab]},$$scope:{ctx:r}}}),n.$on("click",r[6]),{c(){e=T("p"),e.innerHTML=`Snapping to existing roads. Press <b>s</b>
    or click below to draw anywhere`,t=B(),L(n.$$.fragment),ve(e,"background","red"),ve(e,"color","white"),ve(e,"padding","8px")},m(o,s){w(o,e,s),w(o,t,s),A(n,o,s),i=!0},p(o,s){const a={};s&1024&&(a.$$scope={dirty:s,ctx:o}),n.$set(a)},i(o){i||($(n.$$.fragment,o),i=!0)},o(o){E(n.$$.fragment,o),i=!1},d(o){o&&(S(e),S(t)),C(n,o)}}}function Lb(r){let e;return{c(){e=z("Snap to roads")},m(t,n){w(t,e,n)},d(t){t&&S(e)}}}function Ab(r){let e;return{c(){e=z("Draw anywhere")},m(t,n){w(t,e,n)},d(t){t&&S(e)}}}function Cb(r){let e;return{c(){e=z("Add points to end")},m(t,n){w(t,e,n)},d(t){t&&S(e)}}}function Ob(r){let e;return{c(){e=z("Avoid doubling back")},m(t,n){w(t,e,n)},d(t){t&&S(e)}}}function Fb(r){let e,t,n,i,o,s;function a(c){r[8](c)}let l={hint:"Keep clicking to add more points to the end of the route",$$slots:{default:[Cb]},$$scope:{ctx:r}};r[0]!==void 0&&(l.checked=r[0]),e=new vo({props:l}),_e.push(()=>$e(e,"checked",a));function u(c){r[9](c)}let f={hint:"Try to make the route avoid using the same streets with multiple waypoints",$$slots:{default:[Ob]},$$scope:{ctx:r}};return r[2].avoidDoublingBack!==void 0&&(f.checked=r[2].avoidDoublingBack),i=new vo({props:f}),_e.push(()=>$e(i,"checked",u)),{c(){L(e.$$.fragment),n=B(),L(i.$$.fragment)},m(c,h){A(e,c,h),w(c,n,h),A(i,c,h),s=!0},p(c,h){const p={};h&1024&&(p.$$scope={dirty:h,ctx:c}),!t&&h&1&&(t=!0,p.checked=c[0],Pe(()=>t=!1)),e.$set(p);const g={};h&1024&&(g.$$scope={dirty:h,ctx:c}),!o&&h&4&&(o=!0,g.checked=c[2].avoidDoublingBack,Pe(()=>o=!1)),i.$set(g)},i(c){s||($(e.$$.fragment,c),$(i.$$.fragment,c),s=!0)},o(c){E(e.$$.fragment,c),E(i.$$.fragment,c),s=!1},d(c){c&&S(n),C(e,c),C(i,c)}}}function Mu(r){let e,t;return e=new Sb({props:{cfg:r[1]}}),{c(){L(e.$$.fragment)},m(n,i){A(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.cfg=n[1]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){E(e.$$.fragment,n),t=!1},d(n){C(e,n)}}}function Rb(r){let e,t,n,i,o,s,a,l,u,f,c;e=new pe({props:{disabled:r[3]==0,$$slots:{default:[Eb]},$$scope:{ctx:r}}}),e.$on("click",r[5]);const h=[Pb,Mb],p=[];function g(v,b){return v[4]?0:1}n=g(r),i=p[n]=h[n](r),l=new Up({props:{small:!0,$$slots:{default:[Fb]},$$scope:{ctx:r}}});let m=r[1].maptilerApiKey&&Mu(r);return{c(){L(e.$$.fragment),t=B(),i.c(),o=B(),s=T("ul"),s.innerHTML=`<li><b>Click</b>
    the map to add points</li> <li>Press <b>s</b>
    to switch between snapping points to existing roads and drawing anywhere</li> <li><b>Click and drag</b>
    any point to move it</li> <li><b>Click</b>
    a waypoint to delete it</li> <li>Press <b>Control+Z</b>
    to undo your last change</li> <li>Press <b>Enter</b>
    or
    <b>double click</b>
    to finish</li> <li>Press <b>Escape</b>
    to cancel</li>`,a=B(),L(l.$$.fragment),u=B(),m&&m.c(),f=me()},m(v,b){A(e,v,b),w(v,t,b),p[n].m(v,b),w(v,o,b),w(v,s,b),w(v,a,b),A(l,v,b),w(v,u,b),m&&m.m(v,b),w(v,f,b),c=!0},p(v,[b]){const d={};b&8&&(d.disabled=v[3]==0),b&1032&&(d.$$scope={dirty:b,ctx:v}),e.$set(d);let y=n;n=g(v),n===y?p[n].p(v,b):(ue(),E(p[y],1,1,()=>{p[y]=null}),fe(),i=p[n],i?i.p(v,b):(i=p[n]=h[n](v),i.c()),$(i,1),i.m(o.parentNode,o));const k={};b&1029&&(k.$$scope={dirty:b,ctx:v}),l.$set(k),v[1].maptilerApiKey?m?(m.p(v,b),b&2&&$(m,1)):(m=Mu(v),m.c(),$(m,1),m.m(f.parentNode,f)):m&&(ue(),E(m,1,1,()=>{m=null}),fe())},i(v){c||($(e.$$.fragment,v),$(i),$(l.$$.fragment,v),$(m),c=!0)},o(v){E(e.$$.fragment,v),E(i),E(l.$$.fragment,v),E(m),c=!1},d(v){v&&(S(t),S(o),S(s),S(a),S(u),S(f)),C(e,v),p[n].d(v),C(l,v),m&&m.d(v)}}}function Bb(r,e,t){let n,i,o,s;J(r,Pt,p=>t(7,n=p)),J(r,ir,p=>t(2,i=p)),J(r,js,p=>t(3,o=p)),J(r,Zc,p=>t(4,s=p));let{cfg:a}=e,{extendRoute:l}=e;function u(){n.undo()}function f(){n.toggleSnapMode()}function c(p){l=p,t(0,l)}function h(p){r.$$.not_equal(i.avoidDoublingBack,p)&&(i.avoidDoublingBack=p,ir.set(i))}return r.$$set=p=>{"cfg"in p&&t(1,a=p.cfg),"extendRoute"in p&&t(0,l=p.extendRoute)},r.$$.update=()=>{r.$$.dirty&133&&n.setRouteConfig({avoid_doubling_back:i.avoidDoublingBack,extend_route:l})},[l,a,i,o,s,u,f,n,c,h]}class Qc extends Z{constructor(e){super(),Q(this,e,Bb,Rb,K,{cfg:1,extendRoute:0})}}function Ib(r){let e,t,n;return{c(){e=z("Undo ("),t=z(r[0]),n=z(")")},m(i,o){w(i,e,o),w(i,t,o),w(i,n,o)},p(i,o){o&1&&de(t,i[0])},d(i){i&&(S(e),S(t),S(n))}}}function Nb(r){let e;return{c(){e=z("Undo")},m(t,n){w(t,e,n)},p:x,d(t){t&&S(e)}}}function Tb(r){let e;function t(o,s){return o[0]==0?Nb:Ib}let n=t(r),i=n(r);return{c(){i.c(),e=me()},m(o,s){i.m(o,s),w(o,e,s)},p(o,s){n===(n=t(o))&&i?i.p(o,s):(i.d(1),i=n(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){o&&S(e),i.d(o)}}}function Db(r){let e,t,n,i;return e=new pe({props:{disabled:r[0]==0,$$slots:{default:[Tb]},$$scope:{ctx:r}}}),e.$on("click",r[1]),{c(){L(e.$$.fragment),t=B(),n=T("ul"),n.innerHTML=`<li><b>Click</b>
    the map to add points</li> <li><b>Click and drag</b>
    any point to move it</li> <li><b>Click</b>
    a waypoint to delete it</li> <li>Press <b>Control+Z</b>
    to undo your last change</li> <li>Press <b>Enter</b>
    or
    <b>double click</b>
    to finish</li> <li>Press <b>Escape</b>
    to cancel</li>`},m(o,s){A(e,o,s),w(o,t,s),w(o,n,s),i=!0},p(o,[s]){const a={};s&1&&(a.disabled=o[0]==0),s&9&&(a.$$scope={dirty:s,ctx:o}),e.$set(a)},i(o){i||($(e.$$.fragment,o),i=!0)},o(o){E(e.$$.fragment,o),i=!1},d(o){o&&(S(t),S(n)),C(e,o)}}}function jb(r,e,t){let n,i;J(r,Pt,s=>t(2,n=s)),J(r,js,s=>t(0,i=s));function o(){n.undo()}return[i,o]}class xc extends Z{constructor(e){super(),Q(this,e,jb,Db,K,{})}}function Gb(r){let e;return{c(){e=z("Finish")},m(t,n){w(t,e,n)},d(t){t&&S(e)}}}function Ub(r){let e;return{c(){e=z("Cancel")},m(t,n){w(t,e,n)},d(t){t&&S(e)}}}function qb(r){let e,t,n,i;return e=new Wt({props:{$$slots:{default:[Gb]},$$scope:{ctx:r}}}),e.$on("click",r[3]),n=new pe({props:{$$slots:{default:[Ub]},$$scope:{ctx:r}}}),n.$on("click",r[4]),{c(){L(e.$$.fragment),t=B(),L(n.$$.fragment)},m(o,s){A(e,o,s),w(o,t,s),A(n,o,s),i=!0},p(o,s){const a={};s&32768&&(a.$$scope={dirty:s,ctx:o}),e.$set(a);const l={};s&32768&&(l.$$scope={dirty:s,ctx:o}),n.$set(l)},i(o){i||($(e.$$.fragment,o),$(n.$$.fragment,o),i=!0)},o(o){E(e.$$.fragment,o),E(n.$$.fragment,o),i=!1},d(o){o&&S(t),C(e,o),C(n,o)}}}function zb(r){let e,t;return e=new xc({}),{c(){L(e.$$.fragment)},m(n,i){A(e,n,i),t=!0},p:x,i(n){t||($(e.$$.fragment,n),t=!0)},o(n){E(e.$$.fragment,n),t=!1},d(n){C(e,n)}}}function Wb(r){let e,t;return e=new Xc({}),{c(){L(e.$$.fragment)},m(n,i){A(e,n,i),t=!0},p:x,i(n){t||($(e.$$.fragment,n),t=!0)},o(n){E(e.$$.fragment,n),t=!1},d(n){C(e,n)}}}function Hb(r){let e,t;return e=new Qc({props:{cfg:r[0],extendRoute:!1}}),{c(){L(e.$$.fragment)},m(n,i){A(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.cfg=n[0]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){E(e.$$.fragment,n),t=!1},d(n){C(e,n)}}}function Vb(r){let e,t;return e=new Yc({props:{editingExisting:!0}}),{c(){L(e.$$.fragment)},m(n,i){A(e,n,i),t=!0},p:x,i(n){t||($(e.$$.fragment,n),t=!0)},o(n){E(e.$$.fragment,n),t=!1},d(n){C(e,n)}}}function Jb(r){let e,t,n,i,o,s,a,l,u,f;o=new or({props:{$$slots:{default:[qb]},$$scope:{ctx:r}}});const c=[Vb,Hb,Wb,zb],h=[];function p(g,m){return g[2]=="point"?0:g[2]=="route"?1:g[2]=="freehand-polygon"?2:g[2]=="snapped-polygon"?3:-1}return~(a=p(r))&&(l=h[a]=c[a](r)),{c(){e=T("h2"),t=z("Editing "),n=z(r[1]),i=B(),L(o.$$.fragment),s=B(),l&&l.c(),u=me()},m(g,m){w(g,e,m),j(e,t),j(e,n),w(g,i,m),A(o,g,m),w(g,s,m),~a&&h[a].m(g,m),w(g,u,m),f=!0},p(g,[m]){(!f||m&2)&&de(n,g[1]);const v={};m&32768&&(v.$$scope={dirty:m,ctx:g}),o.$set(v);let b=a;a=p(g),a===b?~a&&h[a].p(g,m):(l&&(ue(),E(h[b],1,1,()=>{h[b]=null}),fe()),~a?(l=h[a],l?l.p(g,m):(l=h[a]=c[a](g),l.c()),$(l,1),l.m(u.parentNode,u)):l=null)},i(g){f||($(o.$$.fragment,g),$(l),f=!0)},o(g){E(o.$$.fragment,g),E(l),f=!1},d(g){g&&(S(e),S(i),S(s),S(u)),C(o,g),~a&&h[a].d(g)}}}function Yb(r,e,t){let n,i,o;J(r,Cr,d=>t(8,n=d)),J(r,Pt,d=>t(9,i=d)),J(r,yn,d=>t(10,o=d));let{cfg:s}=e,{gjSchemes:a}=e,{id:l}=e,u="",f="",c=null;Ft(()=>{let d=null;a.update(k=>(d=k.features.find(_=>_.id==l),d.properties.hide_while_editing=!0,k));let y=d;t(1,u=s.interventionName(y)),y.geometry.type=="LineString"?(i==null||i.editExistingRoute(y),i==null||i.addEventListenerSuccess(h),i==null||i.addEventListenerUpdated(p),i==null||i.addEventListenerFailure(g),t(2,f="route")):y.geometry.type=="Polygon"?y.properties.waypoints?(i==null||i.editExistingArea(y),i==null||i.addEventListenerSuccess(h),i==null||i.addEventListenerUpdated(p),i==null||i.addEventListenerFailure(g),t(2,f="snapped-polygon")):(n==null||n.editExisting(y),n==null||n.addEventListenerSuccess(h),n==null||n.addEventListenerUpdated(p),n==null||n.addEventListenerFailure(g),t(2,f="freehand-polygon")):y.geometry.type=="Point"&&(o==null||o.start(),o==null||o.addEventListenerSuccess(h),o==null||o.addEventListenerFailure(g),t(2,f="point"))}),tt(()=>{o==null||o.stop(),o==null||o.clearEventListeners(),i==null||i.stop(),i==null||i.clearEventListeners(),n==null||n.stop(),n==null||n.clearEventListeners(),a.update(d=>{let y=d.features.find(k=>k.id==l);return delete y.properties.hide_while_editing,c&&m(y,c),d})});function h(d){d.properties??(d.properties={}),c=d,te.set({mode:"edit-form",id:l})}function p(d){c=d}function g(){c=null,te.set({mode:"edit-form",id:l})}function m(d,y){d.geometry=y.geometry,y.properties.length_meters&&(d.properties.length_meters=y.properties.length_meters),y.properties.waypoints&&(d.properties.waypoints=y.properties.waypoints),s.updateFeature(d,y)}function v(){te.set({mode:"edit-form",id:l})}function b(){c=null,te.set({mode:"edit-form",id:l})}return r.$$set=d=>{"cfg"in d&&t(0,s=d.cfg),"gjSchemes"in d&&t(5,a=d.gjSchemes),"id"in d&&t(6,l=d.id)},[s,u,f,v,b,a,l]}class Xb extends Z{constructor(e){super(),Q(this,e,Yb,Jb,K,{cfg:0,gjSchemes:5,id:6})}}const ri=Oe(null),ni=Oe(100);function Pu(r){let e,t;return e=new Ph({props:{url:r[3],coordinates:[[r[1].lng,r[1].lat],[r[4].lng,r[1].lat],[r[4].lng,r[4].lat],[r[1].lng,r[4].lat]],$$slots:{default:[Kb]},$$scope:{ctx:r}}}),{c(){L(e.$$.fragment)},m(n,i){A(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.url=n[3]),i&18&&(o.coordinates=[[n[1].lng,n[1].lat],[n[4].lng,n[1].lat],[n[4].lng,n[4].lat],[n[1].lng,n[4].lat]]),i&545&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){E(e.$$.fragment,n),t=!1},d(n){C(e,n)}}}function Kb(r){let e,t;const n=[oe(r[0],"georeferenced-image"),{paint:{"raster-fade-duration":0,"raster-opacity":r[5]/100}}];let i={};for(let o=0;o<n.length;o+=1)i=he(i,n[o]);return e=new xh({props:i}),{c(){L(e.$$.fragment)},m(o,s){A(e,o,s),t=!0},p(o,s){const a=s&33?we(n,[s&1&&Ce(oe(o[0],"georeferenced-image")),s&32&&{paint:{"raster-fade-duration":0,"raster-opacity":o[5]/100}}]):{};e.$set(a)},i(o){t||($(e.$$.fragment,o),t=!0)},o(o){E(e.$$.fragment,o),t=!1},d(o){C(e,o)}}}function Lu(r){let e,t,n,i,o,s;function a(c){r[7](c)}let l={draggable:!0,$$slots:{default:[Zb]},$$scope:{ctx:r}};r[1]!==void 0&&(l.lngLat=r[1]),e=new bo({props:l}),_e.push(()=>$e(e,"lngLat",a));function u(c){r[8](c)}let f={draggable:!0,$$slots:{default:[Qb]},$$scope:{ctx:r}};return r[4]!==void 0&&(f.lngLat=r[4]),i=new bo({props:f}),_e.push(()=>$e(i,"lngLat",u)),{c(){L(e.$$.fragment),n=B(),L(i.$$.fragment)},m(c,h){A(e,c,h),w(c,n,h),A(i,c,h),s=!0},p(c,h){const p={};h&512&&(p.$$scope={dirty:h,ctx:c}),!t&&h&2&&(t=!0,p.lngLat=c[1],Pe(()=>t=!1)),e.$set(p);const g={};h&512&&(g.$$scope={dirty:h,ctx:c}),!o&&h&16&&(o=!0,g.lngLat=c[4],Pe(()=>o=!1)),i.$set(g)},i(c){s||($(e.$$.fragment,c),$(i.$$.fragment,c),s=!0)},o(c){E(e.$$.fragment,c),E(i.$$.fragment,c),s=!1},d(c){c&&S(n),C(e,c),C(i,c)}}}function Zb(r){let e;return{c(){e=T("span"),N(e,"class","dot svelte-1tmbx1c"),ve(e,"background-color","red")},m(t,n){w(t,e,n)},p:x,d(t){t&&S(e)}}}function Qb(r){let e;return{c(){e=T("span"),N(e,"class","dot svelte-1tmbx1c"),ve(e,"background-color","blue")},m(t,n){w(t,e,n)},p:x,d(t){t&&S(e)}}}function xb(r){let e,t,n,i=r[3]&&Pu(r),o=r[3]&&r[2].mode=="set-image"&&Lu(r);return{c(){i&&i.c(),e=B(),o&&o.c(),t=me()},m(s,a){i&&i.m(s,a),w(s,e,a),o&&o.m(s,a),w(s,t,a),n=!0},p(s,[a]){s[3]?i?(i.p(s,a),a&8&&$(i,1)):(i=Pu(s),i.c(),$(i,1),i.m(e.parentNode,e)):i&&(ue(),E(i,1,1,()=>{i=null}),fe()),s[3]&&s[2].mode=="set-image"?o?(o.p(s,a),a&12&&$(o,1)):(o=Lu(s),o.c(),$(o,1),o.m(t.parentNode,t)):o&&(ue(),E(o,1,1,()=>{o=null}),fe())},i(s){n||($(i),$(o),n=!0)},o(s){E(i),E(o),n=!1},d(s){s&&(S(e),S(t)),i&&i.d(s),o&&o.d(s)}}}function e1(r,e,t){let n,i,o,s;J(r,et,h=>t(6,n=h)),J(r,te,h=>t(2,i=h)),J(r,ri,h=>t(3,o=h)),J(r,ni,h=>t(5,s=h));let{cfg:a}=e,l={lng:0,lat:0},u={lng:0,lat:0};function f(h){l=h,t(1,l),t(6,n),t(3,o),t(2,i)}function c(h){u=h,t(4,u),t(6,n),t(3,o),t(2,i),t(1,l)}return r.$$set=h=>{"cfg"in h&&t(0,a=h.cfg)},r.$$.update=()=>{if(r.$$.dirty&78&&n&&o&&i.mode=="set-image"&&l.lng==0&&l.lat==0){let h=n.getBounds();t(1,l.lng=h.getWest()+.4*(h.getEast()-h.getWest()),l),t(4,u.lng=h.getWest()+.6*(h.getEast()-h.getWest()),u),t(1,l.lat=h.getNorth()+.4*(h.getSouth()-h.getNorth()),l),t(4,u.lat=h.getNorth()+.6*(h.getSouth()-h.getNorth()),u)}},[a,l,i,o,u,s,n,f,c]}class t1 extends Z{constructor(e){super(),Q(this,e,e1,xb,K,{cfg:0})}}function r1(r){let e,t,n,i,o,s;const a=[oe(r[0],"hover-polygons"),{filter:Zt},{paint:{"line-color":nn.hovering,"line-width":.5*Kt}}];let l={};for(let p=0;p<a.length;p+=1)l=he(l,a[p]);e=new _r({props:l});const u=[oe(r[0],"hover-lines"),{filter:cn},{paint:{"line-color":nn.hovering,"line-width":1.5*Kt}}];let f={};for(let p=0;p<u.length;p+=1)f=he(f,u[p]);n=new _r({props:f});const c=[oe(r[0],"hover-points"),{filter:pn},{paint:{"circle-color":nn.hovering,"circle-radius":1.5*Ri}}];let h={};for(let p=0;p<c.length;p+=1)h=he(h,c[p]);return o=new br({props:h}),{c(){L(e.$$.fragment),t=B(),L(n.$$.fragment),i=B(),L(o.$$.fragment)},m(p,g){A(e,p,g),w(p,t,g),A(n,p,g),w(p,i,g),A(o,p,g),s=!0},p(p,g){const m=g&1?we(a,[Ce(oe(p[0],"hover-polygons")),a[1],a[2]]):{};e.$set(m);const v=g&1?we(u,[Ce(oe(p[0],"hover-lines")),u[1],u[2]]):{};n.$set(v);const b=g&1?we(c,[Ce(oe(p[0],"hover-points")),c[1],c[2]]):{};o.$set(b)},i(p){s||($(e.$$.fragment,p),$(n.$$.fragment,p),$(o.$$.fragment,p),s=!0)},o(p){E(e.$$.fragment,p),E(n.$$.fragment,p),E(o.$$.fragment,p),s=!1},d(p){p&&(S(t),S(i)),C(e,p),C(n,p),C(o,p)}}}function n1(r){let e,t;return e=new rr({props:{data:r[2],$$slots:{default:[r1]},$$scope:{ctx:r}}}),{c(){L(e.$$.fragment)},m(n,i){A(e,n,i),t=!0},p(n,[i]){const o={};i&4&&(o.data=n[2]),i&33&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){E(e.$$.fragment,n),t=!1},d(n){C(e,n)}}}function i1(r,e,t){let n,i,o,s=x,a=()=>(s(),s=zt(u,f=>t(4,o=f)),u);J(r,on,f=>t(3,i=f)),r.$$.on_destroy.push(()=>s());let{cfg:l}=e,{gjSchemes:u}=e;return a(),r.$$set=f=>{"cfg"in f&&t(0,l=f.cfg),"gjSchemes"in f&&a(t(1,u=f.gjSchemes))},r.$$.update=()=>{r.$$.dirty&24&&t(2,n=i==null?Mr():o.features.find(f=>f.id==i))},[l,u,n,i,o]}class o1 extends Z{constructor(e){super(),Q(this,e,i1,n1,K,{cfg:0,gjSchemes:1})}}function Au(r){let e,t;return e=new ps({props:{openOn:"hover",openIfTopMost:!0,$$slots:{default:[s1,({features:n})=>({16:n}),({features:n})=>n?65536:0]},$$scope:{ctx:r}}}),{c(){L(e.$$.fragment)},m(n,i){A(e,n,i),t=!0},p(n,i){const o={};i&196608&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){E(e.$$.fragment,n),t=!1},d(n){C(e,n)}}}function s1(r){let e,t,n=r[9](r[16])+"",i;return{c(){e=T("div"),t=T("p"),i=z(n),N(e,"class","govuk-prose")},m(o,s){w(o,e,s),j(e,t),j(t,i)},p(o,s){s&65536&&n!==(n=o[9](o[16])+"")&&de(i,n)},d(o){o&&S(e)}}}function a1(r){let e,t,n=r[4]&&Au(r);return{c(){n&&n.c(),e=me()},m(i,o){n&&n.m(i,o),w(i,e,o),t=!0},p(i,o){i[4]?n?(n.p(i,o),o&16&&$(n,1)):(n=Au(i),n.c(),$(n,1),n.m(e.parentNode,e)):n&&(ue(),E(n,1,1,()=>{n=null}),fe())},i(i){t||($(n),t=!0)},o(i){E(n),t=!1},d(i){i&&S(e),n&&n.d(i)}}}function Cu(r){let e,t;return e=new ps({props:{openOn:"hover",openIfTopMost:!0,$$slots:{default:[l1,({features:n})=>({16:n}),({features:n})=>n?65536:0]},$$scope:{ctx:r}}}),{c(){L(e.$$.fragment)},m(n,i){A(e,n,i),t=!0},p(n,i){const o={};i&196608&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){E(e.$$.fragment,n),t=!1},d(n){C(e,n)}}}function l1(r){let e,t,n=r[9](r[16])+"",i;return{c(){e=T("div"),t=T("p"),i=z(n),N(e,"class","govuk-prose")},m(o,s){w(o,e,s),j(e,t),j(t,i)},p(o,s){s&65536&&n!==(n=o[9](o[16])+"")&&de(i,n)},d(o){o&&S(e)}}}function u1(r){let e,t,n=r[4]&&Cu(r);return{c(){n&&n.c(),e=me()},m(i,o){n&&n.m(i,o),w(i,e,o),t=!0},p(i,o){i[4]?n?(n.p(i,o),o&16&&$(n,1)):(n=Cu(i),n.c(),$(n,1),n.m(e.parentNode,e)):n&&(ue(),E(n,1,1,()=>{n=null}),fe())},i(i){t||($(n),t=!0)},o(i){E(n),t=!1},d(i){i&&S(e),n&&n.d(i)}}}function Ou(r){let e,t;return e=new ps({props:{openOn:"hover",openIfTopMost:!0,$$slots:{default:[f1,({features:n})=>({16:n}),({features:n})=>n?65536:0]},$$scope:{ctx:r}}}),{c(){L(e.$$.fragment)},m(n,i){A(e,n,i),t=!0},p(n,i){const o={};i&196608&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){E(e.$$.fragment,n),t=!1},d(n){C(e,n)}}}function f1(r){let e,t,n=r[9](r[16])+"",i;return{c(){e=T("div"),t=T("p"),i=z(n),N(e,"class","govuk-prose")},m(o,s){w(o,e,s),j(e,t),j(t,i)},p(o,s){s&65536&&n!==(n=o[9](o[16])+"")&&de(i,n)},d(o){o&&S(e)}}}function c1(r){let e,t,n=r[4]&&Ou(r);return{c(){n&&n.c(),e=me()},m(i,o){n&&n.m(i,o),w(i,e,o),t=!0},p(i,o){i[4]?n?(n.p(i,o),o&16&&$(n,1)):(n=Ou(i),n.c(),$(n,1),n.m(e.parentNode,e)):n&&(ue(),E(n,1,1,()=>{n=null}),fe())},i(i){t||($(n),t=!0)},o(i){E(n),t=!1},d(i){i&&S(e),n&&n.d(i)}}}function p1(r){let e,t,n,i,o,s,a,l,u,f;const c=[oe(r[0],"interventions-points"),{filter:["all",pn,r[6],r[7],r[3]]},{paint:{"circle-color":r[2],"circle-radius":Ri}},{hoverCursor:r[4]?"pointer":void 0},{manageHoverState:r[4]}];let h={$$slots:{default:[a1]},$$scope:{ctx:r}};for(let _=0;_<c.length;_+=1)h=he(h,c[_]);e=new br({props:h}),e.$on("click",r[8]);const p=[oe(r[0],"interventions-lines"),{filter:["all",cn,r[6],r[3]]},{paint:{"line-color":r[2],"line-width":Kt}},{hoverCursor:r[4]?"pointer":void 0},{manageHoverState:r[4]}];let g={$$slots:{default:[u1]},$$scope:{ctx:r}};for(let _=0;_<p.length;_+=1)g=he(g,p[_]);n=new _r({props:g}),n.$on("click",r[8]);const m=[oe(r[0],"interventions-lines-endpoints"),{filter:["all",["==",["get","endpoint"],!0],r[3]]},{paint:{"circle-radius":.5*Kt,"circle-opacity":0,"circle-stroke-color":nn.lineEndpointColor,"circle-stroke-width":2}}];let v={};for(let _=0;_<m.length;_+=1)v=he(v,m[_]);o=new br({props:v});const b=[oe(r[0],"interventions-polygons"),{filter:["all",Zt,r[6],r[3]]},{paint:{"fill-color":r[2],"fill-opacity":.2}},{hoverCursor:r[4]?"pointer":void 0},{manageHoverState:r[4]}];let d={$$slots:{default:[c1]},$$scope:{ctx:r}};for(let _=0;_<b.length;_+=1)d=he(d,b[_]);a=new vn({props:d}),a.$on("click",r[8]);const y=[oe(r[0],"interventions-polygons-outlines"),{filter:["all",Zt,r[6],r[3]]},{paint:{"line-color":r[2],"line-opacity":.5,"line-width":.7*Kt}}];let k={};for(let _=0;_<y.length;_+=1)k=he(k,y[_]);return u=new _r({props:k}),{c(){L(e.$$.fragment),t=B(),L(n.$$.fragment),i=B(),L(o.$$.fragment),s=B(),L(a.$$.fragment),l=B(),L(u.$$.fragment)},m(_,M){A(e,_,M),w(_,t,M),A(n,_,M),w(_,i,M),A(o,_,M),w(_,s,M),A(a,_,M),w(_,l,M),A(u,_,M),f=!0},p(_,M){const F=M&221?we(c,[M&1&&Ce(oe(_[0],"interventions-points")),M&200&&{filter:["all",pn,_[6],_[7],_[3]]},M&4&&{paint:{"circle-color":_[2],"circle-radius":Ri}},M&16&&{hoverCursor:_[4]?"pointer":void 0},M&16&&{manageHoverState:_[4]}]):{};M&131088&&(F.$$scope={dirty:M,ctx:_}),e.$set(F);const I=M&93?we(p,[M&1&&Ce(oe(_[0],"interventions-lines")),M&72&&{filter:["all",cn,_[6],_[3]]},M&4&&{paint:{"line-color":_[2],"line-width":Kt}},M&16&&{hoverCursor:_[4]?"pointer":void 0},M&16&&{manageHoverState:_[4]}]):{};M&131088&&(I.$$scope={dirty:M,ctx:_}),n.$set(I);const U=M&9?we(m,[M&1&&Ce(oe(_[0],"interventions-lines-endpoints")),M&8&&{filter:["all",["==",["get","endpoint"],!0],_[3]]},m[2]]):{};o.$set(U);const W=M&93?we(b,[M&1&&Ce(oe(_[0],"interventions-polygons")),M&72&&{filter:["all",Zt,_[6],_[3]]},M&4&&{paint:{"fill-color":_[2],"fill-opacity":.2}},M&16&&{hoverCursor:_[4]?"pointer":void 0},M&16&&{manageHoverState:_[4]}]):{};M&131088&&(W.$$scope={dirty:M,ctx:_}),a.$set(W);const O=M&77?we(y,[M&1&&Ce(oe(_[0],"interventions-polygons-outlines")),M&72&&{filter:["all",Zt,_[6],_[3]]},M&4&&{paint:{"line-color":_[2],"line-opacity":.5,"line-width":.7*Kt}}]):{};u.$set(O)},i(_){f||($(e.$$.fragment,_),$(n.$$.fragment,_),$(o.$$.fragment,_),$(a.$$.fragment,_),$(u.$$.fragment,_),f=!0)},o(_){E(e.$$.fragment,_),E(n.$$.fragment,_),E(o.$$.fragment,_),E(a.$$.fragment,_),E(u.$$.fragment,_),f=!1},d(_){_&&(S(t),S(i),S(s),S(l)),C(e,_),C(n,_),C(o,_),C(a,_),C(u,_)}}}function h1(r){let e,t;return e=new rr({props:{data:r[5],$$slots:{default:[p1]},$$scope:{ctx:r}}}),{c(){L(e.$$.fragment)},m(n,i){A(e,n,i),t=!0},p(n,[i]){const o={};i&32&&(o.data=n[5]),i&131101&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){E(e.$$.fragment,n),t=!1},d(n){C(e,n)}}}function g1(r){let e=["all"];for(let t of r.keys())e.push(["!=",["get","scheme_reference"],t]);return e}function m1(r,e,t){let n,i,o,s,a,l=x,u=()=>(l(),l=zt(g,_=>t(11,a=_)),g),f,c,h;J(r,et,_=>t(14,f=_)),J(r,te,_=>t(12,c=_)),J(r,ei,_=>t(13,h=_)),r.$$.on_destroy.push(()=>l());let{cfg:p}=e,{gjSchemes:g}=e;u();const m=["!=",["get","hide_while_editing"],!0],v=["!=",["get","endpoint"],!0];let b;function d(_){return Hr(["get","scheme_reference"],Object.fromEntries(Object.values(_.schemes).map(M=>[M.scheme_reference,M.color])),"black")}function y(_){c.mode!="list"||!f||_.detail.features[0]&&(f.getCanvas().style.cursor="inherit",te.set({mode:"edit-form",id:_.detail.features[0].id}))}function k(_){if(_){let M=_[0],F=p.interventionName(M),I=p.schemeName(a.schemes[M.properties.scheme_reference]);return`${F} (${I})`}return"Tooltip bug"}return r.$$set=_=>{"cfg"in _&&t(0,p=_.cfg),"gjSchemes"in _&&u(t(1,g=_.gjSchemes))},r.$$.update=()=>{if(r.$$.dirty&2048&&t(5,n=B_(a)),r.$$.dirty&4096&&t(4,i=c.mode=="list"),r.$$.dirty&8192&&t(3,o=g1(h)),r.$$.dirty&2048&&t(10,s=d(a)),r.$$.dirty&5120){let _="grey";c.mode=="edit-form"?t(2,b=["case",["==",["id"],c.id],s,_]):c.mode=="list"?t(2,b=s):c.mode=="split-route"?t(2,b=["case",["==","intervention_type","route"],s,_]):t(2,b=_)}},[p,g,b,o,i,n,m,v,y,k,s,a,c,h]}class d1 extends Z{constructor(e){super(),Q(this,e,m1,h1,K,{cfg:0,gjSchemes:1})}}function y1(r){let e,t,n,i,o,s;const a=[oe(r[0],"edit-polygon-fill"),{filter:Zt},{paint:{"fill-color":"red","fill-opacity":["case",["boolean",["get","hover"],"false"],1,.5]}}];let l={};for(let p=0;p<a.length;p+=1)l=he(l,a[p]);e=new vn({props:l});const u=[oe(r[0],"edit-polygon-lines"),{filter:cn},{paint:{"line-color":"black","line-width":8,"line-opacity":.5}}];let f={};for(let p=0;p<u.length;p+=1)f=he(f,u[p]);n=new _r({props:f});const c=[oe(r[0],"edit-polygon-vertices"),{filter:pn},{paint:{"circle-color":nn.hovering,"circle-opacity":["case",["has","hovered"],1,.5],"circle-radius":Ri}}];let h={};for(let p=0;p<c.length;p+=1)h=he(h,c[p]);return o=new br({props:h}),{c(){L(e.$$.fragment),t=B(),L(n.$$.fragment),i=B(),L(o.$$.fragment)},m(p,g){A(e,p,g),w(p,t,g),A(n,p,g),w(p,i,g),A(o,p,g),s=!0},p(p,g){const m=g&1?we(a,[Ce(oe(p[0],"edit-polygon-fill")),a[1],a[2]]):{};e.$set(m);const v=g&1?we(u,[Ce(oe(p[0],"edit-polygon-lines")),u[1],u[2]]):{};n.$set(v);const b=g&1?we(c,[Ce(oe(p[0],"edit-polygon-vertices")),c[1],c[2]]):{};o.$set(b)},i(p){s||($(e.$$.fragment,p),$(n.$$.fragment,p),$(o.$$.fragment,p),s=!0)},o(p){E(e.$$.fragment,p),E(n.$$.fragment,p),E(o.$$.fragment,p),s=!1},d(p){p&&(S(t),S(i)),C(e,p),C(n,p),C(o,p)}}}function v1(r){let e,t;return e=new rr({props:{data:r[1],$$slots:{default:[y1]},$$scope:{ctx:r}}}),{c(){L(e.$$.fragment)},m(n,i){A(e,n,i),t=!0},p(n,[i]){const o={};i&2&&(o.data=n[1]),i&5&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){E(e.$$.fragment,n),t=!1},d(n){C(e,n)}}}function _1(r,e,t){let n;J(r,Oc,o=>t(1,n=o));let{cfg:i}=e;return r.$$set=o=>{"cfg"in o&&t(0,i=o.cfg)},[i,n]}class b1 extends Z{constructor(e){super(),Q(this,e,_1,v1,K,{cfg:0})}}function w1(r){let e,t,n,i,o,s;const a=[oe(r[0],"route-points"),{filter:pn},{paint:{"circle-color":Hr(["get","type"],{"snapped-waypoint":"red","free-waypoint":"blue"},"black"),"circle-opacity":["case",["has","hovered"],.5,1],"circle-radius":Hr(["get","type"],{node:Nn/2},Nn)}}];let l={};for(let p=0;p<a.length;p+=1)l=he(l,a[p]);e=new br({props:l});const u=[oe(r[0],"route-lines"),{filter:cn},{paint:{"line-color":["case",["get","snapped"],"red","blue"],"line-width":2.5}}];let f={};for(let p=0;p<u.length;p+=1)f=he(f,u[p]);n=new _r({props:f});const c=[oe(r[0],"route-polygons"),{filter:Zt},{paint:{"fill-color":"black","fill-opacity":.5}}];let h={};for(let p=0;p<c.length;p+=1)h=he(h,c[p]);return o=new vn({props:h}),{c(){L(e.$$.fragment),t=B(),L(n.$$.fragment),i=B(),L(o.$$.fragment)},m(p,g){A(e,p,g),w(p,t,g),A(n,p,g),w(p,i,g),A(o,p,g),s=!0},p(p,g){const m=g&1?we(a,[g&1&&Ce(oe(p[0],"route-points")),a[1],g&0&&{paint:{"circle-color":Hr(["get","type"],{"snapped-waypoint":"red","free-waypoint":"blue"},"black"),"circle-opacity":["case",["has","hovered"],.5,1],"circle-radius":Hr(["get","type"],{node:Nn/2},Nn)}}]):{};e.$set(m);const v=g&1?we(u,[Ce(oe(p[0],"route-lines")),u[1],u[2]]):{};n.$set(v);const b=g&1?we(c,[Ce(oe(p[0],"route-polygons")),c[1],c[2]]):{};o.$set(b)},i(p){s||($(e.$$.fragment,p),$(n.$$.fragment,p),$(o.$$.fragment,p),s=!0)},o(p){E(e.$$.fragment,p),E(n.$$.fragment,p),E(o.$$.fragment,p),s=!1},d(p){p&&(S(t),S(i)),C(e,p),C(n,p),C(o,p)}}}function S1(r){let e,t=Fu(r[3])+"",n;return{c(){e=T("div"),n=z(t),ve(e,"font-size","30px"),ve(e,"background","white"),ve(e,"padding","16px"),ve(e,"border-radius","50%")},m(i,o){w(i,e,o),j(e,n)},p(i,o){o&8&&t!==(t=Fu(i[3])+"")&&de(n,t)},d(i){i&&S(e)}}}function $1(r){let e,t;return e=new Xh({props:{$$slots:{default:[S1,({feature:n})=>({3:n}),({feature:n})=>n?8:0]},$$scope:{ctx:r}}}),{c(){L(e.$$.fragment)},m(n,i){A(e,n,i),t=!0},p(n,i){const o={};i&24&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){E(e.$$.fragment,n),t=!1},d(n){C(e,n)}}}function k1(r){let e,t,n,i;return e=new rr({props:{data:r[1],$$slots:{default:[w1]},$$scope:{ctx:r}}}),n=new rr({props:{data:r[2],$$slots:{default:[$1]},$$scope:{ctx:r}}}),{c(){L(e.$$.fragment),t=B(),L(n.$$.fragment)},m(o,s){A(e,o,s),w(o,t,s),A(n,o,s),i=!0},p(o,[s]){const a={};s&2&&(a.data=o[1]),s&17&&(a.$$scope={dirty:s,ctx:o}),e.$set(a);const l={};s&4&&(l.data=o[2]),s&16&&(l.$$scope={dirty:s,ctx:o}),n.$set(l)},i(o){i||($(e.$$.fragment,o),$(n.$$.fragment,o),i=!0)},o(o){E(e.$$.fragment,o),E(n.$$.fragment,o),i=!1},d(o){o&&S(t),C(e,o),C(n,o)}}}const Nn=10;function Fu(r){var e;return(e=r.properties)==null?void 0:e.number}function E1(r,e,t){let n,i;J(r,Kc,s=>t(1,n=s)),J(r,ti,s=>t(2,i=s));let{cfg:o}=e;return r.$$set=s=>{"cfg"in s&&t(0,o=s.cfg)},[o,n,i]}class M1 extends Z{constructor(e){super(),Q(this,e,E1,k1,K,{cfg:0})}}var P1=Object.defineProperty,Jt=(r,e)=>P1(r,"name",{value:e,configurable:!0});function Or(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return[...r.geometry.coordinates];if(r.type==="Point")return[...r.coordinates]}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return[...r];throw new Error("coord must be GeoJSON Point or an Array of numbers")}Jt(Or,"getCoord");function ep(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}Jt(ep,"getCoords");function tp(r){if(r.length>1&&Er(r[0])&&Er(r[1]))return!0;if(Array.isArray(r[0])&&r[0].length)return tp(r[0]);throw new Error("coordinates must only contain numbers")}Jt(tp,"containsNumber");function L1(r,e,t){if(!e||!t)throw new Error("type and name required");if(!r||r.type!==e)throw new Error("Invalid input to "+t+": must be a "+e+", given "+r.type)}Jt(L1,"geojsonType");function A1(r,e,t){if(!r)throw new Error("No feature passed");if(!t)throw new Error(".featureOf() requires a name");if(!r||r.type!=="Feature"||!r.geometry)throw new Error("Invalid input to "+t+", Feature with geometry required");if(!r.geometry||r.geometry.type!==e)throw new Error("Invalid input to "+t+": must be a "+e+", given "+r.geometry.type)}Jt(A1,"featureOf");function C1(r,e,t){if(!r)throw new Error("No featureCollection passed");if(!t)throw new Error(".collectionOf() requires a name");if(!r||r.type!=="FeatureCollection")throw new Error("Invalid input to "+t+", FeatureCollection required");for(const n of r.features){if(!n||n.type!=="Feature"||!n.geometry)throw new Error("Invalid input to "+t+", Feature with geometry required");if(!n.geometry||n.geometry.type!==e)throw new Error("Invalid input to "+t+": must be a "+e+", given "+n.geometry.type)}}Jt(C1,"collectionOf");function O1(r){return r.type==="Feature"?r.geometry:r}Jt(O1,"getGeom");function F1(r,e){return r.type==="FeatureCollection"?"FeatureCollection":r.type==="GeometryCollection"?"GeometryCollection":r.type==="Feature"&&r.geometry!==null?r.geometry.type:r.type}Jt(F1,"getType");var R1=Object.defineProperty,rp=(r,e)=>R1(r,"name",{value:e,configurable:!0});function Gs(r,e,t={}){if(t.final===!0)return np(r,e);const n=Or(r),i=Or(e),o=ot(n[0]),s=ot(i[0]),a=ot(n[1]),l=ot(i[1]),u=Math.sin(s-o)*Math.cos(l),f=Math.cos(a)*Math.sin(l)-Math.sin(a)*Math.cos(l)*Math.cos(s-o);return ln(Math.atan2(u,f))}rp(Gs,"bearing");function np(r,e){let t=Gs(e,r);return t=(t+180)%360,t}rp(np,"calculateFinalBearing");var B1=Object.defineProperty,I1=(r,e)=>B1(r,"name",{value:e,configurable:!0});function gr(r,e,t={}){var n=Or(r),i=Or(e),o=ot(i[1]-n[1]),s=ot(i[0]-n[0]),a=ot(n[1]),l=ot(i[1]),u=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(a)*Math.cos(l);return Fs(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)),t.units)}I1(gr,"distance");var N1=Object.defineProperty,T1=(r,e)=>N1(r,"name",{value:e,configurable:!0});function as(r,e,t,n={}){const i=Or(r),o=ot(i[0]),s=ot(i[1]),a=ot(t),l=ji(e,n.units),u=Math.asin(Math.sin(s)*Math.cos(l)+Math.cos(s)*Math.sin(l)*Math.cos(a)),f=o+Math.atan2(Math.sin(a)*Math.sin(l)*Math.cos(s),Math.cos(l)-Math.sin(s)*Math.sin(u)),c=ln(f),h=ln(u);return Qe([c,h],n.properties)}T1(as,"destination");class ip{constructor(e=[],t=D1){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:n}=this,i=t[e];for(;e>0;){const o=e-1>>1,s=t[o];if(n(i,s)>=0)break;t[e]=s,e=o}t[e]=i}_down(e){const{data:t,compare:n}=this,i=this.length>>1,o=t[e];for(;e<i;){let s=(e<<1)+1,a=t[s];const l=s+1;if(l<this.length&&n(t[l],a)<0&&(s=l,a=t[l]),n(a,o)>=0)break;t[e]=a,e=s}t[e]=o}}function D1(r,e){return r<e?-1:r>e?1:0}function op(r,e){return r.p.x>e.p.x?1:r.p.x<e.p.x?-1:r.p.y!==e.p.y?r.p.y>e.p.y?1:-1:1}function j1(r,e){return r.rightSweepEvent.p.x>e.rightSweepEvent.p.x?1:r.rightSweepEvent.p.x<e.rightSweepEvent.p.x?-1:r.rightSweepEvent.p.y!==e.rightSweepEvent.p.y?r.rightSweepEvent.p.y<e.rightSweepEvent.p.y?1:-1:1}class Ru{constructor(e,t,n,i){this.p={x:e[0],y:e[1]},this.featureId=t,this.ringId=n,this.eventId=i,this.otherEvent=null,this.isLeftEndpoint=null}isSamePoint(e){return this.p.x===e.p.x&&this.p.y===e.p.y}}function G1(r,e){if(r.type==="FeatureCollection"){const t=r.features;for(let n=0;n<t.length;n++)Bu(t[n],e)}else Bu(r,e)}let Tn=0,Dn=0,jn=0;function Bu(r,e){const t=r.type==="Feature"?r.geometry:r;let n=t.coordinates;(t.type==="Polygon"||t.type==="MultiLineString")&&(n=[n]),t.type==="LineString"&&(n=[[n]]);for(let i=0;i<n.length;i++)for(let o=0;o<n[i].length;o++){let s=n[i][o][0],a=null;Dn=Dn+1;for(let l=0;l<n[i][o].length-1;l++){a=n[i][o][l+1];const u=new Ru(s,Tn,Dn,jn),f=new Ru(a,Tn,Dn,jn+1);u.otherEvent=f,f.otherEvent=u,op(u,f)>0?(f.isLeftEndpoint=!0,u.isLeftEndpoint=!1):(u.isLeftEndpoint=!0,f.isLeftEndpoint=!1),e.push(u),e.push(f),s=a,jn=jn+1}}Tn=Tn+1}class U1{constructor(e){this.leftSweepEvent=e,this.rightSweepEvent=e.otherEvent}}function q1(r,e){if(r===null||e===null||r.leftSweepEvent.ringId===e.leftSweepEvent.ringId&&(r.rightSweepEvent.isSamePoint(e.leftSweepEvent)||r.rightSweepEvent.isSamePoint(e.leftSweepEvent)||r.rightSweepEvent.isSamePoint(e.rightSweepEvent)||r.leftSweepEvent.isSamePoint(e.leftSweepEvent)||r.leftSweepEvent.isSamePoint(e.rightSweepEvent)))return!1;const t=r.leftSweepEvent.p.x,n=r.leftSweepEvent.p.y,i=r.rightSweepEvent.p.x,o=r.rightSweepEvent.p.y,s=e.leftSweepEvent.p.x,a=e.leftSweepEvent.p.y,l=e.rightSweepEvent.p.x,u=e.rightSweepEvent.p.y,f=(u-a)*(i-t)-(l-s)*(o-n),c=(l-s)*(n-a)-(u-a)*(t-s),h=(i-t)*(n-a)-(o-n)*(t-s);if(f===0)return!1;const p=c/f,g=h/f;if(p>=0&&p<=1&&g>=0&&g<=1){const m=t+p*(i-t),v=n+p*(o-n);return[m,v]}return!1}function z1(r,e){e=e||!1;const t=[],n=new ip([],j1);for(;r.length;){const i=r.pop();if(i.isLeftEndpoint){const o=new U1(i);for(let s=0;s<n.data.length;s++){const a=n.data[s];if(e&&a.leftSweepEvent.featureId===i.featureId)continue;const l=q1(o,a);l!==!1&&t.push(l)}n.push(o)}else i.isLeftEndpoint===!1&&n.pop()}return t}function W1(r,e){const t=new ip([],op);return G1(r,t),z1(t,e)}var H1=Object.defineProperty,V1=(r,e)=>H1(r,"name",{value:e,configurable:!0}),J1=W1;function sp(r,e,t={}){const{removeDuplicates:n=!0,ignoreSelfIntersections:i=!1}=t;let o=[];r.type==="FeatureCollection"?o=o.concat(r.features):r.type==="Feature"?o.push(r):(r.type==="LineString"||r.type==="Polygon"||r.type==="MultiLineString"||r.type==="MultiPolygon")&&o.push(lt(r)),e.type==="FeatureCollection"?o=o.concat(e.features):e.type==="Feature"?o.push(e):(e.type==="LineString"||e.type==="Polygon"||e.type==="MultiLineString"||e.type==="MultiPolygon")&&o.push(lt(e));const s=J1(kr(o),i);let a=[];if(n){const l={};s.forEach(u=>{const f=u.join(",");l[f]||(l[f]=!0,a.push(u))})}else a=s;return kr(a.map(l=>Qe(l)))}V1(sp,"lineIntersect");var Y1=Object.defineProperty,Fe=(r,e)=>Y1(r,"name",{value:e,configurable:!0});function En(r,e,t){if(r!==null)for(var n,i,o,s,a,l,u,f=0,c=0,h,p=r.type,g=p==="FeatureCollection",m=p==="Feature",v=g?r.features.length:1,b=0;b<v;b++){u=g?r.features[b].geometry:m?r.geometry:r,h=u?u.type==="GeometryCollection":!1,a=h?u.geometries.length:1;for(var d=0;d<a;d++){var y=0,k=0;if(s=h?u.geometries[d]:u,s!==null){l=s.coordinates;var _=s.type;switch(f=t&&(_==="Polygon"||_==="MultiPolygon")?1:0,_){case null:break;case"Point":if(e(l,c,b,y,k)===!1)return!1;c++,y++;break;case"LineString":case"MultiPoint":for(n=0;n<l.length;n++){if(e(l[n],c,b,y,k)===!1)return!1;c++,_==="MultiPoint"&&y++}_==="LineString"&&y++;break;case"Polygon":case"MultiLineString":for(n=0;n<l.length;n++){for(i=0;i<l[n].length-f;i++){if(e(l[n][i],c,b,y,k)===!1)return!1;c++}_==="MultiLineString"&&y++,_==="Polygon"&&k++}_==="Polygon"&&y++;break;case"MultiPolygon":for(n=0;n<l.length;n++){for(k=0,i=0;i<l[n].length;i++){for(o=0;o<l[n][i].length-f;o++){if(e(l[n][i][o],c,b,y,k)===!1)return!1;c++}k++}y++}break;case"GeometryCollection":for(n=0;n<s.geometries.length;n++)if(En(s.geometries[n],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}Fe(En,"coordEach");function X1(r,e,t,n){var i=t;return En(r,function(o,s,a,l,u){s===0&&t===void 0?i=o:i=e(i,o,s,a,l,u)},n),i}Fe(X1,"coordReduce");function ap(r,e){var t;switch(r.type){case"FeatureCollection":for(t=0;t<r.features.length&&e(r.features[t].properties,t)!==!1;t++);break;case"Feature":e(r.properties,0);break}}Fe(ap,"propEach");function K1(r,e,t){var n=t;return ap(r,function(i,o){o===0&&t===void 0?n=i:n=e(n,i,o)}),n}Fe(K1,"propReduce");function lp(r,e){if(r.type==="Feature")e(r,0);else if(r.type==="FeatureCollection")for(var t=0;t<r.features.length&&e(r.features[t],t)!==!1;t++);}Fe(lp,"featureEach");function Z1(r,e,t){var n=t;return lp(r,function(i,o){o===0&&t===void 0?n=i:n=e(n,i,o)}),n}Fe(Z1,"featureReduce");function Q1(r){var e=[];return En(r,function(t){e.push(t)}),e}Fe(Q1,"coordAll");function Us(r,e){var t,n,i,o,s,a,l,u,f,c,h=0,p=r.type==="FeatureCollection",g=r.type==="Feature",m=p?r.features.length:1;for(t=0;t<m;t++){for(a=p?r.features[t].geometry:g?r.geometry:r,u=p?r.features[t].properties:g?r.properties:{},f=p?r.features[t].bbox:g?r.bbox:void 0,c=p?r.features[t].id:g?r.id:void 0,l=a?a.type==="GeometryCollection":!1,s=l?a.geometries.length:1,i=0;i<s;i++){if(o=l?a.geometries[i]:a,o===null){if(e(null,h,u,f,c)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(o,h,u,f,c)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<o.geometries.length;n++)if(e(o.geometries[n],h,u,f,c)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}h++}}Fe(Us,"geomEach");function x1(r,e,t){var n=t;return Us(r,function(i,o,s,a,l){o===0&&t===void 0?n=i:n=e(n,i,o,s,a,l)}),n}Fe(x1,"geomReduce");function Mn(r,e){Us(r,function(t,n,i,o,s){var a=t===null?null:t.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return e(lt(t,i,{bbox:o,id:s}),n,0)===!1?!1:void 0}var l;switch(a){case"MultiPoint":l="Point";break;case"MultiLineString":l="LineString";break;case"MultiPolygon":l="Polygon";break}for(var u=0;u<t.coordinates.length;u++){var f=t.coordinates[u],c={type:l,coordinates:f};if(e(lt(c,i),n,u)===!1)return!1}})}Fe(Mn,"flattenEach");function ew(r,e,t){var n=t;return Mn(r,function(i,o,s){o===0&&s===0&&t===void 0?n=i:n=e(n,i,o,s)}),n}Fe(ew,"flattenReduce");function up(r,e){Mn(r,function(t,n,i){var o=0;if(t.geometry){var s=t.geometry.type;if(!(s==="Point"||s==="MultiPoint")){var a,l=0,u=0,f=0;if(En(t,function(c,h,p,g,m){if(a===void 0||n>l||g>u||m>f){a=c,l=n,u=g,f=m,o=0;return}var v=pt([a,c],t.properties);if(e(v,n,i,m,o)===!1)return!1;o++,a=c})===!1)return!1}}})}Fe(up,"segmentEach");function tw(r,e,t){var n=t,i=!1;return up(r,function(o,s,a,l,u){i===!1&&t===void 0?n=o:n=e(n,o,s,a,l,u),i=!0}),n}Fe(tw,"segmentReduce");function fp(r,e){if(!r)throw new Error("geojson is required");Mn(r,function(t,n,i){if(t.geometry!==null){var o=t.geometry.type,s=t.geometry.coordinates;switch(o){case"LineString":if(e(t,n,i,0,0)===!1)return!1;break;case"Polygon":for(var a=0;a<s.length;a++)if(e(pt(s[a],t.properties),n,i,a)===!1)return!1;break}}})}Fe(fp,"lineEach");function rw(r,e,t){var n=t;return fp(r,function(i,o,s,a){o===0&&t===void 0?n=i:n=e(n,i,o,s,a)}),n}Fe(rw,"lineReduce");function nw(r,e){if(e=e||{},!Rs(e))throw new Error("options is invalid");var t=e.featureIndex||0,n=e.multiFeatureIndex||0,i=e.geometryIndex||0,o=e.segmentIndex||0,s=e.properties,a;switch(r.type){case"FeatureCollection":t<0&&(t=r.features.length+t),s=s||r.features[t].properties,a=r.features[t].geometry;break;case"Feature":s=s||r.properties,a=r.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":a=r;break;default:throw new Error("geojson is invalid")}if(a===null)return null;var l=a.coordinates;switch(a.type){case"Point":case"MultiPoint":return null;case"LineString":return o<0&&(o=l.length+o-1),pt([l[o],l[o+1]],s,e);case"Polygon":return i<0&&(i=l.length+i),o<0&&(o=l[i].length+o-1),pt([l[i][o],l[i][o+1]],s,e);case"MultiLineString":return n<0&&(n=l.length+n),o<0&&(o=l[n].length+o-1),pt([l[n][o],l[n][o+1]],s,e);case"MultiPolygon":return n<0&&(n=l.length+n),i<0&&(i=l[n].length+i),o<0&&(o=l[n][i].length-o-1),pt([l[n][i][o],l[n][i][o+1]],s,e)}throw new Error("geojson is invalid")}Fe(nw,"findSegment");function iw(r,e){if(e=e||{},!Rs(e))throw new Error("options is invalid");var t=e.featureIndex||0,n=e.multiFeatureIndex||0,i=e.geometryIndex||0,o=e.coordIndex||0,s=e.properties,a;switch(r.type){case"FeatureCollection":t<0&&(t=r.features.length+t),s=s||r.features[t].properties,a=r.features[t].geometry;break;case"Feature":s=s||r.properties,a=r.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":a=r;break;default:throw new Error("geojson is invalid")}if(a===null)return null;var l=a.coordinates;switch(a.type){case"Point":return Qe(l,s,e);case"MultiPoint":return n<0&&(n=l.length+n),Qe(l[n],s,e);case"LineString":return o<0&&(o=l.length+o),Qe(l[o],s,e);case"Polygon":return i<0&&(i=l.length+i),o<0&&(o=l[i].length+o),Qe(l[i][o],s,e);case"MultiLineString":return n<0&&(n=l.length+n),o<0&&(o=l[n].length+o),Qe(l[n][o],s,e);case"MultiPolygon":return n<0&&(n=l.length+n),i<0&&(i=l[n].length+i),o<0&&(o=l[n][i].length-o),Qe(l[n][i][o],s,e)}throw new Error("geojson is invalid")}Fe(iw,"findPoint");var cp=Object.defineProperty,ow=Object.defineProperties,sw=Object.getOwnPropertyDescriptors,Iu=Object.getOwnPropertySymbols,aw=Object.prototype.hasOwnProperty,lw=Object.prototype.propertyIsEnumerable,Nu=(r,e,t)=>e in r?cp(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Yt=(r,e)=>{for(var t in e||(e={}))aw.call(e,t)&&Nu(r,t,e[t]);if(Iu)for(var t of Iu(e))lw.call(e,t)&&Nu(r,t,e[t]);return r},Xt=(r,e)=>ow(r,sw(e)),uw=(r,e)=>cp(r,"name",{value:e,configurable:!0});function pp(r,e,t={}){if(!r||!e)throw new Error("lines and pt are required arguments");let n=Qe([1/0,1/0],{dist:1/0,index:-1,location:-1}),i=0;return Mn(r,function(o){const s=ep(o);for(let a=0;a<s.length-1;a++){const l=Qe(s[a]);l.properties.dist=gr(e,l,t);const u=Qe(s[a+1]);u.properties.dist=gr(e,u,t);const f=gr(l,u,t),c=Math.max(l.properties.dist,u.properties.dist),h=Gs(l,u),p=as(e,c,h+90,t),g=as(e,c,h-90,t),m=sp(pt([p.geometry.coordinates,g.geometry.coordinates]),pt([l.geometry.coordinates,u.geometry.coordinates]));let v;m.features.length>0&&m.features[0]&&(v=Xt(Yt({},m.features[0]),{properties:{dist:gr(e,m.features[0],t),location:i+gr(l,m.features[0],t)}})),l.properties.dist<n.properties.dist&&(n=Xt(Yt({},l),{properties:Xt(Yt({},l.properties),{index:a,location:i})})),u.properties.dist<n.properties.dist&&(n=Xt(Yt({},u),{properties:Xt(Yt({},u.properties),{index:a+1,location:i+f})})),v&&v.properties.dist<n.properties.dist&&(n=Xt(Yt({},v),{properties:Xt(Yt({},v.properties),{index:a})})),i+=f}}),n}uw(pp,"nearestPointOnLine");var fw=pp;const hp="/scheme-sketcher/assets/split_route-9e0ea2da.svg";function cw(r){let e,t;const n=[oe(r[0],"draw-split-route"),{paint:{"circle-color":"black","circle-radius":Tu}}];let i={};for(let o=0;o<n.length;o+=1)i=he(i,n[o]);return e=new br({props:i}),{c(){L(e.$$.fragment)},m(o,s){A(e,o,s),t=!0},p(o,s){const a=s&1?we(n,[s&1&&Ce(oe(o[0],"draw-split-route")),s&0&&{paint:{"circle-color":"black","circle-radius":Tu}}]):{};e.$set(a)},i(o){t||($(e.$$.fragment,o),t=!0)},o(o){E(e.$$.fragment,o),t=!1},d(o){C(e,o)}}}function pw(r){let e,t,n,i,o,s;return e=new Ah({}),e.$on("mousemove",r[3]),e.$on("click",r[4]),n=new rr({props:{data:r[2],$$slots:{default:[cw]},$$scope:{ctx:r}}}),{c(){L(e.$$.fragment),t=B(),L(n.$$.fragment)},m(a,l){A(e,a,l),w(a,t,l),A(n,a,l),i=!0,o||(s=ne(window,"keydown",r[5]),o=!0)},p(a,[l]){const u={};l&4&&(u.data=a[2]),l&2049&&(u.$$scope={dirty:l,ctx:a}),n.$set(u)},i(a){i||($(e.$$.fragment,a),$(n.$$.fragment,a),i=!0)},o(a){E(e.$$.fragment,a),E(n.$$.fragment,a),i=!1},d(a){a&&S(t),C(e,a),C(n,a),o=!1,s()}}}const Tu=10,hw=30;function gw(r,e,t){let n,i=x,o=()=>(i(),i=zt(l,v=>t(8,n=v)),l),s;J(r,et,v=>t(9,s=v)),r.$$.on_destroy.push(()=>i());let{cfg:a}=e,{gjSchemes:l}=e;o(),Ft(()=>{s&&(s.getCanvas().style.cursor=`url(${hp}), crosshair`)}),tt(()=>{s&&(s.getCanvas().style.cursor="inherit")});let u=null,f=null,c=Mr();function h(v){if(!s)return;t(6,u=null),f=null;let b=m(v.detail.lngLat.toArray());const d=[v.detail.point.x-hw,v.detail.point.y],y=s.unproject(v.detail.point).distanceTo(s.unproject(d))/1e3;let k=[];for(let[_,M]of n.features.entries())if(M.geometry.type=="LineString"){let F=fw(M.geometry,b,{units:"kilometers"});F.properties.dist!=null&&F.properties.dist<=y&&k.push([_,F.geometry.coordinates,F.properties.dist])}k.sort((_,M)=>_[2]-M[2]),k.length>0&&(t(6,u=m(k[0][1])),f=k[0][0])}function p(){if(f==null){te.set({mode:"list"});return}let v=x0(n.features[f],u);if(v!=null){let[b,d]=v;l.update(y=>(b.id=y.features[f].id,d.id=kn(y),y.features.splice(f,1,b,d),y))}t(6,u=null),f=null}function g(v){v.key=="Escape"&&(v.stopPropagation(),te.set({mode:"list"}))}function m(v){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:Hc(v)}}}return r.$$set=v=>{"cfg"in v&&t(0,a=v.cfg),"gjSchemes"in v&&o(t(1,l=v.gjSchemes))},r.$$.update=()=>{if(r.$$.dirty&64){let v=Mr();u&&v.features.push(u),t(2,c=v)}},[a,l,c,h,p,g,u]}class mw extends Z{constructor(e){super(),Q(this,e,gw,pw,K,{cfg:0,gjSchemes:1})}}function Du(r){let e,t;return e=new pe({props:{$$slots:{default:[dw]},$$scope:{ctx:r}}}),e.$on("click",r[5]),{c(){L(e.$$.fragment)},m(n,i){A(e,n,i),t=!0},p(n,i){const o={};i&128&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){E(e.$$.fragment,n),t=!1},d(n){C(e,n)}}}function dw(r){let e;return{c(){e=z("X")},m(t,n){w(t,e,n)},d(t){t&&S(e)}}}function yw(r){let e,t,n,i,o,s,a,l,u,f,c=r[2]&&Du(r);const h=r[4].default,p=Ne(h,r,r[7],null);return{c(){e=T("div"),t=T("div"),n=T("div"),i=T("h1"),o=z(r[1]),s=B(),c&&c.c(),a=B(),p&&p.c(),N(i,"class","govuk-heading-l"),ve(n,"display","flex"),ve(n,"justify-content","space-between"),N(t,"class","content centered-fullscreen svelte-1st8ub0"),N(e,"class","background svelte-1st8ub0"),Nt(e,"open",r[0]),Nt(e,"closed",!r[0])},m(g,m){w(g,e,m),j(e,t),j(t,n),j(n,i),j(i,o),j(n,s),c&&c.m(n,null),j(t,a),p&&p.m(t,null),l=!0,u||(f=[ne(t,"click",Gn(vw)),ne(e,"click",r[6])],u=!0)},p(g,[m]){(!l||m&2)&&de(o,g[1]),g[2]?c?(c.p(g,m),m&4&&$(c,1)):(c=Du(g),c.c(),$(c,1),c.m(n,null)):c&&(ue(),E(c,1,1,()=>{c=null}),fe()),p&&p.p&&(!l||m&128)&&Te(p,h,g,g[7],l?je(h,g[7],m,null):De(g[7]),null),(!l||m&1)&&Nt(e,"open",g[0]),(!l||m&1)&&Nt(e,"closed",!g[0])},i(g){l||($(c),$(p,g),l=!0)},o(g){E(c),E(p,g),l=!1},d(g){g&&S(e),c&&c.d(),p&&p.d(g),u=!1,qt(f)}}}const vw=()=>null;function _w(r,e,t){let{$$slots:n={},$$scope:i}=e,{title:o}=e,{open:s=!1}=e,{displayEscapeButton:a=!0}=e,{canCloseByClickingBackground:l=!0}=e;const u=()=>t(0,s=!1),f=()=>{l&&t(0,s=!1)};return r.$$set=c=>{"title"in c&&t(1,o=c.title),"open"in c&&t(0,s=c.open),"displayEscapeButton"in c&&t(2,a=c.displayEscapeButton),"canCloseByClickingBackground"in c&&t(3,l=c.canCloseByClickingBackground),"$$scope"in c&&t(7,i=c.$$scope)},[s,o,a,l,n,u,f,i]}class bw extends Z{constructor(e){super(),Q(this,e,_w,yw,K,{title:1,open:0,displayEscapeButton:2,canCloseByClickingBackground:3})}}function ww(r){let e;return{c(){e=T("ul"),e.innerHTML=`<li><b>Click</b>
    on the map to open a new tab with a 3rd-party imagery provider</li> <li>Press <b>Escape</b>
    to exit this mode</li> <li>Cursor by <a href="https://icon-icons.com/icon/screenshot-cursor-camera/100181" target="_blank" rel="noreferrer">Luc Chaissac</a></li>`},m(t,n){w(t,e,n)},p:x,i:x,o:x,d(t){t&&S(e)}}}class gp extends Z{constructor(e){super(),Q(this,e,null,ww,K,{})}}const Sw="/scheme-sketcher/assets/camera_cursor-824d29b6.svg",{window:$w}=ef;function ju(r){let e,t,n,i;const o=[Ew,kw],s=[];function a(l,u){return l[0]?0:1}return e=a(r),t=s[e]=o[e](r),{c(){t.c(),n=me()},m(l,u){s[e].m(l,u),w(l,n,u),i=!0},p(l,u){let f=e;e=a(l),e===f?s[e].p(l,u):(ue(),E(s[f],1,1,()=>{s[f]=null}),fe(),t=s[e],t?t.p(l,u):(t=s[e]=o[e](l),t.c()),$(t,1),t.m(n.parentNode,n))},i(l){i||($(t),i=!0)},o(l){E(t),i=!1},d(l){l&&S(n),s[e].d(l)}}}function kw(r){let e,t;return e=new pe({props:{$$slots:{default:[Mw]},$$scope:{ctx:r}}}),e.$on("click",r[8]),{c(){L(e.$$.fragment)},m(n,i){A(e,n,i),t=!0},p(n,i){const o={};i&8192&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){E(e.$$.fragment,n),t=!1},d(n){C(e,n)}}}function Ew(r){let e,t,n,i,o,s,a;e=new pe({props:{$$slots:{default:[Pw]},$$scope:{ctx:r}}}),e.$on("click",r[6]);function l(f){r[7](f)}let u={legend:"Source",choices:[["google","Google Street View"],["bing","Bing Streetside"]]};return r[2].streetViewImagery!==void 0&&(u.value=r[2].streetViewImagery),n=new nf({props:u}),_e.push(()=>$e(n,"value",l)),s=new Zp({props:{label:"Help",$$slots:{default:[Lw]},$$scope:{ctx:r}}}),{c(){L(e.$$.fragment),t=B(),L(n.$$.fragment),o=B(),L(s.$$.fragment)},m(f,c){A(e,f,c),w(f,t,c),A(n,f,c),w(f,o,c),A(s,f,c),a=!0},p(f,c){const h={};c&8192&&(h.$$scope={dirty:c,ctx:f}),e.$set(h);const p={};!i&&c&4&&(i=!0,p.value=f[2].streetViewImagery,Pe(()=>i=!1)),n.$set(p);const g={};c&8192&&(g.$$scope={dirty:c,ctx:f}),s.$set(g)},i(f){a||($(e.$$.fragment,f),$(n.$$.fragment,f),$(s.$$.fragment,f),a=!0)},o(f){E(e.$$.fragment,f),E(n.$$.fragment,f),E(s.$$.fragment,f),a=!1},d(f){f&&(S(t),S(o)),C(e,f),C(n,f),C(s,f)}}}function Mw(r){let e;return{c(){e=z("Enable Street View")},m(t,n){w(t,e,n)},d(t){t&&S(e)}}}function Pw(r){let e;return{c(){e=z("Disable Street View")},m(t,n){w(t,e,n)},d(t){t&&S(e)}}}function Lw(r){let e,t;return e=new gp({}),{c(){L(e.$$.fragment)},m(n,i){A(e,n,i),t=!0},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){E(e.$$.fragment,n),t=!1},d(n){C(e,n)}}}function Aw(r){let e,t,n,i,o=r[1]&&ju(r);return{c(){o&&o.c(),e=me()},m(s,a){o&&o.m(s,a),w(s,e,a),t=!0,n||(i=ne($w,"keydown",r[3]),n=!0)},p(s,[a]){s[1]?o?(o.p(s,a),a&2&&$(o,1)):(o=ju(s),o.c(),$(o,1),o.m(e.parentNode,e)):o&&(ue(),E(o,1,1,()=>{o=null}),fe())},i(s){t||($(o),t=!0)},o(s){E(o),t=!1},d(s){s&&S(e),o&&o.d(s),n=!1,i()}}}function Cw(r,e,t){let n;J(r,ir,v=>t(2,n=v));let{cfg:i}=e,{map:o}=e,{enabled:s}=e,{showControls:a=!0}=e,l=[];function u(){if(o){o.on("click",c),o.getCanvas().style.cursor=`url(${Sw}), auto`;for(let v of i.getStreetViewRoadLayerNames(o))l.push([v,o.getPaintProperty(v,"line-color")]),o.setPaintProperty(v,"line-color","cyan")}}function f(){if(o){o.off("click",c),o.getCanvas().style.cursor="inherit";for(let[v,b]of l)o.setPaintProperty(v,"line-color",b);l=[]}}tt(f);function c(v){if(!s)return;let b=v.lngLat.lng,d=v.lngLat.lat;n.streetViewImagery=="google"?window.open(`http://maps.google.com/maps?q=&layer=c&cbll=${d},${b}&cbp=11,0,0,0,0`,"_blank"):n.streetViewImagery=="bing"&&window.open(`https://www.bing.com/maps?cp=${d}~${b}&style=x`,"_blank")}function h(v){s&&v.key=="Escape"&&(v.stopPropagation(),t(0,s=!1))}const p=()=>t(0,s=!1);function g(v){r.$$.not_equal(n.streetViewImagery,v)&&(n.streetViewImagery=v,ir.set(n))}const m=()=>t(0,s=!0);return r.$$set=v=>{"cfg"in v&&t(4,i=v.cfg),"map"in v&&t(5,o=v.map),"enabled"in v&&t(0,s=v.enabled),"showControls"in v&&t(1,a=v.showControls)},r.$$.update=()=>{r.$$.dirty&1&&(s?u():f())},[s,a,n,h,i,o,p,g,m]}class Ow extends Z{constructor(e){super(),Q(this,e,Cw,Aw,K,{cfg:4,map:5,enabled:0,showControls:1})}}const Fw="/scheme-sketcher/assets/warning-81bba3f6.svg";function Rw(r){let e,t;return{c(){e=T("img"),Rt(e.src,t=Fw)||N(e,"src",t),N(e,"title",r[0]),N(e,"alt",r[0])},m(n,i){w(n,e,i)},p(n,[i]){i&1&&N(e,"title",n[0]),i&1&&N(e,"alt",n[0])},i:x,o:x,d(n){n&&S(e)}}}function Bw(r,e,t){let{text:n}=e;return r.$$set=i=>{"text"in i&&t(0,n=i.text)},[n]}class Iw extends Z{constructor(e){super(),Q(this,e,Bw,Rw,K,{text:0})}}async function Nw(r,e){let t=await fetch(r),n=t.body.getReader(),i=t.headers.get("Content-Length");if(!i)throw new Error(`No Content-Length header from ${r}`);let o=parseInt(i),s=0,a=[];for(;;){let{done:f,value:c}=await n.read();if(f)break;c&&(a.push(c),s+=c.length,e(100*s/o))}let l=new Uint8Array(s),u=0;for(let f of a)l.set(f,u),u+=f.length;return l}function Tw(r){let e;return{c(){e=z("Finish")},m(t,n){w(t,e,n)},d(t){t&&S(e)}}}function Dw(r){let e,t,n,i,o,s,a,l,u,f;function c(m){r[4](m)}let h={cfg:r[0],map:r[2],showControls:!1};r[1]!==void 0&&(h.enabled=r[1]),e=new Ow({props:h}),_e.push(()=>$e(e,"enabled",c)),i=new Wt({props:{$$slots:{default:[Tw]},$$scope:{ctx:r}}}),i.$on("click",r[5]);function p(m){r[6](m)}let g={legend:"Source",choices:[["google","Google Street View"],["bing","Bing Streetside"]],inlineSmall:!0};return r[3].streetViewImagery!==void 0&&(g.value=r[3].streetViewImagery),s=new nf({props:g}),_e.push(()=>$e(s,"value",p)),u=new gp({}),{c(){L(e.$$.fragment),n=B(),L(i.$$.fragment),o=B(),L(s.$$.fragment),l=B(),L(u.$$.fragment)},m(m,v){A(e,m,v),w(m,n,v),A(i,m,v),w(m,o,v),A(s,m,v),w(m,l,v),A(u,m,v),f=!0},p(m,[v]){const b={};v&1&&(b.cfg=m[0]),v&4&&(b.map=m[2]),!t&&v&2&&(t=!0,b.enabled=m[1],Pe(()=>t=!1)),e.$set(b);const d={};v&128&&(d.$$scope={dirty:v,ctx:m}),i.$set(d);const y={};!a&&v&8&&(a=!0,y.value=m[3].streetViewImagery,Pe(()=>a=!1)),s.$set(y)},i(m){f||($(e.$$.fragment,m),$(i.$$.fragment,m),$(s.$$.fragment,m),$(u.$$.fragment,m),f=!0)},o(m){E(e.$$.fragment,m),E(i.$$.fragment,m),E(s.$$.fragment,m),E(u.$$.fragment,m),f=!1},d(m){m&&(S(n),S(o),S(l)),C(e,m),C(i,m),C(s,m),C(u,m)}}}function jw(r,e,t){let n,i;J(r,et,f=>t(2,n=f)),J(r,ir,f=>t(3,i=f));let{cfg:o}=e,s=!0;function a(f){s=f,t(1,s)}const l=()=>t(1,s=!1);function u(f){r.$$.not_equal(i.streetViewImagery,f)&&(i.streetViewImagery=f,ir.set(i))}return r.$$set=f=>{"cfg"in f&&t(0,o=f.cfg)},r.$$.update=()=>{r.$$.dirty&2&&(s||te.set({mode:"list"}))},[o,s,n,i,a,l,u]}class Gw extends Z{constructor(e){super(),Q(this,e,jw,Dw,K,{cfg:0})}}const Uw="/scheme-sketcher/assets/image-3e3a13e8.svg",qw="/scheme-sketcher/assets/point-276f4055.svg",zw="/scheme-sketcher/assets/polygon_freehand-cf965967.svg",Ww="/scheme-sketcher/assets/polygon_snapped-18efbbea.svg",Hw="/scheme-sketcher/assets/route-d3c0ebad.svg",Vw="/scheme-sketcher/assets/street_view-48580b6a.svg";function Jw(r){let e,t,n;return{c(){e=T("img"),n=z(`
    New point`),Rt(e.src,t=qw)||N(e,"src",t),N(e,"alt","New point")},m(i,o){w(i,e,o),w(i,n,o)},p:x,d(i){i&&(S(e),S(n))}}}function Yw(r){let e,t,n;return{c(){e=T("img"),n=z(`
    New route`),Rt(e.src,t=Hw)||N(e,"src",t),N(e,"alt","New route")},m(i,o){w(i,e,o),w(i,n,o)},p:x,d(i){i&&(S(e),S(n))}}}function Xw(r){let e,t,n;return{c(){e=T("img"),n=z(`
    New polygon (freehand)`),Rt(e.src,t=zw)||N(e,"src",t),N(e,"alt","New polygon (freehand)")},m(i,o){w(i,e,o),w(i,n,o)},p:x,d(i){i&&(S(e),S(n))}}}function Kw(r){let e,t,n;return{c(){e=T("img"),n=z(`
    New polygon (snapped)`),Rt(e.src,t=Ww)||N(e,"src",t),N(e,"alt","New polygon (snapped)")},m(i,o){w(i,e,o),w(i,n,o)},p:x,d(i){i&&(S(e),S(n))}}}function Zw(r){let e,t,n;return{c(){e=T("img"),n=z(`
    Split route`),Rt(e.src,t=hp)||N(e,"src",t),N(e,"alt","Split route")},m(i,o){w(i,e,o),w(i,n,o)},p:x,d(i){i&&(S(e),S(n))}}}function Qw(r){let e,t,n;return{c(){e=T("img"),n=z(`
    Georeference image`),Rt(e.src,t=Uw)||N(e,"src",t),N(e,"alt","Georeference image")},m(i,o){w(i,e,o),w(i,n,o)},p:x,d(i){i&&(S(e),S(n))}}}function xw(r){let e,t,n;return{c(){e=T("img"),n=z(`
    StreetView`),Rt(e.src,t=Vw)||N(e,"src",t),N(e,"alt","StreetView")},m(i,o){w(i,e,o),w(i,n,o)},p:x,d(i){i&&(S(e),S(n))}}}function eS(r){let e,t,n,i,o,s,a,l,u,f,c,h,p,g,m,v,b;return e=new o1({props:{cfg:r[0],gjSchemes:r[1]}}),i=new pe({props:{disabled:!r[2],$$slots:{default:[Jw]},$$scope:{ctx:r}}}),i.$on("click",r[5]),s=new pe({props:{disabled:!r[3],$$slots:{default:[Yw]},$$scope:{ctx:r}}}),s.$on("click",r[6]),l=new pe({props:{disabled:!r[4],$$slots:{default:[Xw]},$$scope:{ctx:r}}}),l.$on("click",r[7]),f=new pe({props:{disabled:!r[3],$$slots:{default:[Kw]},$$scope:{ctx:r}}}),f.$on("click",r[8]),h=new pe({props:{$$slots:{default:[Zw]},$$scope:{ctx:r}}}),h.$on("click",r[9]),g=new pe({props:{$$slots:{default:[Qw]},$$scope:{ctx:r}}}),g.$on("click",r[10]),v=new pe({props:{$$slots:{default:[xw]},$$scope:{ctx:r}}}),v.$on("click",r[11]),{c(){L(e.$$.fragment),t=B(),n=T("div"),L(i.$$.fragment),o=B(),L(s.$$.fragment),a=B(),L(l.$$.fragment),u=B(),L(f.$$.fragment),c=B(),L(h.$$.fragment),p=B(),L(g.$$.fragment),m=B(),L(v.$$.fragment),N(n,"class","top govuk-prose svelte-1kai3ke")},m(d,y){A(e,d,y),w(d,t,y),w(d,n,y),A(i,n,null),j(n,o),A(s,n,null),j(n,a),A(l,n,null),j(n,u),A(f,n,null),j(n,c),A(h,n,null),j(n,p),A(g,n,null),j(n,m),A(v,n,null),b=!0},p(d,[y]){const k={};y&1&&(k.cfg=d[0]),y&2&&(k.gjSchemes=d[1]),e.$set(k);const _={};y&4&&(_.disabled=!d[2]),y&4096&&(_.$$scope={dirty:y,ctx:d}),i.$set(_);const M={};y&8&&(M.disabled=!d[3]),y&4096&&(M.$$scope={dirty:y,ctx:d}),s.$set(M);const F={};y&16&&(F.disabled=!d[4]),y&4096&&(F.$$scope={dirty:y,ctx:d}),l.$set(F);const I={};y&8&&(I.disabled=!d[3]),y&4096&&(I.$$scope={dirty:y,ctx:d}),f.$set(I);const U={};y&4096&&(U.$$scope={dirty:y,ctx:d}),h.$set(U);const W={};y&4096&&(W.$$scope={dirty:y,ctx:d}),g.$set(W);const O={};y&4096&&(O.$$scope={dirty:y,ctx:d}),v.$set(O)},i(d){b||($(e.$$.fragment,d),$(i.$$.fragment,d),$(s.$$.fragment,d),$(l.$$.fragment,d),$(f.$$.fragment,d),$(h.$$.fragment,d),$(g.$$.fragment,d),$(v.$$.fragment,d),b=!0)},o(d){E(e.$$.fragment,d),E(i.$$.fragment,d),E(s.$$.fragment,d),E(l.$$.fragment,d),E(f.$$.fragment,d),E(h.$$.fragment,d),E(g.$$.fragment,d),E(v.$$.fragment,d),b=!1},d(d){d&&(S(t),S(n)),C(e,d),C(i),C(s),C(l),C(f),C(h),C(g),C(v)}}}function tS(r,e,t){let n,i,o;J(r,yn,m=>t(2,n=m)),J(r,Pt,m=>t(3,i=m)),J(r,Cr,m=>t(4,o=m));let{cfg:s}=e,{gjSchemes:a}=e;const l=()=>te.set({mode:"new-point"}),u=()=>te.set({mode:"new-route"}),f=()=>te.set({mode:"new-freehand-polygon"}),c=()=>te.set({mode:"new-snapped-polygon"}),h=()=>te.set({mode:"split-route"}),p=()=>te.set({mode:"set-image"}),g=()=>te.set({mode:"streetview"});return r.$$set=m=>{"cfg"in m&&t(0,s=m.cfg),"gjSchemes"in m&&t(1,a=m.gjSchemes)},[s,a,n,i,o,l,u,f,c,h,p,g]}class rS extends Z{constructor(e){super(),Q(this,e,tS,eS,K,{cfg:0,gjSchemes:1})}}function nS(r){let e;return{c(){e=z("Save")},m(t,n){w(t,e,n)},d(t){t&&S(e)}}}function iS(r){let e;return{c(){e=z("Edit geometry")},m(t,n){w(t,e,n)},d(t){t&&S(e)}}}function oS(r){let e;return{c(){e=z("Delete")},m(t,n){w(t,e,n)},d(t){t&&S(e)}}}function sS(r){let e,t,n,i,o,s;return e=new Wt({props:{$$slots:{default:[nS]},$$scope:{ctx:r}}}),e.$on("click",r[5]),n=new pe({props:{$$slots:{default:[iS]},$$scope:{ctx:r}}}),n.$on("click",r[6]),o=new Ii({props:{$$slots:{default:[oS]},$$scope:{ctx:r}}}),o.$on("click",r[7]),{c(){L(e.$$.fragment),t=B(),L(n.$$.fragment),i=B(),L(o.$$.fragment)},m(a,l){A(e,a,l),w(a,t,l),A(n,a,l),w(a,i,l),A(o,a,l),s=!0},p(a,l){const u={};l&8192&&(u.$$scope={dirty:l,ctx:a}),e.$set(u);const f={};l&8192&&(f.$$scope={dirty:l,ctx:a}),n.$set(f);const c={};l&8192&&(c.$$scope={dirty:l,ctx:a}),o.$set(c)},i(a){s||($(e.$$.fragment,a),$(n.$$.fragment,a),$(o.$$.fragment,a),s=!0)},o(a){E(e.$$.fragment,a),E(n.$$.fragment,a),E(o.$$.fragment,a),s=!1},d(a){a&&(S(t),S(i)),C(e,a),C(n,a),C(o,a)}}}function aS(r){let e,t,n=r[0].interventionName(r[3])+"",i,o,s,a,l,u,f,c,h,p,g,m;s=new or({props:{$$slots:{default:[sS]},$$scope:{ctx:r}}}),l=new Ot({props:{errorMessage:r[0].interventionWarning(r[3])}});function v(y){r[8](y)}var b=r[0].editFeatureForm;function d(y,k){let _={cfg:y[0],gjSchemes:y[1],id:y[2]};return y[3].properties!==void 0&&(_.props=y[3].properties),{props:_}}return b&&(f=ii(b,d(r)),_e.push(()=>$e(f,"props",v))),{c(){e=T("h2"),t=z("Editing "),i=z(n),o=B(),L(s.$$.fragment),a=B(),L(l.$$.fragment),u=B(),f&&L(f.$$.fragment),h=me()},m(y,k){w(y,e,k),j(e,t),j(e,i),w(y,o,k),A(s,y,k),w(y,a,k),A(l,y,k),w(y,u,k),f&&A(f,y,k),w(y,h,k),p=!0,g||(m=ne(window,"keydown",r[4]),g=!0)},p(y,[k]){(!p||k&9)&&n!==(n=y[0].interventionName(y[3])+"")&&de(i,n);const _={};k&8198&&(_.$$scope={dirty:k,ctx:y}),s.$set(_);const M={};if(k&9&&(M.errorMessage=y[0].interventionWarning(y[3])),l.$set(M),k&1&&b!==(b=y[0].editFeatureForm)){if(f){ue();const F=f;E(F.$$.fragment,1,0,()=>{C(F,1)}),fe()}b?(f=ii(b,d(y)),_e.push(()=>$e(f,"props",v)),L(f.$$.fragment),$(f.$$.fragment,1),A(f,h.parentNode,h)):f=null}else if(b){const F={};k&1&&(F.cfg=y[0]),k&2&&(F.gjSchemes=y[1]),k&4&&(F.id=y[2]),!c&&k&8&&(c=!0,F.props=y[3].properties,Pe(()=>c=!1)),f.$set(F)}},i(y){p||($(s.$$.fragment,y),$(l.$$.fragment,y),f&&$(f.$$.fragment,y),p=!0)},o(y){E(s.$$.fragment,y),E(l.$$.fragment,y),f&&E(f.$$.fragment,y),p=!1},d(y){y&&(S(e),S(o),S(a),S(u),S(h)),C(s,y),C(l,y),f&&C(f,y),g=!1,m()}}}function lS(r,e,t){let n,i,o=x,s=()=>(o(),o=zt(l,d=>t(10,i=d)),l);J(r,et,d=>t(9,n=d)),r.$$.on_destroy.push(()=>o());let{cfg:a}=e,{gjSchemes:l}=e;s();let{id:u}=e,f=i.features.find(d=>d.id==u);function c(d){l.set(i)}Ft(()=>{n==null||n.on("click",h)}),tt(()=>{n==null||n.off("click",h)});function h(d){for(let y of n.queryRenderedFeatures(d.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]}))if(y.id==u)return;te.set({mode:"list"})}function p(d){if(d.key=="Escape"){d.stopPropagation(),te.set({mode:"list"});return}if(d.key=="Delete"){const y=d.target.tagName;if(y=="INPUT"||y=="TEXTAREA")return;d.stopPropagation(),$u(l,u)}if(d.key=="e"){const y=d.target.tagName;if(y=="INPUT"||y=="TEXTAREA")return;d.stopPropagation(),te.set({mode:"edit-geometry",id:u})}}const g=()=>te.set({mode:"list"}),m=()=>te.set({mode:"edit-geometry",id:u}),v=()=>$u(l,u);function b(d){r.$$.not_equal(f.properties,d)&&(f.properties=d,t(3,f))}return r.$$set=d=>{"cfg"in d&&t(0,a=d.cfg),"gjSchemes"in d&&s(t(1,l=d.gjSchemes)),"id"in d&&t(2,u=d.id)},r.$$.update=()=>{r.$$.dirty&8&&c()},[a,l,u,f,p,g,m,v,b]}class uS extends Z{constructor(e){super(),Q(this,e,lS,aS,K,{cfg:0,gjSchemes:1,id:2})}}const fS="/scheme-sketcher/assets/delete-3c023172.svg";function Gu(r,e,t){const n=r.slice();n[29]=e[t];const i=n[0].interventionWarning(n[29]);return n[30]=i,n}function cS(r){let e,t,n;return{c(){e=T("img"),n=z(`
    Delete`),Rt(e.src,t=fS)||N(e,"src",t),N(e,"alt","Delete scheme")},m(i,o){w(i,e,o),w(i,n,o)},p:x,d(i){i&&(S(e),S(n))}}}function pS(r){let e;return{c(){e=z("Show")},m(t,n){w(t,e,n)},d(t){t&&S(e)}}}function hS(r){let e,t;return e=new Ot({props:{errorMessage:"There's a problem with "+r[8]+" interventions below"}}),{c(){L(e.$$.fragment)},m(n,i){A(e,n,i),t=!0},p(n,i){const o={};i[0]&256&&(o.errorMessage="There's a problem with "+n[8]+" interventions below"),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){E(e.$$.fragment,n),t=!1},d(n){C(e,n)}}}function gS(r){let e,t;return e=new Ot({props:{errorMessage:"There's a problem with one intervention below"}}),{c(){L(e.$$.fragment)},m(n,i){A(e,n,i),t=!0},p:x,i(n){t||($(e.$$.fragment,n),t=!0)},o(n){E(e.$$.fragment,n),t=!1},d(n){C(e,n)}}}function Uu(r){let e,t;return e=new Iw({props:{text:r[30]}}),{c(){L(e.$$.fragment)},m(n,i){A(e,n,i),t=!0},p(n,i){const o={};i[0]&13&&(o.text=n[30]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){E(e.$$.fragment,n),t=!1},d(n){C(e,n)}}}function qu(r,e){let t,n,i,o=e[0].interventionName(e[29])+"",s,a,l,u,f,c=e[30]&&Uu(e);function h(...m){return e[20](e[29],...m)}function p(){return e[21](e[29])}function g(){return e[22](e[29])}return{key:r,first:null,c(){t=T("li"),n=T("a"),c&&c.c(),i=B(),s=z(o),a=B(),N(n,"href","#"),this.first=t},m(m,v){w(m,t,v),j(t,n),c&&c.m(n,null),j(n,i),j(n,s),j(t,a),l=!0,u||(f=[ne(n,"click",h),ne(n,"mouseenter",p),ne(n,"mouseleave",g)],u=!0)},p(m,v){e=m,e[30]?c?(c.p(e,v),v[0]&13&&$(c,1)):(c=Uu(e),c.c(),$(c,1),c.m(n,i)):c&&(ue(),E(c,1,1,()=>{c=null}),fe()),(!l||v[0]&13)&&o!==(o=e[0].interventionName(e[29])+"")&&de(s,o)},i(m){l||($(c),l=!0)},o(m){E(c),l=!1},d(m){m&&S(t),c&&c.d(),u=!1,qt(f)}}}function zu(r){let e,t,n,i,o=r[7]==1?"intervention":"interventions",s,a,l,u,f,c;function h(g){r[23](g)}let p={label:"Move interventions to another scheme",choices:r[13]()};return r[5]!==void 0&&(p.value=r[5]),u=new _o({props:p}),_e.push(()=>$e(u,"value",h)),u.$on("change",r[12]),{c(){e=T("p"),t=z("Do you want to first move "),n=z(r[7]),i=B(),s=z(o),a=z(" to another scheme?"),l=B(),L(u.$$.fragment)},m(g,m){w(g,e,m),j(e,t),j(e,n),j(e,i),j(e,s),j(e,a),w(g,l,m),A(u,g,m),c=!0},p(g,m){(!c||m[0]&128)&&de(n,g[7]),(!c||m[0]&128)&&o!==(o=g[7]==1?"intervention":"interventions")&&de(s,o);const v={};!f&&m[0]&32&&(f=!0,v.value=g[5],Pe(()=>f=!1)),u.$set(v)},i(g){c||($(u.$$.fragment,g),c=!0)},o(g){E(u.$$.fragment,g),c=!1},d(g){g&&(S(e),S(l)),C(u,g)}}}function mS(r){let e;return{c(){e=z("Delete scheme")},m(t,n){w(t,e,n)},d(t){t&&S(e)}}}function dS(r){let e;return{c(){e=z("Cancel")},m(t,n){w(t,e,n)},d(t){t&&S(e)}}}function yS(r){let e,t,n,i;return e=new Ii({props:{$$slots:{default:[mS]},$$scope:{ctx:r}}}),e.$on("click",r[11]),n=new pe({props:{$$slots:{default:[dS]},$$scope:{ctx:r}}}),n.$on("click",r[24]),{c(){L(e.$$.fragment),t=B(),L(n.$$.fragment)},m(o,s){A(e,o,s),w(o,t,s),A(n,o,s),i=!0},p(o,s){const a={};s[0]&67108864&&(a.$$scope={dirty:s,ctx:o}),e.$set(a);const l={};s[0]&67108864&&(l.$$scope={dirty:s,ctx:o}),n.$set(l)},i(o){i||($(e.$$.fragment,o),$(n.$$.fragment,o),i=!0)},o(o){E(e.$$.fragment,o),E(n.$$.fragment,o),i=!1},d(o){o&&S(t),C(e,o),C(n,o)}}}function vS(r){let e=r[7]>0&&r[13]().length>0,t,n,i,o=e&&zu(r);return n=new or({props:{$$slots:{default:[yS]},$$scope:{ctx:r}}}),{c(){o&&o.c(),t=B(),L(n.$$.fragment)},m(s,a){o&&o.m(s,a),w(s,t,a),A(n,s,a),i=!0},p(s,a){a[0]&128&&(e=s[7]>0&&s[13]().length>0),e?o?(o.p(s,a),a[0]&128&&$(o,1)):(o=zu(s),o.c(),$(o,1),o.m(t.parentNode,t)):o&&(ue(),E(o,1,1,()=>{o=null}),fe());const l={};a[0]&67108880&&(l.$$scope={dirty:a,ctx:s}),n.$set(l)},i(s){i||($(o),$(n.$$.fragment,s),i=!0)},o(s){E(o),E(n.$$.fragment,s),i=!1},d(s){s&&S(t),o&&o.d(s),C(n,s)}}}function _S(r){let e,t=r[0].schemeName(r[3].schemes[r[2]])+"",n,i,o,s,a,l,u,f,c,h,p,g,m,v,b,d,y=[],k=new Map,_,M,F,I,U,W;a=new Ii({props:{$$slots:{default:[cS]},$$scope:{ctx:r}}}),a.$on("click",r[17]);function O(G){r[18](G)}let P={$$slots:{default:[pS]},$$scope:{ctx:r}};r[6]!==void 0&&(P.checked=r[6]),u=new vo({props:P}),_e.push(()=>$e(u,"checked",O)),u.$on("change",r[14]);const R=r[15].default,q=Ne(R,r,r[26],null);var se=r[0].editSchemeForm;function ie(G,X){return{props:{gjSchemes:G[1],scheme_reference:G[2]}}}se&&(p=ii(se,ie(r)));const H=[gS,hS],D=[];function ge(G,X){return G[8]==1?0:G[8]>0?1:-1}~(m=ge(r))&&(v=D[m]=H[m](r));let ye=at(r[3].features.filter(r[19]));const rt=G=>G[29].id;for(let G=0;G<ye.length;G+=1){let X=Gu(r,ye,G),nt=rt(X);k.set(nt,y[G]=qu(nt,X))}function Ue(G){r[25](G)}let Pn={title:"Delete this scheme?",displayEscapeButton:!1,$$slots:{default:[vS]},$$scope:{ctx:r}};return r[4]!==void 0&&(Pn.open=r[4]),M=new bw({props:Pn}),_e.push(()=>$e(M,"open",Ue)),{c(){e=T("h3"),n=z(t),i=B(),o=T("input"),s=B(),L(a.$$.fragment),l=B(),L(u.$$.fragment),c=B(),q&&q.c(),h=B(),p&&L(p.$$.fragment),g=B(),v&&v.c(),b=B(),d=T("ol");for(let G=0;G<y.length;G+=1)y[G].c();_=B(),L(M.$$.fragment),N(o,"type","color"),N(d,"class","govuk-list govuk-list--number")},m(G,X){w(G,e,X),j(e,n),j(e,i),j(e,o),Ve(o,r[3].schemes[r[2]].color),j(e,s),A(a,e,null),w(G,l,X),A(u,G,X),w(G,c,X),q&&q.m(G,X),w(G,h,X),p&&A(p,G,X),w(G,g,X),~m&&D[m].m(G,X),w(G,b,X),w(G,d,X);for(let nt=0;nt<y.length;nt+=1)y[nt]&&y[nt].m(d,null);w(G,_,X),A(M,G,X),I=!0,U||(W=ne(o,"input",r[16]),U=!0)},p(G,X){(!I||X[0]&13)&&t!==(t=G[0].schemeName(G[3].schemes[G[2]])+"")&&de(n,t),X[0]&12&&Ve(o,G[3].schemes[G[2]].color);const nt={};X[0]&67108864&&(nt.$$scope={dirty:X,ctx:G}),a.$set(nt);const V={};if(X[0]&67108864&&(V.$$scope={dirty:X,ctx:G}),!f&&X[0]&64&&(f=!0,V.checked=G[6],Pe(()=>f=!1)),u.$set(V),q&&q.p&&(!I||X[0]&67108864)&&Te(q,R,G,G[26],I?je(R,G[26],X,null):De(G[26]),null),X[0]&1&&se!==(se=G[0].editSchemeForm)){if(p){ue();const Re=p;E(Re.$$.fragment,1,0,()=>{C(Re,1)}),fe()}se?(p=ii(se,ie(G)),L(p.$$.fragment),$(p.$$.fragment,1),A(p,g.parentNode,g)):p=null}else if(se){const Re={};X[0]&2&&(Re.gjSchemes=G[1]),X[0]&4&&(Re.scheme_reference=G[2]),p.$set(Re)}let Ee=m;m=ge(G),m===Ee?~m&&D[m].p(G,X):(v&&(ue(),E(D[Ee],1,1,()=>{D[Ee]=null}),fe()),~m?(v=D[m],v?v.p(G,X):(v=D[m]=H[m](G),v.c()),$(v,1),v.m(b.parentNode,b)):v=null),X[0]&1549&&(ye=at(G[3].features.filter(G[19])),ue(),y=fs(y,X,rt,1,G,ye,k,d,cs,qu,null,Gu),fe());const lr={};X[0]&67109040&&(lr.$$scope={dirty:X,ctx:G}),!F&&X[0]&16&&(F=!0,lr.open=G[4],Pe(()=>F=!1)),M.$set(lr)},i(G){if(!I){$(a.$$.fragment,G),$(u.$$.fragment,G),$(q,G),p&&$(p.$$.fragment,G),$(v);for(let X=0;X<ye.length;X+=1)$(y[X]);$(M.$$.fragment,G),I=!0}},o(G){E(a.$$.fragment,G),E(u.$$.fragment,G),E(q,G),p&&E(p.$$.fragment,G),E(v);for(let X=0;X<y.length;X+=1)E(y[X]);E(M.$$.fragment,G),I=!1},d(G){G&&(S(e),S(l),S(c),S(h),S(g),S(b),S(d),S(_)),C(a),C(u,G),q&&q.d(G),p&&C(p,G),~m&&D[m].d(G);for(let X=0;X<y.length;X+=1)y[X].d();C(M,G),U=!1,W()}}}function bS(r,e,t){let n,i,o,s,a=x,l=()=>(a(),a=zt(p,D=>t(3,s=D)),p),u;J(r,ei,D=>t(27,o=D)),J(r,et,D=>t(28,u=D)),r.$$.on_destroy.push(()=>a());let{$$slots:f={},$$scope:c}=e,{cfg:h}=e,{gjSchemes:p}=e;l();let{scheme_reference:g}=e,m=!1;tt(()=>{on.set(null)});function v(D,ge){D.preventDefault();let ye=s.features.find(rt=>rt.id==ge);ye.geometry.type=="Point"?u==null||u.flyTo({center:ye.geometry.coordinates,duration:500}):u==null||u.fitBounds(vc(ye),{padding:200,duration:500}),te.set({mode:"edit-form",id:ge})}function b(D){on.update(ge=>ge==D?null:ge)}function d(){p.update(D=>(D.features=D.features.filter(ge=>ge.properties.scheme_reference!=g),delete D.schemes[g],Object.keys(D.schemes).length==0&&(D=Vc(h)),D)),ei.update(D=>(D.delete(g),D)),t(4,m=!1)}let y="";function k(){y&&p.update(D=>{for(let ge of D.features)ge.properties.scheme_reference==g&&(ge.properties.scheme_reference=y);return D})}function _(){return Object.values(s.schemes).filter(D=>D.scheme_reference!=g).map(D=>[D.scheme_reference,h.schemeName(D)])}let M=!o.has(g);function F(){ei.update(D=>(M?D.delete(g):D.add(g),D))}function I(){s.schemes[g].color=this.value,p.set(s)}const U=()=>t(4,m=!0);function W(D){M=D,t(6,M)}const O=D=>D.properties.scheme_reference==g,P=(D,ge)=>v(ge,D.id),R=D=>on.set(D.id),q=D=>b(D.id);function se(D){y=D,t(5,y)}const ie=()=>t(4,m=!1);function H(D){m=D,t(4,m)}return r.$$set=D=>{"cfg"in D&&t(0,h=D.cfg),"gjSchemes"in D&&l(t(1,p=D.gjSchemes)),"scheme_reference"in D&&t(2,g=D.scheme_reference),"$$scope"in D&&t(26,c=D.$$scope)},r.$$.update=()=>{r.$$.dirty[0]&13&&t(8,n=s.features.filter(D=>D.properties.scheme_reference==g&&h.interventionWarning(D)!=null).length),r.$$.dirty[0]&12&&t(7,i=s.features.filter(D=>D.properties.scheme_reference==g).length)},[h,p,g,s,m,y,M,i,n,v,b,d,k,_,F,f,I,U,W,O,P,R,q,se,ie,H,c]}class wS extends Z{constructor(e){super(),Q(this,e,bS,_S,K,{cfg:0,gjSchemes:1,scheme_reference:2},null,[-1,-1])}}function Wu(r,e,t){const n=r.slice();return n[9]=e[t],n[11]=t,n}function SS(r){let e;return{c(){e=z("Add new blank scheme")},m(t,n){w(t,e,n)},d(t){t&&S(e)}}}function Hu(r){let e,t,n,i;function o(){return r[7](r[9])}e=new pe({props:{disabled:r[11]==0,$$slots:{default:[$S]},$$scope:{ctx:r}}}),e.$on("click",o);function s(){return r[8](r[9])}return n=new pe({props:{disabled:r[11]==Object.keys(r[3].schemes).length-1,$$slots:{default:[kS]},$$scope:{ctx:r}}}),n.$on("click",s),{c(){L(e.$$.fragment),t=B(),L(n.$$.fragment)},m(a,l){A(e,a,l),w(a,t,l),A(n,a,l),i=!0},p(a,l){r=a;const u={};l&8&&(u.disabled=r[11]==0),l&4096&&(u.$$scope={dirty:l,ctx:r}),e.$set(u);const f={};l&8&&(f.disabled=r[11]==Object.keys(r[3].schemes).length-1),l&4096&&(f.$$scope={dirty:l,ctx:r}),n.$set(f)},i(a){i||($(e.$$.fragment,a),$(n.$$.fragment,a),i=!0)},o(a){E(e.$$.fragment,a),E(n.$$.fragment,a),i=!1},d(a){a&&S(t),C(e,a),C(n,a)}}}function $S(r){let e;return{c(){e=z("Move up")},m(t,n){w(t,e,n)},d(t){t&&S(e)}}}function kS(r){let e;return{c(){e=z("Move down")},m(t,n){w(t,e,n)},d(t){t&&S(e)}}}function ES(r){let e=Object.keys(r[3].schemes).length>1,t,n,i=e&&Hu(r);return{c(){i&&i.c(),t=me()},m(o,s){i&&i.m(o,s),w(o,t,s),n=!0},p(o,s){s&8&&(e=Object.keys(o[3].schemes).length>1),e?i?(i.p(o,s),s&8&&$(i,1)):(i=Hu(o),i.c(),$(i,1),i.m(t.parentNode,t)):i&&(ue(),E(i,1,1,()=>{i=null}),fe())},i(o){n||($(i),n=!0)},o(o){E(i),n=!1},d(o){o&&S(t),i&&i.d(o)}}}function Vu(r,e){let t,n,i,o,s;return n=new wS({props:{cfg:e[0],gjSchemes:e[1],scheme_reference:e[9],$$slots:{default:[ES]},$$scope:{ctx:e}}}),{key:r,first:null,c(){t=me(),L(n.$$.fragment),i=B(),o=T("hr"),this.first=t},m(a,l){w(a,t,l),A(n,a,l),w(a,i,l),w(a,o,l),s=!0},p(a,l){e=a;const u={};l&1&&(u.cfg=e[0]),l&2&&(u.gjSchemes=e[1]),l&8&&(u.scheme_reference=e[9]),l&4104&&(u.$$scope={dirty:l,ctx:e}),n.$set(u)},i(a){s||($(n.$$.fragment,a),s=!0)},o(a){E(n.$$.fragment,a),s=!1},d(a){a&&(S(t),S(i),S(o)),C(n,a)}}}function MS(r){let e,t,n,i,o,s,a,l,u=[],f=new Map,c,h;e=new pe({props:{$$slots:{default:[SS]},$$scope:{ctx:r}}}),e.$on("click",r[4]),n=new nh({props:{label:"Add scheme from file",onLoad:r[5]}}),o=new Ot({props:{errorMessage:r[2]}});let p=at(Object.keys(r[3].schemes));const g=m=>m[9];for(let m=0;m<p.length;m+=1){let v=Wu(r,p,m),b=g(v);f.set(b,u[m]=Vu(b,v))}return{c(){L(e.$$.fragment),t=B(),L(n.$$.fragment),i=B(),L(o.$$.fragment),s=B(),a=T("hr"),l=B();for(let m=0;m<u.length;m+=1)u[m].c();c=me()},m(m,v){A(e,m,v),w(m,t,v),A(n,m,v),w(m,i,v),A(o,m,v),w(m,s,v),w(m,a,v),w(m,l,v);for(let b=0;b<u.length;b+=1)u[b]&&u[b].m(m,v);w(m,c,v),h=!0},p(m,[v]){const b={};v&4096&&(b.$$scope={dirty:v,ctx:m}),e.$set(b);const d={};v&4&&(d.errorMessage=m[2]),o.$set(d),v&75&&(p=at(Object.keys(m[3].schemes)),ue(),u=fs(u,v,g,1,m,p,f,c.parentNode,cs,Vu,c,Wu),fe())},i(m){if(!h){$(e.$$.fragment,m),$(n.$$.fragment,m),$(o.$$.fragment,m);for(let v=0;v<p.length;v+=1)$(u[v]);h=!0}},o(m){E(e.$$.fragment,m),E(n.$$.fragment,m),E(o.$$.fragment,m);for(let v=0;v<u.length;v+=1)E(u[v]);h=!1},d(m){m&&(S(t),S(i),S(s),S(a),S(l),S(c)),C(e,m),C(n,m),C(o,m);for(let v=0;v<u.length;v+=1)u[v].d(m)}}}function PS(r,e,t){[r[e],r[t]]=[r[t],r[e]]}function LS(r,e){const t={};return r.forEach(n=>{t[n]=e[n]}),t}function AS(r,e,t){let n,i=x,o=()=>(i(),i=zt(a,g=>t(3,n=g)),a);r.$$.on_destroy.push(()=>i());let{cfg:s}=e,{gjSchemes:a}=e;o();function l(){Jc(s,n),a.set(n)}let u="";function f(g,m){try{let v=s.backfill(JSON.parse(m));for(let d of Object.values(v.schemes)){if(d.scheme_reference in n.schemes)throw new Error("The file you're loading seems to contain duplicate data. Are you merging in the same file accidentally?");st(a,n.schemes[d.scheme_reference]=d,n)}st(a,n.features=n.features.concat(v.features),n);let b=1;n.features.forEach(d=>{d.id=b++}),a.set(n),t(2,u="")}catch(v){t(2,u=`Couldn't load scheme from a file: ${v}`)}}function c(g,m){const v=JSON.parse(JSON.stringify(Object.keys(n.schemes))),b=v.indexOf(g);if(b+m>=0&&b+m<v.length){PS(v,b,b+m);const d=LS(v,n.schemes);st(a,n.schemes=d,n),a.set(n)}}const h=g=>c(g,-1),p=g=>c(g,1);return r.$$set=g=>{"cfg"in g&&t(0,s=g.cfg),"gjSchemes"in g&&o(t(1,a=g.gjSchemes))},[s,a,u,n,l,f,c,h,p]}class CS extends Z{constructor(e){super(),Q(this,e,AS,MS,K,{cfg:0,gjSchemes:1})}}function OS(r){let e;return{c(){e=z("Save")},m(t,n){w(t,e,n)},d(t){t&&S(e)}}}function FS(r){let e;return{c(){e=z("Delete")},m(t,n){w(t,e,n)},d(t){t&&S(e)}}}function RS(r){let e,t,n,i;return e=new Wt({props:{$$slots:{default:[OS]},$$scope:{ctx:r}}}),e.$on("click",r[6]),n=new Ii({props:{disabled:!r[2],$$slots:{default:[FS]},$$scope:{ctx:r}}}),n.$on("click",r[4]),{c(){L(e.$$.fragment),t=B(),L(n.$$.fragment)},m(o,s){A(e,o,s),w(o,t,s),A(n,o,s),i=!0},p(o,s){const a={};s&512&&(a.$$scope={dirty:s,ctx:o}),e.$set(a);const l={};s&4&&(l.disabled=!o[2]),s&512&&(l.$$scope={dirty:s,ctx:o}),n.$set(l)},i(o){i||($(e.$$.fragment,o),$(n.$$.fragment,o),i=!0)},o(o){E(e.$$.fragment,o),E(n.$$.fragment,o),i=!1},d(o){o&&S(t),C(e,o),C(n,o)}}}function BS(r){let e,t,n;return{c(){e=T("input"),N(e,"class","govuk-file-upload"),N(e,"id","load-image"),N(e,"type","file")},m(i,o){w(i,e,o),r[7](e),t||(n=ne(e,"change",r[3]),t=!0)},p:x,d(i){i&&S(e),r[7](null),t=!1,n()}}}function Ju(r){let e,t,n,i,o,s,a,l;return{c(){e=T("div"),t=T("label"),n=T("input"),i=z(`
      Opacity: `),o=z(r[1]),s=z("%"),N(n,"type","range"),N(n,"min","0"),N(n,"max","100")},m(u,f){w(u,e,f),j(e,t),j(t,n),Ve(n,r[1]),j(t,i),j(t,o),j(t,s),a||(l=[ne(n,"change",r[8]),ne(n,"input",r[8])],a=!0)},p(u,f){f&2&&Ve(n,u[1]),f&2&&de(o,u[1])},d(u){u&&S(e),a=!1,qt(l)}}}function IS(r){let e,t,n,i,o,s,a,l,u;e=new or({props:{$$slots:{default:[RS]},$$scope:{ctx:r}}}),n=new Rr({props:{label:"Load an image",id:"load-image",$$slots:{default:[BS]},$$scope:{ctx:r}}});let f=r[2]&&Ju(r);return{c(){L(e.$$.fragment),t=B(),L(n.$$.fragment),i=B(),f&&f.c(),o=B(),s=T("p"),s.textContent=`Note this image isn't saved as part of this scheme. When you close this page,
  it'll be lost.`},m(c,h){A(e,c,h),w(c,t,h),A(n,c,h),w(c,i,h),f&&f.m(c,h),w(c,o,h),w(c,s,h),a=!0,l||(u=ne(window,"keydown",r[5]),l=!0)},p(c,[h]){const p={};h&516&&(p.$$scope={dirty:h,ctx:c}),e.$set(p);const g={};h&513&&(g.$$scope={dirty:h,ctx:c}),n.$set(g),c[2]?f?f.p(c,h):(f=Ju(c),f.c(),f.m(o.parentNode,o)):f&&(f.d(1),f=null)},i(c){a||($(e.$$.fragment,c),$(n.$$.fragment,c),a=!0)},o(c){E(e.$$.fragment,c),E(n.$$.fragment,c),a=!1},d(c){c&&(S(t),S(i),S(o),S(s)),C(e,c),C(n,c),f&&f.d(c),l=!1,u()}}}function NS(r,e,t){let n,i;J(r,ni,h=>t(1,n=h)),J(r,ri,h=>t(2,i=h));let o;async function s(h){let p=await o.files[0].arrayBuffer(),g=new Blob([new Uint8Array(p)]);st(ri,i=URL.createObjectURL(g),i)}function a(){st(ri,i=null,i),st(ni,n=100,n)}function l(h){h.key=="Escape"&&(h.stopPropagation(),te.set({mode:"list"}))}const u=()=>te.set({mode:"list"});function f(h){_e[h?"unshift":"push"](()=>{o=h,t(0,o)})}function c(){n=Rp(this.value),ni.set(n)}return[o,n,i,s,a,l,u,f,c]}class TS extends Z{constructor(e){super(),Q(this,e,NS,IS,K,{})}}function DS(r){let e;return{c(){e=z("Cancel")},m(t,n){w(t,e,n)},d(t){t&&S(e)}}}function jS(r){let e,t,n,i;return e=new pe({props:{$$slots:{default:[DS]},$$scope:{ctx:r}}}),e.$on("click",r[0]),n=new Yc({props:{editingExisting:!1}}),{c(){L(e.$$.fragment),t=B(),L(n.$$.fragment)},m(o,s){A(e,o,s),w(o,t,s),A(n,o,s),i=!0},p(o,[s]){const a={};s&32&&(a.$$scope={dirty:s,ctx:o}),e.$set(a)},i(o){i||($(e.$$.fragment,o),$(n.$$.fragment,o),i=!0)},o(o){E(e.$$.fragment,o),E(n.$$.fragment,o),i=!1},d(o){o&&S(t),C(e,o),C(n,o)}}}function GS(r,e,t){let n;J(r,yn,l=>t(3,n=l));let{cfg:i}=e,{gjSchemes:o}=e;Ft(()=>{n.start(),n.addEventListenerSuccess(s),n.addEventListenerFailure(a)}),tt(()=>{n.stop(),n.clearEventListeners()});function s(l){l.properties||(l.properties={});let u=l;o.update(f=>(u.id=kn(f),u.properties.scheme_reference=qi(f),i.newPointFeature(u),f.features.push(u),f)),te.set({mode:"edit-form",id:u.id})}function a(){te.set({mode:"list"})}return r.$$set=l=>{"cfg"in l&&t(1,i=l.cfg),"gjSchemes"in l&&t(2,o=l.gjSchemes)},[a,i,o]}class US extends Z{constructor(e){super(),Q(this,e,GS,jS,K,{cfg:1,gjSchemes:2})}}function qS(r){let e;return{c(){e=z("Finish")},m(t,n){w(t,e,n)},d(t){t&&S(e)}}}function zS(r){let e;return{c(){e=z("Cancel")},m(t,n){w(t,e,n)},d(t){t&&S(e)}}}function WS(r){let e,t,n,i;return e=new Wt({props:{$$slots:{default:[qS]},$$scope:{ctx:r}}}),e.$on("click",r[1]),n=new pe({props:{$$slots:{default:[zS]},$$scope:{ctx:r}}}),n.$on("click",r[0]),{c(){L(e.$$.fragment),t=B(),L(n.$$.fragment)},m(o,s){A(e,o,s),w(o,t,s),A(n,o,s),i=!0},p(o,s){const a={};s&64&&(a.$$scope={dirty:s,ctx:o}),e.$set(a);const l={};s&64&&(l.$$scope={dirty:s,ctx:o}),n.$set(l)},i(o){i||($(e.$$.fragment,o),$(n.$$.fragment,o),i=!0)},o(o){E(e.$$.fragment,o),E(n.$$.fragment,o),i=!1},d(o){o&&S(t),C(e,o),C(n,o)}}}function HS(r){let e,t,n,i;return e=new or({props:{$$slots:{default:[WS]},$$scope:{ctx:r}}}),n=new Xc({}),{c(){L(e.$$.fragment),t=B(),L(n.$$.fragment)},m(o,s){A(e,o,s),w(o,t,s),A(n,o,s),i=!0},p(o,[s]){const a={};s&64&&(a.$$scope={dirty:s,ctx:o}),e.$set(a)},i(o){i||($(e.$$.fragment,o),$(n.$$.fragment,o),i=!0)},o(o){E(e.$$.fragment,o),E(n.$$.fragment,o),i=!1},d(o){o&&S(t),C(e,o),C(n,o)}}}function VS(r,e,t){let n;J(r,Cr,u=>t(4,n=u));let{cfg:i}=e,{gjSchemes:o}=e;Ft(()=>{n.startNew(),n.addEventListenerSuccess(s),n.addEventListenerFailure(a)}),tt(()=>{n.stop(),n.clearEventListeners()});function s(u){u.properties||(u.properties={});let f=u;o.update(c=>(f.id=kn(c),f.properties.scheme_reference=qi(c),i.newPolygonFeature(f),c.features.push(f),c)),te.set({mode:"edit-form",id:f.id})}function a(){te.set({mode:"list"})}function l(){n.finish()}return r.$$set=u=>{"cfg"in u&&t(2,i=u.cfg),"gjSchemes"in u&&t(3,o=u.gjSchemes)},[a,l,i,o]}class JS extends Z{constructor(e){super(),Q(this,e,VS,HS,K,{cfg:2,gjSchemes:3})}}function YS(r){let e;return{c(){e=z("Finish")},m(t,n){w(t,e,n)},d(t){t&&S(e)}}}function XS(r){let e;return{c(){e=z("Cancel")},m(t,n){w(t,e,n)},d(t){t&&S(e)}}}function KS(r){let e,t,n,i;return e=new Wt({props:{$$slots:{default:[YS]},$$scope:{ctx:r}}}),e.$on("click",r[2]),n=new pe({props:{$$slots:{default:[XS]},$$scope:{ctx:r}}}),n.$on("click",r[1]),{c(){L(e.$$.fragment),t=B(),L(n.$$.fragment)},m(o,s){A(e,o,s),w(o,t,s),A(n,o,s),i=!0},p(o,s){const a={};s&64&&(a.$$scope={dirty:s,ctx:o}),e.$set(a);const l={};s&64&&(l.$$scope={dirty:s,ctx:o}),n.$set(l)},i(o){i||($(e.$$.fragment,o),$(n.$$.fragment,o),i=!0)},o(o){E(e.$$.fragment,o),E(n.$$.fragment,o),i=!1},d(o){o&&S(t),C(e,o),C(n,o)}}}function ZS(r){let e,t,n,i;return e=new or({props:{$$slots:{default:[KS]},$$scope:{ctx:r}}}),n=new Qc({props:{cfg:r[0],extendRoute:!0}}),{c(){L(e.$$.fragment),t=B(),L(n.$$.fragment)},m(o,s){A(e,o,s),w(o,t,s),A(n,o,s),i=!0},p(o,[s]){const a={};s&64&&(a.$$scope={dirty:s,ctx:o}),e.$set(a);const l={};s&1&&(l.cfg=o[0]),n.$set(l)},i(o){i||($(e.$$.fragment,o),$(n.$$.fragment,o),i=!0)},o(o){E(e.$$.fragment,o),E(n.$$.fragment,o),i=!1},d(o){o&&S(t),C(e,o),C(n,o)}}}function QS(r,e,t){let n;J(r,Pt,u=>t(4,n=u));let{cfg:i}=e,{gjSchemes:o}=e;Ft(()=>{n.startRoute(),n.addEventListenerSuccess(s),n.addEventListenerFailure(a)}),tt(()=>{n.stop(),n.clearEventListeners()});function s(u){let f=u;o.update(c=>(f.id=kn(c),f.properties.scheme_reference=qi(c),i.newLineStringFeature(f),c.features.push(f),c)),te.set({mode:"edit-form",id:f.id})}function a(){te.set({mode:"list"})}function l(){n.finish()}return r.$$set=u=>{"cfg"in u&&t(0,i=u.cfg),"gjSchemes"in u&&t(3,o=u.gjSchemes)},[i,a,l,o]}class xS extends Z{constructor(e){super(),Q(this,e,QS,ZS,K,{cfg:0,gjSchemes:3})}}function e$(r){let e,t;return e=new Ot({props:{errorMessage:"Failed to load route snapper"}}),{c(){L(e.$$.fragment)},m(n,i){A(e,n,i),t=!0},p:x,i(n){t||($(e.$$.fragment,n),t=!0)},o(n){E(e.$$.fragment,n),t=!1},d(n){C(e,n)}}}function t$(r){let e,t,n;return{c(){e=T("label"),e.textContent="Route data unpacking",t=B(),n=T("progress"),N(e,"for","route-unpacking"),N(n,"id","route-unpacking"),N(n,"class","svelte-q3473n")},m(i,o){w(i,e,o),w(i,t,o),w(i,n,o)},p:x,i:x,o:x,d(i){i&&(S(e),S(t),S(n))}}}function r$(r){let e,t,n;return{c(){e=T("label"),e.textContent="Route tool loading",t=B(),n=T("progress"),N(e,"for","route-loading"),N(n,"id","route-loading"),n.value=r[0],N(n,"class","svelte-q3473n")},m(i,o){w(i,e,o),w(i,t,o),w(i,n,o)},p(i,o){o&1&&(n.value=i[0])},i:x,o:x,d(i){i&&(S(e),S(t),S(n))}}}function n$(r){let e,t,n,i;const o=[r$,t$,e$],s=[];function a(l,u){return!l[1]&&!l[2]&&!l[3]?0:l[3]&&!l[1]&&!l[2]?1:l[2]?2:-1}return~(e=a(r))&&(t=s[e]=o[e](r)),{c(){t&&t.c(),n=me()},m(l,u){~e&&s[e].m(l,u),w(l,n,u),i=!0},p(l,[u]){let f=e;e=a(l),e===f?~e&&s[e].p(l,u):(t&&(ue(),E(s[f],1,1,()=>{s[f]=null}),fe()),~e?(t=s[e],t?t.p(l,u):(t=s[e]=o[e](l),t.c()),$(t,1),t.m(n.parentNode,n)):t=null)},i(l){i||($(t),i=!0)},o(l){E(t),i=!1},d(l){l&&S(n),~e&&s[e].d(l)}}}function i$(r,e,t){let n,i;J(r,et,u=>t(5,i=u));let{url:o}=e,s=0,a=!1,l=!1;return Ft(async()=>{await Bc(),console.log(`Grabbing ${o}`);try{const u=await Nw(o,f=>{t(0,s=f)});Pt.set(new rb(i,u,Kc,Zc,js)),t(0,s=100),t(1,a=!0)}catch(u){console.log(`Route tool broke: ${u}`),t(2,l=!0)}}),r.$$set=u=>{"url"in u&&t(4,o=u.url)},r.$$.update=()=>{r.$$.dirty&1&&t(3,n=s>=100)},[s,a,l,n,o]}class o$ extends Z{constructor(e){super(),Q(this,e,i$,n$,K,{url:4})}}function s$(r){let e;return{c(){e=z("Finish")},m(t,n){w(t,e,n)},d(t){t&&S(e)}}}function a$(r){let e;return{c(){e=z("Cancel")},m(t,n){w(t,e,n)},d(t){t&&S(e)}}}function l$(r){let e,t,n,i;return e=new Wt({props:{$$slots:{default:[s$]},$$scope:{ctx:r}}}),e.$on("click",r[1]),n=new pe({props:{$$slots:{default:[a$]},$$scope:{ctx:r}}}),n.$on("click",r[0]),{c(){L(e.$$.fragment),t=B(),L(n.$$.fragment)},m(o,s){A(e,o,s),w(o,t,s),A(n,o,s),i=!0},p(o,s){const a={};s&64&&(a.$$scope={dirty:s,ctx:o}),e.$set(a);const l={};s&64&&(l.$$scope={dirty:s,ctx:o}),n.$set(l)},i(o){i||($(e.$$.fragment,o),$(n.$$.fragment,o),i=!0)},o(o){E(e.$$.fragment,o),E(n.$$.fragment,o),i=!1},d(o){o&&S(t),C(e,o),C(n,o)}}}function u$(r){let e,t,n,i;return e=new or({props:{$$slots:{default:[l$]},$$scope:{ctx:r}}}),n=new xc({}),{c(){L(e.$$.fragment),t=B(),L(n.$$.fragment)},m(o,s){A(e,o,s),w(o,t,s),A(n,o,s),i=!0},p(o,[s]){const a={};s&64&&(a.$$scope={dirty:s,ctx:o}),e.$set(a)},i(o){i||($(e.$$.fragment,o),$(n.$$.fragment,o),i=!0)},o(o){E(e.$$.fragment,o),E(n.$$.fragment,o),i=!1},d(o){o&&S(t),C(e,o),C(n,o)}}}function f$(r,e,t){let n;J(r,Pt,u=>t(4,n=u));let{cfg:i}=e,{gjSchemes:o}=e;Ft(()=>{n.startArea(),n.addEventListenerSuccess(s),n.addEventListenerFailure(a)}),tt(()=>{n.stop(),n.clearEventListeners()});function s(u){let f=u;o.update(c=>(f.id=kn(c),f.properties.scheme_reference=qi(c),i.newPolygonFeature(f),c.features.push(f),c)),te.set({mode:"edit-form",id:f.id})}function a(){te.set({mode:"list"})}function l(){n.finish()}return r.$$set=u=>{"cfg"in u&&t(2,i=u.cfg),"gjSchemes"in u&&t(3,o=u.gjSchemes)},[a,l,i,o]}class c$ extends Z{constructor(e){super(),Q(this,e,f$,u$,K,{cfg:2,gjSchemes:3})}}function Yu(r){let e,t;return e=new o$({props:{url:r[2]}}),{c(){L(e.$$.fragment)},m(n,i){A(e,n,i),t=!0},p(n,i){const o={};i&4&&(o.url=n[2]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){E(e.$$.fragment,n),t=!1},d(n){C(e,n)}}}function p$(r){let e,t,n,i;return n=new Gw({props:{cfg:r[0]}}),{c(){e=T("h2"),e.textContent="StreetView",t=B(),L(n.$$.fragment)},m(o,s){w(o,e,s),w(o,t,s),A(n,o,s),i=!0},p(o,s){const a={};s&1&&(a.cfg=o[0]),n.$set(a)},i(o){i||($(n.$$.fragment,o),i=!0)},o(o){E(n.$$.fragment,o),i=!1},d(o){o&&(S(e),S(t)),C(n,o)}}}function h$(r){let e,t,n,i;return n=new TS({}),{c(){e=T("h2"),e.textContent="Georeference image",t=B(),L(n.$$.fragment)},m(o,s){w(o,e,s),w(o,t,s),A(n,o,s),i=!0},p:x,i(o){i||($(n.$$.fragment,o),i=!0)},o(o){E(n.$$.fragment,o),i=!1},d(o){o&&(S(e),S(t)),C(n,o)}}}function g$(r){let e,t,n,i,o,s;return n=new Wt({props:{$$slots:{default:[S$]},$$scope:{ctx:r}}}),n.$on("click",r[7]),{c(){e=T("h2"),e.textContent="Split route",t=B(),L(n.$$.fragment),i=B(),o=T("ul"),o.innerHTML=`<li><b>Click</b>
      on a route to split it</li> <li><b>Click</b>
      on the map or press
      <b>Escape</b>
      to cancel</li>`},m(a,l){w(a,e,l),w(a,t,l),A(n,a,l),w(a,i,l),w(a,o,l),s=!0},p(a,l){const u={};l&512&&(u.$$scope={dirty:l,ctx:a}),n.$set(u)},i(a){s||($(n.$$.fragment,a),s=!0)},o(a){E(n.$$.fragment,a),s=!1},d(a){a&&(S(e),S(t),S(i),S(o)),C(n,a)}}}function m$(r){let e,t,n,i;return n=new c$({props:{cfg:r[0],gjSchemes:r[1]}}),{c(){e=T("h2"),e.textContent="New polygon (snapped)",t=B(),L(n.$$.fragment)},m(o,s){w(o,e,s),w(o,t,s),A(n,o,s),i=!0},p(o,s){const a={};s&1&&(a.cfg=o[0]),s&2&&(a.gjSchemes=o[1]),n.$set(a)},i(o){i||($(n.$$.fragment,o),i=!0)},o(o){E(n.$$.fragment,o),i=!1},d(o){o&&(S(e),S(t)),C(n,o)}}}function d$(r){let e,t,n,i;return n=new JS({props:{cfg:r[0],gjSchemes:r[1]}}),{c(){e=T("h2"),e.textContent="New polygon (freehand)",t=B(),L(n.$$.fragment)},m(o,s){w(o,e,s),w(o,t,s),A(n,o,s),i=!0},p(o,s){const a={};s&1&&(a.cfg=o[0]),s&2&&(a.gjSchemes=o[1]),n.$set(a)},i(o){i||($(n.$$.fragment,o),i=!0)},o(o){E(n.$$.fragment,o),i=!1},d(o){o&&(S(e),S(t)),C(n,o)}}}function y$(r){let e,t,n,i;return n=new xS({props:{cfg:r[0],gjSchemes:r[1]}}),{c(){e=T("h2"),e.textContent="New route",t=B(),L(n.$$.fragment)},m(o,s){w(o,e,s),w(o,t,s),A(n,o,s),i=!0},p(o,s){const a={};s&1&&(a.cfg=o[0]),s&2&&(a.gjSchemes=o[1]),n.$set(a)},i(o){i||($(n.$$.fragment,o),i=!0)},o(o){E(n.$$.fragment,o),i=!1},d(o){o&&(S(e),S(t)),C(n,o)}}}function v$(r){let e,t,n,i;return n=new US({props:{cfg:r[0],gjSchemes:r[1]}}),{c(){e=T("h2"),e.textContent="New point",t=B(),L(n.$$.fragment)},m(o,s){w(o,e,s),w(o,t,s),A(n,o,s),i=!0},p(o,s){const a={};s&1&&(a.cfg=o[0]),s&2&&(a.gjSchemes=o[1]),n.$set(a)},i(o){i||($(n.$$.fragment,o),i=!0)},o(o){E(n.$$.fragment,o),i=!1},d(o){o&&(S(e),S(t)),C(n,o)}}}function _$(r){let e,t;return e=new Xb({props:{cfg:r[0],gjSchemes:r[1],id:r[4].id}}),{c(){L(e.$$.fragment)},m(n,i){A(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.cfg=n[0]),i&2&&(o.gjSchemes=n[1]),i&16&&(o.id=n[4].id),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){E(e.$$.fragment,n),t=!1},d(n){C(e,n)}}}function b$(r){let e,t;return e=new uS({props:{cfg:r[0],gjSchemes:r[1],id:r[4].id}}),{c(){L(e.$$.fragment)},m(n,i){A(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.cfg=n[0]),i&2&&(o.gjSchemes=n[1]),i&16&&(o.id=n[4].id),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){E(e.$$.fragment,n),t=!1},d(n){C(e,n)}}}function w$(r){let e,t;return e=new CS({props:{cfg:r[0],gjSchemes:r[1]}}),{c(){L(e.$$.fragment)},m(n,i){A(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.cfg=n[0]),i&2&&(o.gjSchemes=n[1]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){E(e.$$.fragment,n),t=!1},d(n){C(e,n)}}}function S$(r){let e;return{c(){e=z("Finish")},m(t,n){w(t,e,n)},d(t){t&&S(e)}}}function $$(r){let e,t,n,i,o,s,a=r[3]&&Yu(r);const l=[w$,b$,_$,v$,y$,d$,m$,g$,h$,p$],u=[];function f(c,h){return c[4].mode=="list"?0:c[4].mode=="edit-form"?1:c[4].mode=="edit-geometry"?2:c[4].mode=="new-point"?3:c[4].mode=="new-route"?4:c[4].mode=="new-freehand-polygon"?5:c[4].mode=="new-snapped-polygon"?6:c[4].mode=="split-route"?7:c[4].mode=="set-image"?8:c[4].mode=="streetview"?9:-1}return~(n=f(r))&&(i=u[n]=l[n](r)),{c(){e=T("div"),a&&a.c(),t=B(),i&&i.c(),o=me(),ve(e,"visibility",r[4].mode=="list"?"visible":"hidden")},m(c,h){w(c,e,h),a&&a.m(e,null),w(c,t,h),~n&&u[n].m(c,h),w(c,o,h),s=!0},p(c,[h]){c[3]?a?(a.p(c,h),h&8&&$(a,1)):(a=Yu(c),a.c(),$(a,1),a.m(e,null)):a&&(ue(),E(a,1,1,()=>{a=null}),fe()),h&16&&ve(e,"visibility",c[4].mode=="list"?"visible":"hidden");let p=n;n=f(c),n===p?~n&&u[n].p(c,h):(i&&(ue(),E(u[p],1,1,()=>{u[p]=null}),fe()),~n?(i=u[n],i?i.p(c,h):(i=u[n]=l[n](c),i.c()),$(i,1),i.m(o.parentNode,o)):i=null)},i(c){s||($(a),$(i),s=!0)},o(c){E(a),E(i),s=!1},d(c){c&&(S(e),S(t),S(o)),a&&a.d(),~n&&u[n].d(c)}}}function k$(r,e,t){let n,i,o,s,a;J(r,Pt,h=>t(8,n=h)),J(r,Cr,h=>t(5,i=h)),J(r,yn,h=>t(6,o=h)),J(r,et,h=>t(3,s=h)),J(r,te,h=>t(4,a=h));let{cfg:l}=e,{gjSchemes:u}=e,{routeSnapperUrl:f}=e;tt(()=>{o==null||o.tearDown(),i==null||i.tearDown(),n==null||n.tearDown()});const c=()=>te.set({mode:"list"});return r.$$set=h=>{"cfg"in h&&t(0,l=h.cfg),"gjSchemes"in h&&t(1,u=h.gjSchemes),"routeSnapperUrl"in h&&t(2,f=h.routeSnapperUrl)},r.$$.update=()=>{r.$$.dirty&72&&s&&!o&&yn.set(new j_(s)),r.$$.dirty&40&&s&&!i&&Cr.set(new m0(s))},[l,u,f,s,a,i,o,c]}class E$ extends Z{constructor(e){super(),Q(this,e,k$,$$,K,{cfg:0,gjSchemes:1,routeSnapperUrl:2})}}function Xu(r){let e;return{c(){e=T("div"),e.textContent="If transcribing from a document, use the route name there if possible",N(e,"class","govuk-hint")},m(t,n){w(t,e,n)},d(t){t&&S(e)}}}function Ku(r){let e,t;return e=new pe({props:{disabled:!r[3],$$slots:{default:[M$]},$$scope:{ctx:r}}}),e.$on("click",r[9]),{c(){L(e.$$.fragment)},m(n,i){A(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.disabled=!n[3]),i&32768&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){E(e.$$.fragment,n),t=!1},d(n){C(e,n)}}}function M$(r){let e;return{c(){e=z("Auto-fill with street names")},m(t,n){w(t,e,n)},d(t){t&&S(e)}}}function P$(r){let e,t,n,i,o,s,a,l=r[0].length_meters&&Xu(),u=r[0].length_meters&&Ku(r);return{c(){l&&l.c(),e=B(),t=T("input"),n=B(),u&&u.c(),i=me(),N(t,"type","text"),N(t,"class","govuk-input"),N(t,"id",r[6])},m(f,c){l&&l.m(f,c),w(f,e,c),w(f,t,c),Ve(t,r[0].name),w(f,n,c),u&&u.m(f,c),w(f,i,c),o=!0,s||(a=ne(t,"input",r[8]),s=!0)},p(f,c){f[0].length_meters?l||(l=Xu(),l.c(),l.m(e.parentNode,e)):l&&(l.d(1),l=null),c&1&&t.value!==f[0].name&&Ve(t,f[0].name),f[0].length_meters?u?(u.p(f,c),c&1&&$(u,1)):(u=Ku(f),u.c(),$(u,1),u.m(i.parentNode,i)):u&&(ue(),E(u,1,1,()=>{u=null}),fe())},i(f){o||($(u),o=!0)},o(f){E(u),o=!1},d(f){f&&(S(e),S(t),S(n),S(i)),l&&l.d(f),u&&u.d(f),s=!1,a()}}}function L$(r){let e,t,n,i,o,s,a,l,u,f,c;e=new Rr({props:{label:"Name",id:r[6],$$slots:{default:[P$]},$$scope:{ctx:r}}});function h(d){r[11](d)}let p={label:"Scheme",choices:Object.values(r[4].schemes).map(r[10])};r[0].scheme_reference!==void 0&&(p.value=r[0].scheme_reference),n=new _o({props:p}),_e.push(()=>$e(n,"value",h));function g(d){r[12](d)}let m={label:"Infrastructure type",choices:[["mixed-traffic-street","Mixed Traffic Street"],["detached-cycle-track","Detached or Remote Cycle Track"],["carriageway-cycle-track","Cycle Track at Carriageway Level"],["stepped-cycle-track","Stepped or Footway Level Cycle Track"],["light-segregation","Light Segregation"],["cycle-lane","Cycle Lane"],["","Unknown"]]};r[0].infrastructure_type!==void 0&&(m.value=r[0].infrastructure_type),s=new _o({props:m}),_e.push(()=>$e(s,"value",g));function v(d){r[13](d)}let b={label:"Description"};return r[0].description!==void 0&&(b.value=r[0].description),u=new dh({props:b}),_e.push(()=>$e(u,"value",v)),{c(){L(e.$$.fragment),t=B(),L(n.$$.fragment),o=B(),L(s.$$.fragment),l=B(),L(u.$$.fragment)},m(d,y){A(e,d,y),w(d,t,y),A(n,d,y),w(d,o,y),A(s,d,y),w(d,l,y),A(u,d,y),c=!0},p(d,[y]){const k={};y&32777&&(k.$$scope={dirty:y,ctx:d}),e.$set(k);const _={};y&18&&(_.choices=Object.values(d[4].schemes).map(d[10])),!i&&y&1&&(i=!0,_.value=d[0].scheme_reference,Pe(()=>i=!1)),n.$set(_);const M={};!a&&y&1&&(a=!0,M.value=d[0].infrastructure_type,Pe(()=>a=!1)),s.$set(M);const F={};!f&&y&1&&(f=!0,F.value=d[0].description,Pe(()=>f=!1)),u.$set(F)},i(d){c||($(e.$$.fragment,d),$(n.$$.fragment,d),$(s.$$.fragment,d),$(u.$$.fragment,d),c=!0)},o(d){E(e.$$.fragment,d),E(n.$$.fragment,d),E(s.$$.fragment,d),E(u.$$.fragment,d),c=!1},d(d){d&&(S(t),S(o),S(l)),C(e,d),C(n,d),C(s,d),C(u,d)}}}function A$(r,e,t){let n,i,o=x,s=()=>(o(),o=zt(l,y=>t(4,i=y)),l);J(r,Pt,y=>t(3,n=y)),r.$$.on_destroy.push(()=>o());let{cfg:a}=e,{gjSchemes:l}=e;s();let{id:u}=e,{props:f}=e;function c(){try{t(0,f.name=n.inner.routeNameForWaypoints(f.waypoints),f)}catch(y){window.alert(`Couldn't auto-name route: ${y}`)}}let h=Wc();function p(){f.name=this.value,t(0,f)}const g=()=>c(),m=y=>[y.scheme_reference,a.schemeName(y)];function v(y){r.$$.not_equal(f.scheme_reference,y)&&(f.scheme_reference=y,t(0,f))}function b(y){r.$$.not_equal(f.infrastructure_type,y)&&(f.infrastructure_type=y,t(0,f))}function d(y){r.$$.not_equal(f.description,y)&&(f.description=y,t(0,f))}return r.$$set=y=>{"cfg"in y&&t(1,a=y.cfg),"gjSchemes"in y&&s(t(2,l=y.gjSchemes)),"id"in y&&t(7,u=y.id),"props"in y&&t(0,f=y.props)},[f,a,l,n,i,c,h,u,p,g,m,v,b,d]}class C$ extends Z{constructor(e){super(),Q(this,e,A$,L$,K,{cfg:1,gjSchemes:2,id:7,props:0})}}function O$(r){let e,t,n;function i(s){r[3](s)}let o={label:"Scheme name",required:!0};return r[2].schemes[r[1]].scheme_name!==void 0&&(o.value=r[2].schemes[r[1]].scheme_name),e=new of({props:o}),_e.push(()=>$e(e,"value",i)),{c(){L(e.$$.fragment)},m(s,a){A(e,s,a),n=!0},p(s,[a]){const l={};!t&&a&6&&(t=!0,l.value=s[2].schemes[s[1]].scheme_name,Pe(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){E(e.$$.fragment,s),n=!1},d(s){C(e,s)}}}function F$(r,e,t){let n,i=x,o=()=>(i(),i=zt(s,u=>t(2,n=u)),s);r.$$.on_destroy.push(()=>i());let{gjSchemes:s}=e;o();let{scheme_reference:a}=e;function l(u){r.$$.not_equal(n.schemes[a].scheme_name,u)&&(n.schemes[a].scheme_name=u,s.set(n))}return r.$$set=u=>{"gjSchemes"in u&&o(t(0,s=u.gjSchemes)),"scheme_reference"in u&&t(1,a=u.scheme_reference)},[s,a,n,l]}class R$ extends Z{constructor(e){super(),Q(this,e,F$,O$,K,{gjSchemes:0,scheme_reference:1})}}let wt={interventionName:B$,schemeName:r=>r.scheme_name,backfill:r=>r,initializeEmptyScheme:r=>{let e=r;return e.scheme_name="",e},interventionWarning:r=>null,editFeatureForm:C$,editSchemeForm:R$,newPointFeature:r=>{r.properties.infrastructure_type=""},newPolygonFeature:r=>{r.properties.infrastructure_type=""},newLineStringFeature:r=>{r.properties.infrastructure_type=""},updateFeature:(r,e)=>{},maptilerApiKey:"MZEJTanw3WpxRvt7qDfo",getStreetViewRoadLayerNames:r=>r.getStyle().layers.filter(e=>e["source-layer"]=="roads"&&e.type=="line").map(e=>e.id),layerZorder:["interventions-polygons","interventions-polygons-outlines","hover-polygons","hover-lines","interventions-lines","interventions-lines-endpoints","hover-points","interventions-points","edit-polygon-fill","edit-polygon-lines","edit-polygon-vertices","draw-split-route","route-points","route-lines","route-polygons","Road labels","boundary","georeferenced-image"]};function B$(r){return r.properties.name?r.properties.name:r.geometry.type=="Point"?"untitled point":r.geometry.type=="LineString"?"untitled route":"untitled area"}function Zu(r){let e,t,n,i,o,s,a;return{c(){e=T("h2"),e.textContent="NPT Scheme Sketcher",t=B(),n=T("p"),i=z(r[3]),o=z(` (
        `),s=T("a"),s.textContent="Change area",a=z(`
        )`),N(s,"href","index.html")},m(l,u){w(l,e,u),w(l,t,u),w(l,n,u),j(n,i),j(n,o),j(n,s),j(n,a)},p:x,d(l){l&&(S(e),S(t),S(n))}}}function I$(r){let e,t;return e=new mw({props:{cfg:wt,gjSchemes:r[6]}}),{c(){L(e.$$.fragment)},m(n,i){A(e,n,i),t=!0},p:x,i(n){t||($(e.$$.fragment,n),t=!0)},o(n){E(e.$$.fragment,n),t=!1},d(n){C(e,n)}}}function N$(r){let e,t;return e=new rS({props:{cfg:wt,gjSchemes:r[6]}}),{c(){L(e.$$.fragment)},m(n,i){A(e,n,i),t=!0},p:x,i(n){t||($(e.$$.fragment,n),t=!0)},o(n){E(e.$$.fragment,n),t=!1},d(n){C(e,n)}}}function T$(r){let e,t,n,i,o,s,a,l,u,f,c,h,p;e=new D_({props:{cfg:wt,boundaryGeojson:r[0],fitBoundsAtStart:r[4]}}),n=new d1({props:{cfg:wt,gjSchemes:r[6]}}),o=new t1({props:{cfg:wt}});const g=[N$,I$],m=[];function v(b,d){return b[1].mode=="list"?0:b[1].mode=="split-route"?1:-1}return~(a=v(r))&&(l=m[a]=g[a](r)),f=new M1({props:{cfg:wt}}),h=new b1({props:{cfg:wt}}),{c(){L(e.$$.fragment),t=B(),L(n.$$.fragment),i=B(),L(o.$$.fragment),s=B(),l&&l.c(),u=B(),L(f.$$.fragment),c=B(),L(h.$$.fragment)},m(b,d){A(e,b,d),w(b,t,d),A(n,b,d),w(b,i,d),A(o,b,d),w(b,s,d),~a&&m[a].m(b,d),w(b,u,d),A(f,b,d),w(b,c,d),A(h,b,d),p=!0},p(b,d){const y={};d&1&&(y.boundaryGeojson=b[0]),e.$set(y);let k=a;a=v(b),a===k?~a&&m[a].p(b,d):(l&&(ue(),E(m[k],1,1,()=>{m[k]=null}),fe()),~a?(l=m[a],l?l.p(b,d):(l=m[a]=g[a](b),l.c()),$(l,1),l.m(u.parentNode,u)):l=null)},i(b){p||($(e.$$.fragment,b),$(n.$$.fragment,b),$(o.$$.fragment,b),$(l),$(f.$$.fragment,b),$(h.$$.fragment,b),p=!0)},o(b){E(e.$$.fragment,b),E(n.$$.fragment,b),E(o.$$.fragment,b),E(l),E(f.$$.fragment,b),E(h.$$.fragment,b),p=!1},d(b){b&&(S(t),S(i),S(s),S(u),S(c)),C(e,b),C(n,b),C(o,b),~a&&m[a].d(b),C(f,b),C(h,b)}}}function D$(r){let e,t,n,i,o,s,a,l,u,f=r[1].mode=="list"&&Zu(r);i=new E$({props:{cfg:wt,gjSchemes:r[6],routeSnapperUrl:r[5]}});function c(p){r[7](p)}let h={style:"https://api.maptiler.com/maps/uk-openzoomstack-light/style.json?key="+wt.maptilerApiKey,standardControls:!0,hash:!0,$$slots:{default:[T$]},$$scope:{ctx:r}};return r[2]!==void 0&&(h.map=r[2]),a=new Bp({props:h}),_e.push(()=>$e(a,"map",c)),a.$on("error",r[8]),{c(){e=T("div"),t=T("div"),f&&f.c(),n=B(),L(i.$$.fragment),o=B(),s=T("div"),L(a.$$.fragment),N(t,"class","sidebar svelte-1j3l30i"),N(s,"class","map svelte-1j3l30i"),ve(e,"display","flex"),ve(e,"height","100vh")},m(p,g){w(p,e,g),j(e,t),f&&f.m(t,null),j(t,n),A(i,t,null),j(e,o),j(e,s),A(a,s,null),u=!0},p(p,[g]){p[1].mode=="list"?f?f.p(p,g):(f=Zu(p),f.c(),f.m(t,n)):f&&(f.d(1),f=null);const m={};g&1027&&(m.$$scope={dirty:g,ctx:p}),!l&&g&4&&(l=!0,m.map=p[2],Pe(()=>l=!1)),a.$set(m)},i(p){u||($(i.$$.fragment,p),$(a.$$.fragment,p),u=!0)},o(p){E(i.$$.fragment,p),E(a.$$.fragment,p),u=!1},d(p){p&&S(e),f&&f.d(),C(i),C(a)}}}function j$(r,e,t){let n,i;J(r,te,p=>t(1,n=p)),J(r,et,p=>t(2,i=p));let s=new URLSearchParams(window.location.search).get("boundary"),a=!window.location.hash,l={type:"FeatureCollection",features:[]};Ft(async()=>{Ip();let g=await(await fetch(Np)).json();g.features=g.features.filter(m=>m.properties.LAD23NM==s),g.features.length===0&&(window.location.href=`index.html?error=Boundary name not found: ${s}`),t(0,l=g)});let u=`https://atip.uk/npt_tmp/${s}.bin.gz`,f=Oe(Vc(wt));function c(p){i=p,et.set(i)}return[l,n,i,s,a,u,f,c,p=>{console.log(p.detail.error)}]}class G$ extends Z{constructor(e){super(),Q(this,e,j$,D$,K,{})}}document.body.className+=" js-enabled"+("noModule"in HTMLScriptElement.prototype?" govuk-frontend-supported":"");new G$({target:document.getElementById("app")});
