var op=Object.defineProperty;var sp=(n,e,t)=>e in n?op(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var ae=(n,e,t)=>(sp(n,typeof e!="symbol"?e+"":e,t),t);import{S as ee,i as te,s as Q,A as Ue,k as G,r as j,b as w,B as qe,D as ze,H as We,t as S,d as E,f as $,u as D,l as I,I as de,J as ge,K as Pr,N as ap,O as es,Q as Re,p as z,w as ye,R as me,T as Zn,U as we,V as Qn,W as jf,m as L,n as A,o as C,X as Me,E as Lr,e as ot,Y as It,h as ts,Z as lp,_ as pr,$ as Uf,a0 as Be,a1 as He,a2 as Ai,a as ve,g as fe,c as ue,a3 as fp,a4 as X,a5 as et,a6 as up,a7 as Pe,a8 as cp,a9 as pp,q as Z,aa as rs,ab as qf,ac as Is,ad as On,ae as zf,af as hp,ag as gp,F as hn,ah as dp,ai as ns,aj as is,ak as mp,al as Wf,am as mt,an as Hf,ao as en,ap as Jf,aq as Yf,ar as ce,C as yp,as as At,at as tt,au as Xf,G as xt,av as vp,aw as Le,ax as hr,ay as _p,az as Ct,aA as gr,aB as tn,v as Ft,aC as oe,aD as Rn,aE as Hr,aF as Yt,L as dr,aG as xn,aH as Bn,P as os,aI as gn,aJ as ei,aK as Ns,aL as Vf,aM as bp,aN as wp,aO as $p,aP as Ci,aQ as bt,M as Sp,aR as kp,j as Ep,x as Mp,y as Pp}from"./FileManager.svelte_svelte_type_style_lang-d748b3d9.js";function Lp(n){let e,t;const r=n[1].default,i=Ue(r,n,n[0],null);return{c(){e=G("div"),i&&i.c(),j(e,"class","govuk-button-group")},m(o,s){w(o,e,s),i&&i.m(e,null),t=!0},p(o,[s]){i&&i.p&&(!t||s&1)&&qe(i,r,o,o[0],t?We(r,o[0],s,null):ze(o[0]),null)},i(o){t||(S(i,o),t=!0)},o(o){E(i,o),t=!1},d(o){o&&$(e),i&&i.d(o)}}}function Ap(n,e,t){let{$$slots:r={},$$scope:i}=e;return n.$$set=o=>{"$$scope"in o&&t(0,i=o.$$scope)},[i,r]}class Ut extends ee{constructor(e){super(),te(this,e,Ap,Lp,Q,{})}}function Cp(n){let e,t,r;const i=n[3].default,o=Ue(i,n,n[2],null);return{c(){e=G("fieldset"),t=G("div"),o&&o.c(),j(t,"class",n[0]),j(t,"data-module","govuk-checkboxes"),j(e,"class","govuk-fieldset")},m(s,a){w(s,e,a),D(e,t),o&&o.m(t,null),r=!0},p(s,[a]){o&&o.p&&(!r||a&4)&&qe(o,i,s,s[2],r?We(i,s[2],a,null):ze(s[2]),null)},i(s){r||(S(o,s),r=!0)},o(s){E(o,s),r=!1},d(s){s&&$(e),o&&o.d(s)}}}function Fp(n,e,t){let{$$slots:r={},$$scope:i}=e,{small:o=!1}=e,s=o?"govuk-checkboxes--small":"govuk-checkboxes";return n.$$set=a=>{"small"in a&&t(1,o=a.small),"$$scope"in a&&t(2,i=a.$$scope)},[s,o,i,r]}class Op extends ee{constructor(e){super(),te(this,e,Fp,Cp,Q,{small:1})}}const Rp=n=>({}),Ts=n=>({});function Bp(n){let e,t,r,i,o,s,a,l,f;const c=n[5].default,u=Ue(c,n,n[4],null),h=n[5].right,p=Ue(h,n,n[4],Ts);return{c(){e=G("div"),t=G("input"),r=I(),i=G("label"),u&&u.c(),o=I(),s=G("span"),p&&p.c(),j(t,"type","checkbox"),j(t,"class","govuk-checkboxes__input"),j(t,"id",n[3]),j(i,"class","govuk-label govuk-checkboxes__label"),j(i,"for",n[3]),j(i,"title",n[1]),de(s,"float","right"),j(e,"class","govuk-checkboxes__item"),j(e,"style",n[2])},m(g,d){w(g,e,d),D(e,t),t.checked=n[0],D(e,r),D(e,i),u&&u.m(i,null),D(e,o),D(e,s),p&&p.m(s,null),a=!0,l||(f=[ge(t,"change",n[7]),ge(t,"change",n[6])],l=!0)},p(g,[d]){d&1&&(t.checked=g[0]),u&&u.p&&(!a||d&16)&&qe(u,c,g,g[4],a?We(c,g[4],d,null):ze(g[4]),null),(!a||d&2)&&j(i,"title",g[1]),p&&p.p&&(!a||d&16)&&qe(p,h,g,g[4],a?We(h,g[4],d,Rp):ze(g[4]),Ts)},i(g){a||(S(u,g),S(p,g),a=!0)},o(g){E(u,g),E(p,g),a=!1},d(g){g&&$(e),u&&u.d(g),p&&p.d(g),l=!1,Pr(f)}}}function Ip(n,e,t){let{$$slots:r={},$$scope:i}=e;const o=ap(r);let{checked:s}=e,{hint:a=null}=e,f=o.right!==void 0?"float: none":"",c=es();function u(p){Re.call(this,n,p)}function h(){s=this.checked,t(0,s)}return n.$$set=p=>{"checked"in p&&t(0,s=p.checked),"hint"in p&&t(1,a=p.hint),"$$scope"in p&&t(4,i=p.$$scope)},[s,a,f,c,i,r,u,h]}class uo extends ee{constructor(e){super(),te(this,e,Ip,Bp,Q,{checked:0,hint:1})}}function Np(n){let e,t,r,i,o,s,a;const l=n[3].default,f=Ue(l,n,n[2],null);return{c(){e=G("details"),t=G("summary"),r=G("span"),i=z(n[0]),o=I(),s=G("div"),f&&f.c(),j(r,"class","govuk-details__summary-text"),j(t,"class","govuk-details__summary"),j(s,"class","govuk-details__text"),e.open=n[1],j(e,"class","govuk-details"),j(e,"data-module","govuk-details")},m(c,u){w(c,e,u),D(e,t),D(t,r),D(r,i),D(e,o),D(e,s),f&&f.m(s,null),a=!0},p(c,[u]){(!a||u&1)&&ye(i,c[0]),f&&f.p&&(!a||u&4)&&qe(f,l,c,c[2],a?We(l,c[2],u,null):ze(c[2]),null),(!a||u&2)&&(e.open=c[1])},i(c){a||(S(f,c),a=!0)},o(c){E(f,c),a=!1},d(c){c&&$(e),f&&f.d(c)}}}function Tp(n,e,t){let{$$slots:r={},$$scope:i}=e,{label:o}=e,{open:s=!1}=e;return n.$$set=a=>{"label"in a&&t(0,o=a.label),"open"in a&&t(1,s=a.open),"$$scope"in a&&t(2,i=a.$$scope)},[o,s,i,r]}class Gp extends ee{constructor(e){super(),te(this,e,Tp,Np,Q,{label:0,open:1})}}function Dp(n){let e,t,r,i;const o=n[2].default,s=Ue(o,n,n[1],null);let a=[{type:"button"},{class:"govuk-button"},{"data-module":"govuk-button"},n[0]],l={};for(let f=0;f<a.length;f+=1)l=me(l,a[f]);return{c(){e=G("button"),s&&s.c(),Zn(e,l)},m(f,c){w(f,e,c),s&&s.m(e,null),e.autofocus&&e.focus(),t=!0,r||(i=ge(e,"click",n[3]),r=!0)},p(f,[c]){s&&s.p&&(!t||c&2)&&qe(s,o,f,f[1],t?We(o,f[1],c,null):ze(f[1]),null),Zn(e,l=we(a,[{type:"button"},{class:"govuk-button"},{"data-module":"govuk-button"},c&1&&f[0]]))},i(f){t||(S(s,f),t=!0)},o(f){E(s,f),t=!1},d(f){f&&$(e),s&&s.d(f),r=!1,i()}}}function jp(n,e,t){let{$$slots:r={},$$scope:i}=e;function o(s){Re.call(this,n,s)}return n.$$set=s=>{t(0,e=me(me({},e),Qn(s))),"$$scope"in s&&t(1,i=s.$$scope)},e=Qn(e),[e,i,r,o]}class Ot extends ee{constructor(e){super(),te(this,e,jp,Dp,Q,{})}}function Up(n){let e,t,r;return{c(){e=G("input"),e.disabled=n[1],j(e,"class","govuk-file-upload"),j(e,"id",n[4]),j(e,"type","file")},m(i,o){w(i,e,o),n[6](e),t||(r=ge(e,"change",n[3]),t=!0)},p(i,o){o&2&&(e.disabled=i[1])},d(i){i&&$(e),n[6](null),t=!1,r()}}}function qp(n){let e,t;return e=new jf({props:{label:n[0],id:n[4],$$slots:{default:[Up]},$$scope:{ctx:n}}}),{c(){L(e.$$.fragment)},m(r,i){A(e,r,i),t=!0},p(r,[i]){const o={};i&1&&(o.label=r[0]),i&134&&(o.$$scope={dirty:i,ctx:r}),e.$set(o)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){E(e.$$.fragment,r),t=!1},d(r){C(e,r)}}}function zp(n,e,t){let{label:r}=e,{onLoad:i}=e,{disabled:o=!1}=e,s;async function a(c){let u=s.files[0].name,h=await s.files[0].text();i(u,h)}let l=es();function f(c){Me[c?"unshift":"push"](()=>{s=c,t(2,s)})}return n.$$set=c=>{"label"in c&&t(0,r=c.label),"onLoad"in c&&t(5,i=c.onLoad),"disabled"in c&&t(1,o=c.disabled)},[r,o,s,a,l,i,f]}class Kf extends ee{constructor(e){super(),te(this,e,zp,qp,Q,{label:0,onLoad:5,disabled:1})}}function Gs(n,e,t){const r=n.slice();return r[10]=e[t][0],r[11]=e[t][1],r}function Ds(n){let e,t,r,i,o=!1,s,a,l=n[11]+"",f,c,u,h,p,g;return h=lp(n[9][0]),{c(){e=G("div"),t=G("input"),s=I(),a=G("label"),f=z(l),u=I(),j(t,"class","govuk-radios__input"),j(t,"id",r=n[5]+n[10]),j(t,"type","radio"),t.__value=i=n[10],pr(t,t.__value),j(a,"class","govuk-label govuk-radios__label"),j(a,"for",c=n[5]+n[10]),j(e,"class","govuk-radios__item"),h.p(t)},m(d,v){w(d,e,v),D(e,t),t.checked=t.__value===n[0],D(e,s),D(e,a),D(a,f),D(e,u),p||(g=[ge(t,"change",n[8]),ge(t,"change",n[7])],p=!0)},p(d,v){v&4&&r!==(r=d[5]+d[10])&&j(t,"id",r),v&4&&i!==(i=d[10])&&(t.__value=i,pr(t,t.__value),o=!0),(o||v&5)&&(t.checked=t.__value===d[0]),v&4&&l!==(l=d[11]+"")&&ye(f,l),v&4&&c!==(c=d[5]+d[10])&&j(a,"for",c)},d(d){d&&$(e),h.r(),p=!1,Pr(g)}}}function Wp(n){let e,t,r,i,o,s,a,l,f;s=new Lr({props:{errorMessage:n[4]}});let c=ot(n[2]),u=[];for(let h=0;h<c.length;h+=1)u[h]=Ds(Gs(n,c,h));return{c(){e=G("div"),t=G("fieldset"),r=G("legend"),i=z(n[1]),o=I(),L(s.$$.fragment),a=I(),l=G("div");for(let h=0;h<u.length;h+=1)u[h].c();j(r,"class","govuk-fieldset__legend govuk-label--s"),j(l,"class","govuk-radios"),j(l,"data-module","govuk-radios"),It(l,"govuk-radios--inline",n[3]),It(l,"govuk-radios--small",n[3]),j(t,"class","govuk-fieldset"),j(e,"class","govuk-form-group")},m(h,p){w(h,e,p),D(e,t),D(t,r),D(r,i),D(t,o),A(s,t,null),D(t,a),D(t,l);for(let g=0;g<u.length;g+=1)u[g]&&u[g].m(l,null);f=!0},p(h,[p]){(!f||p&2)&&ye(i,h[1]);const g={};if(p&16&&(g.errorMessage=h[4]),s.$set(g),p&37){c=ot(h[2]);let d;for(d=0;d<c.length;d+=1){const v=Gs(h,c,d);u[d]?u[d].p(v,p):(u[d]=Ds(v),u[d].c(),u[d].m(l,null))}for(;d<u.length;d+=1)u[d].d(1);u.length=c.length}(!f||p&8)&&It(l,"govuk-radios--inline",h[3]),(!f||p&8)&&It(l,"govuk-radios--small",h[3])},i(h){f||(S(s.$$.fragment,h),f=!0)},o(h){E(s.$$.fragment,h),f=!1},d(h){h&&$(e),C(s),ts(u,h)}}}function Hp(n,e,t){let r,{legend:i}=e,{choices:o}=e,{inlineSmall:s=!1}=e,{required:a=!1}=e,{value:l}=e,f=es();const c=[[]];function u(p){Re.call(this,n,p)}function h(){l=this.__value,t(0,l)}return n.$$set=p=>{"legend"in p&&t(1,i=p.legend),"choices"in p&&t(2,o=p.choices),"inlineSmall"in p&&t(3,s=p.inlineSmall),"required"in p&&t(6,a=p.required),"value"in p&&t(0,l=p.value)},n.$$.update=()=>{n.$$.dirty&65&&t(4,r=a&&l==""?"Required":"")},[l,i,o,s,r,f,a,u,h,c]}class Zf extends ee{constructor(e){super(),te(this,e,Hp,Wp,Q,{legend:1,choices:2,inlineSmall:3,required:6,value:0})}}function Jp(n){let e,t,r,i;const o=n[2].default,s=Ue(o,n,n[1],null);let a=[{type:"button"},{class:"govuk-button govuk-button--warning"},{"data-module":"govuk-button"},n[0]],l={};for(let f=0;f<a.length;f+=1)l=me(l,a[f]);return{c(){e=G("button"),s&&s.c(),Zn(e,l)},m(f,c){w(f,e,c),s&&s.m(e,null),e.autofocus&&e.focus(),t=!0,r||(i=ge(e,"click",n[3]),r=!0)},p(f,[c]){s&&s.p&&(!t||c&2)&&qe(s,o,f,f[1],t?We(o,f[1],c,null):ze(f[1]),null),Zn(e,l=we(a,[{type:"button"},{class:"govuk-button govuk-button--warning"},{"data-module":"govuk-button"},c&1&&f[0]]))},i(f){t||(S(s,f),t=!0)},o(f){E(s,f),t=!1},d(f){f&&$(e),s&&s.d(f),r=!1,i()}}}function Yp(n,e,t){let{$$slots:r={},$$scope:i}=e;function o(s){Re.call(this,n,s)}return n.$$set=s=>{t(0,e=me(me({},e),Qn(s))),"$$scope"in s&&t(1,i=s.$$scope)},e=Qn(e),[e,i,r,o]}class Ar extends ee{constructor(e){super(),te(this,e,Yp,Jp,Q,{})}}function Xp(n){let e;const t=n[16].default,r=Ue(t,n,n[24],null);return{c(){r&&r.c()},m(i,o){r&&r.m(i,o),e=!0},p(i,o){r&&r.p&&(!e||o&16777216)&&qe(r,t,i,i[24],e?We(t,i[24],o,null):ze(i[24]),null)},i(i){e||(S(r,i),e=!0)},o(i){E(r,i),e=!1},d(i){r&&r.d(i)}}}function Vp(n){let e,t,r;function i(s){n[17](s)}let o={id:n[1],type:"circle",source:n[2],sourceLayer:n[3],beforeId:n[4],beforeLayerType:n[5],paint:n[6],layout:n[7],filter:n[8],applyToClusters:n[9],minzoom:n[10],maxzoom:n[11],hoverCursor:n[12],manageHoverState:n[13],eventsIfTopMost:n[14],interactive:n[15],$$slots:{default:[Xp]},$$scope:{ctx:n}};return n[0]!==void 0&&(o.hovered=n[0]),e=new Uf({props:o}),Me.push(()=>Be(e,"hovered",i)),e.$on("click",n[18]),e.$on("dblclick",n[19]),e.$on("contextmenu",n[20]),e.$on("mouseenter",n[21]),e.$on("mousemove",n[22]),e.$on("mouseleave",n[23]),{c(){L(e.$$.fragment)},m(s,a){A(e,s,a),r=!0},p(s,[a]){const l={};a&2&&(l.id=s[1]),a&4&&(l.source=s[2]),a&8&&(l.sourceLayer=s[3]),a&16&&(l.beforeId=s[4]),a&32&&(l.beforeLayerType=s[5]),a&64&&(l.paint=s[6]),a&128&&(l.layout=s[7]),a&256&&(l.filter=s[8]),a&512&&(l.applyToClusters=s[9]),a&1024&&(l.minzoom=s[10]),a&2048&&(l.maxzoom=s[11]),a&4096&&(l.hoverCursor=s[12]),a&8192&&(l.manageHoverState=s[13]),a&16384&&(l.eventsIfTopMost=s[14]),a&32768&&(l.interactive=s[15]),a&16777216&&(l.$$scope={dirty:a,ctx:s}),!t&&a&1&&(t=!0,l.hovered=s[0],He(()=>t=!1)),e.$set(l)},i(s){r||(S(e.$$.fragment,s),r=!0)},o(s){E(e.$$.fragment,s),r=!1},d(s){C(e,s)}}}function Kp(n,e,t){let{$$slots:r={},$$scope:i}=e,{id:o=Ai("circle")}=e,{source:s=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:l=void 0}=e,{beforeLayerType:f=void 0}=e,{paint:c}=e,{layout:u=void 0}=e,{filter:h=void 0}=e,{applyToClusters:p=void 0}=e,{minzoom:g=void 0}=e,{maxzoom:d=void 0}=e,{hoverCursor:v=void 0}=e,{manageHoverState:_=!1}=e,{hovered:y=null}=e,{eventsIfTopMost:m=!1}=e,{interactive:k=!0}=e;function b(M){y=M,t(0,y)}function P(M){Re.call(this,n,M)}function R(M){Re.call(this,n,M)}function N(M){Re.call(this,n,M)}function q(M){Re.call(this,n,M)}function T(M){Re.call(this,n,M)}function F(M){Re.call(this,n,M)}return n.$$set=M=>{"id"in M&&t(1,o=M.id),"source"in M&&t(2,s=M.source),"sourceLayer"in M&&t(3,a=M.sourceLayer),"beforeId"in M&&t(4,l=M.beforeId),"beforeLayerType"in M&&t(5,f=M.beforeLayerType),"paint"in M&&t(6,c=M.paint),"layout"in M&&t(7,u=M.layout),"filter"in M&&t(8,h=M.filter),"applyToClusters"in M&&t(9,p=M.applyToClusters),"minzoom"in M&&t(10,g=M.minzoom),"maxzoom"in M&&t(11,d=M.maxzoom),"hoverCursor"in M&&t(12,v=M.hoverCursor),"manageHoverState"in M&&t(13,_=M.manageHoverState),"hovered"in M&&t(0,y=M.hovered),"eventsIfTopMost"in M&&t(14,m=M.eventsIfTopMost),"interactive"in M&&t(15,k=M.interactive),"$$scope"in M&&t(24,i=M.$$scope)},[y,o,s,a,l,f,c,u,h,p,g,d,v,_,m,k,r,b,P,R,N,q,T,F,i]}class mr extends ee{constructor(e){super(),te(this,e,Kp,Vp,Q,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function js(n){let e=n[0],t,r,i=Us(n);return{c(){i.c(),t=ve()},m(o,s){i.m(o,s),w(o,t,s),r=!0},p(o,s){s&1&&Q(e,e=o[0])?(fe(),E(i,1,1,Z),ue(),i=Us(o),i.c(),S(i,1),i.m(t.parentNode,t)):i.p(o,s)},i(o){r||(S(i),r=!0)},o(o){E(i),r=!1},d(o){o&&$(t),i.d(o)}}}function Us(n){let e;const t=n[10].default,r=Ue(t,n,n[9],null);return{c(){r&&r.c()},m(i,o){r&&r.m(i,o),e=!0},p(i,o){r&&r.p&&(!e||o&512)&&qe(r,t,i,i[9],e?We(t,i[9],o,null):ze(i[9]),null)},i(i){e||(S(r,i),e=!0)},o(i){E(r,i),e=!1},d(i){r&&r.d(i)}}}function Zp(n){let e,t,r=n[0]&&js(n);return{c(){r&&r.c(),e=ve()},m(i,o){r&&r.m(i,o),w(i,e,o),t=!0},p(i,[o]){i[0]?r?(r.p(i,o),o&1&&S(r,1)):(r=js(i),r.c(),S(r,1),r.m(e.parentNode,e)):r&&(fe(),E(r,1,1,()=>{r=null}),ue())},i(i){t||(S(r),t=!0)},o(i){E(r),t=!1},d(i){i&&$(e),r&&r.d(i)}}}function Qp(n,e,t){let r,i,{$$slots:o={},$$scope:s}=e,{id:a=Ai("image")}=e,{url:l}=e,{coordinates:f}=e;const{map:c,self:u}=fp();X(n,c,g=>t(8,i=g)),X(n,u,g=>t(0,r=g));let h,p=!0;return et(()=>{r&&i&&(up(c,r,h),Pe(u,r=null,r),t(6,h=void 0))}),n.$$set=g=>{"id"in g&&t(3,a=g.id),"url"in g&&t(4,l=g.url),"coordinates"in g&&t(5,f=g.coordinates),"$$scope"in g&&t(9,s=g.$$scope)},n.$$.update=()=>{n.$$.dirty&313&&i&&r!==a&&(Pe(u,r=a,r),cp(i,r,pp({type:"image",url:l,coordinates:f}),g=>i&&g===r,()=>{r&&(t(6,h=i==null?void 0:i.getSource(r)),t(7,p=!0))})),n.$$.dirty&264&&(i==null||i.on("style.load",()=>{t(6,h=i==null?void 0:i.getSource(a))})),n.$$.dirty&224&&h&&(p?t(7,p=!1):h.setCoordinates(f))},[r,c,u,a,l,f,h,p,i,s,o]}class xp extends ee{constructor(e){super(),te(this,e,Qp,Zp,Q,{id:3,url:4,coordinates:5})}}function eh(n,e,t){let r;const i=rs();let{layer:o=void 0}=e;const{map:s}=qf();X(n,s,c=>t(2,r=c));function a(c){i(c.type,{...c,map:s})}const l=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","contextmenu","mouseover","mouseout"],f=["click","dblclick","contextmenu","mousemove","movestart","moveend","zoomstart","zoom","zoomend"];return et(()=>{if(r)if(o)for(const c of l)r.off(c,o,a);else for(const c of f)r.off(c,a)}),n.$$set=c=>{"layer"in c&&t(1,o=c.layer)},n.$$.update=()=>{if(n.$$.dirty&6&&r)if(o)for(const c of l)r.on(c,o,a);else for(const c of f)r.on(c,a)},[s,o,r]}class th extends ee{constructor(e){super(),te(this,e,eh,null,Q,{layer:1})}}const rh=n=>({marker:n&8}),qs=n=>({marker:n[3]});function nh(n){let e,t,r,i,o,s,a;const l=n[19].default,f=Ue(l,n,n[18],qs);return{c(){e=G("div"),f&&f.c(),j(e,"tabindex",t=n[1]?0:void 0),j(e,"role",r=n[1]?"button":void 0),de(e,"z-index",n[2])},m(c,u){w(c,e,u),f&&f.m(e,null),o=!0,s||(a=[Is(n[7].call(null,e)),Is(i=ih.call(null,e,n[0])),ge(e,"click",On(n[20])),ge(e,"dblclick",On(n[21])),ge(e,"contextmenu",On(n[22])),ge(e,"mouseenter",n[23]),ge(e,"mouseleave",n[24]),ge(e,"mousemove",n[25]),ge(e,"keydown",n[8])],s=!0)},p(c,[u]){f&&f.p&&(!o||u&262152)&&qe(f,l,c,c[18],o?We(l,c[18],u,rh):ze(c[18]),qs),(!o||u&2&&t!==(t=c[1]?0:void 0))&&j(e,"tabindex",t),(!o||u&2&&r!==(r=c[1]?"button":void 0))&&j(e,"role",r),i&&zf(i.update)&&u&1&&i.update.call(null,c[0]),u&4&&de(e,"z-index",c[2])},i(c){o||(S(f,c),o=!0)},o(c){E(f,c),o=!1},d(c){c&&$(e),f&&f.d(c),s=!1,Pr(a)}}}function ih(n,e){const t=n.className;function r(i){i?n.className=`${t} ${i}`:n.className=t}return r(e),{update:r}}function oh(n,e,t){let r,i,o,{$$slots:s={},$$scope:a}=e,{marker:l=void 0}=e,{lngLat:f}=e,{class:c=void 0}=e,{interactive:u=!0}=e,{asButton:h=!1}=e,{draggable:p=!1}=e,{feature:g=null}=e,{offset:d=void 0}=e,{zIndex:v=void 0}=e,{rotation:_=0}=e,{opacity:y=1}=e;const m=rs(),{map:k,layerEvent:b,self:P}=hp();X(n,k,H=>t(27,o=H)),X(n,b,H=>t(26,r=H)),X(n,P,H=>t(3,i=H));function R(H){Pe(P,i=new gp.Marker({element:H,rotation:_,draggable:p,offset:d,opacity:y.toString()}).setLngLat(f).addTo(o),i),t(11,l=i);const B=()=>T("dragstart"),x=()=>{N(),T("drag")},le=()=>{N(),T("dragend")};return p&&(i.on("dragstart",B),i.on("drag",x),i.on("dragend",le)),{destroy(){p&&(i==null||i.off("dragstart",B),i==null||i.off("drag",x),i==null||i.off("dragend",le)),t(11,l=void 0),i==null||i.remove()}}}function N(){let H=i==null?void 0:i.getLngLat();H&&(Array.isArray(f)?t(10,f=[H.lng,H.lat]):f&&"lon"in f?t(10,f={lon:H.lng,lat:H.lat}):t(10,f=H))}function q(H){H.key===" "&&(H.preventDefault(),H.stopPropagation(),T("click"))}function T(H){if(!u)return;let B=i==null?void 0:i.getLngLat();if(!B)return;const x=[B.lng,B.lat];let le={map:o,marker:i,lngLat:x,features:[{type:"Feature",properties:(g==null?void 0:g.properties)??{},geometry:{type:"Point",coordinates:x}}]};Pe(b,r={...le,layerType:"marker",type:H},r),m(H,le)}const F=()=>T("click"),M=()=>T("dblclick"),O=()=>T("contextmenu"),U=H=>{T("mouseenter")},ne=()=>{T("mouseleave")},V=()=>T("mousemove");return n.$$set=H=>{"marker"in H&&t(11,l=H.marker),"lngLat"in H&&t(10,f=H.lngLat),"class"in H&&t(0,c=H.class),"interactive"in H&&t(12,u=H.interactive),"asButton"in H&&t(1,h=H.asButton),"draggable"in H&&t(13,p=H.draggable),"feature"in H&&t(14,g=H.feature),"offset"in H&&t(15,d=H.offset),"zIndex"in H&&t(2,v=H.zIndex),"rotation"in H&&t(16,_=H.rotation),"opacity"in H&&t(17,y=H.opacity),"$$scope"in H&&t(18,a=H.$$scope)},n.$$.update=()=>{n.$$.dirty&1032&&(i==null||i.setLngLat(f)),n.$$.dirty&32776&&(i==null||i.setOffset(d??[0,0])),n.$$.dirty&65544&&(i==null||i.setRotation(_)),n.$$.dirty&131080&&(i==null||i.setOpacity(y.toString()))},[c,h,v,i,k,b,P,R,q,T,f,l,u,p,g,d,_,y,a,s,F,M,O,U,ne,V]}class co extends ee{constructor(e){super(),te(this,e,oh,nh,Q,{marker:11,lngLat:10,class:0,interactive:12,asButton:1,draggable:13,feature:14,offset:15,zIndex:2,rotation:16,opacity:17})}}class Ti{constructor(){this._partials=new Float64Array(32),this._n=0}add(e){const t=this._partials;let r=0;for(let i=0;i<this._n&&i<32;i++){const o=t[i],s=e+o,a=Math.abs(e)<Math.abs(o)?e-(s-o):o-(s-e);a&&(t[r++]=a),e=s}return t[r]=e,this._n=r+1,this}valueOf(){const e=this._partials;let t=this._n,r,i,o,s=0;if(t>0){for(s=e[--t];t>0&&(r=s,i=e[--t],s=r+i,o=i-(s-r),!o););t>0&&(o<0&&e[t-1]<0||o>0&&e[t-1]>0)&&(i=o*2,r=s+i,i==r-s&&(s=r))}return s}}var sh=1e-6,zs=1e-12,ss=Math.PI,Ws=ss/2,Hs=180/ss,wt=ss/180,Qf=Math.atan2,$t=Math.cos,po=Math.hypot,St=Math.sin,ah=Math.sqrt;function xf(n){return n>1?Ws:n<-1?-Ws:Math.asin(n)}function lh(){}function ti(n,e){n&&Ys.hasOwnProperty(n.type)&&Ys[n.type](n,e)}var Js={Feature:function(n,e){ti(n.geometry,e)},FeatureCollection:function(n,e){for(var t=n.features,r=-1,i=t.length;++r<i;)ti(t[r].geometry,e)}},Ys={Sphere:function(n,e){e.sphere()},Point:function(n,e){n=n.coordinates,e.point(n[0],n[1],n[2])},MultiPoint:function(n,e){for(var t=n.coordinates,r=-1,i=t.length;++r<i;)n=t[r],e.point(n[0],n[1],n[2])},LineString:function(n,e){ho(n.coordinates,e,0)},MultiLineString:function(n,e){for(var t=n.coordinates,r=-1,i=t.length;++r<i;)ho(t[r],e,0)},Polygon:function(n,e){Xs(n.coordinates,e)},MultiPolygon:function(n,e){for(var t=n.coordinates,r=-1,i=t.length;++r<i;)Xs(t[r],e)},GeometryCollection:function(n,e){for(var t=n.geometries,r=-1,i=t.length;++r<i;)ti(t[r],e)}};function ho(n,e,t){var r=-1,i=n.length-t,o;for(e.lineStart();++r<i;)o=n[r],e.point(o[0],o[1],o[2]);e.lineEnd()}function Xs(n,e){var t=-1,r=n.length;for(e.polygonStart();++t<r;)ho(n[t],e,1);e.polygonEnd()}function fh(n,e){n&&Js.hasOwnProperty(n.type)?Js[n.type](n,e):ti(n,e)}var Dr,ri,ni,ii,oi,si,ai,li,go,mo,yo,eu,tu,Ge,De,je,ft={sphere:lh,point:as,lineStart:Vs,lineEnd:Ks,polygonStart:function(){ft.lineStart=ph,ft.lineEnd=hh},polygonEnd:function(){ft.lineStart=Vs,ft.lineEnd=Ks}};function as(n,e){n*=wt,e*=wt;var t=$t(e);dn(t*$t(n),t*St(n),St(e))}function dn(n,e,t){++Dr,ni+=(n-ni)/Dr,ii+=(e-ii)/Dr,oi+=(t-oi)/Dr}function Vs(){ft.point=uh}function uh(n,e){n*=wt,e*=wt;var t=$t(e);Ge=t*$t(n),De=t*St(n),je=St(e),ft.point=ch,dn(Ge,De,je)}function ch(n,e){n*=wt,e*=wt;var t=$t(e),r=t*$t(n),i=t*St(n),o=St(e),s=Qf(ah((s=De*o-je*i)*s+(s=je*r-Ge*o)*s+(s=Ge*i-De*r)*s),Ge*r+De*i+je*o);ri+=s,si+=s*(Ge+(Ge=r)),ai+=s*(De+(De=i)),li+=s*(je+(je=o)),dn(Ge,De,je)}function Ks(){ft.point=as}function ph(){ft.point=gh}function hh(){ru(eu,tu),ft.point=as}function gh(n,e){eu=n,tu=e,n*=wt,e*=wt,ft.point=ru;var t=$t(e);Ge=t*$t(n),De=t*St(n),je=St(e),dn(Ge,De,je)}function ru(n,e){n*=wt,e*=wt;var t=$t(e),r=t*$t(n),i=t*St(n),o=St(e),s=De*o-je*i,a=je*r-Ge*o,l=Ge*i-De*r,f=po(s,a,l),c=xf(f),u=f&&-c/f;go.add(u*s),mo.add(u*a),yo.add(u*l),ri+=c,si+=c*(Ge+(Ge=r)),ai+=c*(De+(De=i)),li+=c*(je+(je=o)),dn(Ge,De,je)}function dh(n){Dr=ri=ni=ii=oi=si=ai=li=0,go=new Ti,mo=new Ti,yo=new Ti,fh(n,ft);var e=+go,t=+mo,r=+yo,i=po(e,t,r);return i<zs&&(e=si,t=ai,r=li,ri<sh&&(e=ni,t=ii,r=oi),i=po(e,t,r),i<zs)?[NaN,NaN]:[Qf(t,e)*Hs,xf(r/i)*Hs]}const{Map:mh}=Wf;function Zs(n,e,t){const r=n.slice();r[40]=e[t];const i=r[1](r[40]);r[41]=i;const o=typeof r[7]=="function"?r[7](r[40]):r[7];return r[42]=o,r}const yh=n=>({feature:n[0]&1024,position:n[0]&1026}),Qs=n=>({feature:n[40],position:n[41]});function xs(n){let e=[],t=new mh,r,i,o=ot(n[10]);const s=a=>a[40].id;for(let a=0;a<o.length;a+=1){let l=Zs(n,o,a),f=s(l);t.set(f,e[a]=ea(f,l))}return{c(){for(let a=0;a<e.length;a+=1)e[a].c();r=ve()},m(a,l){for(let f=0;f<e.length;f+=1)e[f]&&e[f].m(a,l);w(a,r,l),i=!0},p(a,l){l[0]&264095|l[1]&4&&(o=ot(a[10]),fe(),e=ns(e,l,s,1,a,o,t,r.parentNode,is,ea,r,Zs),ue())},i(a){if(!i){for(let l=0;l<o.length;l+=1)S(e[l]);i=!0}},o(a){for(let l=0;l<e.length;l+=1)E(e[l]);i=!1},d(a){a&&$(r);for(let l=0;l<e.length;l+=1)e[l].d(a)}}}function vh(n){let e,t;const r=n[24].default,i=Ue(r,n,n[33],Qs);return{c(){i&&i.c(),e=I()},m(o,s){i&&i.m(o,s),w(o,e,s),t=!0},p(o,s){i&&i.p&&(!t||s[0]&1026|s[1]&4)&&qe(i,r,o,o[33],t?We(r,o[33],s,yh):ze(o[33]),Qs)},i(o){t||(S(i,o),t=!0)},o(o){E(i,o),t=!1},d(o){o&&$(e),i&&i.d(o)}}}function ea(n,e){let t,r,i;function o(){return e[25](e[40])}function s(){return e[26](e[40])}function a(...p){return e[27](e[40],...p)}function l(...p){return e[28](e[40],...p)}function f(...p){return e[29](e[40],...p)}function c(...p){return e[30](e[40],...p)}function u(...p){return e[31](e[40],...p)}function h(...p){return e[32](e[40],...p)}return r=new co({props:{asButton:e[3],interactive:e[2],draggable:e[4],class:e[8],zIndex:e[42],lngLat:e[41],$$slots:{default:[vh]},$$scope:{ctx:e}}}),r.$on("mouseenter",o),r.$on("mouseleave",s),r.$on("dragstart",a),r.$on("drag",l),r.$on("dragend",f),r.$on("click",c),r.$on("dblclick",u),r.$on("contextmenu",h),{key:n,first:null,c(){t=ve(),L(r.$$.fragment),this.first=t},m(p,g){w(p,t,g),A(r,p,g),i=!0},p(p,g){e=p;const d={};g[0]&8&&(d.asButton=e[3]),g[0]&4&&(d.interactive=e[2]),g[0]&16&&(d.draggable=e[4]),g[0]&256&&(d.class=e[8]),g[0]&1152&&(d.zIndex=e[42]),g[0]&1026&&(d.lngLat=e[41]),g[0]&1026|g[1]&4&&(d.$$scope={dirty:g,ctx:e}),r.$set(d)},i(p){i||(S(r.$$.fragment,p),i=!0)},o(p){E(r.$$.fragment,p),i=!1},d(p){p&&$(t),C(r,p)}}}function _h(n){let e,t,r,i;e=new hn({props:{minzoom:n[5],maxzoom:n[6],paint:{"fill-opacity":0},beforeLayerType:"symbol"}});let o=n[11]>=n[13]&&n[11]<=n[12]&&xs(n);return{c(){L(e.$$.fragment),t=I(),o&&o.c(),r=ve()},m(s,a){A(e,s,a),w(s,t,a),o&&o.m(s,a),w(s,r,a),i=!0},p(s,a){const l={};a[0]&32&&(l.minzoom=s[5]),a[0]&64&&(l.maxzoom=s[6]),e.$set(l),s[11]>=s[13]&&s[11]<=s[12]?o?(o.p(s,a),a[0]&14336&&S(o,1)):(o=xs(s),o.c(),S(o,1),o.m(r.parentNode,r)):o&&(fe(),E(o,1,1,()=>{o=null}),ue())},i(s){i||(S(e.$$.fragment,s),S(o),i=!0)},o(s){E(e.$$.fragment,s),E(o),i=!1},d(s){s&&($(t),$(r)),C(e,s),o&&o.d(s)}}}function bh(n,e,t){let r,i,o,s,a,l,f,{$$slots:c={},$$scope:u}=e;const{map:h,source:p,minzoom:g,maxzoom:d}=qf();X(n,h,J=>t(21,s=J)),X(n,p,J=>t(9,a=J)),X(n,g,J=>t(23,f=J)),X(n,d,J=>t(22,l=J));const v=rs();let{applyToClusters:_=void 0}=e,{filter:y=void 0}=e,{markerLngLat:m=dh}=e,{interactive:k=!0}=e,{asButton:b=!1}=e,{draggable:P=!1}=e,{minzoom:R=void 0}=e,{maxzoom:N=void 0}=e,{hovered:q=null}=e,{zIndex:T=void 0}=e,{class:F=void 0}=e,M=!1;function O(){s&&(M=!0,s.on("zoom",B),s.on("move",V),s.on("moveend",V),s.loaded()?s.once("load",V):V())}function U(J){J.sourceId===a&&J.isSourceLoaded&&(M?V():O())}et(()=>{s&&(s.off("zoom",B),s.off("move",V),s.off("moveend",V),s.off("sourcedata",U))});let ne=[];function V(){var nr;if(!s||!a)return;let J=s.querySourceFeatures(a,{filter:o}),ke=new Map;for(let Ce of J)Ce.id||((nr=Ce.properties)!=null&&nr.cluster_id?Ce.id="autocluster_"+Ce.properties.cluster_id:Ce.id=Ai("autofeat")),ke.set(Ce.id,Ce);t(10,ne=[...ke.values()].sort((Ce,ip)=>Ce.id.toString().localeCompare(ip.id.toString())))}let H=(s==null?void 0:s.getZoom())??0;function B(J){t(11,H=s.getZoom()),V()}const x=J=>{t(0,q=J)},le=J=>{(q==null?void 0:q.id)===J.id&&t(0,q=null)},Ne=(J,ke)=>v("dragstart",{...ke.detail,source:a,feature:J}),Se=(J,ke)=>v("drag",{...ke.detail,source:a,feature:J}),_e=(J,ke)=>v("dragend",{...ke.detail,source:a,feature:J}),W=(J,ke)=>v("click",{...ke.detail,source:a,feature:J}),K=(J,ke)=>v("dblclick",{...ke.detail,source:a,feature:J}),rt=(J,ke)=>v("contextmenu",{...ke.detail,source:a,feature:J});return n.$$set=J=>{"applyToClusters"in J&&t(19,_=J.applyToClusters),"filter"in J&&t(20,y=J.filter),"markerLngLat"in J&&t(1,m=J.markerLngLat),"interactive"in J&&t(2,k=J.interactive),"asButton"in J&&t(3,b=J.asButton),"draggable"in J&&t(4,P=J.draggable),"minzoom"in J&&t(5,R=J.minzoom),"maxzoom"in J&&t(6,N=J.maxzoom),"hovered"in J&&t(0,q=J.hovered),"zIndex"in J&&t(7,T=J.zIndex),"class"in J&&t(8,F=J.class),"$$scope"in J&&t(33,u=J.$$scope)},n.$$.update=()=>{if(n.$$.dirty[0]&8388640&&t(13,r=R??f),n.$$.dirty[0]&4194368&&t(12,i=N??l),n.$$.dirty[0]&1572864&&(o=dp("all",mp(_),y)),n.$$.dirty[0]&2097664&&s&&a){let J=s.getSource(a);J!=null&&J.loaded()?O():s.on("sourcedata",U)}},[q,m,k,b,P,R,N,T,F,a,ne,H,i,r,h,p,g,d,v,_,y,s,l,f,c,x,le,Ne,Se,_e,W,K,rt,u]}class wh extends ee{constructor(e){super(),te(this,e,bh,_h,Q,{applyToClusters:19,filter:20,markerLngLat:1,interactive:2,asButton:3,draggable:4,minzoom:5,maxzoom:6,hovered:0,zIndex:7,class:8},null,[-1,-1])}}function $h(n){let e;const t=n[8].default,r=Ue(t,n,n[15],null);return{c(){r&&r.c()},m(i,o){r&&r.m(i,o),e=!0},p(i,o){r&&r.p&&(!e||o&32768)&&qe(r,t,i,i[15],e?We(t,i[15],o,null):ze(i[15]),null)},i(i){e||(S(r,i),e=!0)},o(i){E(r,i),e=!1},d(i){r&&r.d(i)}}}function Sh(n){let e,t;return e=new Uf({props:{id:n[0],type:"raster",source:n[1],beforeId:n[2],beforeLayerType:n[3],paint:n[4],layout:n[5],minzoom:n[6],maxzoom:n[7],$$slots:{default:[$h]},$$scope:{ctx:n}}}),e.$on("click",n[9]),e.$on("dblclick",n[10]),e.$on("contextmenu",n[11]),e.$on("mouseenter",n[12]),e.$on("mousemove",n[13]),e.$on("mouseleave",n[14]),{c(){L(e.$$.fragment)},m(r,i){A(e,r,i),t=!0},p(r,[i]){const o={};i&1&&(o.id=r[0]),i&2&&(o.source=r[1]),i&4&&(o.beforeId=r[2]),i&8&&(o.beforeLayerType=r[3]),i&16&&(o.paint=r[4]),i&32&&(o.layout=r[5]),i&64&&(o.minzoom=r[6]),i&128&&(o.maxzoom=r[7]),i&32768&&(o.$$scope={dirty:i,ctx:r}),e.$set(o)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){E(e.$$.fragment,r),t=!1},d(r){C(e,r)}}}function kh(n,e,t){let{$$slots:r={},$$scope:i}=e,{id:o=Ai("raster-layer")}=e,{source:s=void 0}=e,{beforeId:a=void 0}=e,{beforeLayerType:l=void 0}=e,{paint:f}=e,{layout:c=void 0}=e,{minzoom:u=void 0}=e,{maxzoom:h=void 0}=e;function p(m){Re.call(this,n,m)}function g(m){Re.call(this,n,m)}function d(m){Re.call(this,n,m)}function v(m){Re.call(this,n,m)}function _(m){Re.call(this,n,m)}function y(m){Re.call(this,n,m)}return n.$$set=m=>{"id"in m&&t(0,o=m.id),"source"in m&&t(1,s=m.source),"beforeId"in m&&t(2,a=m.beforeId),"beforeLayerType"in m&&t(3,l=m.beforeLayerType),"paint"in m&&t(4,f=m.paint),"layout"in m&&t(5,c=m.layout),"minzoom"in m&&t(6,u=m.minzoom),"maxzoom"in m&&t(7,h=m.maxzoom),"$$scope"in m&&t(15,i=m.$$scope)},[o,s,a,l,f,c,u,h,r,p,g,d,v,_,y,i]}class Eh extends ee{constructor(e){super(),te(this,e,kh,Sh,Q,{id:0,source:1,beforeId:2,beforeLayerType:3,paint:4,layout:5,minzoom:6,maxzoom:7})}}let xe=mt(null);class Mh{constructor(e){ae(this,"map");ae(this,"active");ae(this,"eventListenersSuccess");ae(this,"eventListenersFailure");ae(this,"cursor");ae(this,"onMouseMove",e=>{this.active&&(this.cursor={type:"Feature",properties:{},geometry:{type:"Point",coordinates:Hf(e.lngLat.toArray())}})});ae(this,"onClick",()=>{if(this.active&&this.cursor){for(let e of this.eventListenersSuccess)e(this.cursor);this.stop()}});ae(this,"onKeyDown",e=>{this.active&&e.key=="Escape"&&(e.stopPropagation(),this.cancel())});this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersFailure=[],this.cursor=null,this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),document.addEventListener("keydown",this.onKeyDown)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),document.removeEventListener("keydown",this.onKeyDown)}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersFailure=[]}start(){this.map.getCanvas().style.cursor="crosshair",this.active=!0}stop(){this.map.getCanvas().style.cursor="inherit",this.cursor=null,this.active=!1}}var Je=63710088e-1,nu={centimeters:Je*100,centimetres:Je*100,degrees:Je/111325,feet:Je*3.28084,inches:Je*39.37,kilometers:Je/1e3,kilometres:Je/1e3,meters:Je,metres:Je,miles:Je/1609.344,millimeters:Je*1e3,millimetres:Je*1e3,nauticalmiles:Je/1852,radians:1,yards:Je*1.0936};function yr(n,e,t){t===void 0&&(t={});var r={type:"Feature"};return(t.id===0||t.id)&&(r.id=t.id),t.bbox&&(r.bbox=t.bbox),r.properties=e||{},r.geometry=n,r}function Jr(n,e,t){if(t===void 0&&(t={}),!n)throw new Error("coordinates is required");if(!Array.isArray(n))throw new Error("coordinates must be an Array");if(n.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!na(n[0])||!na(n[1]))throw new Error("coordinates must contain numbers");var r={type:"Point",coordinates:n};return yr(r,e,t)}function ta(n,e,t){if(t===void 0&&(t={}),n.length<2)throw new Error("coordinates must be an array of two or more positions");var r={type:"LineString",coordinates:n};return yr(r,e,t)}function ra(n,e){e===void 0&&(e={});var t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=n,t}function Ph(n,e){e===void 0&&(e="kilometers");var t=nu[e];if(!t)throw new Error(e+" units is invalid");return n*t}function Lh(n,e){e===void 0&&(e="kilometers");var t=nu[e];if(!t)throw new Error(e+" units is invalid");return n/t}function vo(n){var e=n%(2*Math.PI);return e*180/Math.PI}function ut(n){var e=n%360;return e*Math.PI/180}function na(n){return!isNaN(n)&&n!==null&&!Array.isArray(n)}function rn(n){if(!n)throw new Error("coord is required");if(!Array.isArray(n)){if(n.type==="Feature"&&n.geometry!==null&&n.geometry.type==="Point")return n.geometry.coordinates;if(n.type==="Point")return n.coordinates}if(Array.isArray(n)&&n.length>=2&&!Array.isArray(n[0])&&!Array.isArray(n[1]))return n;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function fi(n){if(Array.isArray(n))return n;if(n.type==="Feature"){if(n.geometry!==null)return n.geometry.coordinates}else if(n.coordinates)return n.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function iu(n,e,t){if(t===void 0&&(t={}),t.final===!0)return Ah(n,e);var r=rn(n),i=rn(e),o=ut(r[0]),s=ut(i[0]),a=ut(r[1]),l=ut(i[1]),f=Math.sin(s-o)*Math.cos(l),c=Math.cos(a)*Math.sin(l)-Math.sin(a)*Math.cos(l)*Math.cos(s-o);return vo(Math.atan2(f,c))}function Ah(n,e){var t=iu(e,n);return t=(t+180)%360,t}function Or(n,e,t){t===void 0&&(t={});var r=rn(n),i=rn(e),o=ut(i[1]-r[1]),s=ut(i[0]-r[0]),a=ut(r[1]),l=ut(i[1]),f=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(a)*Math.cos(l);return Ph(2*Math.atan2(Math.sqrt(f),Math.sqrt(1-f)),t.units)}function ia(n,e,t,r){r===void 0&&(r={});var i=rn(n),o=ut(i[0]),s=ut(i[1]),a=ut(t),l=Lh(e,r.units),f=Math.asin(Math.sin(s)*Math.cos(l)+Math.cos(s)*Math.sin(l)*Math.cos(a)),c=o+Math.atan2(Math.sin(a)*Math.sin(l)*Math.cos(s),Math.cos(l)-Math.sin(s)*Math.sin(f)),u=vo(c),h=vo(f);return Jr([u,h],r.properties)}function _o(n,e,t){t===void 0&&(t={});var r={type:"Feature"};return(t.id===0||t.id)&&(r.id=t.id),t.bbox&&(r.bbox=t.bbox),r.properties=e||{},r.geometry=n,r}function Ch(n,e,t){if(t===void 0&&(t={}),n.length<2)throw new Error("coordinates must be an array of two or more positions");var r={type:"LineString",coordinates:n};return _o(r,e,t)}function Fh(n,e){e===void 0&&(e={});var t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=n,t}function oa(n){if(Array.isArray(n))return n;if(n.type==="Feature"){if(n.geometry!==null)return n.geometry.coordinates}else if(n.coordinates)return n.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Oh(n,e){var t,r,i,o,s,a,l,f,c,u,h=0,p=n.type==="FeatureCollection",g=n.type==="Feature",d=p?n.features.length:1;for(t=0;t<d;t++){for(a=p?n.features[t].geometry:g?n.geometry:n,f=p?n.features[t].properties:g?n.properties:{},c=p?n.features[t].bbox:g?n.bbox:void 0,u=p?n.features[t].id:g?n.id:void 0,l=a?a.type==="GeometryCollection":!1,s=l?a.geometries.length:1,i=0;i<s;i++){if(o=l?a.geometries[i]:a,o===null){if(e(null,h,f,c,u)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(o,h,f,c,u)===!1)return!1;break}case"GeometryCollection":{for(r=0;r<o.geometries.length;r++)if(e(o.geometries[r],h,f,c,u)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}h++}}function Rh(n,e){Oh(n,function(t,r,i,o,s){var a=t===null?null:t.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return e(_o(t,i,{bbox:o,id:s}),r,0)===!1?!1:void 0}var l;switch(a){case"MultiPoint":l="Point";break;case"MultiLineString":l="LineString";break;case"MultiPolygon":l="Polygon";break}for(var f=0;f<t.coordinates.length;f++){var c=t.coordinates[f],u={type:l,coordinates:c};if(e(_o(u,i),r,f)===!1)return!1}})}function er(n){if(!n)throw new Error("geojson is required");var e=[];return Rh(n,function(t){Bh(t,e)}),Fh(e)}function Bh(n,e){var t=[],r=n.geometry;if(r!==null){switch(r.type){case"Polygon":t=oa(r);break;case"LineString":t=[oa(r)]}t.forEach(function(i){var o=Ih(i,n.properties);o.forEach(function(s){s.id=e.length,e.push(s)})})}}function Ih(n,e){var t=[];return n.reduce(function(r,i){var o=Ch([r,i],e);return o.bbox=Nh(r,i),t.push(o),i}),t}function Nh(n,e){var t=n[0],r=n[1],i=e[0],o=e[1],s=t<i?t:i,a=r<o?r:o,l=t>i?t:i,f=r>o?r:o;return[s,a,l,f]}function sa(n,e){if(n.type==="Feature")e(n,0);else if(n.type==="FeatureCollection")for(var t=0;t<n.features.length&&e(n.features[t],t)!==!1;t++);}function Th(n,e){var t,r,i,o,s,a,l,f,c,u,h=0,p=n.type==="FeatureCollection",g=n.type==="Feature",d=p?n.features.length:1;for(t=0;t<d;t++){for(a=p?n.features[t].geometry:g?n.geometry:n,f=p?n.features[t].properties:g?n.properties:{},c=p?n.features[t].bbox:g?n.bbox:void 0,u=p?n.features[t].id:g?n.id:void 0,l=a?a.type==="GeometryCollection":!1,s=l?a.geometries.length:1,i=0;i<s;i++){if(o=l?a.geometries[i]:a,o===null){if(e(null,h,f,c,u)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(o,h,f,c,u)===!1)return!1;break}case"GeometryCollection":{for(r=0;r<o.geometries.length;r++)if(e(o.geometries[r],h,f,c,u)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}h++}}function Gh(n,e){Th(n,function(t,r,i,o,s){var a=t===null?null:t.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return e(yr(t,i,{bbox:o,id:s}),r,0)===!1?!1:void 0}var l;switch(a){case"MultiPoint":l="Point";break;case"MultiLineString":l="LineString";break;case"MultiPolygon":l="Polygon";break}for(var f=0;f<t.coordinates.length;f++){var c=t.coordinates[f],u={type:l,coordinates:c};if(e(yr(u,i),r,f)===!1)return!1}})}var ls={exports:{}},ou={exports:{}};(function(n,e){(function(t,r){n.exports=r()})(en,function(){function t(y,m,k,b,P){(function R(N,q,T,F,M){for(;F>T;){if(F-T>600){var O=F-T+1,U=q-T+1,ne=Math.log(O),V=.5*Math.exp(2*ne/3),H=.5*Math.sqrt(ne*V*(O-V)/O)*(U-O/2<0?-1:1),B=Math.max(T,Math.floor(q-U*V/O+H)),x=Math.min(F,Math.floor(q+(O-U)*V/O+H));R(N,q,B,x,M)}var le=N[q],Ne=T,Se=F;for(r(N,T,q),M(N[F],le)>0&&r(N,T,F);Ne<Se;){for(r(N,Ne,Se),Ne++,Se--;M(N[Ne],le)<0;)Ne++;for(;M(N[Se],le)>0;)Se--}M(N[T],le)===0?r(N,T,Se):r(N,++Se,F),Se<=q&&(T=Se+1),q<=Se&&(F=Se-1)}})(y,m,k||0,b||y.length-1,P||i)}function r(y,m,k){var b=y[m];y[m]=y[k],y[k]=b}function i(y,m){return y<m?-1:y>m?1:0}var o=function(y){y===void 0&&(y=9),this._maxEntries=Math.max(4,y),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function s(y,m,k){if(!k)return m.indexOf(y);for(var b=0;b<m.length;b++)if(k(y,m[b]))return b;return-1}function a(y,m){l(y,0,y.children.length,m,y)}function l(y,m,k,b,P){P||(P=v(null)),P.minX=1/0,P.minY=1/0,P.maxX=-1/0,P.maxY=-1/0;for(var R=m;R<k;R++){var N=y.children[R];f(P,y.leaf?b(N):N)}return P}function f(y,m){return y.minX=Math.min(y.minX,m.minX),y.minY=Math.min(y.minY,m.minY),y.maxX=Math.max(y.maxX,m.maxX),y.maxY=Math.max(y.maxY,m.maxY),y}function c(y,m){return y.minX-m.minX}function u(y,m){return y.minY-m.minY}function h(y){return(y.maxX-y.minX)*(y.maxY-y.minY)}function p(y){return y.maxX-y.minX+(y.maxY-y.minY)}function g(y,m){return y.minX<=m.minX&&y.minY<=m.minY&&m.maxX<=y.maxX&&m.maxY<=y.maxY}function d(y,m){return m.minX<=y.maxX&&m.minY<=y.maxY&&m.maxX>=y.minX&&m.maxY>=y.minY}function v(y){return{children:y,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function _(y,m,k,b,P){for(var R=[m,k];R.length;)if(!((k=R.pop())-(m=R.pop())<=b)){var N=m+Math.ceil((k-m)/b/2)*b;t(y,N,m,k,P),R.push(m,N,N,k)}}return o.prototype.all=function(){return this._all(this.data,[])},o.prototype.search=function(y){var m=this.data,k=[];if(!d(y,m))return k;for(var b=this.toBBox,P=[];m;){for(var R=0;R<m.children.length;R++){var N=m.children[R],q=m.leaf?b(N):N;d(y,q)&&(m.leaf?k.push(N):g(y,q)?this._all(N,k):P.push(N))}m=P.pop()}return k},o.prototype.collides=function(y){var m=this.data;if(!d(y,m))return!1;for(var k=[];m;){for(var b=0;b<m.children.length;b++){var P=m.children[b],R=m.leaf?this.toBBox(P):P;if(d(y,R)){if(m.leaf||g(y,R))return!0;k.push(P)}}m=k.pop()}return!1},o.prototype.load=function(y){if(!y||!y.length)return this;if(y.length<this._minEntries){for(var m=0;m<y.length;m++)this.insert(y[m]);return this}var k=this._build(y.slice(),0,y.length-1,0);if(this.data.children.length)if(this.data.height===k.height)this._splitRoot(this.data,k);else{if(this.data.height<k.height){var b=this.data;this.data=k,k=b}this._insert(k,this.data.height-k.height-1,!0)}else this.data=k;return this},o.prototype.insert=function(y){return y&&this._insert(y,this.data.height-1),this},o.prototype.clear=function(){return this.data=v([]),this},o.prototype.remove=function(y,m){if(!y)return this;for(var k,b,P,R=this.data,N=this.toBBox(y),q=[],T=[];R||q.length;){if(R||(R=q.pop(),b=q[q.length-1],k=T.pop(),P=!0),R.leaf){var F=s(y,R.children,m);if(F!==-1)return R.children.splice(F,1),q.push(R),this._condense(q),this}P||R.leaf||!g(R,N)?b?(k++,R=b.children[k],P=!1):R=null:(q.push(R),T.push(k),k=0,b=R,R=R.children[0])}return this},o.prototype.toBBox=function(y){return y},o.prototype.compareMinX=function(y,m){return y.minX-m.minX},o.prototype.compareMinY=function(y,m){return y.minY-m.minY},o.prototype.toJSON=function(){return this.data},o.prototype.fromJSON=function(y){return this.data=y,this},o.prototype._all=function(y,m){for(var k=[];y;)y.leaf?m.push.apply(m,y.children):k.push.apply(k,y.children),y=k.pop();return m},o.prototype._build=function(y,m,k,b){var P,R=k-m+1,N=this._maxEntries;if(R<=N)return a(P=v(y.slice(m,k+1)),this.toBBox),P;b||(b=Math.ceil(Math.log(R)/Math.log(N)),N=Math.ceil(R/Math.pow(N,b-1))),(P=v([])).leaf=!1,P.height=b;var q=Math.ceil(R/N),T=q*Math.ceil(Math.sqrt(N));_(y,m,k,T,this.compareMinX);for(var F=m;F<=k;F+=T){var M=Math.min(F+T-1,k);_(y,F,M,q,this.compareMinY);for(var O=F;O<=M;O+=q){var U=Math.min(O+q-1,M);P.children.push(this._build(y,O,U,b-1))}}return a(P,this.toBBox),P},o.prototype._chooseSubtree=function(y,m,k,b){for(;b.push(m),!m.leaf&&b.length-1!==k;){for(var P=1/0,R=1/0,N=void 0,q=0;q<m.children.length;q++){var T=m.children[q],F=h(T),M=(O=y,U=T,(Math.max(U.maxX,O.maxX)-Math.min(U.minX,O.minX))*(Math.max(U.maxY,O.maxY)-Math.min(U.minY,O.minY))-F);M<R?(R=M,P=F<P?F:P,N=T):M===R&&F<P&&(P=F,N=T)}m=N||m.children[0]}var O,U;return m},o.prototype._insert=function(y,m,k){var b=k?y:this.toBBox(y),P=[],R=this._chooseSubtree(b,this.data,m,P);for(R.children.push(y),f(R,b);m>=0&&P[m].children.length>this._maxEntries;)this._split(P,m),m--;this._adjustParentBBoxes(b,P,m)},o.prototype._split=function(y,m){var k=y[m],b=k.children.length,P=this._minEntries;this._chooseSplitAxis(k,P,b);var R=this._chooseSplitIndex(k,P,b),N=v(k.children.splice(R,k.children.length-R));N.height=k.height,N.leaf=k.leaf,a(k,this.toBBox),a(N,this.toBBox),m?y[m-1].children.push(N):this._splitRoot(k,N)},o.prototype._splitRoot=function(y,m){this.data=v([y,m]),this.data.height=y.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},o.prototype._chooseSplitIndex=function(y,m,k){for(var b,P,R,N,q,T,F,M=1/0,O=1/0,U=m;U<=k-m;U++){var ne=l(y,0,U,this.toBBox),V=l(y,U,k,this.toBBox),H=(P=ne,R=V,N=void 0,q=void 0,T=void 0,F=void 0,N=Math.max(P.minX,R.minX),q=Math.max(P.minY,R.minY),T=Math.min(P.maxX,R.maxX),F=Math.min(P.maxY,R.maxY),Math.max(0,T-N)*Math.max(0,F-q)),B=h(ne)+h(V);H<M?(M=H,b=U,O=B<O?B:O):H===M&&B<O&&(O=B,b=U)}return b||k-m},o.prototype._chooseSplitAxis=function(y,m,k){var b=y.leaf?this.compareMinX:c,P=y.leaf?this.compareMinY:u;this._allDistMargin(y,m,k,b)<this._allDistMargin(y,m,k,P)&&y.children.sort(b)},o.prototype._allDistMargin=function(y,m,k,b){y.children.sort(b);for(var P=this.toBBox,R=l(y,0,m,P),N=l(y,k-m,k,P),q=p(R)+p(N),T=m;T<k-m;T++){var F=y.children[T];f(R,y.leaf?P(F):F),q+=p(R)}for(var M=k-m-1;M>=m;M--){var O=y.children[M];f(N,y.leaf?P(O):O),q+=p(N)}return q},o.prototype._adjustParentBBoxes=function(y,m,k){for(var b=k;b>=0;b--)f(m[b],y)},o.prototype._condense=function(y){for(var m=y.length-1,k=void 0;m>=0;m--)y[m].children.length===0?m>0?(k=y[m-1].children).splice(k.indexOf(y[m]),1):this.clear():a(y[m],this.toBBox)},o})})(ou);var Dh=ou.exports,fs={};(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.earthRadius=63710088e-1,n.factors={centimeters:n.earthRadius*100,centimetres:n.earthRadius*100,degrees:n.earthRadius/111325,feet:n.earthRadius*3.28084,inches:n.earthRadius*39.37,kilometers:n.earthRadius/1e3,kilometres:n.earthRadius/1e3,meters:n.earthRadius,metres:n.earthRadius,miles:n.earthRadius/1609.344,millimeters:n.earthRadius*1e3,millimetres:n.earthRadius*1e3,nauticalmiles:n.earthRadius/1852,radians:1,yards:n.earthRadius*1.0936},n.unitsFactors={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/n.earthRadius,yards:1.0936133},n.areaFactors={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function e(F,M,O){O===void 0&&(O={});var U={type:"Feature"};return(O.id===0||O.id)&&(U.id=O.id),O.bbox&&(U.bbox=O.bbox),U.properties=M||{},U.geometry=F,U}n.feature=e;function t(F,M,O){switch(F){case"Point":return r(M).geometry;case"LineString":return a(M).geometry;case"Polygon":return o(M).geometry;case"MultiPoint":return u(M).geometry;case"MultiLineString":return c(M).geometry;case"MultiPolygon":return h(M).geometry;default:throw new Error(F+" is invalid")}}n.geometry=t;function r(F,M,O){if(O===void 0&&(O={}),!F)throw new Error("coordinates is required");if(!Array.isArray(F))throw new Error("coordinates must be an Array");if(F.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!R(F[0])||!R(F[1]))throw new Error("coordinates must contain numbers");var U={type:"Point",coordinates:F};return e(U,M,O)}n.point=r;function i(F,M,O){return O===void 0&&(O={}),f(F.map(function(U){return r(U,M)}),O)}n.points=i;function o(F,M,O){O===void 0&&(O={});for(var U=0,ne=F;U<ne.length;U++){var V=ne[U];if(V.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var H=0;H<V[V.length-1].length;H++)if(V[V.length-1][H]!==V[0][H])throw new Error("First and last Position are not equivalent.")}var B={type:"Polygon",coordinates:F};return e(B,M,O)}n.polygon=o;function s(F,M,O){return O===void 0&&(O={}),f(F.map(function(U){return o(U,M)}),O)}n.polygons=s;function a(F,M,O){if(O===void 0&&(O={}),F.length<2)throw new Error("coordinates must be an array of two or more positions");var U={type:"LineString",coordinates:F};return e(U,M,O)}n.lineString=a;function l(F,M,O){return O===void 0&&(O={}),f(F.map(function(U){return a(U,M)}),O)}n.lineStrings=l;function f(F,M){M===void 0&&(M={});var O={type:"FeatureCollection"};return M.id&&(O.id=M.id),M.bbox&&(O.bbox=M.bbox),O.features=F,O}n.featureCollection=f;function c(F,M,O){O===void 0&&(O={});var U={type:"MultiLineString",coordinates:F};return e(U,M,O)}n.multiLineString=c;function u(F,M,O){O===void 0&&(O={});var U={type:"MultiPoint",coordinates:F};return e(U,M,O)}n.multiPoint=u;function h(F,M,O){O===void 0&&(O={});var U={type:"MultiPolygon",coordinates:F};return e(U,M,O)}n.multiPolygon=h;function p(F,M,O){O===void 0&&(O={});var U={type:"GeometryCollection",geometries:F};return e(U,M,O)}n.geometryCollection=p;function g(F,M){if(M===void 0&&(M=0),M&&!(M>=0))throw new Error("precision must be a positive number");var O=Math.pow(10,M||0);return Math.round(F*O)/O}n.round=g;function d(F,M){M===void 0&&(M="kilometers");var O=n.factors[M];if(!O)throw new Error(M+" units is invalid");return F*O}n.radiansToLength=d;function v(F,M){M===void 0&&(M="kilometers");var O=n.factors[M];if(!O)throw new Error(M+" units is invalid");return F/O}n.lengthToRadians=v;function _(F,M){return m(v(F,M))}n.lengthToDegrees=_;function y(F){var M=F%360;return M<0&&(M+=360),M}n.bearingToAzimuth=y;function m(F){var M=F%(2*Math.PI);return M*180/Math.PI}n.radiansToDegrees=m;function k(F){var M=F%360;return M*Math.PI/180}n.degreesToRadians=k;function b(F,M,O){if(M===void 0&&(M="kilometers"),O===void 0&&(O="kilometers"),!(F>=0))throw new Error("length must be a positive number");return d(v(F,M),O)}n.convertLength=b;function P(F,M,O){if(M===void 0&&(M="meters"),O===void 0&&(O="kilometers"),!(F>=0))throw new Error("area must be a positive number");var U=n.areaFactors[M];if(!U)throw new Error("invalid original units");var ne=n.areaFactors[O];if(!ne)throw new Error("invalid final units");return F/U*ne}n.convertArea=P;function R(F){return!isNaN(F)&&F!==null&&!Array.isArray(F)}n.isNumber=R;function N(F){return!!F&&F.constructor===Object}n.isObject=N;function q(F){if(!F)throw new Error("bbox is required");if(!Array.isArray(F))throw new Error("bbox must be an Array");if(F.length!==4&&F.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");F.forEach(function(M){if(!R(M))throw new Error("bbox must only contain numbers")})}n.validateBBox=q;function T(F){if(!F)throw new Error("id is required");if(["string","number"].indexOf(typeof F)===-1)throw new Error("id must be a number or a string")}n.validateId=T})(fs);var $e={};Object.defineProperty($e,"__esModule",{value:!0});var Oe=fs;function mn(n,e,t){if(n!==null)for(var r,i,o,s,a,l,f,c=0,u=0,h,p=n.type,g=p==="FeatureCollection",d=p==="Feature",v=g?n.features.length:1,_=0;_<v;_++){f=g?n.features[_].geometry:d?n.geometry:n,h=f?f.type==="GeometryCollection":!1,a=h?f.geometries.length:1;for(var y=0;y<a;y++){var m=0,k=0;if(s=h?f.geometries[y]:f,s!==null){l=s.coordinates;var b=s.type;switch(c=t&&(b==="Polygon"||b==="MultiPolygon")?1:0,b){case null:break;case"Point":if(e(l,u,_,m,k)===!1)return!1;u++,m++;break;case"LineString":case"MultiPoint":for(r=0;r<l.length;r++){if(e(l[r],u,_,m,k)===!1)return!1;u++,b==="MultiPoint"&&m++}b==="LineString"&&m++;break;case"Polygon":case"MultiLineString":for(r=0;r<l.length;r++){for(i=0;i<l[r].length-c;i++){if(e(l[r][i],u,_,m,k)===!1)return!1;u++}b==="MultiLineString"&&m++,b==="Polygon"&&k++}b==="Polygon"&&m++;break;case"MultiPolygon":for(r=0;r<l.length;r++){for(k=0,i=0;i<l[r].length;i++){for(o=0;o<l[r][i].length-c;o++){if(e(l[r][i][o],u,_,m,k)===!1)return!1;u++}k++}m++}break;case"GeometryCollection":for(r=0;r<s.geometries.length;r++)if(mn(s.geometries[r],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function jh(n,e,t,r){var i=t;return mn(n,function(o,s,a,l,f){s===0&&t===void 0?i=o:i=e(i,o,s,a,l,f)},r),i}function su(n,e){var t;switch(n.type){case"FeatureCollection":for(t=0;t<n.features.length&&e(n.features[t].properties,t)!==!1;t++);break;case"Feature":e(n.properties,0);break}}function Uh(n,e,t){var r=t;return su(n,function(i,o){o===0&&t===void 0?r=i:r=e(r,i,o)}),r}function au(n,e){if(n.type==="Feature")e(n,0);else if(n.type==="FeatureCollection")for(var t=0;t<n.features.length&&e(n.features[t],t)!==!1;t++);}function qh(n,e,t){var r=t;return au(n,function(i,o){o===0&&t===void 0?r=i:r=e(r,i,o)}),r}function zh(n){var e=[];return mn(n,function(t){e.push(t)}),e}function us(n,e){var t,r,i,o,s,a,l,f,c,u,h=0,p=n.type==="FeatureCollection",g=n.type==="Feature",d=p?n.features.length:1;for(t=0;t<d;t++){for(a=p?n.features[t].geometry:g?n.geometry:n,f=p?n.features[t].properties:g?n.properties:{},c=p?n.features[t].bbox:g?n.bbox:void 0,u=p?n.features[t].id:g?n.id:void 0,l=a?a.type==="GeometryCollection":!1,s=l?a.geometries.length:1,i=0;i<s;i++){if(o=l?a.geometries[i]:a,o===null){if(e(null,h,f,c,u)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(o,h,f,c,u)===!1)return!1;break}case"GeometryCollection":{for(r=0;r<o.geometries.length;r++)if(e(o.geometries[r],h,f,c,u)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}h++}}function Wh(n,e,t){var r=t;return us(n,function(i,o,s,a,l){o===0&&t===void 0?r=i:r=e(r,i,o,s,a,l)}),r}function Fi(n,e){us(n,function(t,r,i,o,s){var a=t===null?null:t.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return e(Oe.feature(t,i,{bbox:o,id:s}),r,0)===!1?!1:void 0}var l;switch(a){case"MultiPoint":l="Point";break;case"MultiLineString":l="LineString";break;case"MultiPolygon":l="Polygon";break}for(var f=0;f<t.coordinates.length;f++){var c=t.coordinates[f],u={type:l,coordinates:c};if(e(Oe.feature(u,i),r,f)===!1)return!1}})}function Hh(n,e,t){var r=t;return Fi(n,function(i,o,s){o===0&&s===0&&t===void 0?r=i:r=e(r,i,o,s)}),r}function lu(n,e){Fi(n,function(t,r,i){var o=0;if(t.geometry){var s=t.geometry.type;if(!(s==="Point"||s==="MultiPoint")){var a,l=0,f=0,c=0;if(mn(t,function(u,h,p,g,d){if(a===void 0||r>l||g>f||d>c){a=u,l=r,f=g,c=d,o=0;return}var v=Oe.lineString([a,u],t.properties);if(e(v,r,i,d,o)===!1)return!1;o++,a=u})===!1)return!1}}})}function Jh(n,e,t){var r=t,i=!1;return lu(n,function(o,s,a,l,f){i===!1&&t===void 0?r=o:r=e(r,o,s,a,l,f),i=!0}),r}function fu(n,e){if(!n)throw new Error("geojson is required");Fi(n,function(t,r,i){if(t.geometry!==null){var o=t.geometry.type,s=t.geometry.coordinates;switch(o){case"LineString":if(e(t,r,i,0,0)===!1)return!1;break;case"Polygon":for(var a=0;a<s.length;a++)if(e(Oe.lineString(s[a],t.properties),r,i,a)===!1)return!1;break}}})}function Yh(n,e,t){var r=t;return fu(n,function(i,o,s,a){o===0&&t===void 0?r=i:r=e(r,i,o,s,a)}),r}function Xh(n,e){if(e=e||{},!Oe.isObject(e))throw new Error("options is invalid");var t=e.featureIndex||0,r=e.multiFeatureIndex||0,i=e.geometryIndex||0,o=e.segmentIndex||0,s=e.properties,a;switch(n.type){case"FeatureCollection":t<0&&(t=n.features.length+t),s=s||n.features[t].properties,a=n.features[t].geometry;break;case"Feature":s=s||n.properties,a=n.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":a=n;break;default:throw new Error("geojson is invalid")}if(a===null)return null;var l=a.coordinates;switch(a.type){case"Point":case"MultiPoint":return null;case"LineString":return o<0&&(o=l.length+o-1),Oe.lineString([l[o],l[o+1]],s,e);case"Polygon":return i<0&&(i=l.length+i),o<0&&(o=l[i].length+o-1),Oe.lineString([l[i][o],l[i][o+1]],s,e);case"MultiLineString":return r<0&&(r=l.length+r),o<0&&(o=l[r].length+o-1),Oe.lineString([l[r][o],l[r][o+1]],s,e);case"MultiPolygon":return r<0&&(r=l.length+r),i<0&&(i=l[r].length+i),o<0&&(o=l[r][i].length-o-1),Oe.lineString([l[r][i][o],l[r][i][o+1]],s,e)}throw new Error("geojson is invalid")}function Vh(n,e){if(e=e||{},!Oe.isObject(e))throw new Error("options is invalid");var t=e.featureIndex||0,r=e.multiFeatureIndex||0,i=e.geometryIndex||0,o=e.coordIndex||0,s=e.properties,a;switch(n.type){case"FeatureCollection":t<0&&(t=n.features.length+t),s=s||n.features[t].properties,a=n.features[t].geometry;break;case"Feature":s=s||n.properties,a=n.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":a=n;break;default:throw new Error("geojson is invalid")}if(a===null)return null;var l=a.coordinates;switch(a.type){case"Point":return Oe.point(l,s,e);case"MultiPoint":return r<0&&(r=l.length+r),Oe.point(l[r],s,e);case"LineString":return o<0&&(o=l.length+o),Oe.point(l[o],s,e);case"Polygon":return i<0&&(i=l.length+i),o<0&&(o=l[i].length+o),Oe.point(l[i][o],s,e);case"MultiLineString":return r<0&&(r=l.length+r),o<0&&(o=l[r].length+o),Oe.point(l[r][o],s,e);case"MultiPolygon":return r<0&&(r=l.length+r),i<0&&(i=l[r].length+i),o<0&&(o=l[r][i].length-o),Oe.point(l[r][i][o],s,e)}throw new Error("geojson is invalid")}$e.coordAll=zh;$e.coordEach=mn;$e.coordReduce=jh;$e.featureEach=au;$e.featureReduce=qh;$e.findPoint=Vh;$e.findSegment=Xh;$e.flattenEach=Fi;$e.flattenReduce=Hh;$e.geomEach=us;$e.geomReduce=Wh;$e.lineEach=fu;$e.lineReduce=Yh;$e.propEach=su;$e.propReduce=Uh;$e.segmentEach=lu;$e.segmentReduce=Jh;function uu(n,e,t){if(n!==null)for(var r,i,o,s,a,l,f,c=0,u=0,h,p=n.type,g=p==="FeatureCollection",d=p==="Feature",v=g?n.features.length:1,_=0;_<v;_++){f=g?n.features[_].geometry:d?n.geometry:n,h=f?f.type==="GeometryCollection":!1,a=h?f.geometries.length:1;for(var y=0;y<a;y++){var m=0,k=0;if(s=h?f.geometries[y]:f,s!==null){l=s.coordinates;var b=s.type;switch(c=t&&(b==="Polygon"||b==="MultiPolygon")?1:0,b){case null:break;case"Point":if(e(l,u,_,m,k)===!1)return!1;u++,m++;break;case"LineString":case"MultiPoint":for(r=0;r<l.length;r++){if(e(l[r],u,_,m,k)===!1)return!1;u++,b==="MultiPoint"&&m++}b==="LineString"&&m++;break;case"Polygon":case"MultiLineString":for(r=0;r<l.length;r++){for(i=0;i<l[r].length-c;i++){if(e(l[r][i],u,_,m,k)===!1)return!1;u++}b==="MultiLineString"&&m++,b==="Polygon"&&k++}b==="Polygon"&&m++;break;case"MultiPolygon":for(r=0;r<l.length;r++){for(k=0,i=0;i<l[r].length;i++){for(o=0;o<l[r][i].length-c;o++){if(e(l[r][i][o],u,_,m,k)===!1)return!1;u++}k++}m++}break;case"GeometryCollection":for(r=0;r<s.geometries.length;r++)if(uu(s.geometries[r],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function nn(n){var e=[1/0,1/0,-1/0,-1/0];return uu(n,function(t){e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])}),e}nn.default=nn;const Kh=Object.freeze(Object.defineProperty({__proto__:null,default:nn},Symbol.toStringTag,{value:"Module"})),Zh=Jf(Kh);var yt=Dh,cu=fs,pu=$e,ir=Zh.default,Qh=pu.featureEach;pu.coordEach;cu.polygon;var aa=cu.featureCollection;function hu(n){var e=new yt(n);return e.insert=function(t){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:ir(t),yt.prototype.insert.call(this,t)},e.load=function(t){var r=[];return Array.isArray(t)?t.forEach(function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:ir(i),r.push(i)}):Qh(t,function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:ir(i),r.push(i)}),yt.prototype.load.call(this,r)},e.remove=function(t,r){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:ir(t),yt.prototype.remove.call(this,t,r)},e.clear=function(){return yt.prototype.clear.call(this)},e.search=function(t){var r=yt.prototype.search.call(this,this.toBBox(t));return aa(r)},e.collides=function(t){return yt.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=yt.prototype.all.call(this);return aa(t)},e.toJSON=function(){return yt.prototype.toJSON.call(this)},e.fromJSON=function(t){return yt.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var r;if(t.bbox)r=t.bbox;else if(Array.isArray(t)&&t.length===4)r=t;else if(Array.isArray(t)&&t.length===6)r=[t[0],t[1],t[3],t[4]];else if(t.type==="Feature")r=ir(t);else if(t.type==="FeatureCollection")r=ir(t);else throw new Error("invalid geojson");return{minX:r[0],minY:r[1],maxX:r[2],maxY:r[3]}},e}ls.exports=hu;ls.exports.default=hu;var xh=ls.exports;const yn=Yf(xh);function eg(n,e){var t={},r=[];if(n.type==="LineString"&&(n=yr(n)),e.type==="LineString"&&(e=yr(e)),n.type==="Feature"&&e.type==="Feature"&&n.geometry!==null&&e.geometry!==null&&n.geometry.type==="LineString"&&e.geometry.type==="LineString"&&n.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var i=la(n,e);return i&&r.push(i),ra(r)}var o=yn();return o.load(er(e)),sa(er(n),function(s){sa(o.search(s),function(a){var l=la(s,a);if(l){var f=fi(l).join(",");t[f]||(t[f]=!0,r.push(l))}})}),ra(r)}function la(n,e){var t=fi(n),r=fi(e);if(t.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(r.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var i=t[0][0],o=t[0][1],s=t[1][0],a=t[1][1],l=r[0][0],f=r[0][1],c=r[1][0],u=r[1][1],h=(u-f)*(s-i)-(c-l)*(a-o),p=(c-l)*(o-f)-(u-f)*(i-l),g=(s-i)*(o-f)-(a-o)*(i-l);if(h===0)return null;var d=p/h,v=g/h;if(d>=0&&d<=1&&v>=0&&v<=1){var _=i+d*(s-i),y=o+d*(a-o);return Jr([_,y])}return null}function tg(n,e,t){t===void 0&&(t={});var r=Jr([1/0,1/0],{dist:1/0}),i=0;return Gh(n,function(o){for(var s=fi(o),a=0;a<s.length-1;a++){var l=Jr(s[a]);l.properties.dist=Or(e,l,t);var f=Jr(s[a+1]);f.properties.dist=Or(e,f,t);var c=Or(l,f,t),u=Math.max(l.properties.dist,f.properties.dist),h=iu(l,f),p=ia(e,u,h+90,t),g=ia(e,u,h-90,t),d=eg(ta([p.geometry.coordinates,g.geometry.coordinates]),ta([l.geometry.coordinates,f.geometry.coordinates])),v=null;d.features.length>0&&(v=d.features[0],v.properties.dist=Or(e,v,t),v.properties.location=i+Or(l,v,t)),l.properties.dist<r.properties.dist&&(r=l,r.properties.index=a,r.properties.location=i),f.properties.dist<r.properties.dist&&(r=f,r.properties.index=a+1,r.properties.location=i+c),v&&v.properties.dist<r.properties.dist&&(r=v,r.properties.index=a),i+=c}}),r}function gu(){return{type:"FeatureCollection",features:[]}}function Gi(n){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:du(n)}}}function du(n){return[Math.round(n[0]*1e7)/1e7,Math.round(n[1]*1e7)/1e7]}const mu=mt(gu()),yu=mt(0),rg=100;class ng{constructor(e){ae(this,"map");ae(this,"active");ae(this,"eventListenersSuccess");ae(this,"eventListenersUpdated");ae(this,"eventListenersFailure");ae(this,"points");ae(this,"cursor");ae(this,"hover");ae(this,"dragFrom");ae(this,"previousStates");ae(this,"onMouseMove",e=>{if(this.active&&!this.dragFrom)this.recalculateHovering(e);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let t=this.dragFrom[0]-e.lngLat.lng,r=this.dragFrom[1]-e.lngLat.lat;for(let i of this.points)i[0]-=t,i[1]-=r}else this.points[this.hover]=e.lngLat.toArray();this.dragFrom=e.lngLat.toArray(),this.redraw()}});ae(this,"onClick",e=>{if(this.beforeUpdate(),this.active&&this.cursor){let t=[];if(fa(this.points).forEach((r,i)=>{t.push([i+1,tg(r,this.cursor).properties.dist])}),t.sort((r,i)=>r[1]-i[1]),t.length>0){let r=t[0][0];this.points.splice(r,0,this.cursor.geometry.coordinates),this.hover=r}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw(),this.pointsUpdated()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.pointsUpdated(),this.recalculateHovering(e))});ae(this,"onDoubleClick",e=>{this.active&&(e.preventDefault(),this.cursor=Gi(e.lngLat.toArray()),this.onClick(e),this.finish())});ae(this,"onMouseDown",e=>{this.active&&!this.dragFrom&&this.hover!=null&&(e.preventDefault(),this.cursor=null,this.dragFrom=e.lngLat.toArray(),this.beforeUpdate(),this.redraw())});ae(this,"onMouseUp",()=>{this.active&&this.dragFrom&&(this.dragFrom=null,this.redraw(),this.pointsUpdated())});ae(this,"onKeypress",e=>{this.active&&(e.key=="Enter"?(e.stopPropagation(),this.finish()):e.key=="z"&&e.ctrlKey&&this.undo())});ae(this,"onKeyDown",e=>{this.active&&e.key=="Escape"&&(e.stopPropagation(),this.cancel())});this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.previousStates=[],this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("mousedown",this.onMouseDown),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keypress",this.onKeypress),document.addEventListener("keydown",this.onKeyDown)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("mousedown",this.onMouseDown),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keypress",this.onKeypress),document.removeEventListener("keydown",this.onKeyDown)}finish(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersSuccess)t(e);else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}startNew(){this.active=!0,this.map.doubleClickZoom.disable()}editExisting(e){this.active=!0,this.map.doubleClickZoom.disable(),this.points=JSON.parse(JSON.stringify(e.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.map.doubleClickZoom.enable(),this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.previousStates=[],this.redraw(),this.map.getCanvas().style.cursor="inherit"}undo(){this.dragFrom!=null||this.previousStates.length==0||(this.points=this.previousStates.pop(),this.hover=null,this.redraw())}redraw(){let e=gu();this.points.forEach((i,o)=>{let s=Gi(i);s.properties.hover=this.hover==o,s.properties.idx=o,e.features.push(s)}),e.features=e.features.concat(fa(this.points));let t=this.polygonFeature();t&&(t.properties.hover=this.hover=="polygon",e.features.push(t)),mu.set(e);let r="crosshair";this.hover!=null&&(r=this.dragFrom?"grabbing":"pointer"),this.map.getCanvas().style.cursor=r,yu.set(this.previousStates.length)}pointsUpdated(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersUpdated)t(e)}recalculateHovering(e){this.cursor=null,this.hover=null;for(let t of this.map.queryRenderedFeatures(e.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(t.geometry.type=="Polygon"){this.hover="polygon";break}else if(t.geometry.type=="Point"&&Object.hasOwn(t.properties,"idx")){this.hover=t.properties.idx;break}this.hover==null&&(this.cursor=Gi(e.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let e=this.points.map(du),t=[JSON.parse(JSON.stringify(e))];return t[0].push(JSON.parse(JSON.stringify(t[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:t},properties:{}}}beforeUpdate(){this.previousStates.push(JSON.parse(JSON.stringify(this.points))),this.previousStates.length>rg&&this.previousStates.shift()}}function fa(n){let e=[];for(let t=0;t<n.length-1;t++)e.push({type:"Feature",geometry:{type:"LineString",coordinates:[n[t],n[t+1]]},properties:{}});return n.length>=3&&e.push({type:"Feature",geometry:{type:"LineString",coordinates:[n[n.length-1],n[0]]},properties:{}}),e}let Y;const vu=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&vu.decode();let jr=null;function Yr(){return(jr===null||jr.byteLength===0)&&(jr=new Uint8Array(Y.memory.buffer)),jr}function vt(n,e){return n=n>>>0,vu.decode(Yr().subarray(n,n+e))}const Pt=new Array(128).fill(void 0);Pt.push(void 0,null,!0,!1);let Xr=Pt.length;function be(n){Xr===Pt.length&&Pt.push(Pt.length+1);const e=Xr;return Xr=Pt[e],Pt[e]=n,e}function re(n){return Pt[n]}function ig(n){n<132||(Pt[n]=Xr,Xr=n)}function In(n){const e=re(n);return ig(n),e}function Di(n){return n==null}let Ur=null;function og(){return(Ur===null||Ur.byteLength===0)&&(Ur=new Float64Array(Y.memory.buffer)),Ur}let qr=null;function he(){return(qr===null||qr.byteLength===0)&&(qr=new Int32Array(Y.memory.buffer)),qr}let Nt=0;const Nn=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},sg=typeof Nn.encodeInto=="function"?function(n,e){return Nn.encodeInto(n,e)}:function(n,e){const t=Nn.encode(n);return e.set(t),{read:n.length,written:t.length}};function $n(n,e,t){if(t===void 0){const a=Nn.encode(n),l=e(a.length,1)>>>0;return Yr().subarray(l,l+a.length).set(a),Nt=a.length,l}let r=n.length,i=e(r,1)>>>0;const o=Yr();let s=0;for(;s<r;s++){const a=n.charCodeAt(s);if(a>127)break;o[i+s]=a}if(s!==r){s!==0&&(n=n.slice(s)),i=t(i,r,r=s+n.length*3,1)>>>0;const a=Yr().subarray(i+s,i+r),l=sg(n,a);s+=l.written}return Nt=s,i}function bo(n){const e=typeof n;if(e=="number"||e=="boolean"||n==null)return`${n}`;if(e=="string")return`"${n}"`;if(e=="symbol"){const i=n.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=n.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(n)){const i=n.length;let o="[";i>0&&(o+=bo(n[0]));for(let s=1;s<i;s++)o+=", "+bo(n[s]);return o+="]",o}const t=/\[object ([^\]]+)\]/.exec(toString.call(n));let r;if(t.length>1)r=t[1];else return toString.call(n);if(r=="Object")try{return"Object("+JSON.stringify(n)+")"}catch{return"Object"}return n instanceof Error?`${n.name}: ${n.message}
${n.stack}`:r}function ag(n,e){const t=e(n.length*1,1)>>>0;return Yr().set(n,t/1),Nt=n.length,t}function ji(n,e){try{return n.apply(this,e)}catch(t){Y.__wbindgen_exn_store(be(t))}}class ui{static __wrap(e){e=e>>>0;const t=Object.create(ui.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();Y.__wbg_jsroutesnapper_free(e)}constructor(e){try{const o=Y.__wbindgen_add_to_stack_pointer(-16),s=ag(e,Y.__wbindgen_malloc),a=Nt;Y.jsroutesnapper_new(o,s,a);var t=he()[o/4+0],r=he()[o/4+1],i=he()[o/4+2];if(i)throw In(r);return ui.__wrap(t)}finally{Y.__wbindgen_add_to_stack_pointer(16)}}setRouteConfig(e){Y.jsroutesnapper_setRouteConfig(this.__wbg_ptr,be(e))}setAreaMode(){Y.jsroutesnapper_setAreaMode(this.__wbg_ptr)}getConfig(){let e,t;try{const o=Y.__wbindgen_add_to_stack_pointer(-16);Y.jsroutesnapper_getConfig(o,this.__wbg_ptr);var r=he()[o/4+0],i=he()[o/4+1];return e=r,t=i,vt(r,i)}finally{Y.__wbindgen_add_to_stack_pointer(16),Y.__wbindgen_free(e,t,1)}}toFinalFeature(){try{const r=Y.__wbindgen_add_to_stack_pointer(-16);Y.jsroutesnapper_toFinalFeature(r,this.__wbg_ptr);var e=he()[r/4+0],t=he()[r/4+1];let i;return e!==0&&(i=vt(e,t).slice(),Y.__wbindgen_free(e,t*1)),i}finally{Y.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){let e,t;try{const o=Y.__wbindgen_add_to_stack_pointer(-16);Y.jsroutesnapper_renderGeojson(o,this.__wbg_ptr);var r=he()[o/4+0],i=he()[o/4+1];return e=r,t=i,vt(r,i)}finally{Y.__wbindgen_add_to_stack_pointer(16),Y.__wbindgen_free(e,t,1)}}toggleSnapMode(){Y.jsroutesnapper_toggleSnapMode(this.__wbg_ptr)}onMouseMove(e,t,r){return Y.jsroutesnapper_onMouseMove(this.__wbg_ptr,e,t,r)!==0}onClick(){Y.jsroutesnapper_onClick(this.__wbg_ptr)}onDragStart(){return Y.jsroutesnapper_onDragStart(this.__wbg_ptr)!==0}onMouseUp(){return Y.jsroutesnapper_onMouseUp(this.__wbg_ptr)!==0}clearState(){Y.jsroutesnapper_clearState(this.__wbg_ptr)}editExisting(e){try{const i=Y.__wbindgen_add_to_stack_pointer(-16);Y.jsroutesnapper_editExisting(i,this.__wbg_ptr,be(e));var t=he()[i/4+0],r=he()[i/4+1];if(r)throw In(t)}finally{Y.__wbindgen_add_to_stack_pointer(16)}}debugRenderGraph(){let e,t;try{const o=Y.__wbindgen_add_to_stack_pointer(-16);Y.jsroutesnapper_debugRenderGraph(o,this.__wbg_ptr);var r=he()[o/4+0],i=he()[o/4+1];return e=r,t=i,vt(r,i)}finally{Y.__wbindgen_add_to_stack_pointer(16),Y.__wbindgen_free(e,t,1)}}debugSnappableNodes(){let e,t;try{const o=Y.__wbindgen_add_to_stack_pointer(-16);Y.jsroutesnapper_debugSnappableNodes(o,this.__wbg_ptr);var r=he()[o/4+0],i=he()[o/4+1];return e=r,t=i,vt(r,i)}finally{Y.__wbindgen_add_to_stack_pointer(16),Y.__wbindgen_free(e,t,1)}}routeNameForWaypoints(e){let t,r;try{const c=Y.__wbindgen_add_to_stack_pointer(-16);Y.jsroutesnapper_routeNameForWaypoints(c,this.__wbg_ptr,be(e));var i=he()[c/4+0],o=he()[c/4+1],s=he()[c/4+2],a=he()[c/4+3],l=i,f=o;if(a)throw l=0,f=0,In(s);return t=l,r=f,vt(l,f)}finally{Y.__wbindgen_add_to_stack_pointer(16),Y.__wbindgen_free(t,r,1)}}addSnappedWaypoint(e,t){Y.jsroutesnapper_addSnappedWaypoint(this.__wbg_ptr,e,t)}undo(){Y.jsroutesnapper_undo(this.__wbg_ptr)}}async function lg(n,e){if(typeof Response=="function"&&n instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(n,e)}catch(r){if(n.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",r);else throw r}const t=await n.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(n,e);return t instanceof WebAssembly.Instance?{instance:t,module:n}:t}}function fg(){const n={};return n.wbg={},n.wbg.__wbindgen_string_new=function(e,t){const r=vt(e,t);return be(r)},n.wbg.__wbindgen_object_drop_ref=function(e){In(e)},n.wbg.__wbindgen_error_new=function(e,t){const r=new Error(vt(e,t));return be(r)},n.wbg.__wbindgen_is_object=function(e){const t=re(e);return typeof t=="object"&&t!==null},n.wbg.__wbindgen_is_undefined=function(e){return re(e)===void 0},n.wbg.__wbindgen_in=function(e,t){return re(e)in re(t)},n.wbg.__wbindgen_number_get=function(e,t){const r=re(t),i=typeof r=="number"?r:void 0;og()[e/8+1]=Di(i)?0:i,he()[e/4+0]=!Di(i)},n.wbg.__wbindgen_boolean_get=function(e){const t=re(e);return typeof t=="boolean"?t?1:0:2},n.wbg.__wbindgen_jsval_loose_eq=function(e,t){return re(e)==re(t)},n.wbg.__wbindgen_string_get=function(e,t){const r=re(t),i=typeof r=="string"?r:void 0;var o=Di(i)?0:$n(i,Y.__wbindgen_malloc,Y.__wbindgen_realloc),s=Nt;he()[e/4+1]=s,he()[e/4+0]=o},n.wbg.__wbg_getwithrefkey_d1f0d12f1f1b63ea=function(e,t){const r=re(e)[re(t)];return be(r)},n.wbg.__wbindgen_object_clone_ref=function(e){const t=re(e);return be(t)},n.wbg.__wbg_String_4370c5505c674d30=function(e,t){const r=String(re(t)),i=$n(r,Y.__wbindgen_malloc,Y.__wbindgen_realloc),o=Nt;he()[e/4+1]=o,he()[e/4+0]=i},n.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return be(e)},n.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const r=re(t).stack,i=$n(r,Y.__wbindgen_malloc,Y.__wbindgen_realloc),o=Nt;he()[e/4+1]=o,he()[e/4+0]=i},n.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let r,i;try{r=e,i=t,console.error(vt(e,t))}finally{Y.__wbindgen_free(r,i,1)}},n.wbg.__wbg_debug_9a6b3243fbbebb61=function(e){console.debug(re(e))},n.wbg.__wbg_error_788ae33f81d3b84b=function(e){console.error(re(e))},n.wbg.__wbg_info_2e30e8204b29d91d=function(e){console.info(re(e))},n.wbg.__wbg_log_1d3ae0273d8f4f8a=function(e){console.log(re(e))},n.wbg.__wbg_warn_d60e832f9882c1b2=function(e){console.warn(re(e))},n.wbg.__wbg_get_44be0491f933a435=function(e,t){const r=re(e)[t>>>0];return be(r)},n.wbg.__wbg_length_fff51ee6522a1a18=function(e){return re(e).length},n.wbg.__wbindgen_is_function=function(e){return typeof re(e)=="function"},n.wbg.__wbg_next_526fc47e980da008=function(e){const t=re(e).next;return be(t)},n.wbg.__wbg_next_ddb3312ca1c4e32a=function(){return ji(function(e){const t=re(e).next();return be(t)},arguments)},n.wbg.__wbg_done_5c1f01fb660d73b5=function(e){return re(e).done},n.wbg.__wbg_value_1695675138684bd5=function(e){const t=re(e).value;return be(t)},n.wbg.__wbg_iterator_97f0c81209c6c35a=function(){return be(Symbol.iterator)},n.wbg.__wbg_get_97b561fb56f034b5=function(){return ji(function(e,t){const r=Reflect.get(re(e),re(t));return be(r)},arguments)},n.wbg.__wbg_call_cb65541d95d71282=function(){return ji(function(e,t){const r=re(e).call(re(t));return be(r)},arguments)},n.wbg.__wbg_isArray_4c24b343cb13cfb1=function(e){return Array.isArray(re(e))},n.wbg.__wbg_instanceof_ArrayBuffer_39ac22089b74fddb=function(e){let t;try{t=re(e)instanceof ArrayBuffer}catch{t=!1}return t},n.wbg.__wbg_buffer_085ec1f694018c4f=function(e){const t=re(e).buffer;return be(t)},n.wbg.__wbg_new_8125e318e6245eed=function(e){const t=new Uint8Array(re(e));return be(t)},n.wbg.__wbg_set_5cf90238115182c3=function(e,t,r){re(e).set(re(t),r>>>0)},n.wbg.__wbg_length_72e2208bbc0efc61=function(e){return re(e).length},n.wbg.__wbg_instanceof_Uint8Array_d8d9cb2b8e8ac1d4=function(e){let t;try{t=re(e)instanceof Uint8Array}catch{t=!1}return t},n.wbg.__wbindgen_debug_string=function(e,t){const r=bo(re(t)),i=$n(r,Y.__wbindgen_malloc,Y.__wbindgen_realloc),o=Nt;he()[e/4+1]=o,he()[e/4+0]=i},n.wbg.__wbindgen_throw=function(e,t){throw new Error(vt(e,t))},n.wbg.__wbindgen_memory=function(){const e=Y.memory;return be(e)},n}function ug(n,e){return Y=n.exports,_u.__wbindgen_wasm_module=e,Ur=null,qr=null,jr=null,Y}async function _u(n){if(Y!==void 0)return Y;typeof n>"u"&&(n="/scheme-sketcher/assets/route_snapper_bg.wasm");const e=fg();(typeof n=="string"||typeof Request=="function"&&n instanceof Request||typeof URL=="function"&&n instanceof URL)&&(n=fetch(n));const{instance:t,module:r}=await lg(await n,e);return ug(t,r)}function cg(n,e,t){t===void 0&&(t={});var r={type:"Feature"};return(t.id===0||t.id)&&(r.id=t.id),t.bbox&&(r.bbox=t.bbox),r.properties=e||{},r.geometry=n,r}function pg(n,e,t){if(t===void 0&&(t={}),!n)throw new Error("coordinates is required");if(!Array.isArray(n))throw new Error("coordinates must be an Array");if(n.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!ua(n[0])||!ua(n[1]))throw new Error("coordinates must contain numbers");var r={type:"Point",coordinates:n};return cg(r,e,t)}function ua(n){return!isNaN(n)&&n!==null&&!Array.isArray(n)}var Ye=63710088e-1,hg={centimeters:Ye*100,centimetres:Ye*100,degrees:Ye/111325,feet:Ye*3.28084,inches:Ye*39.37,kilometers:Ye/1e3,kilometres:Ye/1e3,meters:Ye,metres:Ye,miles:Ye/1609.344,millimeters:Ye*1e3,millimetres:Ye*1e3,nauticalmiles:Ye/1852,radians:1,yards:Ye*1.0936};function wo(n,e,t){t===void 0&&(t={});var r={type:"Feature"};return(t.id===0||t.id)&&(r.id=t.id),t.bbox&&(r.bbox=t.bbox),r.properties=e||{},r.geometry=n,r}function gg(n,e,t){if(t===void 0&&(t={}),n.length<2)throw new Error("coordinates must be an array of two or more positions");var r={type:"LineString",coordinates:n};return wo(r,e,t)}function dg(n,e){e===void 0&&(e="kilometers");var t=hg[e];if(!t)throw new Error(e+" units is invalid");return n*t}function Sn(n){var e=n%360;return e*Math.PI/180}function ca(n){if(!n)throw new Error("coord is required");if(!Array.isArray(n)){if(n.type==="Feature"&&n.geometry!==null&&n.geometry.type==="Point")return n.geometry.coordinates;if(n.type==="Point")return n.coordinates}if(Array.isArray(n)&&n.length>=2&&!Array.isArray(n[0])&&!Array.isArray(n[1]))return n;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function mg(n,e,t){t===void 0&&(t={});var r=ca(n),i=ca(e),o=Sn(i[1]-r[1]),s=Sn(i[0]-r[0]),a=Sn(r[1]),l=Sn(i[1]),f=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(a)*Math.cos(l);return dg(2*Math.atan2(Math.sqrt(f),Math.sqrt(1-f)),t.units)}function bu(n,e,t){if(n!==null)for(var r,i,o,s,a,l,f,c=0,u=0,h,p=n.type,g=p==="FeatureCollection",d=p==="Feature",v=g?n.features.length:1,_=0;_<v;_++){f=g?n.features[_].geometry:d?n.geometry:n,h=f?f.type==="GeometryCollection":!1,a=h?f.geometries.length:1;for(var y=0;y<a;y++){var m=0,k=0;if(s=h?f.geometries[y]:f,s!==null){l=s.coordinates;var b=s.type;switch(c=t&&(b==="Polygon"||b==="MultiPolygon")?1:0,b){case null:break;case"Point":if(e(l,u,_,m,k)===!1)return!1;u++,m++;break;case"LineString":case"MultiPoint":for(r=0;r<l.length;r++){if(e(l[r],u,_,m,k)===!1)return!1;u++,b==="MultiPoint"&&m++}b==="LineString"&&m++;break;case"Polygon":case"MultiLineString":for(r=0;r<l.length;r++){for(i=0;i<l[r].length-c;i++){if(e(l[r][i],u,_,m,k)===!1)return!1;u++}b==="MultiLineString"&&m++,b==="Polygon"&&k++}b==="Polygon"&&m++;break;case"MultiPolygon":for(r=0;r<l.length;r++){for(k=0,i=0;i<l[r].length;i++){for(o=0;o<l[r][i].length-c;o++){if(e(l[r][i][o],u,_,m,k)===!1)return!1;u++}k++}m++}break;case"GeometryCollection":for(r=0;r<s.geometries.length;r++)if(bu(s.geometries[r],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function yg(n,e){var t,r,i,o,s,a,l,f,c,u,h=0,p=n.type==="FeatureCollection",g=n.type==="Feature",d=p?n.features.length:1;for(t=0;t<d;t++){for(a=p?n.features[t].geometry:g?n.geometry:n,f=p?n.features[t].properties:g?n.properties:{},c=p?n.features[t].bbox:g?n.bbox:void 0,u=p?n.features[t].id:g?n.id:void 0,l=a?a.type==="GeometryCollection":!1,s=l?a.geometries.length:1,i=0;i<s;i++){if(o=l?a.geometries[i]:a,o===null){if(e(null,h,f,c,u)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(o,h,f,c,u)===!1)return!1;break}case"GeometryCollection":{for(r=0;r<o.geometries.length;r++)if(e(o.geometries[r],h,f,c,u)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}h++}}function vg(n,e){yg(n,function(t,r,i,o,s){var a=t===null?null:t.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return e(wo(t,i,{bbox:o,id:s}),r,0)===!1?!1:void 0}var l;switch(a){case"MultiPoint":l="Point";break;case"MultiLineString":l="LineString";break;case"MultiPolygon":l="Polygon";break}for(var f=0;f<t.coordinates.length;f++){var c=t.coordinates[f],u={type:l,coordinates:c};if(e(wo(u,i),r,f)===!1)return!1}})}function _g(n,e){vg(n,function(t,r,i){var o=0;if(t.geometry){var s=t.geometry.type;if(!(s==="Point"||s==="MultiPoint")){var a,l=0,f=0,c=0;if(bu(t,function(u,h,p,g,d){if(a===void 0||r>l||g>f||d>c){a=u,l=r,f=g,c=d,o=0;return}var v=gg([a,u],t.properties);if(e(v,r,i,d,o)===!1)return!1;o++,a=u})===!1)return!1}}})}function bg(n,e,t){var r=t,i=!1;return _g(n,function(o,s,a,l,f){i===!1&&t===void 0?r=o:r=e(r,o,s,a,l,f),i=!0}),r}function $o(n,e){return e===void 0&&(e={}),bg(n,function(t,r){var i=r.geometry.coordinates;return t+mg(i[0],i[1],e)},0)}var Xe=63710088e-1,wu={centimeters:Xe*100,centimetres:Xe*100,degrees:Xe/111325,feet:Xe*3.28084,inches:Xe*39.37,kilometers:Xe/1e3,kilometres:Xe/1e3,meters:Xe,metres:Xe,miles:Xe/1609.344,millimeters:Xe*1e3,millimetres:Xe*1e3,nauticalmiles:Xe/1852,radians:1,yards:Xe*1.0936};function vr(n,e,t){t===void 0&&(t={});var r={type:"Feature"};return(t.id===0||t.id)&&(r.id=t.id),t.bbox&&(r.bbox=t.bbox),r.properties=e||{},r.geometry=n,r}function Vr(n,e,t){if(t===void 0&&(t={}),!n)throw new Error("coordinates is required");if(!Array.isArray(n))throw new Error("coordinates must be an Array");if(n.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!ha(n[0])||!ha(n[1]))throw new Error("coordinates must contain numbers");var r={type:"Point",coordinates:n};return vr(r,e,t)}function So(n,e,t){if(t===void 0&&(t={}),n.length<2)throw new Error("coordinates must be an array of two or more positions");var r={type:"LineString",coordinates:n};return vr(r,e,t)}function pa(n,e){e===void 0&&(e={});var t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=n,t}function wg(n,e){e===void 0&&(e="kilometers");var t=wu[e];if(!t)throw new Error(e+" units is invalid");return n*t}function $g(n,e){e===void 0&&(e="kilometers");var t=wu[e];if(!t)throw new Error(e+" units is invalid");return n/t}function ko(n){var e=n%(2*Math.PI);return e*180/Math.PI}function ct(n){var e=n%360;return e*Math.PI/180}function ha(n){return!isNaN(n)&&n!==null&&!Array.isArray(n)}function on(n){if(!n)throw new Error("coord is required");if(!Array.isArray(n)){if(n.type==="Feature"&&n.geometry!==null&&n.geometry.type==="Point")return n.geometry.coordinates;if(n.type==="Point")return n.coordinates}if(Array.isArray(n)&&n.length>=2&&!Array.isArray(n[0])&&!Array.isArray(n[1]))return n;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function sn(n){if(Array.isArray(n))return n;if(n.type==="Feature"){if(n.geometry!==null)return n.geometry.coordinates}else if(n.coordinates)return n.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Sg(n,e){return n.type==="FeatureCollection"?"FeatureCollection":n.type==="GeometryCollection"?"GeometryCollection":n.type==="Feature"&&n.geometry!==null?n.geometry.type:n.type}function $u(n,e,t){if(t===void 0&&(t={}),t.final===!0)return kg(n,e);var r=on(n),i=on(e),o=ct(r[0]),s=ct(i[0]),a=ct(r[1]),l=ct(i[1]),f=Math.sin(s-o)*Math.cos(l),c=Math.cos(a)*Math.sin(l)-Math.sin(a)*Math.cos(l)*Math.cos(s-o);return ko(Math.atan2(f,c))}function kg(n,e){var t=$u(e,n);return t=(t+180)%360,t}function Rr(n,e,t){t===void 0&&(t={});var r=on(n),i=on(e),o=ct(i[1]-r[1]),s=ct(i[0]-r[0]),a=ct(r[1]),l=ct(i[1]),f=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(a)*Math.cos(l);return wg(2*Math.atan2(Math.sqrt(f),Math.sqrt(1-f)),t.units)}function ga(n,e,t,r){r===void 0&&(r={});var i=on(n),o=ct(i[0]),s=ct(i[1]),a=ct(t),l=$g(e,r.units),f=Math.asin(Math.sin(s)*Math.cos(l)+Math.cos(s)*Math.sin(l)*Math.cos(a)),c=o+Math.atan2(Math.sin(a)*Math.sin(l)*Math.cos(s),Math.cos(l)-Math.sin(s)*Math.sin(f)),u=ko(c),h=ko(f);return Vr([u,h],r.properties)}function da(n,e){if(n.type==="Feature")e(n,0);else if(n.type==="FeatureCollection")for(var t=0;t<n.features.length&&e(n.features[t],t)!==!1;t++);}function Eg(n,e){var t,r,i,o,s,a,l,f,c,u,h=0,p=n.type==="FeatureCollection",g=n.type==="Feature",d=p?n.features.length:1;for(t=0;t<d;t++){for(a=p?n.features[t].geometry:g?n.geometry:n,f=p?n.features[t].properties:g?n.properties:{},c=p?n.features[t].bbox:g?n.bbox:void 0,u=p?n.features[t].id:g?n.id:void 0,l=a?a.type==="GeometryCollection":!1,s=l?a.geometries.length:1,i=0;i<s;i++){if(o=l?a.geometries[i]:a,o===null){if(e(null,h,f,c,u)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(o,h,f,c,u)===!1)return!1;break}case"GeometryCollection":{for(r=0;r<o.geometries.length;r++)if(e(o.geometries[r],h,f,c,u)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}h++}}function Mg(n,e){Eg(n,function(t,r,i,o,s){var a=t===null?null:t.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return e(vr(t,i,{bbox:o,id:s}),r,0)===!1?!1:void 0}var l;switch(a){case"MultiPoint":l="Point";break;case"MultiLineString":l="LineString";break;case"MultiPolygon":l="Polygon";break}for(var f=0;f<t.coordinates.length;f++){var c=t.coordinates[f],u={type:l,coordinates:c};if(e(vr(u,i),r,f)===!1)return!1}})}function Pg(n,e){var t={},r=[];if(n.type==="LineString"&&(n=vr(n)),e.type==="LineString"&&(e=vr(e)),n.type==="Feature"&&e.type==="Feature"&&n.geometry!==null&&e.geometry!==null&&n.geometry.type==="LineString"&&e.geometry.type==="LineString"&&n.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var i=ma(n,e);return i&&r.push(i),pa(r)}var o=yn();return o.load(er(e)),da(er(n),function(s){da(o.search(s),function(a){var l=ma(s,a);if(l){var f=sn(l).join(",");t[f]||(t[f]=!0,r.push(l))}})}),pa(r)}function ma(n,e){var t=sn(n),r=sn(e);if(t.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(r.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var i=t[0][0],o=t[0][1],s=t[1][0],a=t[1][1],l=r[0][0],f=r[0][1],c=r[1][0],u=r[1][1],h=(u-f)*(s-i)-(c-l)*(a-o),p=(c-l)*(o-f)-(u-f)*(i-l),g=(s-i)*(o-f)-(a-o)*(i-l);if(h===0)return null;var d=p/h,v=g/h;if(d>=0&&d<=1&&v>=0&&v<=1){var _=i+d*(s-i),y=o+d*(a-o);return Vr([_,y])}return null}function ya(n,e,t){t===void 0&&(t={});var r=Vr([1/0,1/0],{dist:1/0}),i=0;return Mg(n,function(o){for(var s=sn(o),a=0;a<s.length-1;a++){var l=Vr(s[a]);l.properties.dist=Rr(e,l,t);var f=Vr(s[a+1]);f.properties.dist=Rr(e,f,t);var c=Rr(l,f,t),u=Math.max(l.properties.dist,f.properties.dist),h=$u(l,f),p=ga(e,u,h+90,t),g=ga(e,u,h-90,t),d=Pg(So([p.geometry.coordinates,g.geometry.coordinates]),So([l.geometry.coordinates,f.geometry.coordinates])),v=null;d.features.length>0&&(v=d.features[0],v.properties.dist=Rr(e,v,t),v.properties.location=i+Rr(l,v,t)),l.properties.dist<r.properties.dist&&(r=l,r.properties.index=a,r.properties.location=i),f.properties.dist<r.properties.dist&&(r=f,r.properties.index=a+1,r.properties.location=i+c),v&&v.properties.dist<r.properties.dist&&(r=v,r.properties.index=a),i+=c}}),r}function Lg(n,e,t){var r=sn(t);if(Sg(t)!=="LineString")throw new Error("line must be a LineString");var i=ya(t,n),o=ya(t,e),s;i.properties.index<=o.properties.index?s=[i,o]:s=[o,i];for(var a=[s[0].geometry.coordinates],l=s[0].properties.index+1;l<s[1].properties.index+1;l++)a.push(r[l]);return a.push(s[1].geometry.coordinates),So(a,t.properties)}var Ve=63710088e-1,Ag={centimeters:Ve*100,centimetres:Ve*100,degrees:Ve/111325,feet:Ve*3.28084,inches:Ve*39.37,kilometers:Ve/1e3,kilometres:Ve/1e3,meters:Ve,metres:Ve,miles:Ve/1609.344,millimeters:Ve*1e3,millimetres:Ve*1e3,nauticalmiles:Ve/1852,radians:1,yards:Ve*1.0936};function Cg(n,e){e===void 0&&(e="kilometers");var t=Ag[e];if(!t)throw new Error(e+" units is invalid");return n*t}function kn(n){var e=n%360;return e*Math.PI/180}function va(n){if(!n)throw new Error("coord is required");if(!Array.isArray(n)){if(n.type==="Feature"&&n.geometry!==null&&n.geometry.type==="Point")return n.geometry.coordinates;if(n.type==="Point")return n.coordinates}if(Array.isArray(n)&&n.length>=2&&!Array.isArray(n[0])&&!Array.isArray(n[1]))return n;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function _a(n,e,t){t===void 0&&(t={});var r=va(n),i=va(e),o=kn(i[1]-r[1]),s=kn(i[0]-r[0]),a=kn(r[1]),l=kn(i[1]),f=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(a)*Math.cos(l);return Cg(2*Math.atan2(Math.sqrt(f),Math.sqrt(1-f)),t.units)}function Fg(n){var e=n[0],t=n[1],r=n[2],i=n[3],o=_a(n.slice(0,2),[r,t]),s=_a(n.slice(0,2),[e,i]);if(o>=s){var a=(t+i)/2;return[e,a-(r-e)/2,r,a+(r-e)/2]}else{var l=(e+r)/2;return[l-(i-t)/2,t,l+(i-t)/2,i]}}function Su(n,e,t){if(n!==null)for(var r,i,o,s,a,l,f,c=0,u=0,h,p=n.type,g=p==="FeatureCollection",d=p==="Feature",v=g?n.features.length:1,_=0;_<v;_++){f=g?n.features[_].geometry:d?n.geometry:n,h=f?f.type==="GeometryCollection":!1,a=h?f.geometries.length:1;for(var y=0;y<a;y++){var m=0,k=0;if(s=h?f.geometries[y]:f,s!==null){l=s.coordinates;var b=s.type;switch(c=t&&(b==="Polygon"||b==="MultiPolygon")?1:0,b){case null:break;case"Point":if(e(l,u,_,m,k)===!1)return!1;u++,m++;break;case"LineString":case"MultiPoint":for(r=0;r<l.length;r++){if(e(l[r],u,_,m,k)===!1)return!1;u++,b==="MultiPoint"&&m++}b==="LineString"&&m++;break;case"Polygon":case"MultiLineString":for(r=0;r<l.length;r++){for(i=0;i<l[r].length-c;i++){if(e(l[r][i],u,_,m,k)===!1)return!1;u++}b==="MultiLineString"&&m++,b==="Polygon"&&k++}b==="Polygon"&&m++;break;case"MultiPolygon":for(r=0;r<l.length;r++){for(k=0,i=0;i<l[r].length;i++){for(o=0;o<l[r][i].length-c;o++){if(e(l[r][i][o],u,_,m,k)===!1)return!1;u++}k++}m++}break;case"GeometryCollection":for(r=0;r<s.geometries.length;r++)if(Su(s.geometries[r],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Og(n,e){e===void 0&&(e={});var t=e.precision,r=e.coordinates,i=e.mutate;if(t=t==null||isNaN(t)?6:t,r=r==null||isNaN(r)?3:r,!n)throw new Error("<geojson> is required");if(typeof t!="number")throw new Error("<precision> must be a number");if(typeof r!="number")throw new Error("<coordinates> must be a number");(i===!1||i===void 0)&&(n=JSON.parse(JSON.stringify(n)));var o=Math.pow(10,t);return Su(n,function(s){Rg(s,o,r)}),n}function Rg(n,e,t){n.length>t&&n.splice(t,n.length);for(var r=0;r<n.length;r++)n[r]=Math.round(n[r]*e)/e;return n}var Ke=63710088e-1,ku={centimeters:Ke*100,centimetres:Ke*100,degrees:Ke/111325,feet:Ke*3.28084,inches:Ke*39.37,kilometers:Ke/1e3,kilometres:Ke/1e3,meters:Ke,metres:Ke,miles:Ke/1609.344,millimeters:Ke*1e3,millimetres:Ke*1e3,nauticalmiles:Ke/1852,radians:1,yards:Ke*1.0936};function _r(n,e,t){t===void 0&&(t={});var r={type:"Feature"};return(t.id===0||t.id)&&(r.id=t.id),t.bbox&&(r.bbox=t.bbox),r.properties=e||{},r.geometry=n,r}function Kr(n,e,t){if(t===void 0&&(t={}),!n)throw new Error("coordinates is required");if(!Array.isArray(n))throw new Error("coordinates must be an Array");if(n.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!ba(n[0])||!ba(n[1]))throw new Error("coordinates must contain numbers");var r={type:"Point",coordinates:n};return _r(r,e,t)}function ci(n,e,t){if(t===void 0&&(t={}),n.length<2)throw new Error("coordinates must be an array of two or more positions");var r={type:"LineString",coordinates:n};return _r(r,e,t)}function Vt(n,e){e===void 0&&(e={});var t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=n,t}function Bg(n,e){e===void 0&&(e="kilometers");var t=ku[e];if(!t)throw new Error(e+" units is invalid");return n*t}function Ig(n,e){e===void 0&&(e="kilometers");var t=ku[e];if(!t)throw new Error(e+" units is invalid");return n/t}function Eo(n){var e=n%(2*Math.PI);return e*180/Math.PI}function pt(n){var e=n%360;return e*Math.PI/180}function ba(n){return!isNaN(n)&&n!==null&&!Array.isArray(n)}function Dt(n){if(!n)throw new Error("coord is required");if(!Array.isArray(n)){if(n.type==="Feature"&&n.geometry!==null&&n.geometry.type==="Point")return n.geometry.coordinates;if(n.type==="Point")return n.coordinates}if(Array.isArray(n)&&n.length>=2&&!Array.isArray(n[0])&&!Array.isArray(n[1]))return n;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Kt(n){if(Array.isArray(n))return n;if(n.type==="Feature"){if(n.geometry!==null)return n.geometry.coordinates}else if(n.coordinates)return n.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function wa(n,e){return n.type==="FeatureCollection"?"FeatureCollection":n.type==="GeometryCollection"?"GeometryCollection":n.type==="Feature"&&n.geometry!==null?n.geometry.type:n.type}function an(n,e){if(n.type==="Feature")e(n,0);else if(n.type==="FeatureCollection")for(var t=0;t<n.features.length&&e(n.features[t],t)!==!1;t++);}function Ng(n,e,t){var r=t;return an(n,function(i,o){o===0&&t===void 0?r=i:r=e(r,i,o)}),r}function Tg(n,e){var t,r,i,o,s,a,l,f,c,u,h=0,p=n.type==="FeatureCollection",g=n.type==="Feature",d=p?n.features.length:1;for(t=0;t<d;t++){for(a=p?n.features[t].geometry:g?n.geometry:n,f=p?n.features[t].properties:g?n.properties:{},c=p?n.features[t].bbox:g?n.bbox:void 0,u=p?n.features[t].id:g?n.id:void 0,l=a?a.type==="GeometryCollection":!1,s=l?a.geometries.length:1,i=0;i<s;i++){if(o=l?a.geometries[i]:a,o===null){if(e(null,h,f,c,u)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(o,h,f,c,u)===!1)return!1;break}case"GeometryCollection":{for(r=0;r<o.geometries.length;r++)if(e(o.geometries[r],h,f,c,u)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}h++}}function Eu(n,e){Tg(n,function(t,r,i,o,s){var a=t===null?null:t.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return e(_r(t,i,{bbox:o,id:s}),r,0)===!1?!1:void 0}var l;switch(a){case"MultiPoint":l="Point";break;case"MultiLineString":l="LineString";break;case"MultiPolygon":l="Polygon";break}for(var f=0;f<t.coordinates.length;f++){var c=t.coordinates[f],u={type:l,coordinates:c};if(e(_r(u,i),r,f)===!1)return!1}})}function Mu(n,e){var t={},r=[];if(n.type==="LineString"&&(n=_r(n)),e.type==="LineString"&&(e=_r(e)),n.type==="Feature"&&e.type==="Feature"&&n.geometry!==null&&e.geometry!==null&&n.geometry.type==="LineString"&&e.geometry.type==="LineString"&&n.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var i=$a(n,e);return i&&r.push(i),Vt(r)}var o=yn();return o.load(er(e)),an(er(n),function(s){an(o.search(s),function(a){var l=$a(s,a);if(l){var f=Kt(l).join(",");t[f]||(t[f]=!0,r.push(l))}})}),Vt(r)}function $a(n,e){var t=Kt(n),r=Kt(e);if(t.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(r.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var i=t[0][0],o=t[0][1],s=t[1][0],a=t[1][1],l=r[0][0],f=r[0][1],c=r[1][0],u=r[1][1],h=(u-f)*(s-i)-(c-l)*(a-o),p=(c-l)*(o-f)-(u-f)*(i-l),g=(s-i)*(o-f)-(a-o)*(i-l);if(h===0)return null;var d=p/h,v=g/h;if(d>=0&&d<=1&&v>=0&&v<=1){var _=i+d*(s-i),y=o+d*(a-o);return Kr([_,y])}return null}function Pu(n,e,t){if(t===void 0&&(t={}),t.final===!0)return Gg(n,e);var r=Dt(n),i=Dt(e),o=pt(r[0]),s=pt(i[0]),a=pt(r[1]),l=pt(i[1]),f=Math.sin(s-o)*Math.cos(l),c=Math.cos(a)*Math.sin(l)-Math.sin(a)*Math.cos(l)*Math.cos(s-o);return Eo(Math.atan2(f,c))}function Gg(n,e){var t=Pu(e,n);return t=(t+180)%360,t}function Br(n,e,t){t===void 0&&(t={});var r=Dt(n),i=Dt(e),o=pt(i[1]-r[1]),s=pt(i[0]-r[0]),a=pt(r[1]),l=pt(i[1]),f=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(a)*Math.cos(l);return Bg(2*Math.atan2(Math.sqrt(f),Math.sqrt(1-f)),t.units)}function Sa(n,e,t,r){r===void 0&&(r={});var i=Dt(n),o=pt(i[0]),s=pt(i[1]),a=pt(t),l=Ig(e,r.units),f=Math.asin(Math.sin(s)*Math.cos(l)+Math.cos(s)*Math.sin(l)*Math.cos(a)),c=o+Math.atan2(Math.sin(a)*Math.sin(l)*Math.cos(s),Math.cos(l)-Math.sin(s)*Math.sin(f)),u=Eo(c),h=Eo(f);return Kr([u,h],r.properties)}function Dg(n,e,t){t===void 0&&(t={});var r=Kr([1/0,1/0],{dist:1/0}),i=0;return Eu(n,function(o){for(var s=Kt(o),a=0;a<s.length-1;a++){var l=Kr(s[a]);l.properties.dist=Br(e,l,t);var f=Kr(s[a+1]);f.properties.dist=Br(e,f,t);var c=Br(l,f,t),u=Math.max(l.properties.dist,f.properties.dist),h=Pu(l,f),p=Sa(e,u,h+90,t),g=Sa(e,u,h-90,t),d=Mu(ci([p.geometry.coordinates,g.geometry.coordinates]),ci([l.geometry.coordinates,f.geometry.coordinates])),v=null;d.features.length>0&&(v=d.features[0],v.properties.dist=Br(e,v,t),v.properties.location=i+Br(l,v,t)),l.properties.dist<r.properties.dist&&(r=l,r.properties.index=a,r.properties.location=i),f.properties.dist<r.properties.dist&&(r=f,r.properties.index=a+1,r.properties.location=i+c),v&&v.properties.dist<r.properties.dist&&(r=v,r.properties.index=a),i+=c}}),r}function jg(n,e){if(!n)throw new Error("line is required");if(!e)throw new Error("splitter is required");var t=wa(n),r=wa(e);if(t!=="LineString")throw new Error("line must be LineString");if(r==="FeatureCollection")throw new Error("splitter cannot be a FeatureCollection");if(r==="GeometryCollection")throw new Error("splitter cannot be a GeometryCollection");var i=Og(e,{precision:7});switch(r){case"Point":return Mo(n,i);case"MultiPoint":return ka(n,i);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return ka(n,Mu(n,i))}}function ka(n,e){var t=[],r=yn();return Eu(e,function(i){if(t.forEach(function(a,l){a.id=l}),!t.length)t=Mo(n,i).features,t.forEach(function(a){a.bbox||(a.bbox=Fg(nn(a)))}),r.load(Vt(t));else{var o=r.search(i);if(o.features.length){var s=Lu(i,o);t=t.filter(function(a){return a.id!==s.id}),r.remove(s),an(Mo(s,i),function(a){t.push(a),r.insert(a)})}}}),Vt(t)}function Mo(n,e){var t=[],r=Kt(n)[0],i=Kt(n)[n.geometry.coordinates.length-1];if(Ui(r,Dt(e))||Ui(i,Dt(e)))return Vt([n]);var o=yn(),s=er(n);o.load(s);var a=o.search(e);if(!a.features.length)return Vt([n]);var l=Lu(e,a),f=[r],c=Ng(s,function(u,h,p){var g=Kt(h)[1],d=Dt(e);return p===l.id?(u.push(d),t.push(ci(u)),Ui(d,g)?[d]:[d,g]):(u.push(g),u)},f);return c.length>1&&t.push(ci(c)),Vt(t)}function Lu(n,e){if(!e.features.length)throw new Error("lines must contain features");if(e.features.length===1)return e.features[0];var t,r=1/0;return an(e,function(i){var o=Dg(i,n),s=o.properties.dist;s<r&&(t=i,r=s)}),t}function Ui(n,e){return n[0]===e[0]&&n[1]===e[1]}function Ug(n,e){let t=jg(n,e);if(t.features.length!=2)return null;let r=t.features[0],i=t.features[1];return r.geometry.coordinates=r.geometry.coordinates.map(Ma),i.geometry.coordinates=i.geometry.coordinates.map(Ma),r.properties=JSON.parse(JSON.stringify(n.properties)),i.properties=JSON.parse(JSON.stringify(n.properties)),qg(n,r,i,e),[r,i]}function qg(n,e,t,r){e.properties.length_meters=$o(e,{units:"kilometers"})*1e3,t.properties.length_meters=$o(t,{units:"kilometers"})*1e3,e.properties.waypoints=[],t.properties.waypoints=[];let i=Ea(n,r),o=!0,s=0;for(let a of n.properties.waypoints){let l=Ea(n,pg([a.lon,a.lat]));if(o)if(l<i)e.properties.waypoints.push(a);else{let f=a.snapped&&n.properties.waypoints[s-1].snapped;e.properties.waypoints.push({lon:r.geometry.coordinates[0],lat:r.geometry.coordinates[1],snapped:f}),o=!1,t.properties.waypoints.push({lon:r.geometry.coordinates[0],lat:r.geometry.coordinates[1],snapped:f}),t.properties.waypoints.push(a)}else t.properties.waypoints.push(a);s++}}function Ea(n,e){let t=n.geometry.coordinates[0],r=Lg(t,e,n);return $o(r,{units:"kilometers"})*1e3}function Ma(n){return[Math.round(n[0]*1e7)/1e7,Math.round(n[1]*1e7)/1e7]}const zg=30;class Wg{constructor(e,t,r,i,o){this.onMouseMove=s=>{if(!this.active)return;const a=[s.point.x-zg,s.point.y],l=this.map.unproject(s.point).distanceTo(this.map.unproject(a));this.inner.onMouseMove(s.lngLat.lng,s.lngLat.lat,l)&&(this.redraw(),this.dataUpdated())},this.onClick=()=>{this.active&&(this.inner.onClick(),this.redraw(),this.dataUpdated())},this.onDoubleClick=s=>{this.active&&(s.preventDefault(),this.inner.onClick(),this.finish())},this.onDragStart=()=>{this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()},this.onMouseUp=()=>{this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()},this.onKeyDown=s=>{this.active&&s.key=="Escape"&&(s.stopPropagation(),this.cancel())},this.onKeyPress=s=>{this.active&&s.target.tagName!="INPUT"&&(s.key=="Enter"?(s.stopPropagation(),this.finish()):s.key=="s"||s.key=="S"?(s.stopPropagation(),this.inner.toggleSnapMode(),this.redraw()):s.key=="z"&&s.ctrlKey&&this.undo())},this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new ui(t),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.routeToolGj=r,this.snapMode=i,this.undoLength=o,this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("dragstart",this.onDragStart),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keypress",this.onKeyPress)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("dragstart",this.onDragStart),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keypress",this.onKeyPress)}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}startArea(){this.active||(this.inner.setAreaMode(),this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable(),this.map.doubleClickZoom.enable()}editExistingRoute(e){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(e.properties.waypoints),this.redraw()}editExistingArea(e){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),e.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(e.properties.waypoints),this.redraw()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)for(let t of this.eventListenersSuccess)t(JSON.parse(e));else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(e){this.inner.setRouteConfig(e),this.redraw()}addSnappedWaypoint(e){this.inner.addSnappedWaypoint(e[0],e[1]),this.redraw()}undo(){this.inner.undo(),this.redraw()}toggleSnapMode(){this.inner.toggleSnapMode(),this.redraw()}redraw(){let e=JSON.parse(this.inner.renderGeojson());this.routeToolGj.set(e),this.map.getCanvas().style.cursor=e.cursor,this.snapMode.set(e.snap_mode),this.undoLength.set(e.undo_length)}dataUpdated(){let e=this.inner.toFinalFeature();if(e)for(let t of this.eventListenersUpdated)t(JSON.parse(e))}}const Hg="/scheme-sketcher/assets/edit-03d80762.svg",Jg="/scheme-sketcher/assets/delete-faeeebbe.svg",Yg="/scheme-sketcher/assets/download-cb1570fd.svg";function Pa(n,e,t){const r=n.slice();return r[19]=e[t],r}function Xg(n){let e,t,r;return{c(){e=G("img"),r=z(`
      Rename this file`),tt(e.src,t=Hg)||j(e,"src",t),j(e,"alt","Rename this file"),j(e,"class","svelte-v2g1wg")},m(i,o){w(i,e,o),w(i,r,o)},p:Z,d(i){i&&($(e),$(r))}}}function Vg(n){let e,t,r,i,o;return{c(){e=G("img"),i=z(`
      Export .`),o=z(n[3]),tt(e.src,t=Yg)||j(e,"src",t),j(e,"alt",r="Export ."+n[3]),j(e,"class","svelte-v2g1wg")},m(s,a){w(s,e,a),w(s,i,a),w(s,o,a)},p(s,a){a&8&&r!==(r="Export ."+s[3])&&j(e,"alt",r),a&8&&ye(o,s[3])},d(s){s&&($(e),$(i),$(o))}}}function Kg(n){let e,t,r;return{c(){e=G("img"),r=z(`
      Delete this file`),tt(e.src,t=Jg)||j(e,"src",t),j(e,"alt","Delete this file"),j(e,"class","svelte-v2g1wg")},m(i,o){w(i,e,o),w(i,r,o)},p:Z,d(i){i&&($(e),$(r))}}}function Zg(n){let e,t,r,i,o,s;return e=new ce({props:{$$slots:{default:[Xg]},$$scope:{ctx:n}}}),e.$on("click",n[7]),r=new ce({props:{$$slots:{default:[Vg]},$$scope:{ctx:n}}}),r.$on("click",n[8]),o=new Ar({props:{$$slots:{default:[Kg]},$$scope:{ctx:n}}}),o.$on("click",n[14]),{c(){L(e.$$.fragment),t=I(),L(r.$$.fragment),i=I(),L(o.$$.fragment)},m(a,l){A(e,a,l),w(a,t,l),A(r,a,l),w(a,i,l),A(o,a,l),s=!0},p(a,l){const f={};l&131072&&(f.$$scope={dirty:l,ctx:a}),e.$set(f);const c={};l&131080&&(c.$$scope={dirty:l,ctx:a}),r.$set(c);const u={};l&131072&&(u.$$scope={dirty:l,ctx:a}),o.$set(u)},i(a){s||(S(e.$$.fragment,a),S(r.$$.fragment,a),S(o.$$.fragment,a),s=!0)},o(a){E(e.$$.fragment,a),E(r.$$.fragment,a),E(o.$$.fragment,a),s=!1},d(a){a&&($(t),$(i)),C(e,a),C(r,a),C(o,a)}}}function Qg(n){let e;return{c(){e=z("New blank file")},m(t,r){w(t,e,r)},d(t){t&&$(e)}}}function xg(n){let e=(n[19]==n[6]?"Currently open":n[0].describeFile(n[19]))+"",t;return{c(){t=z(e)},m(r,i){w(r,t,i)},p(r,i){i&97&&e!==(e=(r[19]==r[6]?"Currently open":r[0].describeFile(r[19]))+"")&&ye(t,e)},d(r){r&&$(t)}}}function ed(n){let e,t;function r(){return n[16](n[19])}return e=new Ar({props:{$$slots:{default:[rd]},$$scope:{ctx:n}}}),e.$on("click",r),{c(){L(e.$$.fragment)},m(i,o){A(e,i,o),t=!0},p(i,o){n=i;const s={};o&131072&&(s.$$scope={dirty:o,ctx:n}),e.$set(s)},i(i){t||(S(e.$$.fragment,i),t=!0)},o(i){E(e.$$.fragment,i),t=!1},d(i){C(e,i)}}}function td(n){let e,t;return e=new Ot({props:{$$slots:{default:[nd]},$$scope:{ctx:n}}}),e.$on("click",function(){zf(n[4])&&n[4].apply(this,arguments)}),{c(){L(e.$$.fragment)},m(r,i){A(e,r,i),t=!0},p(r,i){n=r;const o={};i&131072&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){E(e.$$.fragment,r),t=!1},d(r){C(e,r)}}}function rd(n){let e;return{c(){e=z("Delete")},m(t,r){w(t,e,r)},d(t){t&&$(e)}}}function nd(n){let e;return{c(){e=z("Start")},m(t,r){w(t,e,r)},d(t){t&&$(e)}}}function La(n){let e,t,r,i,o,s,a;function l(){return n[15](n[19])}t=new yp({props:{name:`File name: ${n[19]}`,disabled:n[19]===n[6],$$slots:{default:[xg]},$$scope:{ctx:n}}}),t.$on("click",l);const f=[td,ed],c=[];function u(h,p){return h[19]==h[6]?0:1}return i=u(n),o=c[i]=f[i](n),{c(){e=G("div"),L(t.$$.fragment),r=I(),o.c(),s=I(),de(e,"display","flex"),de(e,"justify-content","space-between")},m(h,p){w(h,e,p),A(t,e,null),D(e,r),c[i].m(e,null),D(e,s),a=!0},p(h,p){n=h;const g={};p&32&&(g.name=`File name: ${n[19]}`),p&96&&(g.disabled=n[19]===n[6]),p&131169&&(g.$$scope={dirty:p,ctx:n}),t.$set(g);let d=i;i=u(n),i===d?c[i].p(n,p):(fe(),E(c[d],1,1,()=>{c[d]=null}),ue(),o=c[i],o?o.p(n,p):(o=c[i]=f[i](n),o.c()),S(o,1),o.m(e,s))},i(h){a||(S(t.$$.fragment,h),S(o),a=!0)},o(h){E(t.$$.fragment,h),E(o),a=!1},d(h){h&&$(e),C(t),c[i].d()}}}function id(n){let e,t,r,i,o,s,a,l,f,c,u,h,p,g,d,v,_,y,m,k,b,P,R,N,q,T,F,M;c=new Ut({props:{$$slots:{default:[Zg]},$$scope:{ctx:n}}});const O=n[13].default,U=Ue(O,n,n[17],null);m=new ce({props:{$$slots:{default:[Qg]},$$scope:{ctx:n}}}),m.$on("click",n[10]),R=new Kf({props:{label:"Import from a ."+n[3]+" file",onLoad:n[11]}});let ne=ot(n[5]),V=[];for(let B=0;B<ne.length;B+=1)V[B]=La(Pa(n,ne,B));const H=B=>E(V[B],1,1,()=>{V[B]=null});return{c(){e=G("div"),t=G("p"),t.textContent=`All files are auto-saved in your browser's local storage. You can close your
    browser and resume later. You can export the file to your computer to share
    with someone else, and import from a file below.`,r=I(),i=G("p"),o=z("You're currently editing "),s=G("u"),a=z(n[6]),l=z(`
    .`),f=I(),L(c.$$.fragment),u=I(),U&&U.c(),h=I(),p=G("hr"),g=I(),d=G("div"),v=G("div"),_=G("h2"),_.textContent="Create or import a file",y=I(),L(m.$$.fragment),k=I(),b=G("hr"),P=I(),L(R.$$.fragment),N=I(),q=G("div"),T=G("h2"),T.textContent="Load a saved file",F=I();for(let B=0;B<V.length;B+=1)V[B].c();j(v,"class","govuk-grid-column-one-half"),j(q,"class","govuk-grid-column-one-half"),j(d,"class","govuk-grid-row"),j(e,"class","govuk-width-container")},m(B,x){w(B,e,x),D(e,t),D(e,r),D(e,i),D(i,o),D(i,s),D(s,a),D(i,l),D(e,f),A(c,e,null),D(e,u),U&&U.m(e,null),D(e,h),D(e,p),D(e,g),D(e,d),D(d,v),D(v,_),D(v,y),A(m,v,null),D(v,k),D(v,b),D(v,P),A(R,v,null),D(d,N),D(d,q),D(q,T),D(q,F);for(let le=0;le<V.length;le+=1)V[le]&&V[le].m(q,null);M=!0},p(B,[x]){(!M||x&64)&&ye(a,B[6]);const le={};x&131144&&(le.$$scope={dirty:x,ctx:B}),c.$set(le),U&&U.p&&(!M||x&131072)&&qe(U,O,B,B[17],M?We(O,B[17],x,null):ze(B[17]),null);const Ne={};x&131072&&(Ne.$$scope={dirty:x,ctx:B}),m.$set(Ne);const Se={};if(x&8&&(Se.label="Import from a ."+B[3]+" file"),R.$set(Se),x&4721){ne=ot(B[5]);let _e;for(_e=0;_e<ne.length;_e+=1){const W=Pa(B,ne,_e);V[_e]?(V[_e].p(W,x),S(V[_e],1)):(V[_e]=La(W),V[_e].c(),S(V[_e],1),V[_e].m(q,null))}for(fe(),_e=ne.length;_e<V.length;_e+=1)H(_e);ue()}},i(B){if(!M){S(c.$$.fragment,B),S(U,B),S(m.$$.fragment,B),S(R.$$.fragment,B);for(let x=0;x<ne.length;x+=1)S(V[x]);M=!0}},o(B){E(c.$$.fragment,B),E(U,B),E(m.$$.fragment,B),E(R.$$.fragment,B),V=V.filter(Boolean);for(let x=0;x<V.length;x+=1)E(V[x]);M=!1},d(B){B&&$(e),C(c),U&&U.d(B),C(m),C(R),ts(V,B)}}}function Aa(n,e){let t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),t.setAttribute("download",n),document.body.appendChild(t),t.click(),document.body.removeChild(t)}function od(n,e,t){let r,i=Z,o=()=>(i(),i=At(p,T=>t(18,r=T)),p),s,a=Z,l=()=>(a(),a=At(h,T=>t(6,s=T)),h);n.$$.on_destroy.push(()=>i()),n.$$.on_destroy.push(()=>a());let{$$slots:f={},$$scope:c}=e,{files:u}=e,{currentFile:h}=e;l();let{state:p}=e;o();let{fileSuffix:g}=e,{onStart:d}=e,v=u.getFileList();function _(){let T=window.prompt(`Rename file ${s} to what?`,s);if(T){let F=u.key(s),M=window.localStorage.getItem(F);window.localStorage.setItem(u.key(T),M),window.localStorage.removeItem(F),Pe(h,s=T,s),t(5,v=u.getFileList())}}function y(){Aa(s+`.${g}`,JSON.stringify(r))}function m(T){if(window.confirm(`Really delete file ${T}? You can't undo this. (If you delete, a copy will still be downloaded to your browser's download folder, in case you make a mistake.)`)){let F=u.key(T);Aa(`${T}.${g}`,window.localStorage.getItem(F)),window.localStorage.removeItem(F),T==s?k():t(5,v=u.saveAndGetFileList(s,r))}}function k(){Pe(h,s=u.newFilename(),s),Pe(p,r=u.emptyState(),r),t(5,v=u.saveAndGetFileList(s,r))}function b(T,F){let M=ld(T,`.${g}`);try{let O=JSON.parse(F);u.validate(O),t(5,v=u.saveAndGetFileList(M,O)),P(M)}catch(O){window.alert(`Couldn't load ${M}: ${O}`)}}function P(T){try{let F=u.loadFile(T);Pe(h,s=T,s),Pe(p,r=F,r)}catch(F){window.alert(`Couldn't load ${T}: ${F}`)}}const R=()=>m(s),N=T=>P(T),q=T=>m(T);return n.$$set=T=>{"files"in T&&t(0,u=T.files),"currentFile"in T&&l(t(1,h=T.currentFile)),"state"in T&&o(t(2,p=T.state)),"fileSuffix"in T&&t(3,g=T.fileSuffix),"onStart"in T&&t(4,d=T.onStart),"$$scope"in T&&t(17,c=T.$$scope)},[u,h,p,g,d,v,s,_,y,m,k,b,P,f,R,N,q,c]}class sd extends ee{constructor(e){super(),te(this,e,od,id,Q,{files:0,currentFile:1,state:2,fileSuffix:3,onStart:4})}}class ad{constructor(e){ae(this,"prefix");ae(this,"emptyState");ae(this,"validate");ae(this,"describe");ae(this,"state");ae(this,"currentFile");this.prefix=e.prefix,this.emptyState=e.emptyState,this.validate=e.validate,this.describe=e.describe,this.state=e.state,this.currentFile=e.currentFile,this.initialLoad(e.initiallyLoadFile),this.state.subscribe(t=>{let r=Xf(this.currentFile);r&&window.localStorage.setItem(this.key(r),JSON.stringify(t))}),this.currentFile.subscribe(t=>{t&&window.localStorage.setItem(this.key("last-opened-file"),t)})}key(e){return`${this.prefix}${e}`}loadFile(e){console.log(`Loading ${e}`);let t=window.localStorage.getItem(this.key(e));if(!t)throw new Error(`Key not in local storage: ${e}`);let r=JSON.parse(t);return this.validate(r),r}newFilename(){let e=this.getFileList();for(let t=1;t<=e.length+1;t++){let r=`untitled${t}`;if(!e.includes(r))return r}throw new Error("Couldn't make a new filename; this shouldn't be possible")}getFileList(){let e=[];for(let t=0;t<window.localStorage.length;t++){let r=window.localStorage.key(t);r.startsWith(this.prefix)&&r!=this.key("last-opened-file")&&e.push(r.slice(this.prefix.length))}return e.sort(),e}saveAndGetFileList(e,t){return window.localStorage.setItem(this.key(e),JSON.stringify(t)),this.getFileList()}describeFile(e){let t=window.localStorage.getItem(this.key(e));if(!t)return"Error: missing";try{let r=JSON.parse(t);return this.validate(r),JSON.stringify(r)==JSON.stringify(this.emptyState())?"Empty":this.describe(r)}catch{return"Error: invalid or broken file"}}initialLoad(e){if(typeof window>"u"){console.log("Running outside of a browser, in test mode -- not loading from local storage");return}if(e){console.log(`Initial load; trying to open ${e}`);try{let r=this.loadFile(e);this.currentFile.set(e),this.state.set(r);return}catch(r){window.alert(`Can't open file ${e}: ${r}`)}}else{console.log("Initial load; trying to open last opened file");let r=window.localStorage.getItem(this.key("last-opened-file"));if(r)try{let i=this.loadFile(r);this.currentFile.set(r),this.state.set(i);return}catch(i){window.alert(`The last opened file ${r} has a problem: ${i}`)}}console.log("Starting with a new file");let t=this.newFilename();this.currentFile.set(t),this.state.set(this.emptyState())}}function ld(n,e){return n.endsWith(e)?n.slice(0,-e.length):n}var Ca=Object.prototype.toString,Au=function(e){var t=Ca.call(e),r=t==="[object Arguments]";return r||(r=t!=="[object Array]"&&e!==null&&typeof e=="object"&&typeof e.length=="number"&&e.length>=0&&Ca.call(e.callee)==="[object Function]"),r},qi,Fa;function fd(){if(Fa)return qi;Fa=1;var n;if(!Object.keys){var e=Object.prototype.hasOwnProperty,t=Object.prototype.toString,r=Au,i=Object.prototype.propertyIsEnumerable,o=!i.call({toString:null},"toString"),s=i.call(function(){},"prototype"),a=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],l=function(h){var p=h.constructor;return p&&p.prototype===h},f={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},c=function(){if(typeof window>"u")return!1;for(var h in window)try{if(!f["$"+h]&&e.call(window,h)&&window[h]!==null&&typeof window[h]=="object")try{l(window[h])}catch{return!0}}catch{return!0}return!1}(),u=function(h){if(typeof window>"u"||!c)return l(h);try{return l(h)}catch{return!1}};n=function(p){var g=p!==null&&typeof p=="object",d=t.call(p)==="[object Function]",v=r(p),_=g&&t.call(p)==="[object String]",y=[];if(!g&&!d&&!v)throw new TypeError("Object.keys called on a non-object");var m=s&&d;if(_&&p.length>0&&!e.call(p,0))for(var k=0;k<p.length;++k)y.push(String(k));if(v&&p.length>0)for(var b=0;b<p.length;++b)y.push(String(b));else for(var P in p)!(m&&P==="prototype")&&e.call(p,P)&&y.push(String(P));if(o)for(var R=u(p),N=0;N<a.length;++N)!(R&&a[N]==="constructor")&&e.call(p,a[N])&&y.push(a[N]);return y}}return qi=n,qi}var ud=Array.prototype.slice,cd=Au,Oa=Object.keys,Tn=Oa?function(e){return Oa(e)}:fd(),Ra=Object.keys;Tn.shim=function(){if(Object.keys){var e=function(){var t=Object.keys(arguments);return t&&t.length===arguments.length}(1,2);e||(Object.keys=function(r){return cd(r)?Ra(ud.call(r)):Ra(r)})}else Object.keys=Tn;return Object.keys||Tn};var cs=Tn,pd=Error,hd=EvalError,gd=RangeError,dd=ReferenceError,Cu=SyntaxError,qt=TypeError,md=URIError,Oi=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var e={},t=Symbol("test"),r=Object(t);if(typeof t=="string"||Object.prototype.toString.call(t)!=="[object Symbol]"||Object.prototype.toString.call(r)!=="[object Symbol]")return!1;var i=42;e[t]=i;for(t in e)return!1;if(typeof Object.keys=="function"&&Object.keys(e).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(e).length!==0)return!1;var o=Object.getOwnPropertySymbols(e);if(o.length!==1||o[0]!==t||!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var s=Object.getOwnPropertyDescriptor(e,t);if(s.value!==i||s.enumerable!==!0)return!1}return!0},Ba=typeof Symbol<"u"&&Symbol,yd=Oi,ps=function(){return typeof Ba!="function"||typeof Symbol!="function"||typeof Ba("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:yd()},zi={__proto__:null,foo:{}},vd=Object,_d=function(){return{__proto__:zi}.foo===zi.foo&&!(zi instanceof vd)},bd="Function.prototype.bind called on incompatible ",wd=Object.prototype.toString,$d=Math.max,Sd="[object Function]",Ia=function(e,t){for(var r=[],i=0;i<e.length;i+=1)r[i]=e[i];for(var o=0;o<t.length;o+=1)r[o+e.length]=t[o];return r},kd=function(e,t){for(var r=[],i=t||0,o=0;i<e.length;i+=1,o+=1)r[o]=e[i];return r},Ed=function(n,e){for(var t="",r=0;r<n.length;r+=1)t+=n[r],r+1<n.length&&(t+=e);return t},Md=function(e){var t=this;if(typeof t!="function"||wd.apply(t)!==Sd)throw new TypeError(bd+t);for(var r=kd(arguments,1),i,o=function(){if(this instanceof i){var c=t.apply(this,Ia(r,arguments));return Object(c)===c?c:this}return t.apply(e,Ia(r,arguments))},s=$d(0,t.length-r.length),a=[],l=0;l<s;l++)a[l]="$"+l;if(i=Function("binder","return function ("+Ed(a,",")+"){ return binder.apply(this,arguments); }")(o),t.prototype){var f=function(){};f.prototype=t.prototype,i.prototype=new f,f.prototype=null}return i},Pd=Md,hs=Function.prototype.bind||Pd,Ld=Function.prototype.call,Ad=Object.prototype.hasOwnProperty,Cd=hs,Fu=Cd.call(Ld,Ad),ie,Fd=pd,Od=hd,Rd=gd,Bd=dd,br=Cu,cr=qt,Id=md,Ou=Function,Wi=function(n){try{return Ou('"use strict"; return ('+n+").constructor;")()}catch{}},Zt=Object.getOwnPropertyDescriptor;if(Zt)try{Zt({},"")}catch{Zt=null}var Hi=function(){throw new cr},Nd=Zt?function(){try{return arguments.callee,Hi}catch{try{return Zt(arguments,"callee").get}catch{return Hi}}}():Hi,or=ps(),Td=_d(),Ee=Object.getPrototypeOf||(Td?function(n){return n.__proto__}:null),lr={},Gd=typeof Uint8Array>"u"||!Ee?ie:Ee(Uint8Array),Qt={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?ie:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?ie:ArrayBuffer,"%ArrayIteratorPrototype%":or&&Ee?Ee([][Symbol.iterator]()):ie,"%AsyncFromSyncIteratorPrototype%":ie,"%AsyncFunction%":lr,"%AsyncGenerator%":lr,"%AsyncGeneratorFunction%":lr,"%AsyncIteratorPrototype%":lr,"%Atomics%":typeof Atomics>"u"?ie:Atomics,"%BigInt%":typeof BigInt>"u"?ie:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?ie:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?ie:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?ie:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Fd,"%eval%":eval,"%EvalError%":Od,"%Float32Array%":typeof Float32Array>"u"?ie:Float32Array,"%Float64Array%":typeof Float64Array>"u"?ie:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?ie:FinalizationRegistry,"%Function%":Ou,"%GeneratorFunction%":lr,"%Int8Array%":typeof Int8Array>"u"?ie:Int8Array,"%Int16Array%":typeof Int16Array>"u"?ie:Int16Array,"%Int32Array%":typeof Int32Array>"u"?ie:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":or&&Ee?Ee(Ee([][Symbol.iterator]())):ie,"%JSON%":typeof JSON=="object"?JSON:ie,"%Map%":typeof Map>"u"?ie:Map,"%MapIteratorPrototype%":typeof Map>"u"||!or||!Ee?ie:Ee(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?ie:Promise,"%Proxy%":typeof Proxy>"u"?ie:Proxy,"%RangeError%":Rd,"%ReferenceError%":Bd,"%Reflect%":typeof Reflect>"u"?ie:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?ie:Set,"%SetIteratorPrototype%":typeof Set>"u"||!or||!Ee?ie:Ee(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?ie:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":or&&Ee?Ee(""[Symbol.iterator]()):ie,"%Symbol%":or?Symbol:ie,"%SyntaxError%":br,"%ThrowTypeError%":Nd,"%TypedArray%":Gd,"%TypeError%":cr,"%Uint8Array%":typeof Uint8Array>"u"?ie:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?ie:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?ie:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?ie:Uint32Array,"%URIError%":Id,"%WeakMap%":typeof WeakMap>"u"?ie:WeakMap,"%WeakRef%":typeof WeakRef>"u"?ie:WeakRef,"%WeakSet%":typeof WeakSet>"u"?ie:WeakSet};if(Ee)try{null.error}catch(n){var Dd=Ee(Ee(n));Qt["%Error.prototype%"]=Dd}var jd=function n(e){var t;if(e==="%AsyncFunction%")t=Wi("async function () {}");else if(e==="%GeneratorFunction%")t=Wi("function* () {}");else if(e==="%AsyncGeneratorFunction%")t=Wi("async function* () {}");else if(e==="%AsyncGenerator%"){var r=n("%AsyncGeneratorFunction%");r&&(t=r.prototype)}else if(e==="%AsyncIteratorPrototype%"){var i=n("%AsyncGenerator%");i&&Ee&&(t=Ee(i.prototype))}return Qt[e]=t,t},Na={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},vn=hs,pi=Fu,Ud=vn.call(Function.call,Array.prototype.concat),qd=vn.call(Function.apply,Array.prototype.splice),Ta=vn.call(Function.call,String.prototype.replace),hi=vn.call(Function.call,String.prototype.slice),zd=vn.call(Function.call,RegExp.prototype.exec),Wd=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,Hd=/\\(\\)?/g,Jd=function(e){var t=hi(e,0,1),r=hi(e,-1);if(t==="%"&&r!=="%")throw new br("invalid intrinsic syntax, expected closing `%`");if(r==="%"&&t!=="%")throw new br("invalid intrinsic syntax, expected opening `%`");var i=[];return Ta(e,Wd,function(o,s,a,l){i[i.length]=a?Ta(l,Hd,"$1"):s||o}),i},Yd=function(e,t){var r=e,i;if(pi(Na,r)&&(i=Na[r],r="%"+i[0]+"%"),pi(Qt,r)){var o=Qt[r];if(o===lr&&(o=jd(r)),typeof o>"u"&&!t)throw new cr("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:i,name:r,value:o}}throw new br("intrinsic "+e+" does not exist!")},kt=function(e,t){if(typeof e!="string"||e.length===0)throw new cr("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof t!="boolean")throw new cr('"allowMissing" argument must be a boolean');if(zd(/^%?[^%]*%?$/,e)===null)throw new br("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var r=Jd(e),i=r.length>0?r[0]:"",o=Yd("%"+i+"%",t),s=o.name,a=o.value,l=!1,f=o.alias;f&&(i=f[0],qd(r,Ud([0,1],f)));for(var c=1,u=!0;c<r.length;c+=1){var h=r[c],p=hi(h,0,1),g=hi(h,-1);if((p==='"'||p==="'"||p==="`"||g==='"'||g==="'"||g==="`")&&p!==g)throw new br("property names with quotes must have matching quotes");if((h==="constructor"||!u)&&(l=!0),i+="."+h,s="%"+i+"%",pi(Qt,s))a=Qt[s];else if(a!=null){if(!(h in a)){if(!t)throw new cr("base intrinsic for "+e+" exists, but the property is not available.");return}if(Zt&&c+1>=r.length){var d=Zt(a,h);u=!!d,u&&"get"in d&&!("originalValue"in d.get)?a=d.get:a=a[h]}else u=pi(a,h),a=a[h];u&&!l&&(Qt[s]=a)}}return a},Ji,Ga;function gs(){if(Ga)return Ji;Ga=1;var n=kt,e=n("%Object.defineProperty%",!0)||!1;if(e)try{e({},"a",{value:1})}catch{e=!1}return Ji=e,Ji}var Xd=kt,Gn=Xd("%Object.getOwnPropertyDescriptor%",!0);if(Gn)try{Gn([],"length")}catch{Gn=null}var ds=Gn,Da=gs(),Vd=Cu,sr=qt,ja=ds,ms=function(e,t,r){if(!e||typeof e!="object"&&typeof e!="function")throw new sr("`obj` must be an object or a function`");if(typeof t!="string"&&typeof t!="symbol")throw new sr("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new sr("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new sr("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new sr("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new sr("`loose`, if provided, must be a boolean");var i=arguments.length>3?arguments[3]:null,o=arguments.length>4?arguments[4]:null,s=arguments.length>5?arguments[5]:null,a=arguments.length>6?arguments[6]:!1,l=!!ja&&ja(e,t);if(Da)Da(e,t,{configurable:s===null&&l?l.configurable:!s,enumerable:i===null&&l?l.enumerable:!i,value:r,writable:o===null&&l?l.writable:!o});else if(a||!i&&!o&&!s)e[t]=r;else throw new Vd("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},Po=gs(),Ru=function(){return!!Po};Ru.hasArrayLengthDefineBug=function(){if(!Po)return null;try{return Po([],"length",{value:1}).length!==1}catch{return!0}};var ys=Ru,Kd=cs,Zd=typeof Symbol=="function"&&typeof Symbol("foo")=="symbol",Qd=Object.prototype.toString,xd=Array.prototype.concat,Ua=ms,em=function(n){return typeof n=="function"&&Qd.call(n)==="[object Function]"},Bu=ys(),tm=function(n,e,t,r){if(e in n){if(r===!0){if(n[e]===t)return}else if(!em(r)||!r())return}Bu?Ua(n,e,t,!0):Ua(n,e,t)},Iu=function(n,e){var t=arguments.length>2?arguments[2]:{},r=Kd(e);Zd&&(r=xd.call(r,Object.getOwnPropertySymbols(e)));for(var i=0;i<r.length;i+=1)tm(n,r[i],e[r[i]],t[r[i]])};Iu.supportsDescriptors=!!Bu;var tr=Iu,Nu={exports:{}},rm=kt,qa=ms,nm=ys(),za=ds,Wa=qt,im=rm("%Math.floor%"),om=function(e,t){if(typeof e!="function")throw new Wa("`fn` is not a function");if(typeof t!="number"||t<0||t>4294967295||im(t)!==t)throw new Wa("`length` must be a positive 32-bit integer");var r=arguments.length>2&&!!arguments[2],i=!0,o=!0;if("length"in e&&za){var s=za(e,"length");s&&!s.configurable&&(i=!1),s&&!s.writable&&(o=!1)}return(i||o||!r)&&(nm?qa(e,"length",t,!0,!0):qa(e,"length",t)),e};(function(n){var e=hs,t=kt,r=om,i=qt,o=t("%Function.prototype.apply%"),s=t("%Function.prototype.call%"),a=t("%Reflect.apply%",!0)||e.call(s,o),l=gs(),f=t("%Math.max%");n.exports=function(h){if(typeof h!="function")throw new i("a function is required");var p=a(e,s,arguments);return r(p,1+f(0,h.length-(arguments.length-1)),!0)};var c=function(){return a(e,o,arguments)};l?l(n.exports,"apply",{value:c}):n.exports.apply=c})(Nu);var Cr=Nu.exports,Tu=kt,Gu=Cr,sm=Gu(Tu("String.prototype.indexOf")),at=function(e,t){var r=Tu(e,!!t);return typeof r=="function"&&sm(e,".prototype.")>-1?Gu(r):r},am=cs,Du=Oi(),ju=at,Ha=Object,lm=ju("Array.prototype.push"),Ja=ju("Object.prototype.propertyIsEnumerable"),fm=Du?Object.getOwnPropertySymbols:null,Uu=function(e,t){if(e==null)throw new TypeError("target must be an object");var r=Ha(e);if(arguments.length===1)return r;for(var i=1;i<arguments.length;++i){var o=Ha(arguments[i]),s=am(o),a=Du&&(Object.getOwnPropertySymbols||fm);if(a)for(var l=a(o),f=0;f<l.length;++f){var c=l[f];Ja(o,c)&&lm(s,c)}for(var u=0;u<s.length;++u){var h=s[u];if(Ja(o,h)){var p=o[h];r[h]=p}}}return r},Yi=Uu,um=function(){if(!Object.assign)return!1;for(var n="abcdefghijklmnopqrst",e=n.split(""),t={},r=0;r<e.length;++r)t[e[r]]=e[r];var i=Object.assign({},t),o="";for(var s in i)o+=s;return n!==o},cm=function(){if(!Object.assign||!Object.preventExtensions)return!1;var n=Object.preventExtensions({1:2});try{Object.assign(n,"xy")}catch{return n[1]==="y"}return!1},qu=function(){return!Object.assign||um()||cm()?Yi:Object.assign},pm=tr,hm=qu,gm=function(){var e=hm();return pm(Object,{assign:e},{assign:function(){return Object.assign!==e}}),e},dm=tr,mm=Cr,ym=Uu,zu=qu,vm=gm,_m=mm.apply(zu()),Wu=function(e,t){return _m(Object,arguments)};dm(Wu,{getPolyfill:zu,implementation:ym,shim:vm});var bm=Wu,ln=function(){return typeof(function(){}).name=="string"},Zr=Object.getOwnPropertyDescriptor;if(Zr)try{Zr([],"length")}catch{Zr=null}ln.functionsHaveConfigurableNames=function(){if(!ln()||!Zr)return!1;var e=Zr(function(){},"name");return!!e&&!!e.configurable};var wm=Function.prototype.bind;ln.boundFunctionsHaveNames=function(){return ln()&&typeof wm=="function"&&(function(){}).bind().name!==""};var $m=ln,Ya=ms,Sm=ys(),km=$m.functionsHaveConfigurableNames(),Em=qt,Mm=function(e,t){if(typeof e!="function")throw new Em("`fn` is not a function");var r=arguments.length>2&&!!arguments[2];return(!r||km)&&(Sm?Ya(e,"name",t,!0,!0):Ya(e,"name",t)),e},Pm=Mm,Lm=qt,Am=Object,Hu=Pm(function(){if(this==null||this!==Am(this))throw new Lm("RegExp.prototype.flags getter called on non-object");var e="";return this.hasIndices&&(e+="d"),this.global&&(e+="g"),this.ignoreCase&&(e+="i"),this.multiline&&(e+="m"),this.dotAll&&(e+="s"),this.unicode&&(e+="u"),this.unicodeSets&&(e+="v"),this.sticky&&(e+="y"),e},"get flags",!0),Cm=Hu,Fm=tr.supportsDescriptors,Om=Object.getOwnPropertyDescriptor,Ju=function(){if(Fm&&/a/mig.flags==="gim"){var e=Om(RegExp.prototype,"flags");if(e&&typeof e.get=="function"&&typeof RegExp.prototype.dotAll=="boolean"&&typeof RegExp.prototype.hasIndices=="boolean"){var t="",r={};if(Object.defineProperty(r,"hasIndices",{get:function(){t+="d"}}),Object.defineProperty(r,"sticky",{get:function(){t+="y"}}),t==="dy")return e.get}}return Cm},Rm=tr.supportsDescriptors,Bm=Ju,Im=Object.getOwnPropertyDescriptor,Nm=Object.defineProperty,Tm=TypeError,Xa=Object.getPrototypeOf,Gm=/a/,Dm=function(){if(!Rm||!Xa)throw new Tm("RegExp.prototype.flags requires a true ES5 environment that supports property descriptors");var e=Bm(),t=Xa(Gm),r=Im(t,"flags");return(!r||r.get!==e)&&Nm(t,"flags",{configurable:!0,enumerable:!1,get:e}),e},jm=tr,Um=Cr,qm=Hu,Yu=Ju,zm=Dm,Xu=Um(Yu());jm(Xu,{getPolyfill:Yu,implementation:qm,shim:zm});var Wm=Xu,Dn={exports:{}},Hm=Oi,rr=function(){return Hm()&&!!Symbol.toStringTag},Jm=rr(),Ym=at,Lo=Ym("Object.prototype.toString"),Ri=function(e){return Jm&&e&&typeof e=="object"&&Symbol.toStringTag in e?!1:Lo(e)==="[object Arguments]"},Vu=function(e){return Ri(e)?!0:e!==null&&typeof e=="object"&&typeof e.length=="number"&&e.length>=0&&Lo(e)!=="[object Array]"&&Lo(e.callee)==="[object Function]"},Xm=function(){return Ri(arguments)}();Ri.isLegacyArguments=Vu;var Ku=Xm?Ri:Vu;const Vm={},Km=Object.freeze(Object.defineProperty({__proto__:null,default:Vm},Symbol.toStringTag,{value:"Module"})),Zm=Jf(Km);var vs=typeof Map=="function"&&Map.prototype,Xi=Object.getOwnPropertyDescriptor&&vs?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,gi=vs&&Xi&&typeof Xi.get=="function"?Xi.get:null,Va=vs&&Map.prototype.forEach,_s=typeof Set=="function"&&Set.prototype,Vi=Object.getOwnPropertyDescriptor&&_s?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,di=_s&&Vi&&typeof Vi.get=="function"?Vi.get:null,Ka=_s&&Set.prototype.forEach,Qm=typeof WeakMap=="function"&&WeakMap.prototype,Qr=Qm?WeakMap.prototype.has:null,xm=typeof WeakSet=="function"&&WeakSet.prototype,xr=xm?WeakSet.prototype.has:null,ey=typeof WeakRef=="function"&&WeakRef.prototype,Za=ey?WeakRef.prototype.deref:null,ty=Boolean.prototype.valueOf,ry=Object.prototype.toString,ny=Function.prototype.toString,iy=String.prototype.match,bs=String.prototype.slice,Tt=String.prototype.replace,oy=String.prototype.toUpperCase,Qa=String.prototype.toLowerCase,Zu=RegExp.prototype.test,xa=Array.prototype.concat,_t=Array.prototype.join,sy=Array.prototype.slice,el=Math.floor,Ao=typeof BigInt=="function"?BigInt.prototype.valueOf:null,Ki=Object.getOwnPropertySymbols,Co=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,wr=typeof Symbol=="function"&&typeof Symbol.iterator=="object",Ie=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===wr||"symbol")?Symbol.toStringTag:null,Qu=Object.prototype.propertyIsEnumerable,tl=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(n){return n.__proto__}:null);function rl(n,e){if(n===1/0||n===-1/0||n!==n||n&&n>-1e3&&n<1e3||Zu.call(/e/,e))return e;var t=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof n=="number"){var r=n<0?-el(-n):el(n);if(r!==n){var i=String(r),o=bs.call(e,i.length+1);return Tt.call(i,t,"$&_")+"."+Tt.call(Tt.call(o,/([0-9]{3})/g,"$&_"),/_$/,"")}}return Tt.call(e,t,"$&_")}var Fo=Zm,nl=Fo.custom,il=ec(nl)?nl:null,ay=function n(e,t,r,i){var o=t||{};if(Rt(o,"quoteStyle")&&o.quoteStyle!=="single"&&o.quoteStyle!=="double")throw new TypeError('option "quoteStyle" must be "single" or "double"');if(Rt(o,"maxStringLength")&&(typeof o.maxStringLength=="number"?o.maxStringLength<0&&o.maxStringLength!==1/0:o.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var s=Rt(o,"customInspect")?o.customInspect:!0;if(typeof s!="boolean"&&s!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(Rt(o,"indent")&&o.indent!==null&&o.indent!=="	"&&!(parseInt(o.indent,10)===o.indent&&o.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(Rt(o,"numericSeparator")&&typeof o.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var a=o.numericSeparator;if(typeof e>"u")return"undefined";if(e===null)return"null";if(typeof e=="boolean")return e?"true":"false";if(typeof e=="string")return rc(e,o);if(typeof e=="number"){if(e===0)return 1/0/e>0?"0":"-0";var l=String(e);return a?rl(e,l):l}if(typeof e=="bigint"){var f=String(e)+"n";return a?rl(e,f):f}var c=typeof o.depth>"u"?5:o.depth;if(typeof r>"u"&&(r=0),r>=c&&c>0&&typeof e=="object")return Oo(e)?"[Array]":"[Object]";var u=Ey(o,r);if(typeof i>"u")i=[];else if(tc(i,e)>=0)return"[Circular]";function h(O,U,ne){if(U&&(i=sy.call(i),i.push(U)),ne){var V={depth:o.depth};return Rt(o,"quoteStyle")&&(V.quoteStyle=o.quoteStyle),n(O,V,r+1,i)}return n(O,o,r+1,i)}if(typeof e=="function"&&!ol(e)){var p=my(e),g=En(e,h);return"[Function"+(p?": "+p:" (anonymous)")+"]"+(g.length>0?" { "+_t.call(g,", ")+" }":"")}if(ec(e)){var d=wr?Tt.call(String(e),/^(Symbol\(.*\))_[^)]*$/,"$1"):Co.call(e);return typeof e=="object"&&!wr?Ir(d):d}if($y(e)){for(var v="<"+Qa.call(String(e.nodeName)),_=e.attributes||[],y=0;y<_.length;y++)v+=" "+_[y].name+"="+xu(ly(_[y].value),"double",o);return v+=">",e.childNodes&&e.childNodes.length&&(v+="..."),v+="</"+Qa.call(String(e.nodeName))+">",v}if(Oo(e)){if(e.length===0)return"[]";var m=En(e,h);return u&&!ky(m)?"["+Ro(m,u)+"]":"[ "+_t.call(m,", ")+" ]"}if(uy(e)){var k=En(e,h);return!("cause"in Error.prototype)&&"cause"in e&&!Qu.call(e,"cause")?"{ ["+String(e)+"] "+_t.call(xa.call("[cause]: "+h(e.cause),k),", ")+" }":k.length===0?"["+String(e)+"]":"{ ["+String(e)+"] "+_t.call(k,", ")+" }"}if(typeof e=="object"&&s){if(il&&typeof e[il]=="function"&&Fo)return Fo(e,{depth:c-r});if(s!=="symbol"&&typeof e.inspect=="function")return e.inspect()}if(yy(e)){var b=[];return Va&&Va.call(e,function(O,U){b.push(h(U,e,!0)+" => "+h(O,e))}),sl("Map",gi.call(e),b,u)}if(by(e)){var P=[];return Ka&&Ka.call(e,function(O){P.push(h(O,e))}),sl("Set",di.call(e),P,u)}if(vy(e))return Zi("WeakMap");if(wy(e))return Zi("WeakSet");if(_y(e))return Zi("WeakRef");if(py(e))return Ir(h(Number(e)));if(gy(e))return Ir(h(Ao.call(e)));if(hy(e))return Ir(ty.call(e));if(cy(e))return Ir(h(String(e)));if(typeof window<"u"&&e===window)return"{ [object Window] }";if(typeof globalThis<"u"&&e===globalThis||typeof en<"u"&&e===en)return"{ [object globalThis] }";if(!fy(e)&&!ol(e)){var R=En(e,h),N=tl?tl(e)===Object.prototype:e instanceof Object||e.constructor===Object,q=e instanceof Object?"":"null prototype",T=!N&&Ie&&Object(e)===e&&Ie in e?bs.call(zt(e),8,-1):q?"Object":"",F=N||typeof e.constructor!="function"?"":e.constructor.name?e.constructor.name+" ":"",M=F+(T||q?"["+_t.call(xa.call([],T||[],q||[]),": ")+"] ":"");return R.length===0?M+"{}":u?M+"{"+Ro(R,u)+"}":M+"{ "+_t.call(R,", ")+" }"}return String(e)};function xu(n,e,t){var r=(t.quoteStyle||e)==="double"?'"':"'";return r+n+r}function ly(n){return Tt.call(String(n),/"/g,"&quot;")}function Oo(n){return zt(n)==="[object Array]"&&(!Ie||!(typeof n=="object"&&Ie in n))}function fy(n){return zt(n)==="[object Date]"&&(!Ie||!(typeof n=="object"&&Ie in n))}function ol(n){return zt(n)==="[object RegExp]"&&(!Ie||!(typeof n=="object"&&Ie in n))}function uy(n){return zt(n)==="[object Error]"&&(!Ie||!(typeof n=="object"&&Ie in n))}function cy(n){return zt(n)==="[object String]"&&(!Ie||!(typeof n=="object"&&Ie in n))}function py(n){return zt(n)==="[object Number]"&&(!Ie||!(typeof n=="object"&&Ie in n))}function hy(n){return zt(n)==="[object Boolean]"&&(!Ie||!(typeof n=="object"&&Ie in n))}function ec(n){if(wr)return n&&typeof n=="object"&&n instanceof Symbol;if(typeof n=="symbol")return!0;if(!n||typeof n!="object"||!Co)return!1;try{return Co.call(n),!0}catch{}return!1}function gy(n){if(!n||typeof n!="object"||!Ao)return!1;try{return Ao.call(n),!0}catch{}return!1}var dy=Object.prototype.hasOwnProperty||function(n){return n in this};function Rt(n,e){return dy.call(n,e)}function zt(n){return ry.call(n)}function my(n){if(n.name)return n.name;var e=iy.call(ny.call(n),/^function\s*([\w$]+)/);return e?e[1]:null}function tc(n,e){if(n.indexOf)return n.indexOf(e);for(var t=0,r=n.length;t<r;t++)if(n[t]===e)return t;return-1}function yy(n){if(!gi||!n||typeof n!="object")return!1;try{gi.call(n);try{di.call(n)}catch{return!0}return n instanceof Map}catch{}return!1}function vy(n){if(!Qr||!n||typeof n!="object")return!1;try{Qr.call(n,Qr);try{xr.call(n,xr)}catch{return!0}return n instanceof WeakMap}catch{}return!1}function _y(n){if(!Za||!n||typeof n!="object")return!1;try{return Za.call(n),!0}catch{}return!1}function by(n){if(!di||!n||typeof n!="object")return!1;try{di.call(n);try{gi.call(n)}catch{return!0}return n instanceof Set}catch{}return!1}function wy(n){if(!xr||!n||typeof n!="object")return!1;try{xr.call(n,xr);try{Qr.call(n,Qr)}catch{return!0}return n instanceof WeakSet}catch{}return!1}function $y(n){return!n||typeof n!="object"?!1:typeof HTMLElement<"u"&&n instanceof HTMLElement?!0:typeof n.nodeName=="string"&&typeof n.getAttribute=="function"}function rc(n,e){if(n.length>e.maxStringLength){var t=n.length-e.maxStringLength,r="... "+t+" more character"+(t>1?"s":"");return rc(bs.call(n,0,e.maxStringLength),e)+r}var i=Tt.call(Tt.call(n,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,Sy);return xu(i,"single",e)}function Sy(n){var e=n.charCodeAt(0),t={8:"b",9:"t",10:"n",12:"f",13:"r"}[e];return t?"\\"+t:"\\x"+(e<16?"0":"")+oy.call(e.toString(16))}function Ir(n){return"Object("+n+")"}function Zi(n){return n+" { ? }"}function sl(n,e,t,r){var i=r?Ro(t,r):_t.call(t,", ");return n+" ("+e+") {"+i+"}"}function ky(n){for(var e=0;e<n.length;e++)if(tc(n[e],`
`)>=0)return!1;return!0}function Ey(n,e){var t;if(n.indent==="	")t="	";else if(typeof n.indent=="number"&&n.indent>0)t=_t.call(Array(n.indent+1)," ");else return null;return{base:t,prev:_t.call(Array(e+1),t)}}function Ro(n,e){if(n.length===0)return"";var t=`
`+e.prev+e.base;return t+_t.call(n,","+t)+`
`+e.prev}function En(n,e){var t=Oo(n),r=[];if(t){r.length=n.length;for(var i=0;i<n.length;i++)r[i]=Rt(n,i)?e(n[i],n):""}var o=typeof Ki=="function"?Ki(n):[],s;if(wr){s={};for(var a=0;a<o.length;a++)s["$"+o[a]]=o[a]}for(var l in n)Rt(n,l)&&(t&&String(Number(l))===l&&l<n.length||wr&&s["$"+l]instanceof Symbol||(Zu.call(/[^\w$]/,l)?r.push(e(l,n)+": "+e(n[l],n)):r.push(l+": "+e(n[l],n))));if(typeof Ki=="function")for(var f=0;f<o.length;f++)Qu.call(n,o[f])&&r.push("["+e(o[f])+"]: "+e(n[o[f]],n));return r}var nc=kt,Fr=at,My=ay,Py=qt,Mn=nc("%WeakMap%",!0),Pn=nc("%Map%",!0),Ly=Fr("WeakMap.prototype.get",!0),Ay=Fr("WeakMap.prototype.set",!0),Cy=Fr("WeakMap.prototype.has",!0),Fy=Fr("Map.prototype.get",!0),Oy=Fr("Map.prototype.set",!0),Ry=Fr("Map.prototype.has",!0),ws=function(n,e){for(var t=n,r;(r=t.next)!==null;t=r)if(r.key===e)return t.next=r.next,r.next=n.next,n.next=r,r},By=function(n,e){var t=ws(n,e);return t&&t.value},Iy=function(n,e,t){var r=ws(n,e);r?r.value=t:n.next={key:e,next:n.next,value:t}},Ny=function(n,e){return!!ws(n,e)},ic=function(){var e,t,r,i={assert:function(o){if(!i.has(o))throw new Py("Side channel does not contain "+My(o))},get:function(o){if(Mn&&o&&(typeof o=="object"||typeof o=="function")){if(e)return Ly(e,o)}else if(Pn){if(t)return Fy(t,o)}else if(r)return By(r,o)},has:function(o){if(Mn&&o&&(typeof o=="object"||typeof o=="function")){if(e)return Cy(e,o)}else if(Pn){if(t)return Ry(t,o)}else if(r)return Ny(r,o);return!1},set:function(o,s){Mn&&o&&(typeof o=="object"||typeof o=="function")?(e||(e=new Mn),Ay(e,o,s)):Pn?(t||(t=new Pn),Oy(t,o,s)):(r||(r={key:{},next:null}),Iy(r,o,s))}};return i},Ty=Fu,Nr=ic(),Mt=qt,$s={assert:function(n,e){if(!n||typeof n!="object"&&typeof n!="function")throw new Mt("`O` is not an object");if(typeof e!="string")throw new Mt("`slot` must be a string");if(Nr.assert(n),!$s.has(n,e))throw new Mt("`"+e+"` is not present on `O`")},get:function(n,e){if(!n||typeof n!="object"&&typeof n!="function")throw new Mt("`O` is not an object");if(typeof e!="string")throw new Mt("`slot` must be a string");var t=Nr.get(n);return t&&t["$"+e]},has:function(n,e){if(!n||typeof n!="object"&&typeof n!="function")throw new Mt("`O` is not an object");if(typeof e!="string")throw new Mt("`slot` must be a string");var t=Nr.get(n);return!!t&&Ty(t,"$"+e)},set:function(n,e,t){if(!n||typeof n!="object"&&typeof n!="function")throw new Mt("`O` is not an object");if(typeof e!="string")throw new Mt("`slot` must be a string");var r=Nr.get(n);r||(r={},Nr.set(n,r)),r["$"+e]=t}};Object.freeze&&Object.freeze($s);var Gy=$s,Tr=Gy,Dy=SyntaxError,al=typeof StopIteration=="object"?StopIteration:null,jy=function(e){if(!al)throw new Dy("this environment lacks StopIteration");Tr.set(e,"[[Done]]",!1);var t={next:function(){var i=Tr.get(this,"[[Iterator]]"),o=Tr.get(i,"[[Done]]");try{return{done:o,value:o?void 0:i.next()}}catch(s){if(Tr.set(i,"[[Done]]",!0),s!==al)throw s;return{done:!0,value:void 0}}}};return Tr.set(t,"[[Iterator]]",e),t},Uy={}.toString,oc=Array.isArray||function(n){return Uy.call(n)=="[object Array]"},qy=String.prototype.valueOf,zy=function(e){try{return qy.call(e),!0}catch{return!1}},Wy=Object.prototype.toString,Hy="[object String]",Jy=rr(),sc=function(e){return typeof e=="string"?!0:typeof e!="object"?!1:Jy?zy(e):Wy.call(e)===Hy},Ss=typeof Map=="function"&&Map.prototype?Map:null,Yy=typeof Set=="function"&&Set.prototype?Set:null,mi;Ss||(mi=function(e){return!1});var ac=Ss?Map.prototype.has:null,ll=Yy?Set.prototype.has:null;!mi&&!ac&&(mi=function(e){return!1});var lc=mi||function(e){if(!e||typeof e!="object")return!1;try{if(ac.call(e),ll)try{ll.call(e)}catch{return!0}return e instanceof Ss}catch{}return!1},Xy=typeof Map=="function"&&Map.prototype?Map:null,ks=typeof Set=="function"&&Set.prototype?Set:null,yi;ks||(yi=function(e){return!1});var fl=Xy?Map.prototype.has:null,fc=ks?Set.prototype.has:null;!yi&&!fc&&(yi=function(e){return!1});var uc=yi||function(e){if(!e||typeof e!="object")return!1;try{if(fc.call(e),fl)try{fl.call(e)}catch{return!0}return e instanceof ks}catch{}return!1},ul=Ku,cl=jy;if(ps()||Oi()){var Qi=Symbol.iterator;Dn.exports=function(e){if(e!=null&&typeof e[Qi]<"u")return e[Qi]();if(ul(e))return Array.prototype[Qi].call(e)}}else{var Vy=oc,Ky=sc,pl=kt,Zy=pl("%Map%",!0),Qy=pl("%Set%",!0),lt=at,hl=lt("Array.prototype.push"),gl=lt("String.prototype.charCodeAt"),xy=lt("String.prototype.slice"),ev=function(e,t){var r=e.length;if(t+1>=r)return t+1;var i=gl(e,t);if(i<55296||i>56319)return t+1;var o=gl(e,t+1);return o<56320||o>57343?t+1:t+2},xi=function(e){var t=0;return{next:function(){var i=t>=e.length,o;return i||(o=e[t],t+=1),{done:i,value:o}}}},dl=function(e,t){if(Vy(e)||ul(e))return xi(e);if(Ky(e)){var r=0;return{next:function(){var o=ev(e,r),s=xy(e,r,o);return r=o,{done:o>e.length,value:s}}}}if(t&&typeof e["_es6-shim iterator_"]<"u")return e["_es6-shim iterator_"]()};if(!Zy&&!Qy)Dn.exports=function(e){if(e!=null)return dl(e,!0)};else{var tv=lc,rv=uc,ml=lt("Map.prototype.forEach",!0),yl=lt("Set.prototype.forEach",!0);if(typeof process>"u"||!process.versions||!process.versions.node)var vl=lt("Map.prototype.iterator",!0),_l=lt("Set.prototype.iterator",!0);var bl=lt("Map.prototype.@@iterator",!0)||lt("Map.prototype._es6-shim iterator_",!0),wl=lt("Set.prototype.@@iterator",!0)||lt("Set.prototype._es6-shim iterator_",!0),nv=function(e){if(tv(e)){if(vl)return cl(vl(e));if(bl)return bl(e);if(ml){var t=[];return ml(e,function(i,o){hl(t,[o,i])}),xi(t)}}if(rv(e)){if(_l)return cl(_l(e));if(wl)return wl(e);if(yl){var r=[];return yl(e,function(i){hl(r,i)}),xi(r)}}};Dn.exports=function(e){return nv(e)||dl(e)}}}var iv=Dn.exports,$l=function(n){return n!==n},cc=function(e,t){return e===0&&t===0?1/e===1/t:!!(e===t||$l(e)&&$l(t))},ov=cc,pc=function(){return typeof Object.is=="function"?Object.is:ov},sv=pc,av=tr,lv=function(){var e=sv();return av(Object,{is:e},{is:function(){return Object.is!==e}}),e},fv=tr,uv=Cr,cv=cc,hc=pc,pv=lv,gc=uv(hc(),Object);fv(gc,{getPolyfill:hc,implementation:cv,shim:pv});var hv=gc,gv=Cr,dc=at,dv=kt,Bo=dv("%ArrayBuffer%",!0),jn=dc("ArrayBuffer.prototype.byteLength",!0),mv=dc("Object.prototype.toString"),Sl=!!Bo&&!jn&&new Bo(0).slice,kl=!!Sl&&gv(Sl),mc=jn||kl?function(e){if(!e||typeof e!="object")return!1;try{return jn?jn(e):kl(e,0),!0}catch{return!1}}:Bo?function(e){return mv(e)==="[object ArrayBuffer]"}:function(e){return!1},yv=Date.prototype.getDay,vv=function(e){try{return yv.call(e),!0}catch{return!1}},_v=Object.prototype.toString,bv="[object Date]",wv=rr(),$v=function(e){return typeof e!="object"||e===null?!1:wv?vv(e):_v.call(e)===bv},Io=at,yc=rr(),vc,_c,No,To;if(yc){vc=Io("Object.prototype.hasOwnProperty"),_c=Io("RegExp.prototype.exec"),No={};var eo=function(){throw No};To={toString:eo,valueOf:eo},typeof Symbol.toPrimitive=="symbol"&&(To[Symbol.toPrimitive]=eo)}var Sv=Io("Object.prototype.toString"),kv=Object.getOwnPropertyDescriptor,Ev="[object RegExp]",Mv=yc?function(e){if(!e||typeof e!="object")return!1;var t=kv(e,"lastIndex"),r=t&&vc(t,"value");if(!r)return!1;try{_c(e,To)}catch(i){return i===No}}:function(e){return!e||typeof e!="object"&&typeof e!="function"?!1:Sv(e)===Ev},Pv=at,El=Pv("SharedArrayBuffer.prototype.byteLength",!0),Lv=El?function(e){if(!e||typeof e!="object")return!1;try{return El(e),!0}catch{return!1}}:function(e){return!1},Av=Number.prototype.toString,Cv=function(e){try{return Av.call(e),!0}catch{return!1}},Fv=Object.prototype.toString,Ov="[object Number]",Rv=rr(),Bv=function(e){return typeof e=="number"?!0:typeof e!="object"?!1:Rv?Cv(e):Fv.call(e)===Ov},bc=at,Iv=bc("Boolean.prototype.toString"),Nv=bc("Object.prototype.toString"),Tv=function(e){try{return Iv(e),!0}catch{return!1}},Gv="[object Boolean]",Dv=rr(),jv=function(e){return typeof e=="boolean"?!0:e===null||typeof e!="object"?!1:Dv&&Symbol.toStringTag in e?Tv(e):Nv(e)===Gv},Go={exports:{}},Uv=Object.prototype.toString,qv=ps();if(qv){var zv=Symbol.prototype.toString,Wv=/^Symbol\(.*\)$/,Hv=function(e){return typeof e.valueOf()!="symbol"?!1:Wv.test(zv.call(e))};Go.exports=function(e){if(typeof e=="symbol")return!0;if(Uv.call(e)!=="[object Symbol]")return!1;try{return Hv(e)}catch{return!1}}}else Go.exports=function(e){return!1};var Jv=Go.exports,Do={exports:{}},Ml=typeof BigInt<"u"&&BigInt,Yv=function(){return typeof Ml=="function"&&typeof BigInt=="function"&&typeof Ml(42)=="bigint"&&typeof BigInt(42)=="bigint"},Xv=Yv();if(Xv){var Vv=BigInt.prototype.valueOf,Kv=function(e){try{return Vv.call(e),!0}catch{}return!1};Do.exports=function(e){return e===null||typeof e>"u"||typeof e=="boolean"||typeof e=="string"||typeof e=="number"||typeof e=="symbol"||typeof e=="function"?!1:typeof e=="bigint"?!0:Kv(e)}}else Do.exports=function(e){return!1};var Zv=Do.exports,Qv=sc,xv=Bv,e_=jv,t_=Jv,r_=Zv,n_=function(e){if(e==null||typeof e!="object"&&typeof e!="function")return null;if(Qv(e))return"String";if(xv(e))return"Number";if(e_(e))return"Boolean";if(t_(e))return"Symbol";if(r_(e))return"BigInt"},vi=typeof WeakMap=="function"&&WeakMap.prototype?WeakMap:null,Pl=typeof WeakSet=="function"&&WeakSet.prototype?WeakSet:null,_i;vi||(_i=function(e){return!1});var jo=vi?vi.prototype.has:null,to=Pl?Pl.prototype.has:null;!_i&&!jo&&(_i=function(e){return!1});var i_=_i||function(e){if(!e||typeof e!="object")return!1;try{if(jo.call(e,jo),to)try{to.call(e,to)}catch{return!0}return e instanceof vi}catch{}return!1},Uo={exports:{}},o_=kt,wc=at,s_=o_("%WeakSet%",!0),ro=wc("WeakSet.prototype.has",!0);if(ro){var no=wc("WeakMap.prototype.has",!0);Uo.exports=function(e){if(!e||typeof e!="object")return!1;try{if(ro(e,ro),no)try{no(e,no)}catch{return!0}return e instanceof s_}catch{}return!1}}else Uo.exports=function(e){return!1};var a_=Uo.exports,l_=lc,f_=uc,u_=i_,c_=a_,p_=function(e){if(e&&typeof e=="object"){if(l_(e))return"Map";if(f_(e))return"Set";if(u_(e))return"WeakMap";if(c_(e))return"WeakSet"}return!1},$c=Function.prototype.toString,ur=typeof Reflect=="object"&&Reflect!==null&&Reflect.apply,qo,Un;if(typeof ur=="function"&&typeof Object.defineProperty=="function")try{qo=Object.defineProperty({},"length",{get:function(){throw Un}}),Un={},ur(function(){throw 42},null,qo)}catch(n){n!==Un&&(ur=null)}else ur=null;var h_=/^\s*class\b/,zo=function(e){try{var t=$c.call(e);return h_.test(t)}catch{return!1}},io=function(e){try{return zo(e)?!1:($c.call(e),!0)}catch{return!1}},qn=Object.prototype.toString,g_="[object Object]",d_="[object Function]",m_="[object GeneratorFunction]",y_="[object HTMLAllCollection]",v_="[object HTML document.all class]",__="[object HTMLCollection]",b_=typeof Symbol=="function"&&!!Symbol.toStringTag,w_=!(0 in[,]),Wo=function(){return!1};if(typeof document=="object"){var $_=document.all;qn.call($_)===qn.call(document.all)&&(Wo=function(e){if((w_||!e)&&(typeof e>"u"||typeof e=="object"))try{var t=qn.call(e);return(t===y_||t===v_||t===__||t===g_)&&e("")==null}catch{}return!1})}var S_=ur?function(e){if(Wo(e))return!0;if(!e||typeof e!="function"&&typeof e!="object")return!1;try{ur(e,null,qo)}catch(t){if(t!==Un)return!1}return!zo(e)&&io(e)}:function(e){if(Wo(e))return!0;if(!e||typeof e!="function"&&typeof e!="object")return!1;if(b_)return io(e);if(zo(e))return!1;var t=qn.call(e);return t!==d_&&t!==m_&&!/^\[object HTML/.test(t)?!1:io(e)},k_=S_,E_=Object.prototype.toString,Sc=Object.prototype.hasOwnProperty,M_=function(e,t,r){for(var i=0,o=e.length;i<o;i++)Sc.call(e,i)&&(r==null?t(e[i],i,e):t.call(r,e[i],i,e))},P_=function(e,t,r){for(var i=0,o=e.length;i<o;i++)r==null?t(e.charAt(i),i,e):t.call(r,e.charAt(i),i,e)},L_=function(e,t,r){for(var i in e)Sc.call(e,i)&&(r==null?t(e[i],i,e):t.call(r,e[i],i,e))},A_=function(e,t,r){if(!k_(t))throw new TypeError("iterator must be a function");var i;arguments.length>=3&&(i=r),E_.call(e)==="[object Array]"?M_(e,t,i):typeof e=="string"?P_(e,t,i):L_(e,t,i)},C_=A_,F_=["Float32Array","Float64Array","Int8Array","Int16Array","Int32Array","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","BigInt64Array","BigUint64Array"],oo=F_,O_=typeof globalThis>"u"?en:globalThis,R_=function(){for(var e=[],t=0;t<oo.length;t++)typeof O_[oo[t]]=="function"&&(e[e.length]=oo[t]);return e},bi=C_,B_=R_,Ll=Cr,Es=at,zn=ds,I_=Es("Object.prototype.toString"),kc=rr(),Al=typeof globalThis>"u"?en:globalThis,Ho=B_(),Ms=Es("String.prototype.slice"),so=Object.getPrototypeOf,N_=Es("Array.prototype.indexOf",!0)||function(e,t){for(var r=0;r<e.length;r+=1)if(e[r]===t)return r;return-1},wi={__proto__:null};kc&&zn&&so?bi(Ho,function(n){var e=new Al[n];if(Symbol.toStringTag in e){var t=so(e),r=zn(t,Symbol.toStringTag);if(!r){var i=so(t);r=zn(i,Symbol.toStringTag)}wi["$"+n]=Ll(r.get)}}):bi(Ho,function(n){var e=new Al[n],t=e.slice||e.set;t&&(wi["$"+n]=Ll(t))});var T_=function(e){var t=!1;return bi(wi,function(r,i){if(!t)try{"$"+r(e)===i&&(t=Ms(i,1))}catch{}}),t},G_=function(e){var t=!1;return bi(wi,function(r,i){if(!t)try{r(e),t=Ms(i,1)}catch{}}),t},D_=function(e){if(!e||typeof e!="object")return!1;if(!kc){var t=Ms(I_(e),8,-1);return N_(Ho,t)>-1?t:t!=="Object"?!1:G_(e)}return zn?T_(e):null},j_=at,Cl=j_("ArrayBuffer.prototype.byteLength",!0),U_=mc,q_=function(e){return U_(e)?Cl?Cl(e):e.byteLength:NaN},Ec=bm,Et=at,Fl=Wm,z_=kt,$r=iv,W_=ic,Ol=hv,Rl=Ku,Bl=oc,Il=mc,Nl=$v,Tl=Mv,Gl=Lv,Dl=cs,jl=n_,Ul=p_,ql=D_,zl=q_,Wl=Et("SharedArrayBuffer.prototype.byteLength",!0),Hl=Et("Date.prototype.getTime"),ao=Object.getPrototypeOf,Jl=Et("Object.prototype.toString"),$i=z_("%Set%",!0),Jo=Et("Map.prototype.has",!0),Si=Et("Map.prototype.get",!0),Yl=Et("Map.prototype.size",!0),ki=Et("Set.prototype.add",!0),Mc=Et("Set.prototype.delete",!0),Ei=Et("Set.prototype.has",!0),Wn=Et("Set.prototype.size",!0);function Xl(n,e,t,r){for(var i=$r(n),o;(o=i.next())&&!o.done;)if(dt(e,o.value,t,r))return Mc(n,o.value),!0;return!1}function Pc(n){if(typeof n>"u")return null;if(typeof n!="object")return typeof n=="symbol"?!1:typeof n=="string"||typeof n=="number"?+n==+n:!0}function H_(n,e,t,r,i,o){var s=Pc(t);if(s!=null)return s;var a=Si(e,s),l=Ec({},i,{strict:!1});return typeof a>"u"&&!Jo(e,s)||!dt(r,a,l,o)?!1:!Jo(n,s)&&dt(r,a,l,o)}function J_(n,e,t){var r=Pc(t);return r??(Ei(e,r)&&!Ei(n,r))}function Vl(n,e,t,r,i,o){for(var s=$r(n),a,l;(a=s.next())&&!a.done;)if(l=a.value,dt(t,l,i,o)&&dt(r,Si(e,l),i,o))return Mc(n,l),!0;return!1}function dt(n,e,t,r){var i=t||{};if(i.strict?Ol(n,e):n===e)return!0;var o=jl(n),s=jl(e);if(o!==s)return!1;if(!n||!e||typeof n!="object"&&typeof e!="object")return i.strict?Ol(n,e):n==e;var a=r.has(n),l=r.has(e),f;if(a&&l){if(r.get(n)===r.get(e))return!0}else f={};return a||r.set(n,f),l||r.set(e,f),V_(n,e,i,r)}function Kl(n){return!n||typeof n!="object"||typeof n.length!="number"||typeof n.copy!="function"||typeof n.slice!="function"||n.length>0&&typeof n[0]!="number"?!1:!!(n.constructor&&n.constructor.isBuffer&&n.constructor.isBuffer(n))}function Y_(n,e,t,r){if(Wn(n)!==Wn(e))return!1;for(var i=$r(n),o=$r(e),s,a,l;(s=i.next())&&!s.done;)if(s.value&&typeof s.value=="object")l||(l=new $i),ki(l,s.value);else if(!Ei(e,s.value)){if(t.strict||!J_(n,e,s.value))return!1;l||(l=new $i),ki(l,s.value)}if(l){for(;(a=o.next())&&!a.done;)if(a.value&&typeof a.value=="object"){if(!Xl(l,a.value,t.strict,r))return!1}else if(!t.strict&&!Ei(n,a.value)&&!Xl(l,a.value,t.strict,r))return!1;return Wn(l)===0}return!0}function X_(n,e,t,r){if(Yl(n)!==Yl(e))return!1;for(var i=$r(n),o=$r(e),s,a,l,f,c,u;(s=i.next())&&!s.done;)if(f=s.value[0],c=s.value[1],f&&typeof f=="object")l||(l=new $i),ki(l,f);else if(u=Si(e,f),typeof u>"u"&&!Jo(e,f)||!dt(c,u,t,r)){if(t.strict||!H_(n,e,f,c,t,r))return!1;l||(l=new $i),ki(l,f)}if(l){for(;(a=o.next())&&!a.done;)if(f=a.value[0],u=a.value[1],f&&typeof f=="object"){if(!Vl(l,n,f,u,t,r))return!1}else if(!t.strict&&(!n.has(f)||!dt(Si(n,f),u,t,r))&&!Vl(l,n,f,u,Ec({},t,{strict:!1}),r))return!1;return Wn(l)===0}return!0}function V_(n,e,t,r){var i,o;if(typeof n!=typeof e||n==null||e==null||Jl(n)!==Jl(e)||Rl(n)!==Rl(e))return!1;var s=Bl(n),a=Bl(e);if(s!==a)return!1;var l=n instanceof Error,f=e instanceof Error;if(l!==f||(l||f)&&(n.name!==e.name||n.message!==e.message))return!1;var c=Tl(n),u=Tl(e);if(c!==u||(c||u)&&(n.source!==e.source||Fl(n)!==Fl(e)))return!1;var h=Nl(n),p=Nl(e);if(h!==p||(h||p)&&Hl(n)!==Hl(e)||t.strict&&ao&&ao(n)!==ao(e))return!1;var g=ql(n),d=ql(e);if(g!==d)return!1;if(g||d){if(n.length!==e.length)return!1;for(i=0;i<n.length;i++)if(n[i]!==e[i])return!1;return!0}var v=Kl(n),_=Kl(e);if(v!==_)return!1;if(v||_){if(n.length!==e.length)return!1;for(i=0;i<n.length;i++)if(n[i]!==e[i])return!1;return!0}var y=Il(n),m=Il(e);if(y!==m)return!1;if(y||m)return zl(n)!==zl(e)?!1:typeof Uint8Array=="function"&&dt(new Uint8Array(n),new Uint8Array(e),t,r);var k=Gl(n),b=Gl(e);if(k!==b)return!1;if(k||b)return Wl(n)!==Wl(e)?!1:typeof Uint8Array=="function"&&dt(new Uint8Array(n),new Uint8Array(e),t,r);if(typeof n!=typeof e)return!1;var P=Dl(n),R=Dl(e);if(P.length!==R.length)return!1;for(P.sort(),R.sort(),i=P.length-1;i>=0;i--)if(P[i]!=R[i])return!1;for(i=P.length-1;i>=0;i--)if(o=P[i],!dt(n[o],e[o],t,r))return!1;var N=Ul(n),q=Ul(e);return N!==q?!1:N==="Set"||q==="Set"?Y_(n,e,t,r):N==="Map"?X_(n,e,t,r):!0}var K_=function(e,t,r){return dt(e,t,r,W_())};const Z_=Yf(K_);var Q_=Object.defineProperty,pe=(n,e)=>Q_(n,"name",{value:e,configurable:!0}),x_=class{constructor(e){this.direction=!1,this.compareProperties=!0;var t,r,i;this.precision=10**-((t=e==null?void 0:e.precision)!=null?t:17),this.direction=(r=e==null?void 0:e.direction)!=null?r:!1,this.compareProperties=(i=e==null?void 0:e.compareProperties)!=null?i:!0}compare(e,t){if(e.type!==t.type||!zr(e,t))return!1;switch(e.type){case"Point":return this.compareCoord(e.coordinates,t.coordinates);case"LineString":return this.compareLine(e.coordinates,t.coordinates);case"Polygon":return this.comparePolygon(e,t);case"GeometryCollection":return this.compareGeometryCollection(e,t);case"Feature":return this.compareFeature(e,t);case"FeatureCollection":return this.compareFeatureCollection(e,t);default:if(e.type.startsWith("Multi")){const r=Yo(e),i=Yo(t);return r.every(o=>i.some(s=>this.compare(o,s)))}}return!1}compareCoord(e,t){return e.length===t.length&&e.every((r,i)=>Math.abs(r-t[i])<this.precision)}compareLine(e,t,r=0,i=!1){if(!zr(e,t))return!1;const o=e;let s=t;if(i&&!this.compareCoord(o[0],s[0])){const l=this.fixStartIndex(s,o);if(l)s=l;else return!1}const a=this.compareCoord(o[r],s[r]);return this.direction||a?this.comparePath(o,s):this.compareCoord(o[r],s[s.length-(1+r)])?this.comparePath(o.slice().reverse(),s):!1}fixStartIndex(e,t){let r,i=-1;for(let o=0;o<e.length;o++)if(this.compareCoord(e[o],t[0])){i=o;break}return i>=0&&(r=[].concat(e.slice(i,e.length),e.slice(1,i+1))),r}comparePath(e,t){return e.every((r,i)=>this.compareCoord(r,t[i]))}comparePolygon(e,t){if(this.compareLine(e.coordinates[0],t.coordinates[0],1,!0)){const r=e.coordinates.slice(1,e.coordinates.length),i=t.coordinates.slice(1,t.coordinates.length);return r.every(o=>i.some(s=>this.compareLine(o,s,1,!0)))}return!1}compareGeometryCollection(e,t){return zr(e.geometries,t.geometries)&&this.compareBBox(e,t)&&e.geometries.every((r,i)=>this.compare(r,t.geometries[i]))}compareFeature(e,t){return e.id===t.id&&(this.compareProperties?Z_(e.properties,t.properties):!0)&&this.compareBBox(e,t)&&this.compare(e.geometry,t.geometry)}compareFeatureCollection(e,t){return zr(e.features,t.features)&&this.compareBBox(e,t)&&e.features.every((r,i)=>this.compare(r,t.features[i]))}compareBBox(e,t){return!e.bbox&&!t.bbox||(e.bbox&&t.bbox?this.compareCoord(e.bbox,t.bbox):!1)}};pe(x_,"GeojsonEquality");function zr(n,e){return n.coordinates?n.coordinates.length===e.coordinates.length:n.length===e.length}pe(zr,"sameLength");function Yo(n){return n.coordinates.map(e=>({type:n.type.replace("Multi",""),coordinates:e}))}pe(Yo,"explode");var Qe=63710088e-1,Lc={centimeters:Qe*100,centimetres:Qe*100,degrees:360/(2*Math.PI),feet:Qe*3.28084,inches:Qe*39.37,kilometers:Qe/1e3,kilometres:Qe/1e3,meters:Qe,metres:Qe,miles:Qe/1609.344,millimeters:Qe*1e3,millimetres:Qe*1e3,nauticalmiles:Qe/1852,radians:1,yards:Qe*1.0936},Zl={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,nauticalmiles:29155334959812285e-23,millimeters:1e6,millimetres:1e6,yards:1.195990046};function st(n,e,t={}){const r={type:"Feature"};return(t.id===0||t.id)&&(r.id=t.id),t.bbox&&(r.bbox=t.bbox),r.properties=e||{},r.geometry=n,r}pe(st,"feature");function e0(n,e,t={}){switch(n){case"Point":return Ze(e).geometry;case"LineString":return ht(e).geometry;case"Polygon":return Bi(e).geometry;case"MultiPoint":return Cc(e).geometry;case"MultiLineString":return Ac(e).geometry;case"MultiPolygon":return Ps(e).geometry;default:throw new Error(n+" is invalid")}}pe(e0,"geometry");function Ze(n,e,t={}){if(!n)throw new Error("coordinates is required");if(!Array.isArray(n))throw new Error("coordinates must be an Array");if(n.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!kr(n[0])||!kr(n[1]))throw new Error("coordinates must contain numbers");return st({type:"Point",coordinates:n},e,t)}pe(Ze,"point");function t0(n,e,t={}){return Sr(n.map(r=>Ze(r,e)),t)}pe(t0,"points");function Bi(n,e,t={}){for(const i of n){if(i.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(i[i.length-1].length!==i[0].length)throw new Error("First and last Position are not equivalent.");for(let o=0;o<i[i.length-1].length;o++)if(i[i.length-1][o]!==i[0][o])throw new Error("First and last Position are not equivalent.")}return st({type:"Polygon",coordinates:n},e,t)}pe(Bi,"polygon");function r0(n,e,t={}){return Sr(n.map(r=>Bi(r,e)),t)}pe(r0,"polygons");function ht(n,e,t={}){if(n.length<2)throw new Error("coordinates must be an array of two or more positions");return st({type:"LineString",coordinates:n},e,t)}pe(ht,"lineString");function n0(n,e,t={}){return Sr(n.map(r=>ht(r,e)),t)}pe(n0,"lineStrings");function Sr(n,e={}){const t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=n,t}pe(Sr,"featureCollection");function Ac(n,e,t={}){return st({type:"MultiLineString",coordinates:n},e,t)}pe(Ac,"multiLineString");function Cc(n,e,t={}){return st({type:"MultiPoint",coordinates:n},e,t)}pe(Cc,"multiPoint");function Ps(n,e,t={}){return st({type:"MultiPolygon",coordinates:n},e,t)}pe(Ps,"multiPolygon");function i0(n,e,t={}){return st({type:"GeometryCollection",geometries:n},e,t)}pe(i0,"geometryCollection");function o0(n,e=0){if(e&&!(e>=0))throw new Error("precision must be a positive number");const t=Math.pow(10,e||0);return Math.round(n*t)/t}pe(o0,"round");function Ls(n,e="kilometers"){const t=Lc[e];if(!t)throw new Error(e+" units is invalid");return n*t}pe(Ls,"radiansToLength");function Ii(n,e="kilometers"){const t=Lc[e];if(!t)throw new Error(e+" units is invalid");return n/t}pe(Ii,"lengthToRadians");function s0(n,e){return fn(Ii(n,e))}pe(s0,"lengthToDegrees");function a0(n){let e=n%360;return e<0&&(e+=360),e}pe(a0,"bearingToAzimuth");function fn(n){return n%(2*Math.PI)*180/Math.PI}pe(fn,"radiansToDegrees");function it(n){return n%360*Math.PI/180}pe(it,"degreesToRadians");function l0(n,e="kilometers",t="kilometers"){if(!(n>=0))throw new Error("length must be a positive number");return Ls(Ii(n,e),t)}pe(l0,"convertLength");function f0(n,e="meters",t="kilometers"){if(!(n>=0))throw new Error("area must be a positive number");const r=Zl[e];if(!r)throw new Error("invalid original units");const i=Zl[t];if(!i)throw new Error("invalid final units");return n/r*i}pe(f0,"convertArea");function kr(n){return!isNaN(n)&&n!==null&&!Array.isArray(n)}pe(kr,"isNumber");function As(n){return n!==null&&typeof n=="object"&&!Array.isArray(n)}pe(As,"isObject");function u0(n){if(!n)throw new Error("bbox is required");if(!Array.isArray(n))throw new Error("bbox must be an Array");if(n.length!==4&&n.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");n.forEach(e=>{if(!kr(e))throw new Error("bbox must only contain numbers")})}pe(u0,"validateBBox");function c0(n){if(!n)throw new Error("id is required");if(["string","number"].indexOf(typeof n)===-1)throw new Error("id must be a number or a string")}pe(c0,"validateId");/**
 * splaytree v3.1.2
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function p0(n,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(f){return function(c){return l([f,c])}}function l(f){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,i&&(o=f[0]&2?i.return:f[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,f[1])).done)return o;switch(i=0,o&&(f=[f[0]&2,o.value]),f[0]){case 0:case 1:o=f;break;case 4:return t.label++,{value:f[1],done:!1};case 5:t.label++,i=f[1],f=[0];continue;case 7:f=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(f[0]===6||f[0]===2)){t=0;continue}if(f[0]===3&&(!o||f[1]>o[0]&&f[1]<o[3])){t.label=f[1];break}if(f[0]===6&&t.label<o[1]){t.label=o[1],o=f;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(f);break}o[2]&&t.ops.pop(),t.trys.pop();continue}f=e.call(n,t)}catch(c){f=[6,c],i=0}finally{r=o=0}if(f[0]&5)throw f[1];return{value:f[0]?f[1]:void 0,done:!0}}}var jt=function(){function n(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null}return n}();function h0(n,e){return n>e?1:n<e?-1:0}function Bt(n,e,t){for(var r=new jt(null,null),i=r,o=r;;){var s=t(n,e.key);if(s<0){if(e.left===null)break;if(t(n,e.left.key)<0){var a=e.left;if(e.left=a.right,a.right=e,e=a,e.left===null)break}o.left=e,o=e,e=e.left}else if(s>0){if(e.right===null)break;if(t(n,e.right.key)>0){var a=e.right;if(e.right=a.left,a.left=e,e=a,e.right===null)break}i.right=e,i=e,e=e.right}else break}return i.right=e.left,o.left=e.right,e.left=r.right,e.right=r.left,e}function lo(n,e,t,r){var i=new jt(n,e);if(t===null)return i.left=i.right=null,i;t=Bt(n,t,r);var o=r(n,t.key);return o<0?(i.left=t.left,i.right=t,t.left=null):o>=0&&(i.right=t.right,i.left=t,t.right=null),i}function Ql(n,e,t){var r=null,i=null;if(e){e=Bt(n,e,t);var o=t(e.key,n);o===0?(r=e.left,i=e.right):o<0?(i=e.right,e.right=null,r=e):(r=e.left,e.left=null,i=e)}return{left:r,right:i}}function g0(n,e,t){return e===null?n:(n===null||(e=Bt(n.key,e,t),e.left=n),e)}function Xo(n,e,t,r,i){if(n){r(""+e+(t?" ":" ")+i(n)+`
`);var o=e+(t?"    ":"   ");n.left&&Xo(n.left,o,!1,r,i),n.right&&Xo(n.right,o,!0,r,i)}}var Cs=function(){function n(e){e===void 0&&(e=h0),this._root=null,this._size=0,this._comparator=e}return n.prototype.insert=function(e,t){return this._size++,this._root=lo(e,t,this._root,this._comparator)},n.prototype.add=function(e,t){var r=new jt(e,t);this._root===null&&(r.left=r.right=null,this._size++,this._root=r);var i=this._comparator,o=Bt(e,this._root,i),s=i(e,o.key);return s===0?this._root=o:(s<0?(r.left=o.left,r.right=o,o.left=null):s>0&&(r.right=o.right,r.left=o,o.right=null),this._size++,this._root=r),this._root},n.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},n.prototype._remove=function(e,t,r){var i;if(t===null)return null;t=Bt(e,t,r);var o=r(e,t.key);return o===0?(t.left===null?i=t.right:(i=Bt(e,t.left,r),i.right=t.right),this._size--,i):t},n.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=Bt(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},n.prototype.findStatic=function(e){for(var t=this._root,r=this._comparator;t;){var i=r(e,t.key);if(i===0)return t;i<0?t=t.left:t=t.right}return null},n.prototype.find=function(e){return this._root&&(this._root=Bt(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},n.prototype.contains=function(e){for(var t=this._root,r=this._comparator;t;){var i=r(e,t.key);if(i===0)return!0;i<0?t=t.left:t=t.right}return!1},n.prototype.forEach=function(e,t){for(var r=this._root,i=[],o=!1;!o;)r!==null?(i.push(r),r=r.left):i.length!==0?(r=i.pop(),e.call(t,r),r=r.right):o=!0;return this},n.prototype.range=function(e,t,r,i){for(var o=[],s=this._comparator,a=this._root,l;o.length!==0||a;)if(a)o.push(a),a=a.left;else{if(a=o.pop(),l=s(a.key,t),l>0)break;if(s(a.key,e)>=0&&r.call(i,a))return this;a=a.right}return this},n.prototype.keys=function(){var e=[];return this.forEach(function(t){var r=t.key;return e.push(r)}),e},n.prototype.values=function(){var e=[];return this.forEach(function(t){var r=t.data;return e.push(r)}),e},n.prototype.min=function(){return this._root?this.minNode(this._root).key:null},n.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},n.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},n.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},n.prototype.at=function(e){for(var t=this._root,r=!1,i=0,o=[];!r;)if(t)o.push(t),t=t.left;else if(o.length>0){if(t=o.pop(),i===e)return t;i++,t=t.right}else r=!0;return null},n.prototype.next=function(e){var t=this._root,r=null;if(e.right){for(r=e.right;r.left;)r=r.left;return r}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?(r=t,t=t.left):t=t.right}return r},n.prototype.prev=function(e){var t=this._root,r=null;if(e.left!==null){for(r=e.left;r.right;)r=r.right;return r}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?t=t.left:(r=t,t=t.right)}return r},n.prototype.clear=function(){return this._root=null,this._size=0,this},n.prototype.toList=function(){return m0(this._root)},n.prototype.load=function(e,t,r){t===void 0&&(t=[]),r===void 0&&(r=!1);var i=e.length,o=this._comparator;if(r&&Zo(e,t,0,i-1,o),this._root===null)this._root=Vo(e,t,0,i),this._size=i;else{var s=y0(this.toList(),d0(e,t),o);i=this._size+i,this._root=Ko({head:s},0,i)}return this},n.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(n.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),n.prototype.toString=function(e){e===void 0&&(e=function(r){return String(r.key)});var t=[];return Xo(this._root,"",!0,function(r){return t.push(r)},e),t.join("")},n.prototype.update=function(e,t,r){var i=this._comparator,o=Ql(e,this._root,i),s=o.left,a=o.right;i(e,t)<0?a=lo(t,r,a,i):s=lo(t,r,s,i),this._root=g0(s,a,i)},n.prototype.split=function(e){return Ql(e,this._root,this._comparator)},n.prototype[Symbol.iterator]=function(){var e,t,r;return p0(this,function(i){switch(i.label){case 0:e=this._root,t=[],r=!1,i.label=1;case 1:return r?[3,6]:e===null?[3,2]:(t.push(e),e=e.left,[3,5]);case 2:return t.length===0?[3,4]:(e=t.pop(),[4,e]);case 3:return i.sent(),e=e.right,[3,5];case 4:r=!0,i.label=5;case 5:return[3,1];case 6:return[2]}})},n}();function Vo(n,e,t,r){var i=r-t;if(i>0){var o=t+Math.floor(i/2),s=n[o],a=e[o],l=new jt(s,a);return l.left=Vo(n,e,t,o),l.right=Vo(n,e,o+1,r),l}return null}function d0(n,e){for(var t=new jt(null,null),r=t,i=0;i<n.length;i++)r=r.next=new jt(n[i],e[i]);return r.next=null,t.next}function m0(n){for(var e=n,t=[],r=!1,i=new jt(null,null),o=i;!r;)e?(t.push(e),e=e.left):t.length>0?(e=o=o.next=t.pop(),e=e.right):r=!0;return o.next=null,i.next}function Ko(n,e,t){var r=t-e;if(r>0){var i=e+Math.floor(r/2),o=Ko(n,e,i),s=n.head;return s.left=o,n.head=n.head.next,s.right=Ko(n,i+1,t),s}return null}function y0(n,e,t){for(var r=new jt(null,null),i=r,o=n,s=e;o!==null&&s!==null;)t(o.key,s.key)<0?(i.next=o,o=o.next):(i.next=s,s=s.next),i=i.next;return o!==null?i.next=o:s!==null&&(i.next=s),r.next}function Zo(n,e,t,r,i){if(!(t>=r)){for(var o=n[t+r>>1],s=t-1,a=r+1;;){do s++;while(i(n[s],o)<0);do a--;while(i(n[a],o)>0);if(s>=a)break;var l=n[s];n[s]=n[a],n[a]=l,l=e[s],e[s]=e[a],e[a]=l}Zo(n,e,t,a,i),Zo(n,e,a+1,r,i)}}const Lt=11102230246251565e-32,Fe=134217729,v0=(3+8*Lt)*Lt;function fo(n,e,t,r,i){let o,s,a,l,f=e[0],c=r[0],u=0,h=0;c>f==c>-f?(o=f,f=e[++u]):(o=c,c=r[++h]);let p=0;if(u<n&&h<t)for(c>f==c>-f?(s=f+o,a=o-(s-f),f=e[++u]):(s=c+o,a=o-(s-c),c=r[++h]),o=s,a!==0&&(i[p++]=a);u<n&&h<t;)c>f==c>-f?(s=o+f,l=s-o,a=o-(s-l)+(f-l),f=e[++u]):(s=o+c,l=s-o,a=o-(s-l)+(c-l),c=r[++h]),o=s,a!==0&&(i[p++]=a);for(;u<n;)s=o+f,l=s-o,a=o-(s-l)+(f-l),f=e[++u],o=s,a!==0&&(i[p++]=a);for(;h<t;)s=o+c,l=s-o,a=o-(s-l)+(c-l),c=r[++h],o=s,a!==0&&(i[p++]=a);return(o!==0||p===0)&&(i[p++]=o),p}function _0(n,e){let t=e[0];for(let r=1;r<n;r++)t+=e[r];return t}function _n(n){return new Float64Array(n)}const b0=(3+16*Lt)*Lt,w0=(2+12*Lt)*Lt,$0=(9+64*Lt)*Lt*Lt,ar=_n(4),xl=_n(8),ef=_n(12),tf=_n(16),Te=_n(4);function S0(n,e,t,r,i,o,s){let a,l,f,c,u,h,p,g,d,v,_,y,m,k,b,P,R,N;const q=n-i,T=t-i,F=e-o,M=r-o;k=q*M,h=Fe*q,p=h-(h-q),g=q-p,h=Fe*M,d=h-(h-M),v=M-d,b=g*v-(k-p*d-g*d-p*v),P=F*T,h=Fe*F,p=h-(h-F),g=F-p,h=Fe*T,d=h-(h-T),v=T-d,R=g*v-(P-p*d-g*d-p*v),_=b-R,u=b-_,ar[0]=b-(_+u)+(u-R),y=k+_,u=y-k,m=k-(y-u)+(_-u),_=m-P,u=m-_,ar[1]=m-(_+u)+(u-P),N=y+_,u=N-y,ar[2]=y-(N-u)+(_-u),ar[3]=N;let O=_0(4,ar),U=w0*s;if(O>=U||-O>=U||(u=n-q,a=n-(q+u)+(u-i),u=t-T,f=t-(T+u)+(u-i),u=e-F,l=e-(F+u)+(u-o),u=r-M,c=r-(M+u)+(u-o),a===0&&l===0&&f===0&&c===0)||(U=$0*s+v0*Math.abs(O),O+=q*c+M*a-(F*f+T*l),O>=U||-O>=U))return O;k=a*M,h=Fe*a,p=h-(h-a),g=a-p,h=Fe*M,d=h-(h-M),v=M-d,b=g*v-(k-p*d-g*d-p*v),P=l*T,h=Fe*l,p=h-(h-l),g=l-p,h=Fe*T,d=h-(h-T),v=T-d,R=g*v-(P-p*d-g*d-p*v),_=b-R,u=b-_,Te[0]=b-(_+u)+(u-R),y=k+_,u=y-k,m=k-(y-u)+(_-u),_=m-P,u=m-_,Te[1]=m-(_+u)+(u-P),N=y+_,u=N-y,Te[2]=y-(N-u)+(_-u),Te[3]=N;const ne=fo(4,ar,4,Te,xl);k=q*c,h=Fe*q,p=h-(h-q),g=q-p,h=Fe*c,d=h-(h-c),v=c-d,b=g*v-(k-p*d-g*d-p*v),P=F*f,h=Fe*F,p=h-(h-F),g=F-p,h=Fe*f,d=h-(h-f),v=f-d,R=g*v-(P-p*d-g*d-p*v),_=b-R,u=b-_,Te[0]=b-(_+u)+(u-R),y=k+_,u=y-k,m=k-(y-u)+(_-u),_=m-P,u=m-_,Te[1]=m-(_+u)+(u-P),N=y+_,u=N-y,Te[2]=y-(N-u)+(_-u),Te[3]=N;const V=fo(ne,xl,4,Te,ef);k=a*c,h=Fe*a,p=h-(h-a),g=a-p,h=Fe*c,d=h-(h-c),v=c-d,b=g*v-(k-p*d-g*d-p*v),P=l*f,h=Fe*l,p=h-(h-l),g=l-p,h=Fe*f,d=h-(h-f),v=f-d,R=g*v-(P-p*d-g*d-p*v),_=b-R,u=b-_,Te[0]=b-(_+u)+(u-R),y=k+_,u=y-k,m=k-(y-u)+(_-u),_=m-P,u=m-_,Te[1]=m-(_+u)+(u-P),N=y+_,u=N-y,Te[2]=y-(N-u)+(_-u),Te[3]=N;const H=fo(V,ef,4,Te,tf);return tf[H-1]}function k0(n,e,t,r,i,o){const s=(e-o)*(t-i),a=(n-i)*(r-o),l=s-a,f=Math.abs(s+a);return Math.abs(l)>=b0*f?l:-S0(n,e,t,r,i,o,f)}const Gr=(n,e)=>n.ll.x<=e.x&&e.x<=n.ur.x&&n.ll.y<=e.y&&e.y<=n.ur.y,Qo=(n,e)=>{if(e.ur.x<n.ll.x||n.ur.x<e.ll.x||e.ur.y<n.ll.y||n.ur.y<e.ll.y)return null;const t=n.ll.x<e.ll.x?e.ll.x:n.ll.x,r=n.ur.x<e.ur.x?n.ur.x:e.ur.x,i=n.ll.y<e.ll.y?e.ll.y:n.ll.y,o=n.ur.y<e.ur.y?n.ur.y:e.ur.y;return{ll:{x:t,y:i},ur:{x:r,y:o}}};let Gt=Number.EPSILON;Gt===void 0&&(Gt=Math.pow(2,-52));const E0=Gt*Gt,rf=(n,e)=>{if(-Gt<n&&n<Gt&&-Gt<e&&e<Gt)return 0;const t=n-e;return t*t<E0*n*e?0:n<e?-1:1};class M0{constructor(){this.reset()}reset(){this.xRounder=new nf,this.yRounder=new nf}round(e,t){return{x:this.xRounder.round(e),y:this.yRounder.round(t)}}}class nf{constructor(){this.tree=new Cs,this.round(0)}round(e){const t=this.tree.add(e),r=this.tree.prev(t);if(r!==null&&rf(t.key,r.key)===0)return this.tree.remove(e),r.key;const i=this.tree.next(t);return i!==null&&rf(t.key,i.key)===0?(this.tree.remove(e),i.key):e}}const un=new M0,Hn=(n,e)=>n.x*e.y-n.y*e.x,Fc=(n,e)=>n.x*e.x+n.y*e.y,of=(n,e,t)=>{const r=k0(n.x,n.y,e.x,e.y,t.x,t.y);return r>0?-1:r<0?1:0},Mi=n=>Math.sqrt(Fc(n,n)),P0=(n,e,t)=>{const r={x:e.x-n.x,y:e.y-n.y},i={x:t.x-n.x,y:t.y-n.y};return Hn(i,r)/Mi(i)/Mi(r)},L0=(n,e,t)=>{const r={x:e.x-n.x,y:e.y-n.y},i={x:t.x-n.x,y:t.y-n.y};return Fc(i,r)/Mi(i)/Mi(r)},sf=(n,e,t)=>e.y===0?null:{x:n.x+e.x/e.y*(t-n.y),y:t},af=(n,e,t)=>e.x===0?null:{x:t,y:n.y+e.y/e.x*(t-n.x)},A0=(n,e,t,r)=>{if(e.x===0)return af(t,r,n.x);if(r.x===0)return af(n,e,t.x);if(e.y===0)return sf(t,r,n.y);if(r.y===0)return sf(n,e,t.y);const i=Hn(e,r);if(i==0)return null;const o={x:t.x-n.x,y:t.y-n.y},s=Hn(o,e)/i,a=Hn(o,r)/i,l=n.x+a*e.x,f=t.x+s*r.x,c=n.y+a*e.y,u=t.y+s*r.y,h=(l+f)/2,p=(c+u)/2;return{x:h,y:p}};class nt{static compare(e,t){const r=nt.comparePoints(e.point,t.point);return r!==0?r:(e.point!==t.point&&e.link(t),e.isLeft!==t.isLeft?e.isLeft?1:-1:Pi.compare(e.segment,t.segment))}static comparePoints(e,t){return e.x<t.x?-1:e.x>t.x?1:e.y<t.y?-1:e.y>t.y?1:0}constructor(e,t){e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}link(e){if(e.point===this.point)throw new Error("Tried to link already linked events");const t=e.point.events;for(let r=0,i=t.length;r<i;r++){const o=t[r];this.point.events.push(o),o.point=this.point}this.checkForConsuming()}checkForConsuming(){const e=this.point.events.length;for(let t=0;t<e;t++){const r=this.point.events[t];if(r.segment.consumedBy===void 0)for(let i=t+1;i<e;i++){const o=this.point.events[i];o.consumedBy===void 0&&r.otherSE.point.events===o.otherSE.point.events&&r.segment.consume(o.segment)}}}getAvailableLinkedEvents(){const e=[];for(let t=0,r=this.point.events.length;t<r;t++){const i=this.point.events[t];i!==this&&!i.segment.ringOut&&i.segment.isInResult()&&e.push(i)}return e}getLeftmostComparator(e){const t=new Map,r=i=>{const o=i.otherSE;t.set(i,{sine:P0(this.point,e.point,o.point),cosine:L0(this.point,e.point,o.point)})};return(i,o)=>{t.has(i)||r(i),t.has(o)||r(o);const{sine:s,cosine:a}=t.get(i),{sine:l,cosine:f}=t.get(o);return s>=0&&l>=0?a<f?1:a>f?-1:0:s<0&&l<0?a<f?-1:a>f?1:0:l<s?-1:l>s?1:0}}}let C0=0,Pi=class Jn{static compare(e,t){const r=e.leftSE.point.x,i=t.leftSE.point.x,o=e.rightSE.point.x,s=t.rightSE.point.x;if(s<r)return 1;if(o<i)return-1;const a=e.leftSE.point.y,l=t.leftSE.point.y,f=e.rightSE.point.y,c=t.rightSE.point.y;if(r<i){if(l<a&&l<f)return 1;if(l>a&&l>f)return-1;const u=e.comparePoint(t.leftSE.point);if(u<0)return 1;if(u>0)return-1;const h=t.comparePoint(e.rightSE.point);return h!==0?h:-1}if(r>i){if(a<l&&a<c)return-1;if(a>l&&a>c)return 1;const u=t.comparePoint(e.leftSE.point);if(u!==0)return u;const h=e.comparePoint(t.rightSE.point);return h<0?1:h>0?-1:1}if(a<l)return-1;if(a>l)return 1;if(o<s){const u=t.comparePoint(e.rightSE.point);if(u!==0)return u}if(o>s){const u=e.comparePoint(t.rightSE.point);if(u<0)return 1;if(u>0)return-1}if(o!==s){const u=f-a,h=o-r,p=c-l,g=s-i;if(u>h&&p<g)return 1;if(u<h&&p>g)return-1}return o>s?1:o<s||f<c?-1:f>c?1:e.id<t.id?-1:e.id>t.id?1:0}constructor(e,t,r,i){this.id=++C0,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=r,this.windings=i}static fromRing(e,t,r){let i,o,s;const a=nt.comparePoints(e,t);if(a<0)i=e,o=t,s=1;else if(a>0)i=t,o=e,s=-1;else throw new Error(`Tried to create degenerate segment at [${e.x}, ${e.y}]`);const l=new nt(i,!0),f=new nt(o,!1);return new Jn(l,f,[r],[s])}replaceRightSE(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const e=this.leftSE.point.y,t=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e<t?e:t},ur:{x:this.rightSE.point.x,y:e>t?e:t}}}vector(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}isAnEndpoint(e){return e.x===this.leftSE.point.x&&e.y===this.leftSE.point.y||e.x===this.rightSE.point.x&&e.y===this.rightSE.point.y}comparePoint(e){if(this.isAnEndpoint(e))return 0;const t=this.leftSE.point,r=this.rightSE.point,i=this.vector();if(t.x===r.x)return e.x===t.x?0:e.x<t.x?1:-1;const o=(e.y-t.y)/i.y,s=t.x+o*i.x;if(e.x===s)return 0;const a=(e.x-t.x)/i.x,l=t.y+a*i.y;return e.y===l?0:e.y<l?-1:1}getIntersection(e){const t=this.bbox(),r=e.bbox(),i=Qo(t,r);if(i===null)return null;const o=this.leftSE.point,s=this.rightSE.point,a=e.leftSE.point,l=e.rightSE.point,f=Gr(t,a)&&this.comparePoint(a)===0,c=Gr(r,o)&&e.comparePoint(o)===0,u=Gr(t,l)&&this.comparePoint(l)===0,h=Gr(r,s)&&e.comparePoint(s)===0;if(c&&f)return h&&!u?s:!h&&u?l:null;if(c)return u&&o.x===l.x&&o.y===l.y?null:o;if(f)return h&&s.x===a.x&&s.y===a.y?null:a;if(h&&u)return null;if(h)return s;if(u)return l;const p=A0(o,this.vector(),a,e.vector());return p===null||!Gr(i,p)?null:un.round(p.x,p.y)}split(e){const t=[],r=e.events!==void 0,i=new nt(e,!0),o=new nt(e,!1),s=this.rightSE;this.replaceRightSE(o),t.push(o),t.push(i);const a=new Jn(i,s,this.rings.slice(),this.windings.slice());return nt.comparePoints(a.leftSE.point,a.rightSE.point)>0&&a.swapEvents(),nt.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),r&&(i.checkForConsuming(),o.checkForConsuming()),t}swapEvents(){const e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let t=0,r=this.windings.length;t<r;t++)this.windings[t]*=-1}consume(e){let t=this,r=e;for(;t.consumedBy;)t=t.consumedBy;for(;r.consumedBy;)r=r.consumedBy;const i=Jn.compare(t,r);if(i!==0){if(i>0){const o=t;t=r,r=o}if(t.prev===r){const o=t;t=r,r=o}for(let o=0,s=r.rings.length;o<s;o++){const a=r.rings[o],l=r.windings[o],f=t.rings.indexOf(a);f===-1?(t.rings.push(a),t.windings.push(l)):t.windings[f]+=l}r.rings=null,r.windings=null,r.consumedBy=t,r.leftSE.consumedBy=t.leftSE,r.rightSE.consumedBy=t.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const e=this.prev.consumedBy||this.prev;this._beforeState=e.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};const t=this._afterState.rings,r=this._afterState.windings,i=this._afterState.multiPolys;for(let a=0,l=this.rings.length;a<l;a++){const f=this.rings[a],c=this.windings[a],u=t.indexOf(f);u===-1?(t.push(f),r.push(c)):r[u]+=c}const o=[],s=[];for(let a=0,l=t.length;a<l;a++){if(r[a]===0)continue;const f=t[a],c=f.poly;if(s.indexOf(c)===-1)if(f.isExterior)o.push(c);else{s.indexOf(c)===-1&&s.push(c);const u=o.indexOf(f.poly);u!==-1&&o.splice(u,1)}}for(let a=0,l=o.length;a<l;a++){const f=o[a].multiPoly;i.indexOf(f)===-1&&i.push(f)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const e=this.beforeState().multiPolys,t=this.afterState().multiPolys;switch(gt.type){case"union":{const r=e.length===0,i=t.length===0;this._isInResult=r!==i;break}case"intersection":{let r,i;e.length<t.length?(r=e.length,i=t.length):(r=t.length,i=e.length),this._isInResult=i===gt.numMultiPolys&&r<i;break}case"xor":{const r=Math.abs(e.length-t.length);this._isInResult=r%2===1;break}case"difference":{const r=i=>i.length===1&&i[0].isSubject;this._isInResult=r(e)!==r(t);break}default:throw new Error(`Unrecognized operation type found ${gt.type}`)}return this._isInResult}};class lf{constructor(e,t,r){if(!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=r,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const i=un.round(e[0][0],e[0][1]);this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};let o=i;for(let s=1,a=e.length;s<a;s++){if(typeof e[s][0]!="number"||typeof e[s][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let l=un.round(e[s][0],e[s][1]);l.x===o.x&&l.y===o.y||(this.segments.push(Pi.fromRing(o,l,this)),l.x<this.bbox.ll.x&&(this.bbox.ll.x=l.x),l.y<this.bbox.ll.y&&(this.bbox.ll.y=l.y),l.x>this.bbox.ur.x&&(this.bbox.ur.x=l.x),l.y>this.bbox.ur.y&&(this.bbox.ur.y=l.y),o=l)}(i.x!==o.x||i.y!==o.y)&&this.segments.push(Pi.fromRing(o,i,this))}getSweepEvents(){const e=[];for(let t=0,r=this.segments.length;t<r;t++){const i=this.segments[t];e.push(i.leftSE),e.push(i.rightSE)}return e}}class F0{constructor(e,t){if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new lf(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let r=1,i=e.length;r<i;r++){const o=new lf(e[r],this,!1);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.interiorRings.push(o)}this.multiPoly=t}getSweepEvents(){const e=this.exteriorRing.getSweepEvents();for(let t=0,r=this.interiorRings.length;t<r;t++){const i=this.interiorRings[t].getSweepEvents();for(let o=0,s=i.length;o<s;o++)e.push(i[o])}return e}}class ff{constructor(e,t){if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(let r=0,i=e.length;r<i;r++){const o=new F0(e[r],this);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.polys.push(o)}this.isSubject=t}getSweepEvents(){const e=[];for(let t=0,r=this.polys.length;t<r;t++){const i=this.polys[t].getSweepEvents();for(let o=0,s=i.length;o<s;o++)e.push(i[o])}return e}}class Li{static factory(e){const t=[];for(let r=0,i=e.length;r<i;r++){const o=e[r];if(!o.isInResult()||o.ringOut)continue;let s=null,a=o.leftSE,l=o.rightSE;const f=[a],c=a.point,u=[];for(;s=a,a=l,f.push(a),a.point!==c;)for(;;){const h=a.getAvailableLinkedEvents();if(h.length===0){const d=f[0].point,v=f[f.length-1].point;throw new Error(`Unable to complete output ring starting at [${d.x}, ${d.y}]. Last matching segment found ends at [${v.x}, ${v.y}].`)}if(h.length===1){l=h[0].otherSE;break}let p=null;for(let d=0,v=u.length;d<v;d++)if(u[d].point===a.point){p=d;break}if(p!==null){const d=u.splice(p)[0],v=f.splice(d.index);v.unshift(v[0].otherSE),t.push(new Li(v.reverse()));continue}u.push({index:f.length,point:a.point});const g=a.getLeftmostComparator(s);l=h.sort(g)[0].otherSE;break}t.push(new Li(f))}return t}constructor(e){this.events=e;for(let t=0,r=e.length;t<r;t++)e[t].segment.ringOut=this;this.poly=null}getGeom(){let e=this.events[0].point;const t=[e];for(let f=1,c=this.events.length-1;f<c;f++){const u=this.events[f].point,h=this.events[f+1].point;of(u,e,h)!==0&&(t.push(u),e=u)}if(t.length===1)return null;const r=t[0],i=t[1];of(r,e,i)===0&&t.shift(),t.push(t[0]);const o=this.isExteriorRing()?1:-1,s=this.isExteriorRing()?0:t.length-1,a=this.isExteriorRing()?t.length:-1,l=[];for(let f=s;f!=a;f+=o)l.push([t[f].x,t[f].y]);return l}isExteriorRing(){if(this._isExteriorRing===void 0){const e=this.enclosingRing();this._isExteriorRing=e?!e.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let e=this.events[0];for(let i=1,o=this.events.length;i<o;i++){const s=this.events[i];nt.compare(e,s)>0&&(e=s)}let t=e.segment.prevInResult(),r=t?t.prevInResult():null;for(;;){if(!t)return null;if(!r)return t.ringOut;if(r.ringOut!==t.ringOut)return r.ringOut.enclosingRing()!==t.ringOut?t.ringOut:t.ringOut.enclosingRing();t=r.prevInResult(),r=t?t.prevInResult():null}}}class uf{constructor(e){this.exteriorRing=e,e.poly=this,this.interiorRings=[]}addInterior(e){this.interiorRings.push(e),e.poly=this}getGeom(){const e=[this.exteriorRing.getGeom()];if(e[0]===null)return null;for(let t=0,r=this.interiorRings.length;t<r;t++){const i=this.interiorRings[t].getGeom();i!==null&&e.push(i)}return e}}class O0{constructor(e){this.rings=e,this.polys=this._composePolys(e)}getGeom(){const e=[];for(let t=0,r=this.polys.length;t<r;t++){const i=this.polys[t].getGeom();i!==null&&e.push(i)}return e}_composePolys(e){const t=[];for(let r=0,i=e.length;r<i;r++){const o=e[r];if(!o.poly)if(o.isExteriorRing())t.push(new uf(o));else{const s=o.enclosingRing();s.poly||t.push(new uf(s)),s.poly.addInterior(o)}}return t}}class R0{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Pi.compare;this.queue=e,this.tree=new Cs(t),this.segments=[]}process(e){const t=e.segment,r=[];if(e.consumedBy)return e.isLeft?this.queue.remove(e.otherSE):this.tree.remove(t),r;const i=e.isLeft?this.tree.add(t):this.tree.find(t);if(!i)throw new Error(`Unable to find segment #${t.id} [${t.leftSE.point.x}, ${t.leftSE.point.y}] -> [${t.rightSE.point.x}, ${t.rightSE.point.y}] in SweepLine tree.`);let o=i,s=i,a,l;for(;a===void 0;)o=this.tree.prev(o),o===null?a=null:o.key.consumedBy===void 0&&(a=o.key);for(;l===void 0;)s=this.tree.next(s),s===null?l=null:s.key.consumedBy===void 0&&(l=s.key);if(e.isLeft){let f=null;if(a){const u=a.getIntersection(t);if(u!==null&&(t.isAnEndpoint(u)||(f=u),!a.isAnEndpoint(u))){const h=this._splitSafely(a,u);for(let p=0,g=h.length;p<g;p++)r.push(h[p])}}let c=null;if(l){const u=l.getIntersection(t);if(u!==null&&(t.isAnEndpoint(u)||(c=u),!l.isAnEndpoint(u))){const h=this._splitSafely(l,u);for(let p=0,g=h.length;p<g;p++)r.push(h[p])}}if(f!==null||c!==null){let u=null;f===null?u=c:c===null?u=f:u=nt.comparePoints(f,c)<=0?f:c,this.queue.remove(t.rightSE),r.push(t.rightSE);const h=t.split(u);for(let p=0,g=h.length;p<g;p++)r.push(h[p])}r.length>0?(this.tree.remove(t),r.push(e)):(this.segments.push(t),t.prev=a)}else{if(a&&l){const f=a.getIntersection(l);if(f!==null){if(!a.isAnEndpoint(f)){const c=this._splitSafely(a,f);for(let u=0,h=c.length;u<h;u++)r.push(c[u])}if(!l.isAnEndpoint(f)){const c=this._splitSafely(l,f);for(let u=0,h=c.length;u<h;u++)r.push(c[u])}}}this.tree.remove(t)}return r}_splitSafely(e,t){this.tree.remove(e);const r=e.rightSE;this.queue.remove(r);const i=e.split(t);return i.push(r),e.consumedBy===void 0&&this.tree.add(e),i}}const cf=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,B0=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6;class I0{run(e,t,r){gt.type=e,un.reset();const i=[new ff(t,!0)];for(let u=0,h=r.length;u<h;u++)i.push(new ff(r[u],!1));if(gt.numMultiPolys=i.length,gt.type==="difference"){const u=i[0];let h=1;for(;h<i.length;)Qo(i[h].bbox,u.bbox)!==null?h++:i.splice(h,1)}if(gt.type==="intersection")for(let u=0,h=i.length;u<h;u++){const p=i[u];for(let g=u+1,d=i.length;g<d;g++)if(Qo(p.bbox,i[g].bbox)===null)return[]}const o=new Cs(nt.compare);for(let u=0,h=i.length;u<h;u++){const p=i[u].getSweepEvents();for(let g=0,d=p.length;g<d;g++)if(o.insert(p[g]),o.size>cf)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big).")}const s=new R0(o);let a=o.size,l=o.pop();for(;l;){const u=l.key;if(o.size===a){const p=u.segment;throw new Error(`Unable to pop() ${u.isLeft?"left":"right"} SweepEvent [${u.point.x}, ${u.point.y}] from segment #${p.id} [${p.leftSE.point.x}, ${p.leftSE.point.y}] -> [${p.rightSE.point.x}, ${p.rightSE.point.y}] from queue.`)}if(o.size>cf)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big).");if(s.segments.length>B0)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments).");const h=s.process(u);for(let p=0,g=h.length;p<g;p++){const d=h[p];d.consumedBy===void 0&&o.insert(d)}a=o.size,l=o.pop()}un.reset();const f=Li.factory(s.segments);return new O0(f).getGeom()}}const gt=new I0,N0=function(n){for(var e=arguments.length,t=new Array(e>1?e-1:0),r=1;r<e;r++)t[r-1]=arguments[r];return gt.run("union",n,t)},T0=function(n){for(var e=arguments.length,t=new Array(e>1?e-1:0),r=1;r<e;r++)t[r-1]=arguments[r];return gt.run("intersection",n,t)},G0=function(n){for(var e=arguments.length,t=new Array(e>1?e-1:0),r=1;r<e;r++)t[r-1]=arguments[r];return gt.run("xor",n,t)},D0=function(n){for(var e=arguments.length,t=new Array(e>1?e-1:0),r=1;r<e;r++)t[r-1]=arguments[r];return gt.run("difference",n,t)};var Yn={union:N0,intersection:T0,xor:G0,difference:D0},j0=Object.defineProperty,Ni=(n,e)=>j0(n,"name",{value:e,configurable:!0});function Oc(n,e){var t=Bc(e),r=null;return n.type==="FeatureCollection"?r=Rc(n):r=Fs(Yn.union(n.geometry.coordinates)),r.geometry.coordinates.forEach(function(i){t.geometry.coordinates.push(i[0])}),t}Ni(Oc,"mask");function Rc(n){var e=n.features.length===2?Yn.union(n.features[0].geometry.coordinates,n.features[1].geometry.coordinates):Yn.union.apply(Yn,n.features.map(function(t){return t.geometry.coordinates}));return Fs(e)}Ni(Rc,"unionFc");function Fs(n){return Ps(n)}Ni(Fs,"createGeomFromPolygonClippingOutput");function Bc(n){var e=[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]],t=n&&n.geometry.coordinates||e;return Bi(t)}Ni(Bc,"createMask");var pf=Oc;function se(n,e){return{id:e,beforeId:U0(n,e)}}function U0(n,e){let t=Xf(xe);if(!t){console.warn(`getBeforeId(${e}) called before map is ready. Z-ordering may be incorrect.`);return}let r,i=!1;for(let o=n.layerZorder.length-1;o>=0;o--){let s=n.layerZorder[o];if(s==e){i=!0;break}t.getLayer(s)&&(r=s)}if(!i)throw new Error(`Layer ID ${e} not defined in layerZorder`);return r}const Xt=["==",["geometry-type"],"Polygon"],cn=["==",["geometry-type"],"LineString"],pn=["==",["geometry-type"],"Point"];function Er(){return{type:"FeatureCollection",features:[]}}function Wr(n,e,t){let r=["match",n];for(let[i,o]of Object.entries(e))r.push(i),r.push(o);return r.push(t),r}function Ic(n){return nn(n)}function q0(n){var t,r;let e={type:"FeatureCollection",features:[]};for(let i of n.features)if(e.features.push(i),i.geometry.type=="LineString"&&!((t=i.properties)!=null&&t.hide_while_editing))for(let o of[i.geometry.coordinates[0],i.geometry.coordinates[i.geometry.coordinates.length-1]])e.features.push({type:"Feature",properties:{endpoint:!0,scheme_reference:(r=i.properties)==null?void 0:r.scheme_reference},geometry:{type:"Point",coordinates:o}});return e}function z0(n){let e,t;const r=[se(n[0],"boundary"),{paint:{"fill-color":"black","fill-opacity":.5}}];let i={};for(let o=0;o<r.length;o+=1)i=me(i,r[o]);return e=new hn({props:i}),{c(){L(e.$$.fragment)},m(o,s){A(e,o,s),t=!0},p(o,s){const a=s&1?we(r,[Le(se(o[0],"boundary")),r[1]]):{};e.$set(a)},i(o){t||(S(e.$$.fragment,o),t=!0)},o(o){E(e.$$.fragment,o),t=!1},d(o){C(e,o)}}}function W0(n){let e,t;return e=new xt({props:{data:pf(n[1]),$$slots:{default:[z0]},$$scope:{ctx:n}}}),{c(){L(e.$$.fragment)},m(r,i){A(e,r,i),t=!0},p(r,[i]){const o={};i&2&&(o.data=pf(r[1])),i&17&&(o.$$scope={dirty:i,ctx:r}),e.$set(o)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){E(e.$$.fragment,r),t=!1},d(r){C(e,r)}}}function H0(n,e,t){let r;X(n,xe,a=>t(3,r=a));let{cfg:i}=e,{boundaryGeojson:o}=e,{fitBoundsAtStart:s=!1}=e;return(vp("setCamera")||s)&&(r==null||r.fitBounds(Ic(o),{padding:20,animate:!1})),n.$$set=a=>{"cfg"in a&&t(0,i=a.cfg),"boundaryGeojson"in a&&t(1,o=a.boundaryGeojson),"fitBoundsAtStart"in a&&t(2,s=a.fitBoundsAtStart)},[i,o,s]}class J0 extends ee{constructor(e){super(),te(this,e,H0,W0,Q,{cfg:0,boundaryGeojson:1,fitBoundsAtStart:2})}}function Y0(n){let e;return{c(){e=G("li"),e.textContent="Click to add a new point"},m(t,r){w(t,e,r)},d(t){t&&$(e)}}}function X0(n){let e;return{c(){e=G("li"),e.textContent="Click to move the point here"},m(t,r){w(t,e,r)},d(t){t&&$(e)}}}function V0(n){let e,t,r;function i(a,l){return a[0]?X0:Y0}let o=i(n),s=o(n);return{c(){e=G("ul"),s.c(),t=I(),r=G("li"),r.innerHTML=`Press <b>Escape</b>
    to cancel`},m(a,l){w(a,e,l),s.m(e,null),D(e,t),D(e,r)},p(a,[l]){o!==(o=i(a))&&(s.d(1),s=o(a),s&&(s.c(),s.m(e,t)))},i:Z,o:Z,d(a){a&&$(e),s.d()}}}function K0(n,e,t){let{editingExisting:r}=e;return n.$$set=i=>{"editingExisting"in i&&t(0,r=i.editingExisting)},[r]}class Nc extends ee{constructor(e){super(),te(this,e,K0,V0,Q,{editingExisting:0})}}function Z0(n){let e,t,r;return{c(){e=z("Undo ("),t=z(n[0]),r=z(")")},m(i,o){w(i,e,o),w(i,t,o),w(i,r,o)},p(i,o){o&1&&ye(t,i[0])},d(i){i&&($(e),$(t),$(r))}}}function Q0(n){let e;return{c(){e=z("Undo")},m(t,r){w(t,e,r)},p:Z,d(t){t&&$(e)}}}function x0(n){let e;function t(o,s){return o[0]==0?Q0:Z0}let r=t(n),i=r(n);return{c(){i.c(),e=ve()},m(o,s){i.m(o,s),w(o,e,s)},p(o,s){r===(r=t(o))&&i?i.p(o,s):(i.d(1),i=r(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){o&&$(e),i.d(o)}}}function eb(n){let e,t,r,i;return e=new ce({props:{disabled:n[0]==0,$$slots:{default:[x0]},$$scope:{ctx:n}}}),e.$on("click",n[1]),{c(){L(e.$$.fragment),t=I(),r=G("ul"),r.innerHTML=`<li><b>Click</b>
    the map to add a vertex</li> <li><b>Click</b>
    a vertex to delete it</li> <li><b>Drag</b>
    a vertex or the polygon to move it</li> <li>Press <b>Control+Z</b>
    to undo your last change</li> <li>Press <b>Enter</b>
    or
    <b>double click</b>
    to finish</li> <li>Press <b>Escape</b>
    to cancel</li>`},m(o,s){A(e,o,s),w(o,t,s),w(o,r,s),i=!0},p(o,[s]){const a={};s&1&&(a.disabled=o[0]==0),s&9&&(a.$$scope={dirty:s,ctx:o}),e.$set(a)},i(o){i||(S(e.$$.fragment,o),i=!0)},o(o){E(e.$$.fragment,o),i=!1},d(o){o&&($(t),$(r)),C(e,o)}}}function tb(n,e,t){let r,i;X(n,hr,s=>t(2,r=s)),X(n,yu,s=>t(0,i=s));function o(){r.undo()}return[i,o]}class Tc extends ee{constructor(e){super(),te(this,e,tb,eb,Q,{})}}const Gc=mt(Er()),Xn=mt(Er()),Dc=mt(!0),Os=mt(0);function hf(n,e,t){const r=n.slice();return r[9]=e[t],r}function gf(n){let e,t,r=n[9].place_name+"",i,o,s;function a(...l){return n[5](n[9],...l)}return{c(){e=G("li"),t=G("a"),i=z(r),j(t,"href","#")},m(l,f){w(l,e,f),D(e,t),D(t,i),o||(s=ge(t,"click",a),o=!0)},p(l,f){n=l,f&2&&r!==(r=n[9].place_name+"")&&ye(i,r)},d(l){l&&$(e),o=!1,s()}}}function rb(n){let e,t,r,i,o;function s(c){n[4](c)}let a={label:"Add waypoint by search"};n[0]!==void 0&&(a.value=n[0]),e=new _p({props:a}),Me.push(()=>Be(e,"value",s));let l=ot(n[1].features),f=[];for(let c=0;c<l.length;c+=1)f[c]=gf(hf(n,l,c));return{c(){L(e.$$.fragment),r=I(),i=G("ol");for(let c=0;c<f.length;c+=1)f[c].c();j(i,"class","govuk-list govuk-list--number")},m(c,u){A(e,c,u),w(c,r,u),w(c,i,u);for(let h=0;h<f.length;h+=1)f[h]&&f[h].m(i,null);o=!0},p(c,[u]){const h={};if(!t&&u&1&&(t=!0,h.value=c[0],He(()=>t=!1)),e.$set(h),u&6){l=ot(c[1].features);let p;for(p=0;p<l.length;p+=1){const g=hf(c,l,p);f[p]?f[p].p(g,u):(f[p]=gf(g),f[p].c(),f[p].m(i,null))}for(;p<f.length;p+=1)f[p].d(1);f.length=l.length}},i(c){o||(S(e.$$.fragment,c),o=!0)},o(c){E(e.$$.fragment,c),o=!1},d(c){c&&($(r),$(i)),C(e,c),ts(f,c)}}}function nb(n,e,t){let r,i,o;X(n,Ct,h=>t(6,r=h)),X(n,Xn,h=>t(1,i=h)),X(n,xe,h=>t(7,o=h));let{cfg:s}=e,a="";async function l(h){if(!h){Pe(Xn,i=Er(),i);return}let p=new URLSearchParams({country:"gb",proximity:o.getCenter().toArray().join(","),fuzzyMatch:"true",key:s.maptilerApiKey}).toString(),g=`https://api.maptiler.com/geocoding/${h}.json?${p}`,v=await(await fetch(g)).json(),_=1;for(let y of v.features)y.properties.number=_++;Pe(Xn,i=v,i)}function f(h,p){h.preventDefault(),r.addSnappedWaypoint(p),t(0,a="")}function c(h){a=h,t(0,a)}const u=(h,p)=>f(p,h.center);return n.$$set=h=>{"cfg"in h&&t(3,s=h.cfg)},n.$$.update=()=>{n.$$.dirty&1&&l(a)},[a,i,f,s,c,u]}class ib extends ee{constructor(e){super(),te(this,e,nb,rb,Q,{cfg:3})}}function ob(n){let e,t,r;return{c(){e=z("Undo ("),t=z(n[3]),r=z(")")},m(i,o){w(i,e,o),w(i,t,o),w(i,r,o)},p(i,o){o&8&&ye(t,i[3])},d(i){i&&($(e),$(t),$(r))}}}function sb(n){let e;return{c(){e=z("Undo")},m(t,r){w(t,e,r)},p:Z,d(t){t&&$(e)}}}function ab(n){let e;function t(o,s){return o[3]==0?sb:ob}let r=t(n),i=r(n);return{c(){i.c(),e=ve()},m(o,s){i.m(o,s),w(o,e,s)},p(o,s){r===(r=t(o))&&i?i.p(o,s):(i.d(1),i=r(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){o&&$(e),i.d(o)}}}function lb(n){let e,t,r,i;return r=new ce({props:{$$slots:{default:[ub]},$$scope:{ctx:n}}}),r.$on("click",n[6]),{c(){e=G("p"),e.innerHTML=`Drawing points anywhere. Press <b>s</b>
    or click below to snap to roads`,t=I(),L(r.$$.fragment),de(e,"background","blue"),de(e,"color","white"),de(e,"padding","8px")},m(o,s){w(o,e,s),w(o,t,s),A(r,o,s),i=!0},p(o,s){const a={};s&1024&&(a.$$scope={dirty:s,ctx:o}),r.$set(a)},i(o){i||(S(r.$$.fragment,o),i=!0)},o(o){E(r.$$.fragment,o),i=!1},d(o){o&&($(e),$(t)),C(r,o)}}}function fb(n){let e,t,r,i;return r=new ce({props:{$$slots:{default:[cb]},$$scope:{ctx:n}}}),r.$on("click",n[6]),{c(){e=G("p"),e.innerHTML=`Snapping to existing roads. Press <b>s</b>
    or click below to draw anywhere`,t=I(),L(r.$$.fragment),de(e,"background","red"),de(e,"color","white"),de(e,"padding","8px")},m(o,s){w(o,e,s),w(o,t,s),A(r,o,s),i=!0},p(o,s){const a={};s&1024&&(a.$$scope={dirty:s,ctx:o}),r.$set(a)},i(o){i||(S(r.$$.fragment,o),i=!0)},o(o){E(r.$$.fragment,o),i=!1},d(o){o&&($(e),$(t)),C(r,o)}}}function ub(n){let e;return{c(){e=z("Snap to roads")},m(t,r){w(t,e,r)},d(t){t&&$(e)}}}function cb(n){let e;return{c(){e=z("Draw anywhere")},m(t,r){w(t,e,r)},d(t){t&&$(e)}}}function pb(n){let e;return{c(){e=z("Add points to end")},m(t,r){w(t,e,r)},d(t){t&&$(e)}}}function hb(n){let e;return{c(){e=z("Avoid doubling back")},m(t,r){w(t,e,r)},d(t){t&&$(e)}}}function gb(n){let e,t,r,i,o,s;function a(u){n[8](u)}let l={hint:"Keep clicking to add more points to the end of the route",$$slots:{default:[pb]},$$scope:{ctx:n}};n[0]!==void 0&&(l.checked=n[0]),e=new uo({props:l}),Me.push(()=>Be(e,"checked",a));function f(u){n[9](u)}let c={hint:"Try to make the route avoid using the same streets with multiple waypoints",$$slots:{default:[hb]},$$scope:{ctx:n}};return n[2].avoidDoublingBack!==void 0&&(c.checked=n[2].avoidDoublingBack),i=new uo({props:c}),Me.push(()=>Be(i,"checked",f)),{c(){L(e.$$.fragment),r=I(),L(i.$$.fragment)},m(u,h){A(e,u,h),w(u,r,h),A(i,u,h),s=!0},p(u,h){const p={};h&1024&&(p.$$scope={dirty:h,ctx:u}),!t&&h&1&&(t=!0,p.checked=u[0],He(()=>t=!1)),e.$set(p);const g={};h&1024&&(g.$$scope={dirty:h,ctx:u}),!o&&h&4&&(o=!0,g.checked=u[2].avoidDoublingBack,He(()=>o=!1)),i.$set(g)},i(u){s||(S(e.$$.fragment,u),S(i.$$.fragment,u),s=!0)},o(u){E(e.$$.fragment,u),E(i.$$.fragment,u),s=!1},d(u){u&&$(r),C(e,u),C(i,u)}}}function df(n){let e,t;return e=new ib({props:{cfg:n[1]}}),{c(){L(e.$$.fragment)},m(r,i){A(e,r,i),t=!0},p(r,i){const o={};i&2&&(o.cfg=r[1]),e.$set(o)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){E(e.$$.fragment,r),t=!1},d(r){C(e,r)}}}function db(n){let e,t,r,i,o,s,a,l,f,c,u;e=new ce({props:{disabled:n[3]==0,$$slots:{default:[ab]},$$scope:{ctx:n}}}),e.$on("click",n[5]);const h=[fb,lb],p=[];function g(v,_){return v[4]?0:1}r=g(n),i=p[r]=h[r](n),l=new Op({props:{small:!0,$$slots:{default:[gb]},$$scope:{ctx:n}}});let d=n[1].maptilerApiKey&&df(n);return{c(){L(e.$$.fragment),t=I(),i.c(),o=I(),s=G("ul"),s.innerHTML=`<li><b>Click</b>
    the map to add points</li> <li>Press <b>s</b>
    to switch between snapping points to existing roads and drawing anywhere</li> <li><b>Click and drag</b>
    any point to move it</li> <li><b>Click</b>
    a waypoint to delete it</li> <li>Press <b>Control+Z</b>
    to undo your last change</li> <li>Press <b>Enter</b>
    or
    <b>double click</b>
    to finish</li> <li>Press <b>Escape</b>
    to cancel</li>`,a=I(),L(l.$$.fragment),f=I(),d&&d.c(),c=ve()},m(v,_){A(e,v,_),w(v,t,_),p[r].m(v,_),w(v,o,_),w(v,s,_),w(v,a,_),A(l,v,_),w(v,f,_),d&&d.m(v,_),w(v,c,_),u=!0},p(v,[_]){const y={};_&8&&(y.disabled=v[3]==0),_&1032&&(y.$$scope={dirty:_,ctx:v}),e.$set(y);let m=r;r=g(v),r===m?p[r].p(v,_):(fe(),E(p[m],1,1,()=>{p[m]=null}),ue(),i=p[r],i?i.p(v,_):(i=p[r]=h[r](v),i.c()),S(i,1),i.m(o.parentNode,o));const k={};_&1029&&(k.$$scope={dirty:_,ctx:v}),l.$set(k),v[1].maptilerApiKey?d?(d.p(v,_),_&2&&S(d,1)):(d=df(v),d.c(),S(d,1),d.m(c.parentNode,c)):d&&(fe(),E(d,1,1,()=>{d=null}),ue())},i(v){u||(S(e.$$.fragment,v),S(i),S(l.$$.fragment,v),S(d),u=!0)},o(v){E(e.$$.fragment,v),E(i),E(l.$$.fragment,v),E(d),u=!1},d(v){v&&($(t),$(o),$(s),$(a),$(f),$(c)),C(e,v),p[r].d(v),C(l,v),d&&d.d(v)}}}function mb(n,e,t){let r,i,o,s;X(n,Ct,p=>t(7,r=p)),X(n,gr,p=>t(2,i=p)),X(n,Os,p=>t(3,o=p)),X(n,Dc,p=>t(4,s=p));let{cfg:a}=e,{extendRoute:l}=e;function f(){r.undo()}function c(){r.toggleSnapMode()}function u(p){l=p,t(0,l)}function h(p){n.$$.not_equal(i.avoidDoublingBack,p)&&(i.avoidDoublingBack=p,gr.set(i))}return n.$$set=p=>{"cfg"in p&&t(1,a=p.cfg),"extendRoute"in p&&t(0,l=p.extendRoute)},n.$$.update=()=>{n.$$.dirty&133&&r.setRouteConfig({avoid_doubling_back:i.avoidDoublingBack,extend_route:l})},[l,a,i,o,s,f,c,r,u,h]}class jc extends ee{constructor(e){super(),te(this,e,mb,db,Q,{cfg:1,extendRoute:0})}}function yb(n){let e,t,r;return{c(){e=z("Undo ("),t=z(n[0]),r=z(")")},m(i,o){w(i,e,o),w(i,t,o),w(i,r,o)},p(i,o){o&1&&ye(t,i[0])},d(i){i&&($(e),$(t),$(r))}}}function vb(n){let e;return{c(){e=z("Undo")},m(t,r){w(t,e,r)},p:Z,d(t){t&&$(e)}}}function _b(n){let e;function t(o,s){return o[0]==0?vb:yb}let r=t(n),i=r(n);return{c(){i.c(),e=ve()},m(o,s){i.m(o,s),w(o,e,s)},p(o,s){r===(r=t(o))&&i?i.p(o,s):(i.d(1),i=r(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){o&&$(e),i.d(o)}}}function bb(n){let e,t,r,i;return e=new ce({props:{disabled:n[0]==0,$$slots:{default:[_b]},$$scope:{ctx:n}}}),e.$on("click",n[1]),{c(){L(e.$$.fragment),t=I(),r=G("ul"),r.innerHTML=`<li><b>Click</b>
    the map to add points</li> <li><b>Click and drag</b>
    any point to move it</li> <li><b>Click</b>
    a waypoint to delete it</li> <li>Press <b>Control+Z</b>
    to undo your last change</li> <li>Press <b>Enter</b>
    or
    <b>double click</b>
    to finish</li> <li>Press <b>Escape</b>
    to cancel</li>`},m(o,s){A(e,o,s),w(o,t,s),w(o,r,s),i=!0},p(o,[s]){const a={};s&1&&(a.disabled=o[0]==0),s&9&&(a.$$scope={dirty:s,ctx:o}),e.$set(a)},i(o){i||(S(e.$$.fragment,o),i=!0)},o(o){E(e.$$.fragment,o),i=!1},d(o){o&&($(t),$(r)),C(e,o)}}}function wb(n,e,t){let r,i;X(n,Ct,s=>t(2,r=s)),X(n,Os,s=>t(0,i=s));function o(){r.undo()}return[i,o]}class Uc extends ee{constructor(e){super(),te(this,e,wb,bb,Q,{})}}function $b(n){let e;return{c(){e=z("Finish")},m(t,r){w(t,e,r)},d(t){t&&$(e)}}}function Sb(n){let e;return{c(){e=z("Cancel")},m(t,r){w(t,e,r)},d(t){t&&$(e)}}}function kb(n){let e,t,r,i;return e=new Ot({props:{$$slots:{default:[$b]},$$scope:{ctx:n}}}),e.$on("click",n[3]),r=new ce({props:{$$slots:{default:[Sb]},$$scope:{ctx:n}}}),r.$on("click",n[4]),{c(){L(e.$$.fragment),t=I(),L(r.$$.fragment)},m(o,s){A(e,o,s),w(o,t,s),A(r,o,s),i=!0},p(o,s){const a={};s&32768&&(a.$$scope={dirty:s,ctx:o}),e.$set(a);const l={};s&32768&&(l.$$scope={dirty:s,ctx:o}),r.$set(l)},i(o){i||(S(e.$$.fragment,o),S(r.$$.fragment,o),i=!0)},o(o){E(e.$$.fragment,o),E(r.$$.fragment,o),i=!1},d(o){o&&$(t),C(e,o),C(r,o)}}}function Eb(n){let e,t;return e=new Uc({}),{c(){L(e.$$.fragment)},m(r,i){A(e,r,i),t=!0},p:Z,i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){E(e.$$.fragment,r),t=!1},d(r){C(e,r)}}}function Mb(n){let e,t;return e=new Tc({}),{c(){L(e.$$.fragment)},m(r,i){A(e,r,i),t=!0},p:Z,i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){E(e.$$.fragment,r),t=!1},d(r){C(e,r)}}}function Pb(n){let e,t;return e=new jc({props:{cfg:n[0],extendRoute:!1}}),{c(){L(e.$$.fragment)},m(r,i){A(e,r,i),t=!0},p(r,i){const o={};i&1&&(o.cfg=r[0]),e.$set(o)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){E(e.$$.fragment,r),t=!1},d(r){C(e,r)}}}function Lb(n){let e,t;return e=new Nc({props:{editingExisting:!0}}),{c(){L(e.$$.fragment)},m(r,i){A(e,r,i),t=!0},p:Z,i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){E(e.$$.fragment,r),t=!1},d(r){C(e,r)}}}function Ab(n){let e,t,r,i,o,s,a,l,f,c;o=new Ut({props:{$$slots:{default:[kb]},$$scope:{ctx:n}}});const u=[Lb,Pb,Mb,Eb],h=[];function p(g,d){return g[2]=="point"?0:g[2]=="route"?1:g[2]=="freehand-polygon"?2:g[2]=="snapped-polygon"?3:-1}return~(a=p(n))&&(l=h[a]=u[a](n)),{c(){e=G("h2"),t=z("Editing "),r=z(n[1]),i=I(),L(o.$$.fragment),s=I(),l&&l.c(),f=ve()},m(g,d){w(g,e,d),D(e,t),D(e,r),w(g,i,d),A(o,g,d),w(g,s,d),~a&&h[a].m(g,d),w(g,f,d),c=!0},p(g,[d]){(!c||d&2)&&ye(r,g[1]);const v={};d&32768&&(v.$$scope={dirty:d,ctx:g}),o.$set(v);let _=a;a=p(g),a===_?~a&&h[a].p(g,d):(l&&(fe(),E(h[_],1,1,()=>{h[_]=null}),ue()),~a?(l=h[a],l?l.p(g,d):(l=h[a]=u[a](g),l.c()),S(l,1),l.m(f.parentNode,f)):l=null)},i(g){c||(S(o.$$.fragment,g),S(l),c=!0)},o(g){E(o.$$.fragment,g),E(l),c=!1},d(g){g&&($(e),$(i),$(s),$(f)),C(o,g),~a&&h[a].d(g)}}}function Cb(n,e,t){let r,i,o;X(n,hr,y=>t(8,r=y)),X(n,Ct,y=>t(9,i=y)),X(n,tn,y=>t(10,o=y));let{cfg:s}=e,{gjSchemes:a}=e,{id:l}=e,f="",c="",u=null;Ft(()=>{let y=null;a.update(k=>(y=k.features.find(b=>b.id==l),y.properties.hide_while_editing=!0,k));let m=y;t(1,f=s.interventionName(m)),m.geometry.type=="LineString"?(i==null||i.editExistingRoute(m),i==null||i.addEventListenerSuccess(h),i==null||i.addEventListenerUpdated(p),i==null||i.addEventListenerFailure(g),t(2,c="route")):m.geometry.type=="Polygon"?m.properties.waypoints?(i==null||i.editExistingArea(m),i==null||i.addEventListenerSuccess(h),i==null||i.addEventListenerUpdated(p),i==null||i.addEventListenerFailure(g),t(2,c="snapped-polygon")):(r==null||r.editExisting(m),r==null||r.addEventListenerSuccess(h),r==null||r.addEventListenerUpdated(p),r==null||r.addEventListenerFailure(g),t(2,c="freehand-polygon")):m.geometry.type=="Point"&&(o==null||o.start(),o==null||o.addEventListenerSuccess(h),o==null||o.addEventListenerFailure(g),t(2,c="point"))}),et(()=>{o==null||o.stop(),o==null||o.clearEventListeners(),i==null||i.stop(),i==null||i.clearEventListeners(),r==null||r.stop(),r==null||r.clearEventListeners(),a.update(y=>{let m=y.features.find(k=>k.id==l);return delete m.properties.hide_while_editing,u&&d(m,u),y})});function h(y){y.properties??(y.properties={}),u=y,oe.set({mode:"edit-form",id:l})}function p(y){u=y}function g(){u=null,oe.set({mode:"edit-form",id:l})}function d(y,m){y.geometry=m.geometry,m.properties.length_meters&&(y.properties.length_meters=m.properties.length_meters),m.properties.waypoints&&(y.properties.waypoints=m.properties.waypoints),s.updateFeature(y,m)}function v(){oe.set({mode:"edit-form",id:l})}function _(){u=null,oe.set({mode:"edit-form",id:l})}return n.$$set=y=>{"cfg"in y&&t(0,s=y.cfg),"gjSchemes"in y&&t(5,a=y.gjSchemes),"id"in y&&t(6,l=y.id)},[s,f,c,v,_,a,l]}class Fb extends ee{constructor(e){super(),te(this,e,Cb,Ab,Q,{cfg:0,gjSchemes:5,id:6})}}const Vn=mt(null),Kn=mt(100);function mf(n){let e,t;return e=new xp({props:{url:n[3],coordinates:[[n[1].lng,n[1].lat],[n[4].lng,n[1].lat],[n[4].lng,n[4].lat],[n[1].lng,n[4].lat]],$$slots:{default:[Ob]},$$scope:{ctx:n}}}),{c(){L(e.$$.fragment)},m(r,i){A(e,r,i),t=!0},p(r,i){const o={};i&8&&(o.url=r[3]),i&18&&(o.coordinates=[[r[1].lng,r[1].lat],[r[4].lng,r[1].lat],[r[4].lng,r[4].lat],[r[1].lng,r[4].lat]]),i&545&&(o.$$scope={dirty:i,ctx:r}),e.$set(o)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){E(e.$$.fragment,r),t=!1},d(r){C(e,r)}}}function Ob(n){let e,t;const r=[se(n[0],"georeferenced-image"),{paint:{"raster-fade-duration":0,"raster-opacity":n[5]/100}}];let i={};for(let o=0;o<r.length;o+=1)i=me(i,r[o]);return e=new Eh({props:i}),{c(){L(e.$$.fragment)},m(o,s){A(e,o,s),t=!0},p(o,s){const a=s&33?we(r,[s&1&&Le(se(o[0],"georeferenced-image")),s&32&&{paint:{"raster-fade-duration":0,"raster-opacity":o[5]/100}}]):{};e.$set(a)},i(o){t||(S(e.$$.fragment,o),t=!0)},o(o){E(e.$$.fragment,o),t=!1},d(o){C(e,o)}}}function yf(n){let e,t,r,i,o,s;function a(u){n[7](u)}let l={draggable:!0,$$slots:{default:[Rb]},$$scope:{ctx:n}};n[1]!==void 0&&(l.lngLat=n[1]),e=new co({props:l}),Me.push(()=>Be(e,"lngLat",a));function f(u){n[8](u)}let c={draggable:!0,$$slots:{default:[Bb]},$$scope:{ctx:n}};return n[4]!==void 0&&(c.lngLat=n[4]),i=new co({props:c}),Me.push(()=>Be(i,"lngLat",f)),{c(){L(e.$$.fragment),r=I(),L(i.$$.fragment)},m(u,h){A(e,u,h),w(u,r,h),A(i,u,h),s=!0},p(u,h){const p={};h&512&&(p.$$scope={dirty:h,ctx:u}),!t&&h&2&&(t=!0,p.lngLat=u[1],He(()=>t=!1)),e.$set(p);const g={};h&512&&(g.$$scope={dirty:h,ctx:u}),!o&&h&16&&(o=!0,g.lngLat=u[4],He(()=>o=!1)),i.$set(g)},i(u){s||(S(e.$$.fragment,u),S(i.$$.fragment,u),s=!0)},o(u){E(e.$$.fragment,u),E(i.$$.fragment,u),s=!1},d(u){u&&$(r),C(e,u),C(i,u)}}}function Rb(n){let e;return{c(){e=G("span"),j(e,"class","dot svelte-1tmbx1c"),de(e,"background-color","red")},m(t,r){w(t,e,r)},p:Z,d(t){t&&$(e)}}}function Bb(n){let e;return{c(){e=G("span"),j(e,"class","dot svelte-1tmbx1c"),de(e,"background-color","blue")},m(t,r){w(t,e,r)},p:Z,d(t){t&&$(e)}}}function Ib(n){let e,t,r,i=n[3]&&mf(n),o=n[3]&&n[2].mode=="set-image"&&yf(n);return{c(){i&&i.c(),e=I(),o&&o.c(),t=ve()},m(s,a){i&&i.m(s,a),w(s,e,a),o&&o.m(s,a),w(s,t,a),r=!0},p(s,[a]){s[3]?i?(i.p(s,a),a&8&&S(i,1)):(i=mf(s),i.c(),S(i,1),i.m(e.parentNode,e)):i&&(fe(),E(i,1,1,()=>{i=null}),ue()),s[3]&&s[2].mode=="set-image"?o?(o.p(s,a),a&12&&S(o,1)):(o=yf(s),o.c(),S(o,1),o.m(t.parentNode,t)):o&&(fe(),E(o,1,1,()=>{o=null}),ue())},i(s){r||(S(i),S(o),r=!0)},o(s){E(i),E(o),r=!1},d(s){s&&($(e),$(t)),i&&i.d(s),o&&o.d(s)}}}function Nb(n,e,t){let r,i,o,s;X(n,xe,h=>t(6,r=h)),X(n,oe,h=>t(2,i=h)),X(n,Vn,h=>t(3,o=h)),X(n,Kn,h=>t(5,s=h));let{cfg:a}=e,l={lng:0,lat:0},f={lng:0,lat:0};function c(h){l=h,t(1,l),t(6,r),t(3,o),t(2,i)}function u(h){f=h,t(4,f),t(6,r),t(3,o),t(2,i),t(1,l)}return n.$$set=h=>{"cfg"in h&&t(0,a=h.cfg)},n.$$.update=()=>{if(n.$$.dirty&78&&r&&o&&i.mode=="set-image"&&l.lng==0&&l.lat==0){let h=r.getBounds();t(1,l.lng=h.getWest()+.4*(h.getEast()-h.getWest()),l),t(4,f.lng=h.getWest()+.6*(h.getEast()-h.getWest()),f),t(1,l.lat=h.getNorth()+.4*(h.getSouth()-h.getNorth()),l),t(4,f.lat=h.getNorth()+.6*(h.getSouth()-h.getNorth()),f)}},[a,l,i,o,f,s,r,c,u]}class Tb extends ee{constructor(e){super(),te(this,e,Nb,Ib,Q,{cfg:0})}}function Gb(n){let e,t,r,i,o,s;const a=[se(n[0],"hover-polygons"),{filter:Xt},{paint:{"line-color":Hr.hovering,"line-width":.5*Yt}}];let l={};for(let p=0;p<a.length;p+=1)l=me(l,a[p]);e=new dr({props:l});const f=[se(n[0],"hover-lines"),{filter:cn},{paint:{"line-color":Hr.hovering,"line-width":1.5*Yt}}];let c={};for(let p=0;p<f.length;p+=1)c=me(c,f[p]);r=new dr({props:c});const u=[se(n[0],"hover-points"),{filter:pn},{paint:{"circle-color":Hr.hovering,"circle-radius":1.5*xn}}];let h={};for(let p=0;p<u.length;p+=1)h=me(h,u[p]);return o=new mr({props:h}),{c(){L(e.$$.fragment),t=I(),L(r.$$.fragment),i=I(),L(o.$$.fragment)},m(p,g){A(e,p,g),w(p,t,g),A(r,p,g),w(p,i,g),A(o,p,g),s=!0},p(p,g){const d=g&1?we(a,[Le(se(p[0],"hover-polygons")),a[1],a[2]]):{};e.$set(d);const v=g&1?we(f,[Le(se(p[0],"hover-lines")),f[1],f[2]]):{};r.$set(v);const _=g&1?we(u,[Le(se(p[0],"hover-points")),u[1],u[2]]):{};o.$set(_)},i(p){s||(S(e.$$.fragment,p),S(r.$$.fragment,p),S(o.$$.fragment,p),s=!0)},o(p){E(e.$$.fragment,p),E(r.$$.fragment,p),E(o.$$.fragment,p),s=!1},d(p){p&&($(t),$(i)),C(e,p),C(r,p),C(o,p)}}}function Db(n){let e,t;return e=new xt({props:{data:n[2],$$slots:{default:[Gb]},$$scope:{ctx:n}}}),{c(){L(e.$$.fragment)},m(r,i){A(e,r,i),t=!0},p(r,[i]){const o={};i&4&&(o.data=r[2]),i&33&&(o.$$scope={dirty:i,ctx:r}),e.$set(o)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){E(e.$$.fragment,r),t=!1},d(r){C(e,r)}}}function jb(n,e,t){let r,i,o,s=Z,a=()=>(s(),s=At(f,c=>t(4,o=c)),f);X(n,Rn,c=>t(3,i=c)),n.$$.on_destroy.push(()=>s());let{cfg:l}=e,{gjSchemes:f}=e;return a(),n.$$set=c=>{"cfg"in c&&t(0,l=c.cfg),"gjSchemes"in c&&a(t(1,f=c.gjSchemes))},n.$$.update=()=>{n.$$.dirty&24&&t(2,r=i==null?Er():o.features.find(c=>c.id==i))},[l,f,r,i,o]}class Ub extends ee{constructor(e){super(),te(this,e,jb,Db,Q,{cfg:0,gjSchemes:1})}}function vf(n){let e,t;return e=new os({props:{openOn:"hover",openIfTopMost:!0,$$slots:{default:[qb,({features:r})=>({16:r}),({features:r})=>r?65536:0]},$$scope:{ctx:n}}}),{c(){L(e.$$.fragment)},m(r,i){A(e,r,i),t=!0},p(r,i){const o={};i&196608&&(o.$$scope={dirty:i,ctx:r}),e.$set(o)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){E(e.$$.fragment,r),t=!1},d(r){C(e,r)}}}function qb(n){let e,t,r=n[9](n[16])+"",i;return{c(){e=G("div"),t=G("p"),i=z(r),j(e,"class","govuk-prose")},m(o,s){w(o,e,s),D(e,t),D(t,i)},p(o,s){s&65536&&r!==(r=o[9](o[16])+"")&&ye(i,r)},d(o){o&&$(e)}}}function zb(n){let e,t,r=n[4]&&vf(n);return{c(){r&&r.c(),e=ve()},m(i,o){r&&r.m(i,o),w(i,e,o),t=!0},p(i,o){i[4]?r?(r.p(i,o),o&16&&S(r,1)):(r=vf(i),r.c(),S(r,1),r.m(e.parentNode,e)):r&&(fe(),E(r,1,1,()=>{r=null}),ue())},i(i){t||(S(r),t=!0)},o(i){E(r),t=!1},d(i){i&&$(e),r&&r.d(i)}}}function _f(n){let e,t;return e=new os({props:{openOn:"hover",openIfTopMost:!0,$$slots:{default:[Wb,({features:r})=>({16:r}),({features:r})=>r?65536:0]},$$scope:{ctx:n}}}),{c(){L(e.$$.fragment)},m(r,i){A(e,r,i),t=!0},p(r,i){const o={};i&196608&&(o.$$scope={dirty:i,ctx:r}),e.$set(o)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){E(e.$$.fragment,r),t=!1},d(r){C(e,r)}}}function Wb(n){let e,t,r=n[9](n[16])+"",i;return{c(){e=G("div"),t=G("p"),i=z(r),j(e,"class","govuk-prose")},m(o,s){w(o,e,s),D(e,t),D(t,i)},p(o,s){s&65536&&r!==(r=o[9](o[16])+"")&&ye(i,r)},d(o){o&&$(e)}}}function Hb(n){let e,t,r=n[4]&&_f(n);return{c(){r&&r.c(),e=ve()},m(i,o){r&&r.m(i,o),w(i,e,o),t=!0},p(i,o){i[4]?r?(r.p(i,o),o&16&&S(r,1)):(r=_f(i),r.c(),S(r,1),r.m(e.parentNode,e)):r&&(fe(),E(r,1,1,()=>{r=null}),ue())},i(i){t||(S(r),t=!0)},o(i){E(r),t=!1},d(i){i&&$(e),r&&r.d(i)}}}function bf(n){let e,t;return e=new os({props:{openOn:"hover",openIfTopMost:!0,$$slots:{default:[Jb,({features:r})=>({16:r}),({features:r})=>r?65536:0]},$$scope:{ctx:n}}}),{c(){L(e.$$.fragment)},m(r,i){A(e,r,i),t=!0},p(r,i){const o={};i&196608&&(o.$$scope={dirty:i,ctx:r}),e.$set(o)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){E(e.$$.fragment,r),t=!1},d(r){C(e,r)}}}function Jb(n){let e,t,r=n[9](n[16])+"",i;return{c(){e=G("div"),t=G("p"),i=z(r),j(e,"class","govuk-prose")},m(o,s){w(o,e,s),D(e,t),D(t,i)},p(o,s){s&65536&&r!==(r=o[9](o[16])+"")&&ye(i,r)},d(o){o&&$(e)}}}function Yb(n){let e,t,r=n[4]&&bf(n);return{c(){r&&r.c(),e=ve()},m(i,o){r&&r.m(i,o),w(i,e,o),t=!0},p(i,o){i[4]?r?(r.p(i,o),o&16&&S(r,1)):(r=bf(i),r.c(),S(r,1),r.m(e.parentNode,e)):r&&(fe(),E(r,1,1,()=>{r=null}),ue())},i(i){t||(S(r),t=!0)},o(i){E(r),t=!1},d(i){i&&$(e),r&&r.d(i)}}}function Xb(n){let e,t,r,i,o,s,a,l,f,c;const u=[se(n[0],"interventions-points"),{filter:["all",pn,n[6],n[7],n[3]]},{paint:{"circle-color":n[2],"circle-radius":xn}},{hoverCursor:n[4]?"pointer":void 0},{manageHoverState:n[4]}];let h={$$slots:{default:[zb]},$$scope:{ctx:n}};for(let b=0;b<u.length;b+=1)h=me(h,u[b]);e=new mr({props:h}),e.$on("click",n[8]);const p=[se(n[0],"interventions-lines"),{filter:["all",cn,n[6],n[3]]},{paint:{"line-color":n[2],"line-width":Yt}},{hoverCursor:n[4]?"pointer":void 0},{manageHoverState:n[4]}];let g={$$slots:{default:[Hb]},$$scope:{ctx:n}};for(let b=0;b<p.length;b+=1)g=me(g,p[b]);r=new dr({props:g}),r.$on("click",n[8]);const d=[se(n[0],"interventions-lines-endpoints"),{filter:["all",["==",["get","endpoint"],!0],n[3]]},{paint:{"circle-radius":.5*Yt,"circle-opacity":0,"circle-stroke-color":Hr.lineEndpointColor,"circle-stroke-width":2}}];let v={};for(let b=0;b<d.length;b+=1)v=me(v,d[b]);o=new mr({props:v});const _=[se(n[0],"interventions-polygons"),{filter:["all",Xt,n[6],n[3]]},{paint:{"fill-color":n[2],"fill-opacity":.2}},{hoverCursor:n[4]?"pointer":void 0},{manageHoverState:n[4]}];let y={$$slots:{default:[Yb]},$$scope:{ctx:n}};for(let b=0;b<_.length;b+=1)y=me(y,_[b]);a=new hn({props:y}),a.$on("click",n[8]);const m=[se(n[0],"interventions-polygons-outlines"),{filter:["all",Xt,n[6],n[3]]},{paint:{"line-color":n[2],"line-opacity":.5,"line-width":.7*Yt}}];let k={};for(let b=0;b<m.length;b+=1)k=me(k,m[b]);return f=new dr({props:k}),{c(){L(e.$$.fragment),t=I(),L(r.$$.fragment),i=I(),L(o.$$.fragment),s=I(),L(a.$$.fragment),l=I(),L(f.$$.fragment)},m(b,P){A(e,b,P),w(b,t,P),A(r,b,P),w(b,i,P),A(o,b,P),w(b,s,P),A(a,b,P),w(b,l,P),A(f,b,P),c=!0},p(b,P){const R=P&221?we(u,[P&1&&Le(se(b[0],"interventions-points")),P&200&&{filter:["all",pn,b[6],b[7],b[3]]},P&4&&{paint:{"circle-color":b[2],"circle-radius":xn}},P&16&&{hoverCursor:b[4]?"pointer":void 0},P&16&&{manageHoverState:b[4]}]):{};P&131088&&(R.$$scope={dirty:P,ctx:b}),e.$set(R);const N=P&93?we(p,[P&1&&Le(se(b[0],"interventions-lines")),P&72&&{filter:["all",cn,b[6],b[3]]},P&4&&{paint:{"line-color":b[2],"line-width":Yt}},P&16&&{hoverCursor:b[4]?"pointer":void 0},P&16&&{manageHoverState:b[4]}]):{};P&131088&&(N.$$scope={dirty:P,ctx:b}),r.$set(N);const q=P&9?we(d,[P&1&&Le(se(b[0],"interventions-lines-endpoints")),P&8&&{filter:["all",["==",["get","endpoint"],!0],b[3]]},d[2]]):{};o.$set(q);const T=P&93?we(_,[P&1&&Le(se(b[0],"interventions-polygons")),P&72&&{filter:["all",Xt,b[6],b[3]]},P&4&&{paint:{"fill-color":b[2],"fill-opacity":.2}},P&16&&{hoverCursor:b[4]?"pointer":void 0},P&16&&{manageHoverState:b[4]}]):{};P&131088&&(T.$$scope={dirty:P,ctx:b}),a.$set(T);const F=P&77?we(m,[P&1&&Le(se(b[0],"interventions-polygons-outlines")),P&72&&{filter:["all",Xt,b[6],b[3]]},P&4&&{paint:{"line-color":b[2],"line-opacity":.5,"line-width":.7*Yt}}]):{};f.$set(F)},i(b){c||(S(e.$$.fragment,b),S(r.$$.fragment,b),S(o.$$.fragment,b),S(a.$$.fragment,b),S(f.$$.fragment,b),c=!0)},o(b){E(e.$$.fragment,b),E(r.$$.fragment,b),E(o.$$.fragment,b),E(a.$$.fragment,b),E(f.$$.fragment,b),c=!1},d(b){b&&($(t),$(i),$(s),$(l)),C(e,b),C(r,b),C(o,b),C(a,b),C(f,b)}}}function Vb(n){let e,t;return e=new xt({props:{data:n[5],$$slots:{default:[Xb]},$$scope:{ctx:n}}}),{c(){L(e.$$.fragment)},m(r,i){A(e,r,i),t=!0},p(r,[i]){const o={};i&32&&(o.data=r[5]),i&131101&&(o.$$scope={dirty:i,ctx:r}),e.$set(o)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){E(e.$$.fragment,r),t=!1},d(r){C(e,r)}}}function Kb(n){let e=["all"];for(let t of n.keys())e.push(["!=",["get","scheme_reference"],t]);return e}function Zb(n,e,t){let r,i,o,s,a,l=Z,f=()=>(l(),l=At(g,b=>t(11,a=b)),g),c,u,h;X(n,xe,b=>t(14,c=b)),X(n,oe,b=>t(12,u=b)),X(n,Bn,b=>t(13,h=b)),n.$$.on_destroy.push(()=>l());let{cfg:p}=e,{gjSchemes:g}=e;f();const d=["!=",["get","hide_while_editing"],!0],v=["!=",["get","endpoint"],!0];let _;function y(b){return Wr(["get","scheme_reference"],Object.fromEntries(Object.values(b.schemes).map(P=>[P.scheme_reference,P.color])),"black")}function m(b){u.mode!="list"||!c||b.detail.features[0]&&(c.getCanvas().style.cursor="inherit",oe.set({mode:"edit-form",id:b.detail.features[0].id}))}function k(b){if(b){let P=b[0],R=p.interventionName(P),N=p.schemeName(a.schemes[P.properties.scheme_reference]);return`${R} (${N})`}return"Tooltip bug"}return n.$$set=b=>{"cfg"in b&&t(0,p=b.cfg),"gjSchemes"in b&&f(t(1,g=b.gjSchemes))},n.$$.update=()=>{if(n.$$.dirty&2048&&t(5,r=q0(a)),n.$$.dirty&4096&&t(4,i=u.mode=="list"),n.$$.dirty&8192&&t(3,o=Kb(h)),n.$$.dirty&2048&&t(10,s=y(a)),n.$$.dirty&5120){let b="grey";u.mode=="edit-form"?t(2,_=["case",["==",["id"],u.id],s,b]):u.mode=="list"?t(2,_=s):u.mode=="split-route"?t(2,_=["case",["==","intervention_type","route"],s,b]):t(2,_=b)}},[p,g,_,o,i,r,d,v,m,k,s,a,u,h]}class Qb extends ee{constructor(e){super(),te(this,e,Zb,Vb,Q,{cfg:0,gjSchemes:1})}}function xb(n){let e,t,r,i,o,s;const a=[se(n[0],"edit-polygon-fill"),{filter:Xt},{paint:{"fill-color":"red","fill-opacity":["case",["boolean",["get","hover"],"false"],1,.5]}}];let l={};for(let p=0;p<a.length;p+=1)l=me(l,a[p]);e=new hn({props:l});const f=[se(n[0],"edit-polygon-lines"),{filter:cn},{paint:{"line-color":"black","line-width":8,"line-opacity":.5}}];let c={};for(let p=0;p<f.length;p+=1)c=me(c,f[p]);r=new dr({props:c});const u=[se(n[0],"edit-polygon-vertices"),{filter:pn},{paint:{"circle-color":Hr.hovering,"circle-opacity":["case",["has","hovered"],1,.5],"circle-radius":xn}}];let h={};for(let p=0;p<u.length;p+=1)h=me(h,u[p]);return o=new mr({props:h}),{c(){L(e.$$.fragment),t=I(),L(r.$$.fragment),i=I(),L(o.$$.fragment)},m(p,g){A(e,p,g),w(p,t,g),A(r,p,g),w(p,i,g),A(o,p,g),s=!0},p(p,g){const d=g&1?we(a,[Le(se(p[0],"edit-polygon-fill")),a[1],a[2]]):{};e.$set(d);const v=g&1?we(f,[Le(se(p[0],"edit-polygon-lines")),f[1],f[2]]):{};r.$set(v);const _=g&1?we(u,[Le(se(p[0],"edit-polygon-vertices")),u[1],u[2]]):{};o.$set(_)},i(p){s||(S(e.$$.fragment,p),S(r.$$.fragment,p),S(o.$$.fragment,p),s=!0)},o(p){E(e.$$.fragment,p),E(r.$$.fragment,p),E(o.$$.fragment,p),s=!1},d(p){p&&($(t),$(i)),C(e,p),C(r,p),C(o,p)}}}function e1(n){let e,t;return e=new xt({props:{data:n[1],$$slots:{default:[xb]},$$scope:{ctx:n}}}),{c(){L(e.$$.fragment)},m(r,i){A(e,r,i),t=!0},p(r,[i]){const o={};i&2&&(o.data=r[1]),i&5&&(o.$$scope={dirty:i,ctx:r}),e.$set(o)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){E(e.$$.fragment,r),t=!1},d(r){C(e,r)}}}function t1(n,e,t){let r;X(n,mu,o=>t(1,r=o));let{cfg:i}=e;return n.$$set=o=>{"cfg"in o&&t(0,i=o.cfg)},[i,r]}class r1 extends ee{constructor(e){super(),te(this,e,t1,e1,Q,{cfg:0})}}function n1(n){let e,t,r,i,o,s;const a=[se(n[0],"route-points"),{filter:pn},{paint:{"circle-color":Wr(["get","type"],{"snapped-waypoint":"red","free-waypoint":"blue"},"black"),"circle-opacity":["case",["has","hovered"],.5,1],"circle-radius":Wr(["get","type"],{node:Ln/2},Ln)}}];let l={};for(let p=0;p<a.length;p+=1)l=me(l,a[p]);e=new mr({props:l});const f=[se(n[0],"route-lines"),{filter:cn},{paint:{"line-color":["case",["get","snapped"],"red","blue"],"line-width":2.5}}];let c={};for(let p=0;p<f.length;p+=1)c=me(c,f[p]);r=new dr({props:c});const u=[se(n[0],"route-polygons"),{filter:Xt},{paint:{"fill-color":"black","fill-opacity":.5}}];let h={};for(let p=0;p<u.length;p+=1)h=me(h,u[p]);return o=new hn({props:h}),{c(){L(e.$$.fragment),t=I(),L(r.$$.fragment),i=I(),L(o.$$.fragment)},m(p,g){A(e,p,g),w(p,t,g),A(r,p,g),w(p,i,g),A(o,p,g),s=!0},p(p,g){const d=g&1?we(a,[g&1&&Le(se(p[0],"route-points")),a[1],g&0&&{paint:{"circle-color":Wr(["get","type"],{"snapped-waypoint":"red","free-waypoint":"blue"},"black"),"circle-opacity":["case",["has","hovered"],.5,1],"circle-radius":Wr(["get","type"],{node:Ln/2},Ln)}}]):{};e.$set(d);const v=g&1?we(f,[Le(se(p[0],"route-lines")),f[1],f[2]]):{};r.$set(v);const _=g&1?we(u,[Le(se(p[0],"route-polygons")),u[1],u[2]]):{};o.$set(_)},i(p){s||(S(e.$$.fragment,p),S(r.$$.fragment,p),S(o.$$.fragment,p),s=!0)},o(p){E(e.$$.fragment,p),E(r.$$.fragment,p),E(o.$$.fragment,p),s=!1},d(p){p&&($(t),$(i)),C(e,p),C(r,p),C(o,p)}}}function i1(n){let e,t=wf(n[3])+"",r;return{c(){e=G("div"),r=z(t),de(e,"font-size","30px"),de(e,"background","white"),de(e,"padding","16px"),de(e,"border-radius","50%")},m(i,o){w(i,e,o),D(e,r)},p(i,o){o&8&&t!==(t=wf(i[3])+"")&&ye(r,t)},d(i){i&&$(e)}}}function o1(n){let e,t;return e=new wh({props:{$$slots:{default:[i1,({feature:r})=>({3:r}),({feature:r})=>r?8:0]},$$scope:{ctx:n}}}),{c(){L(e.$$.fragment)},m(r,i){A(e,r,i),t=!0},p(r,i){const o={};i&24&&(o.$$scope={dirty:i,ctx:r}),e.$set(o)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){E(e.$$.fragment,r),t=!1},d(r){C(e,r)}}}function s1(n){let e,t,r,i;return e=new xt({props:{data:n[1],$$slots:{default:[n1]},$$scope:{ctx:n}}}),r=new xt({props:{data:n[2],$$slots:{default:[o1]},$$scope:{ctx:n}}}),{c(){L(e.$$.fragment),t=I(),L(r.$$.fragment)},m(o,s){A(e,o,s),w(o,t,s),A(r,o,s),i=!0},p(o,[s]){const a={};s&2&&(a.data=o[1]),s&17&&(a.$$scope={dirty:s,ctx:o}),e.$set(a);const l={};s&4&&(l.data=o[2]),s&16&&(l.$$scope={dirty:s,ctx:o}),r.$set(l)},i(o){i||(S(e.$$.fragment,o),S(r.$$.fragment,o),i=!0)},o(o){E(e.$$.fragment,o),E(r.$$.fragment,o),i=!1},d(o){o&&$(t),C(e,o),C(r,o)}}}const Ln=10;function wf(n){var e;return(e=n.properties)==null?void 0:e.number}function a1(n,e,t){let r,i;X(n,Gc,s=>t(1,r=s)),X(n,Xn,s=>t(2,i=s));let{cfg:o}=e;return n.$$set=s=>{"cfg"in s&&t(0,o=s.cfg)},[o,r,i]}class l1 extends ee{constructor(e){super(),te(this,e,a1,s1,Q,{cfg:0})}}var f1=Object.defineProperty,Wt=(n,e)=>f1(n,"name",{value:e,configurable:!0});function Mr(n){if(!n)throw new Error("coord is required");if(!Array.isArray(n)){if(n.type==="Feature"&&n.geometry!==null&&n.geometry.type==="Point")return[...n.geometry.coordinates];if(n.type==="Point")return[...n.coordinates]}if(Array.isArray(n)&&n.length>=2&&!Array.isArray(n[0])&&!Array.isArray(n[1]))return[...n];throw new Error("coord must be GeoJSON Point or an Array of numbers")}Wt(Mr,"getCoord");function qc(n){if(Array.isArray(n))return n;if(n.type==="Feature"){if(n.geometry!==null)return n.geometry.coordinates}else if(n.coordinates)return n.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}Wt(qc,"getCoords");function zc(n){if(n.length>1&&kr(n[0])&&kr(n[1]))return!0;if(Array.isArray(n[0])&&n[0].length)return zc(n[0]);throw new Error("coordinates must only contain numbers")}Wt(zc,"containsNumber");function u1(n,e,t){if(!e||!t)throw new Error("type and name required");if(!n||n.type!==e)throw new Error("Invalid input to "+t+": must be a "+e+", given "+n.type)}Wt(u1,"geojsonType");function c1(n,e,t){if(!n)throw new Error("No feature passed");if(!t)throw new Error(".featureOf() requires a name");if(!n||n.type!=="Feature"||!n.geometry)throw new Error("Invalid input to "+t+", Feature with geometry required");if(!n.geometry||n.geometry.type!==e)throw new Error("Invalid input to "+t+": must be a "+e+", given "+n.geometry.type)}Wt(c1,"featureOf");function p1(n,e,t){if(!n)throw new Error("No featureCollection passed");if(!t)throw new Error(".collectionOf() requires a name");if(!n||n.type!=="FeatureCollection")throw new Error("Invalid input to "+t+", FeatureCollection required");for(const r of n.features){if(!r||r.type!=="Feature"||!r.geometry)throw new Error("Invalid input to "+t+", Feature with geometry required");if(!r.geometry||r.geometry.type!==e)throw new Error("Invalid input to "+t+": must be a "+e+", given "+r.geometry.type)}}Wt(p1,"collectionOf");function h1(n){return n.type==="Feature"?n.geometry:n}Wt(h1,"getGeom");function g1(n,e){return n.type==="FeatureCollection"?"FeatureCollection":n.type==="GeometryCollection"?"GeometryCollection":n.type==="Feature"&&n.geometry!==null?n.geometry.type:n.type}Wt(g1,"getType");var d1=Object.defineProperty,Wc=(n,e)=>d1(n,"name",{value:e,configurable:!0});function Rs(n,e,t={}){if(t.final===!0)return Hc(n,e);const r=Mr(n),i=Mr(e),o=it(r[0]),s=it(i[0]),a=it(r[1]),l=it(i[1]),f=Math.sin(s-o)*Math.cos(l),c=Math.cos(a)*Math.sin(l)-Math.sin(a)*Math.cos(l)*Math.cos(s-o);return fn(Math.atan2(f,c))}Wc(Rs,"bearing");function Hc(n,e){let t=Rs(e,n);return t=(t+180)%360,t}Wc(Hc,"calculateFinalBearing");var m1=Object.defineProperty,y1=(n,e)=>m1(n,"name",{value:e,configurable:!0});function fr(n,e,t={}){var r=Mr(n),i=Mr(e),o=it(i[1]-r[1]),s=it(i[0]-r[0]),a=it(r[1]),l=it(i[1]),f=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(a)*Math.cos(l);return Ls(2*Math.atan2(Math.sqrt(f),Math.sqrt(1-f)),t.units)}y1(fr,"distance");var v1=Object.defineProperty,_1=(n,e)=>v1(n,"name",{value:e,configurable:!0});function xo(n,e,t,r={}){const i=Mr(n),o=it(i[0]),s=it(i[1]),a=it(t),l=Ii(e,r.units),f=Math.asin(Math.sin(s)*Math.cos(l)+Math.cos(s)*Math.sin(l)*Math.cos(a)),c=o+Math.atan2(Math.sin(a)*Math.sin(l)*Math.cos(s),Math.cos(l)-Math.sin(s)*Math.sin(f)),u=fn(c),h=fn(f);return Ze([u,h],r.properties)}_1(xo,"destination");class Jc{constructor(e=[],t=b1){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:r}=this,i=t[e];for(;e>0;){const o=e-1>>1,s=t[o];if(r(i,s)>=0)break;t[e]=s,e=o}t[e]=i}_down(e){const{data:t,compare:r}=this,i=this.length>>1,o=t[e];for(;e<i;){let s=(e<<1)+1,a=t[s];const l=s+1;if(l<this.length&&r(t[l],a)<0&&(s=l,a=t[l]),r(a,o)>=0)break;t[e]=a,e=s}t[e]=o}}function b1(n,e){return n<e?-1:n>e?1:0}function Yc(n,e){return n.p.x>e.p.x?1:n.p.x<e.p.x?-1:n.p.y!==e.p.y?n.p.y>e.p.y?1:-1:1}function w1(n,e){return n.rightSweepEvent.p.x>e.rightSweepEvent.p.x?1:n.rightSweepEvent.p.x<e.rightSweepEvent.p.x?-1:n.rightSweepEvent.p.y!==e.rightSweepEvent.p.y?n.rightSweepEvent.p.y<e.rightSweepEvent.p.y?1:-1:1}class $f{constructor(e,t,r,i){this.p={x:e[0],y:e[1]},this.featureId=t,this.ringId=r,this.eventId=i,this.otherEvent=null,this.isLeftEndpoint=null}isSamePoint(e){return this.p.x===e.p.x&&this.p.y===e.p.y}}function $1(n,e){if(n.type==="FeatureCollection"){const t=n.features;for(let r=0;r<t.length;r++)Sf(t[r],e)}else Sf(n,e)}let An=0,Cn=0,Fn=0;function Sf(n,e){const t=n.type==="Feature"?n.geometry:n;let r=t.coordinates;(t.type==="Polygon"||t.type==="MultiLineString")&&(r=[r]),t.type==="LineString"&&(r=[[r]]);for(let i=0;i<r.length;i++)for(let o=0;o<r[i].length;o++){let s=r[i][o][0],a=null;Cn=Cn+1;for(let l=0;l<r[i][o].length-1;l++){a=r[i][o][l+1];const f=new $f(s,An,Cn,Fn),c=new $f(a,An,Cn,Fn+1);f.otherEvent=c,c.otherEvent=f,Yc(f,c)>0?(c.isLeftEndpoint=!0,f.isLeftEndpoint=!1):(f.isLeftEndpoint=!0,c.isLeftEndpoint=!1),e.push(f),e.push(c),s=a,Fn=Fn+1}}An=An+1}class S1{constructor(e){this.leftSweepEvent=e,this.rightSweepEvent=e.otherEvent}}function k1(n,e){if(n===null||e===null||n.leftSweepEvent.ringId===e.leftSweepEvent.ringId&&(n.rightSweepEvent.isSamePoint(e.leftSweepEvent)||n.rightSweepEvent.isSamePoint(e.leftSweepEvent)||n.rightSweepEvent.isSamePoint(e.rightSweepEvent)||n.leftSweepEvent.isSamePoint(e.leftSweepEvent)||n.leftSweepEvent.isSamePoint(e.rightSweepEvent)))return!1;const t=n.leftSweepEvent.p.x,r=n.leftSweepEvent.p.y,i=n.rightSweepEvent.p.x,o=n.rightSweepEvent.p.y,s=e.leftSweepEvent.p.x,a=e.leftSweepEvent.p.y,l=e.rightSweepEvent.p.x,f=e.rightSweepEvent.p.y,c=(f-a)*(i-t)-(l-s)*(o-r),u=(l-s)*(r-a)-(f-a)*(t-s),h=(i-t)*(r-a)-(o-r)*(t-s);if(c===0)return!1;const p=u/c,g=h/c;if(p>=0&&p<=1&&g>=0&&g<=1){const d=t+p*(i-t),v=r+p*(o-r);return[d,v]}return!1}function E1(n,e){e=e||!1;const t=[],r=new Jc([],w1);for(;n.length;){const i=n.pop();if(i.isLeftEndpoint){const o=new S1(i);for(let s=0;s<r.data.length;s++){const a=r.data[s];if(e&&a.leftSweepEvent.featureId===i.featureId)continue;const l=k1(o,a);l!==!1&&t.push(l)}r.push(o)}else i.isLeftEndpoint===!1&&r.pop()}return t}function M1(n,e){const t=new Jc([],Yc);return $1(n,t),E1(t,e)}var P1=Object.defineProperty,L1=(n,e)=>P1(n,"name",{value:e,configurable:!0}),A1=M1;function Xc(n,e,t={}){const{removeDuplicates:r=!0,ignoreSelfIntersections:i=!1}=t;let o=[];n.type==="FeatureCollection"?o=o.concat(n.features):n.type==="Feature"?o.push(n):(n.type==="LineString"||n.type==="Polygon"||n.type==="MultiLineString"||n.type==="MultiPolygon")&&o.push(st(n)),e.type==="FeatureCollection"?o=o.concat(e.features):e.type==="Feature"?o.push(e):(e.type==="LineString"||e.type==="Polygon"||e.type==="MultiLineString"||e.type==="MultiPolygon")&&o.push(st(e));const s=A1(Sr(o),i);let a=[];if(r){const l={};s.forEach(f=>{const c=f.join(",");l[c]||(l[c]=!0,a.push(f))})}else a=s;return Sr(a.map(l=>Ze(l)))}L1(Xc,"lineIntersect");var C1=Object.defineProperty,Ae=(n,e)=>C1(n,"name",{value:e,configurable:!0});function bn(n,e,t){if(n!==null)for(var r,i,o,s,a,l,f,c=0,u=0,h,p=n.type,g=p==="FeatureCollection",d=p==="Feature",v=g?n.features.length:1,_=0;_<v;_++){f=g?n.features[_].geometry:d?n.geometry:n,h=f?f.type==="GeometryCollection":!1,a=h?f.geometries.length:1;for(var y=0;y<a;y++){var m=0,k=0;if(s=h?f.geometries[y]:f,s!==null){l=s.coordinates;var b=s.type;switch(c=t&&(b==="Polygon"||b==="MultiPolygon")?1:0,b){case null:break;case"Point":if(e(l,u,_,m,k)===!1)return!1;u++,m++;break;case"LineString":case"MultiPoint":for(r=0;r<l.length;r++){if(e(l[r],u,_,m,k)===!1)return!1;u++,b==="MultiPoint"&&m++}b==="LineString"&&m++;break;case"Polygon":case"MultiLineString":for(r=0;r<l.length;r++){for(i=0;i<l[r].length-c;i++){if(e(l[r][i],u,_,m,k)===!1)return!1;u++}b==="MultiLineString"&&m++,b==="Polygon"&&k++}b==="Polygon"&&m++;break;case"MultiPolygon":for(r=0;r<l.length;r++){for(k=0,i=0;i<l[r].length;i++){for(o=0;o<l[r][i].length-c;o++){if(e(l[r][i][o],u,_,m,k)===!1)return!1;u++}k++}m++}break;case"GeometryCollection":for(r=0;r<s.geometries.length;r++)if(bn(s.geometries[r],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}Ae(bn,"coordEach");function F1(n,e,t,r){var i=t;return bn(n,function(o,s,a,l,f){s===0&&t===void 0?i=o:i=e(i,o,s,a,l,f)},r),i}Ae(F1,"coordReduce");function Vc(n,e){var t;switch(n.type){case"FeatureCollection":for(t=0;t<n.features.length&&e(n.features[t].properties,t)!==!1;t++);break;case"Feature":e(n.properties,0);break}}Ae(Vc,"propEach");function O1(n,e,t){var r=t;return Vc(n,function(i,o){o===0&&t===void 0?r=i:r=e(r,i,o)}),r}Ae(O1,"propReduce");function Kc(n,e){if(n.type==="Feature")e(n,0);else if(n.type==="FeatureCollection")for(var t=0;t<n.features.length&&e(n.features[t],t)!==!1;t++);}Ae(Kc,"featureEach");function R1(n,e,t){var r=t;return Kc(n,function(i,o){o===0&&t===void 0?r=i:r=e(r,i,o)}),r}Ae(R1,"featureReduce");function B1(n){var e=[];return bn(n,function(t){e.push(t)}),e}Ae(B1,"coordAll");function Bs(n,e){var t,r,i,o,s,a,l,f,c,u,h=0,p=n.type==="FeatureCollection",g=n.type==="Feature",d=p?n.features.length:1;for(t=0;t<d;t++){for(a=p?n.features[t].geometry:g?n.geometry:n,f=p?n.features[t].properties:g?n.properties:{},c=p?n.features[t].bbox:g?n.bbox:void 0,u=p?n.features[t].id:g?n.id:void 0,l=a?a.type==="GeometryCollection":!1,s=l?a.geometries.length:1,i=0;i<s;i++){if(o=l?a.geometries[i]:a,o===null){if(e(null,h,f,c,u)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(o,h,f,c,u)===!1)return!1;break}case"GeometryCollection":{for(r=0;r<o.geometries.length;r++)if(e(o.geometries[r],h,f,c,u)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}h++}}Ae(Bs,"geomEach");function I1(n,e,t){var r=t;return Bs(n,function(i,o,s,a,l){o===0&&t===void 0?r=i:r=e(r,i,o,s,a,l)}),r}Ae(I1,"geomReduce");function wn(n,e){Bs(n,function(t,r,i,o,s){var a=t===null?null:t.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return e(st(t,i,{bbox:o,id:s}),r,0)===!1?!1:void 0}var l;switch(a){case"MultiPoint":l="Point";break;case"MultiLineString":l="LineString";break;case"MultiPolygon":l="Polygon";break}for(var f=0;f<t.coordinates.length;f++){var c=t.coordinates[f],u={type:l,coordinates:c};if(e(st(u,i),r,f)===!1)return!1}})}Ae(wn,"flattenEach");function N1(n,e,t){var r=t;return wn(n,function(i,o,s){o===0&&s===0&&t===void 0?r=i:r=e(r,i,o,s)}),r}Ae(N1,"flattenReduce");function Zc(n,e){wn(n,function(t,r,i){var o=0;if(t.geometry){var s=t.geometry.type;if(!(s==="Point"||s==="MultiPoint")){var a,l=0,f=0,c=0;if(bn(t,function(u,h,p,g,d){if(a===void 0||r>l||g>f||d>c){a=u,l=r,f=g,c=d,o=0;return}var v=ht([a,u],t.properties);if(e(v,r,i,d,o)===!1)return!1;o++,a=u})===!1)return!1}}})}Ae(Zc,"segmentEach");function T1(n,e,t){var r=t,i=!1;return Zc(n,function(o,s,a,l,f){i===!1&&t===void 0?r=o:r=e(r,o,s,a,l,f),i=!0}),r}Ae(T1,"segmentReduce");function Qc(n,e){if(!n)throw new Error("geojson is required");wn(n,function(t,r,i){if(t.geometry!==null){var o=t.geometry.type,s=t.geometry.coordinates;switch(o){case"LineString":if(e(t,r,i,0,0)===!1)return!1;break;case"Polygon":for(var a=0;a<s.length;a++)if(e(ht(s[a],t.properties),r,i,a)===!1)return!1;break}}})}Ae(Qc,"lineEach");function G1(n,e,t){var r=t;return Qc(n,function(i,o,s,a){o===0&&t===void 0?r=i:r=e(r,i,o,s,a)}),r}Ae(G1,"lineReduce");function D1(n,e){if(e=e||{},!As(e))throw new Error("options is invalid");var t=e.featureIndex||0,r=e.multiFeatureIndex||0,i=e.geometryIndex||0,o=e.segmentIndex||0,s=e.properties,a;switch(n.type){case"FeatureCollection":t<0&&(t=n.features.length+t),s=s||n.features[t].properties,a=n.features[t].geometry;break;case"Feature":s=s||n.properties,a=n.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":a=n;break;default:throw new Error("geojson is invalid")}if(a===null)return null;var l=a.coordinates;switch(a.type){case"Point":case"MultiPoint":return null;case"LineString":return o<0&&(o=l.length+o-1),ht([l[o],l[o+1]],s,e);case"Polygon":return i<0&&(i=l.length+i),o<0&&(o=l[i].length+o-1),ht([l[i][o],l[i][o+1]],s,e);case"MultiLineString":return r<0&&(r=l.length+r),o<0&&(o=l[r].length+o-1),ht([l[r][o],l[r][o+1]],s,e);case"MultiPolygon":return r<0&&(r=l.length+r),i<0&&(i=l[r].length+i),o<0&&(o=l[r][i].length-o-1),ht([l[r][i][o],l[r][i][o+1]],s,e)}throw new Error("geojson is invalid")}Ae(D1,"findSegment");function j1(n,e){if(e=e||{},!As(e))throw new Error("options is invalid");var t=e.featureIndex||0,r=e.multiFeatureIndex||0,i=e.geometryIndex||0,o=e.coordIndex||0,s=e.properties,a;switch(n.type){case"FeatureCollection":t<0&&(t=n.features.length+t),s=s||n.features[t].properties,a=n.features[t].geometry;break;case"Feature":s=s||n.properties,a=n.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":a=n;break;default:throw new Error("geojson is invalid")}if(a===null)return null;var l=a.coordinates;switch(a.type){case"Point":return Ze(l,s,e);case"MultiPoint":return r<0&&(r=l.length+r),Ze(l[r],s,e);case"LineString":return o<0&&(o=l.length+o),Ze(l[o],s,e);case"Polygon":return i<0&&(i=l.length+i),o<0&&(o=l[i].length+o),Ze(l[i][o],s,e);case"MultiLineString":return r<0&&(r=l.length+r),o<0&&(o=l[r].length+o),Ze(l[r][o],s,e);case"MultiPolygon":return r<0&&(r=l.length+r),i<0&&(i=l[r].length+i),o<0&&(o=l[r][i].length-o),Ze(l[r][i][o],s,e)}throw new Error("geojson is invalid")}Ae(j1,"findPoint");var xc=Object.defineProperty,U1=Object.defineProperties,q1=Object.getOwnPropertyDescriptors,kf=Object.getOwnPropertySymbols,z1=Object.prototype.hasOwnProperty,W1=Object.prototype.propertyIsEnumerable,Ef=(n,e,t)=>e in n?xc(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Ht=(n,e)=>{for(var t in e||(e={}))z1.call(e,t)&&Ef(n,t,e[t]);if(kf)for(var t of kf(e))W1.call(e,t)&&Ef(n,t,e[t]);return n},Jt=(n,e)=>U1(n,q1(e)),H1=(n,e)=>xc(n,"name",{value:e,configurable:!0});function ep(n,e,t={}){if(!n||!e)throw new Error("lines and pt are required arguments");let r=Ze([1/0,1/0],{dist:1/0,index:-1,location:-1}),i=0;return wn(n,function(o){const s=qc(o);for(let a=0;a<s.length-1;a++){const l=Ze(s[a]);l.properties.dist=fr(e,l,t);const f=Ze(s[a+1]);f.properties.dist=fr(e,f,t);const c=fr(l,f,t),u=Math.max(l.properties.dist,f.properties.dist),h=Rs(l,f),p=xo(e,u,h+90,t),g=xo(e,u,h-90,t),d=Xc(ht([p.geometry.coordinates,g.geometry.coordinates]),ht([l.geometry.coordinates,f.geometry.coordinates]));let v;d.features.length>0&&d.features[0]&&(v=Jt(Ht({},d.features[0]),{properties:{dist:fr(e,d.features[0],t),location:i+fr(l,d.features[0],t)}})),l.properties.dist<r.properties.dist&&(r=Jt(Ht({},l),{properties:Jt(Ht({},l.properties),{index:a,location:i})})),f.properties.dist<r.properties.dist&&(r=Jt(Ht({},f),{properties:Jt(Ht({},f.properties),{index:a+1,location:i+c})})),v&&v.properties.dist<r.properties.dist&&(r=Jt(Ht({},v),{properties:Jt(Ht({},v.properties),{index:a})})),i+=c}}),r}H1(ep,"nearestPointOnLine");var J1=ep;const tp="/scheme-sketcher/assets/split_route-9e0ea2da.svg";function Y1(n){let e,t;const r=[se(n[0],"draw-split-route"),{paint:{"circle-color":"black","circle-radius":Mf}}];let i={};for(let o=0;o<r.length;o+=1)i=me(i,r[o]);return e=new mr({props:i}),{c(){L(e.$$.fragment)},m(o,s){A(e,o,s),t=!0},p(o,s){const a=s&1?we(r,[s&1&&Le(se(o[0],"draw-split-route")),s&0&&{paint:{"circle-color":"black","circle-radius":Mf}}]):{};e.$set(a)},i(o){t||(S(e.$$.fragment,o),t=!0)},o(o){E(e.$$.fragment,o),t=!1},d(o){C(e,o)}}}function X1(n){let e,t,r,i,o,s;return e=new th({}),e.$on("mousemove",n[3]),e.$on("click",n[4]),r=new xt({props:{data:n[2],$$slots:{default:[Y1]},$$scope:{ctx:n}}}),{c(){L(e.$$.fragment),t=I(),L(r.$$.fragment)},m(a,l){A(e,a,l),w(a,t,l),A(r,a,l),i=!0,o||(s=ge(window,"keydown",n[5]),o=!0)},p(a,[l]){const f={};l&4&&(f.data=a[2]),l&2049&&(f.$$scope={dirty:l,ctx:a}),r.$set(f)},i(a){i||(S(e.$$.fragment,a),S(r.$$.fragment,a),i=!0)},o(a){E(e.$$.fragment,a),E(r.$$.fragment,a),i=!1},d(a){a&&$(t),C(e,a),C(r,a),o=!1,s()}}}const Mf=10,V1=30;function K1(n,e,t){let r,i=Z,o=()=>(i(),i=At(l,v=>t(8,r=v)),l),s;X(n,xe,v=>t(9,s=v)),n.$$.on_destroy.push(()=>i());let{cfg:a}=e,{gjSchemes:l}=e;o(),Ft(()=>{s&&(s.getCanvas().style.cursor=`url(${tp}), crosshair`)}),et(()=>{s&&(s.getCanvas().style.cursor="inherit")});let f=null,c=null,u=Er();function h(v){if(!s)return;t(6,f=null),c=null;let _=d(v.detail.lngLat.toArray());const y=[v.detail.point.x-V1,v.detail.point.y],m=s.unproject(v.detail.point).distanceTo(s.unproject(y))/1e3;let k=[];for(let[b,P]of r.features.entries())if(P.geometry.type=="LineString"){let R=J1(P.geometry,_,{units:"kilometers"});R.properties.dist!=null&&R.properties.dist<=m&&k.push([b,R.geometry.coordinates,R.properties.dist])}k.sort((b,P)=>b[2]-P[2]),k.length>0&&(t(6,f=d(k[0][1])),c=k[0][0])}function p(){if(c==null){oe.set({mode:"list"});return}let v=Ug(r.features[c],f);if(v!=null){let[_,y]=v;l.update(m=>(_.id=m.features[c].id,y.id=gn(m),m.features.splice(c,1,_,y),m))}t(6,f=null),c=null}function g(v){v.key=="Escape"&&(v.stopPropagation(),oe.set({mode:"list"}))}function d(v){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:Hf(v)}}}return n.$$set=v=>{"cfg"in v&&t(0,a=v.cfg),"gjSchemes"in v&&o(t(1,l=v.gjSchemes))},n.$$.update=()=>{if(n.$$.dirty&64){let v=Er();f&&v.features.push(f),t(2,u=v)}},[a,l,u,h,p,g,f]}class Z1 extends ee{constructor(e){super(),te(this,e,K1,X1,Q,{cfg:0,gjSchemes:1})}}function Pf(n){let e,t;return e=new ce({props:{$$slots:{default:[Q1]},$$scope:{ctx:n}}}),e.$on("click",n[5]),{c(){L(e.$$.fragment)},m(r,i){A(e,r,i),t=!0},p(r,i){const o={};i&128&&(o.$$scope={dirty:i,ctx:r}),e.$set(o)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){E(e.$$.fragment,r),t=!1},d(r){C(e,r)}}}function Q1(n){let e;return{c(){e=z("X")},m(t,r){w(t,e,r)},d(t){t&&$(e)}}}function x1(n){let e,t,r,i,o,s,a,l,f,c,u=n[2]&&Pf(n);const h=n[4].default,p=Ue(h,n,n[7],null);return{c(){e=G("div"),t=G("div"),r=G("div"),i=G("h1"),o=z(n[1]),s=I(),u&&u.c(),a=I(),p&&p.c(),j(i,"class","govuk-heading-l"),de(r,"display","flex"),de(r,"justify-content","space-between"),j(t,"class","content centered-fullscreen svelte-1st8ub0"),j(e,"class","background svelte-1st8ub0"),It(e,"open",n[0]),It(e,"closed",!n[0])},m(g,d){w(g,e,d),D(e,t),D(t,r),D(r,i),D(i,o),D(r,s),u&&u.m(r,null),D(t,a),p&&p.m(t,null),l=!0,f||(c=[ge(t,"click",On(ew)),ge(e,"click",n[6])],f=!0)},p(g,[d]){(!l||d&2)&&ye(o,g[1]),g[2]?u?(u.p(g,d),d&4&&S(u,1)):(u=Pf(g),u.c(),S(u,1),u.m(r,null)):u&&(fe(),E(u,1,1,()=>{u=null}),ue()),p&&p.p&&(!l||d&128)&&qe(p,h,g,g[7],l?We(h,g[7],d,null):ze(g[7]),null),(!l||d&1)&&It(e,"open",g[0]),(!l||d&1)&&It(e,"closed",!g[0])},i(g){l||(S(u),S(p,g),l=!0)},o(g){E(u),E(p,g),l=!1},d(g){g&&$(e),u&&u.d(),p&&p.d(g),f=!1,Pr(c)}}}const ew=()=>null;function tw(n,e,t){let{$$slots:r={},$$scope:i}=e,{title:o}=e,{open:s=!1}=e,{displayEscapeButton:a=!0}=e,{canCloseByClickingBackground:l=!0}=e;const f=()=>t(0,s=!1),c=()=>{l&&t(0,s=!1)};return n.$$set=u=>{"title"in u&&t(1,o=u.title),"open"in u&&t(0,s=u.open),"displayEscapeButton"in u&&t(2,a=u.displayEscapeButton),"canCloseByClickingBackground"in u&&t(3,l=u.canCloseByClickingBackground),"$$scope"in u&&t(7,i=u.$$scope)},[s,o,a,l,r,f,c,i]}class rp extends ee{constructor(e){super(),te(this,e,tw,x1,Q,{title:1,open:0,displayEscapeButton:2,canCloseByClickingBackground:3})}}function rw(n){let e;return{c(){e=G("ul"),e.innerHTML=`<li><b>Click</b>
    on the map to open a new tab with a 3rd-party imagery provider</li> <li>Press <b>Escape</b>
    to exit this mode</li> <li>Cursor by <a href="https://icon-icons.com/icon/screenshot-cursor-camera/100181" target="_blank" rel="noreferrer">Luc Chaissac</a></li>`},m(t,r){w(t,e,r)},p:Z,i:Z,o:Z,d(t){t&&$(e)}}}class np extends ee{constructor(e){super(),te(this,e,null,rw,Q,{})}}const nw="/scheme-sketcher/assets/camera_cursor-824d29b6.svg",{window:iw}=Wf;function Lf(n){let e,t,r,i;const o=[sw,ow],s=[];function a(l,f){return l[0]?0:1}return e=a(n),t=s[e]=o[e](n),{c(){t.c(),r=ve()},m(l,f){s[e].m(l,f),w(l,r,f),i=!0},p(l,f){let c=e;e=a(l),e===c?s[e].p(l,f):(fe(),E(s[c],1,1,()=>{s[c]=null}),ue(),t=s[e],t?t.p(l,f):(t=s[e]=o[e](l),t.c()),S(t,1),t.m(r.parentNode,r))},i(l){i||(S(t),i=!0)},o(l){E(t),i=!1},d(l){l&&$(r),s[e].d(l)}}}function ow(n){let e,t;return e=new ce({props:{$$slots:{default:[aw]},$$scope:{ctx:n}}}),e.$on("click",n[8]),{c(){L(e.$$.fragment)},m(r,i){A(e,r,i),t=!0},p(r,i){const o={};i&8192&&(o.$$scope={dirty:i,ctx:r}),e.$set(o)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){E(e.$$.fragment,r),t=!1},d(r){C(e,r)}}}function sw(n){let e,t,r,i,o,s,a;e=new ce({props:{$$slots:{default:[lw]},$$scope:{ctx:n}}}),e.$on("click",n[6]);function l(c){n[7](c)}let f={legend:"Source",choices:[["google","Google Street View"],["bing","Bing Streetside"]]};return n[2].streetViewImagery!==void 0&&(f.value=n[2].streetViewImagery),r=new Zf({props:f}),Me.push(()=>Be(r,"value",l)),s=new Gp({props:{label:"Help",$$slots:{default:[fw]},$$scope:{ctx:n}}}),{c(){L(e.$$.fragment),t=I(),L(r.$$.fragment),o=I(),L(s.$$.fragment)},m(c,u){A(e,c,u),w(c,t,u),A(r,c,u),w(c,o,u),A(s,c,u),a=!0},p(c,u){const h={};u&8192&&(h.$$scope={dirty:u,ctx:c}),e.$set(h);const p={};!i&&u&4&&(i=!0,p.value=c[2].streetViewImagery,He(()=>i=!1)),r.$set(p);const g={};u&8192&&(g.$$scope={dirty:u,ctx:c}),s.$set(g)},i(c){a||(S(e.$$.fragment,c),S(r.$$.fragment,c),S(s.$$.fragment,c),a=!0)},o(c){E(e.$$.fragment,c),E(r.$$.fragment,c),E(s.$$.fragment,c),a=!1},d(c){c&&($(t),$(o)),C(e,c),C(r,c),C(s,c)}}}function aw(n){let e;return{c(){e=z("Enable Street View")},m(t,r){w(t,e,r)},d(t){t&&$(e)}}}function lw(n){let e;return{c(){e=z("Disable Street View")},m(t,r){w(t,e,r)},d(t){t&&$(e)}}}function fw(n){let e,t;return e=new np({}),{c(){L(e.$$.fragment)},m(r,i){A(e,r,i),t=!0},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){E(e.$$.fragment,r),t=!1},d(r){C(e,r)}}}function uw(n){let e,t,r,i,o=n[1]&&Lf(n);return{c(){o&&o.c(),e=ve()},m(s,a){o&&o.m(s,a),w(s,e,a),t=!0,r||(i=ge(iw,"keydown",n[3]),r=!0)},p(s,[a]){s[1]?o?(o.p(s,a),a&2&&S(o,1)):(o=Lf(s),o.c(),S(o,1),o.m(e.parentNode,e)):o&&(fe(),E(o,1,1,()=>{o=null}),ue())},i(s){t||(S(o),t=!0)},o(s){E(o),t=!1},d(s){s&&$(e),o&&o.d(s),r=!1,i()}}}function cw(n,e,t){let r;X(n,gr,v=>t(2,r=v));let{cfg:i}=e,{map:o}=e,{enabled:s}=e,{showControls:a=!0}=e,l=[];function f(){if(o){o.on("click",u),o.getCanvas().style.cursor=`url(${nw}), auto`;for(let v of i.getStreetViewRoadLayerNames(o))l.push([v,o.getPaintProperty(v,"line-color")]),o.setPaintProperty(v,"line-color","cyan")}}function c(){if(o){o.off("click",u),o.getCanvas().style.cursor="inherit";for(let[v,_]of l)o.setPaintProperty(v,"line-color",_);l=[]}}et(c);function u(v){if(!s)return;let _=v.lngLat.lng,y=v.lngLat.lat;r.streetViewImagery=="google"?window.open(`http://maps.google.com/maps?q=&layer=c&cbll=${y},${_}&cbp=11,0,0,0,0`,"_blank"):r.streetViewImagery=="bing"&&window.open(`https://www.bing.com/maps?cp=${y}~${_}&style=x`,"_blank")}function h(v){s&&v.key=="Escape"&&(v.stopPropagation(),t(0,s=!1))}const p=()=>t(0,s=!1);function g(v){n.$$.not_equal(r.streetViewImagery,v)&&(r.streetViewImagery=v,gr.set(r))}const d=()=>t(0,s=!0);return n.$$set=v=>{"cfg"in v&&t(4,i=v.cfg),"map"in v&&t(5,o=v.map),"enabled"in v&&t(0,s=v.enabled),"showControls"in v&&t(1,a=v.showControls)},n.$$.update=()=>{n.$$.dirty&1&&(s?f():c())},[s,a,r,h,i,o,p,g,d]}class pw extends ee{constructor(e){super(),te(this,e,cw,uw,Q,{cfg:4,map:5,enabled:0,showControls:1})}}const hw="/scheme-sketcher/assets/warning-81bba3f6.svg";function gw(n){let e,t;return{c(){e=G("img"),tt(e.src,t=hw)||j(e,"src",t),j(e,"title",n[0]),j(e,"alt",n[0])},m(r,i){w(r,e,i)},p(r,[i]){i&1&&j(e,"title",r[0]),i&1&&j(e,"alt",r[0])},i:Z,o:Z,d(r){r&&$(e)}}}function dw(n,e,t){let{text:r}=e;return n.$$set=i=>{"text"in i&&t(0,r=i.text)},[r]}class mw extends ee{constructor(e){super(),te(this,e,dw,gw,Q,{text:0})}}async function yw(n,e){let t=await fetch(n),r=t.body.getReader(),i=t.headers.get("Content-Length");if(!i)throw new Error(`No Content-Length header from ${n}`);let o=parseInt(i),s=0,a=[];for(;;){let{done:c,value:u}=await r.read();if(c)break;u&&(a.push(u),s+=u.length,e(100*s/o))}let l=new Uint8Array(s),f=0;for(let c of a)l.set(c,f),f+=c.length;return l}function vw(n){let e;return{c(){e=z("Finish")},m(t,r){w(t,e,r)},d(t){t&&$(e)}}}function _w(n){let e,t,r,i,o,s,a,l,f,c;function u(d){n[4](d)}let h={cfg:n[0],map:n[2],showControls:!1};n[1]!==void 0&&(h.enabled=n[1]),e=new pw({props:h}),Me.push(()=>Be(e,"enabled",u)),i=new Ot({props:{$$slots:{default:[vw]},$$scope:{ctx:n}}}),i.$on("click",n[5]);function p(d){n[6](d)}let g={legend:"Source",choices:[["google","Google Street View"],["bing","Bing Streetside"]],inlineSmall:!0};return n[3].streetViewImagery!==void 0&&(g.value=n[3].streetViewImagery),s=new Zf({props:g}),Me.push(()=>Be(s,"value",p)),f=new np({}),{c(){L(e.$$.fragment),r=I(),L(i.$$.fragment),o=I(),L(s.$$.fragment),l=I(),L(f.$$.fragment)},m(d,v){A(e,d,v),w(d,r,v),A(i,d,v),w(d,o,v),A(s,d,v),w(d,l,v),A(f,d,v),c=!0},p(d,[v]){const _={};v&1&&(_.cfg=d[0]),v&4&&(_.map=d[2]),!t&&v&2&&(t=!0,_.enabled=d[1],He(()=>t=!1)),e.$set(_);const y={};v&128&&(y.$$scope={dirty:v,ctx:d}),i.$set(y);const m={};!a&&v&8&&(a=!0,m.value=d[3].streetViewImagery,He(()=>a=!1)),s.$set(m)},i(d){c||(S(e.$$.fragment,d),S(i.$$.fragment,d),S(s.$$.fragment,d),S(f.$$.fragment,d),c=!0)},o(d){E(e.$$.fragment,d),E(i.$$.fragment,d),E(s.$$.fragment,d),E(f.$$.fragment,d),c=!1},d(d){d&&($(r),$(o),$(l)),C(e,d),C(i,d),C(s,d),C(f,d)}}}function bw(n,e,t){let r,i;X(n,xe,c=>t(2,r=c)),X(n,gr,c=>t(3,i=c));let{cfg:o}=e,s=!0;function a(c){s=c,t(1,s)}const l=()=>t(1,s=!1);function f(c){n.$$.not_equal(i.streetViewImagery,c)&&(i.streetViewImagery=c,gr.set(i))}return n.$$set=c=>{"cfg"in c&&t(0,o=c.cfg)},n.$$.update=()=>{n.$$.dirty&2&&(s||oe.set({mode:"list"}))},[o,s,r,i,a,l,f]}class ww extends ee{constructor(e){super(),te(this,e,bw,_w,Q,{cfg:0})}}const $w="/scheme-sketcher/assets/image-3e3a13e8.svg",Sw="/scheme-sketcher/assets/point-276f4055.svg",kw="/scheme-sketcher/assets/polygon_freehand-cf965967.svg",Ew="/scheme-sketcher/assets/polygon_snapped-18efbbea.svg",Mw="/scheme-sketcher/assets/route-d3c0ebad.svg",Pw="/scheme-sketcher/assets/street_view-48580b6a.svg";function Lw(n){let e,t,r;return{c(){e=G("img"),r=z(`
    New point`),tt(e.src,t=Sw)||j(e,"src",t),j(e,"alt","New point")},m(i,o){w(i,e,o),w(i,r,o)},p:Z,d(i){i&&($(e),$(r))}}}function Aw(n){let e,t,r;return{c(){e=G("img"),r=z(`
    New route`),tt(e.src,t=Mw)||j(e,"src",t),j(e,"alt","New route")},m(i,o){w(i,e,o),w(i,r,o)},p:Z,d(i){i&&($(e),$(r))}}}function Cw(n){let e,t,r;return{c(){e=G("img"),r=z(`
    New polygon (freehand)`),tt(e.src,t=kw)||j(e,"src",t),j(e,"alt","New polygon (freehand)")},m(i,o){w(i,e,o),w(i,r,o)},p:Z,d(i){i&&($(e),$(r))}}}function Fw(n){let e,t,r;return{c(){e=G("img"),r=z(`
    New polygon (snapped)`),tt(e.src,t=Ew)||j(e,"src",t),j(e,"alt","New polygon (snapped)")},m(i,o){w(i,e,o),w(i,r,o)},p:Z,d(i){i&&($(e),$(r))}}}function Ow(n){let e,t,r;return{c(){e=G("img"),r=z(`
    Split route`),tt(e.src,t=tp)||j(e,"src",t),j(e,"alt","Split route")},m(i,o){w(i,e,o),w(i,r,o)},p:Z,d(i){i&&($(e),$(r))}}}function Rw(n){let e,t,r;return{c(){e=G("img"),r=z(`
    Georeference image`),tt(e.src,t=$w)||j(e,"src",t),j(e,"alt","Georeference image")},m(i,o){w(i,e,o),w(i,r,o)},p:Z,d(i){i&&($(e),$(r))}}}function Bw(n){let e,t,r;return{c(){e=G("img"),r=z(`
    StreetView`),tt(e.src,t=Pw)||j(e,"src",t),j(e,"alt","StreetView")},m(i,o){w(i,e,o),w(i,r,o)},p:Z,d(i){i&&($(e),$(r))}}}function Iw(n){let e,t,r,i,o,s,a,l,f,c,u,h,p,g,d,v,_;return e=new Ub({props:{cfg:n[0],gjSchemes:n[1]}}),i=new ce({props:{disabled:!n[2],$$slots:{default:[Lw]},$$scope:{ctx:n}}}),i.$on("click",n[5]),s=new ce({props:{disabled:!n[3],$$slots:{default:[Aw]},$$scope:{ctx:n}}}),s.$on("click",n[6]),l=new ce({props:{disabled:!n[4],$$slots:{default:[Cw]},$$scope:{ctx:n}}}),l.$on("click",n[7]),c=new ce({props:{disabled:!n[3],$$slots:{default:[Fw]},$$scope:{ctx:n}}}),c.$on("click",n[8]),h=new ce({props:{$$slots:{default:[Ow]},$$scope:{ctx:n}}}),h.$on("click",n[9]),g=new ce({props:{$$slots:{default:[Rw]},$$scope:{ctx:n}}}),g.$on("click",n[10]),v=new ce({props:{$$slots:{default:[Bw]},$$scope:{ctx:n}}}),v.$on("click",n[11]),{c(){L(e.$$.fragment),t=I(),r=G("div"),L(i.$$.fragment),o=I(),L(s.$$.fragment),a=I(),L(l.$$.fragment),f=I(),L(c.$$.fragment),u=I(),L(h.$$.fragment),p=I(),L(g.$$.fragment),d=I(),L(v.$$.fragment),j(r,"class","top govuk-prose svelte-1kai3ke")},m(y,m){A(e,y,m),w(y,t,m),w(y,r,m),A(i,r,null),D(r,o),A(s,r,null),D(r,a),A(l,r,null),D(r,f),A(c,r,null),D(r,u),A(h,r,null),D(r,p),A(g,r,null),D(r,d),A(v,r,null),_=!0},p(y,[m]){const k={};m&1&&(k.cfg=y[0]),m&2&&(k.gjSchemes=y[1]),e.$set(k);const b={};m&4&&(b.disabled=!y[2]),m&4096&&(b.$$scope={dirty:m,ctx:y}),i.$set(b);const P={};m&8&&(P.disabled=!y[3]),m&4096&&(P.$$scope={dirty:m,ctx:y}),s.$set(P);const R={};m&16&&(R.disabled=!y[4]),m&4096&&(R.$$scope={dirty:m,ctx:y}),l.$set(R);const N={};m&8&&(N.disabled=!y[3]),m&4096&&(N.$$scope={dirty:m,ctx:y}),c.$set(N);const q={};m&4096&&(q.$$scope={dirty:m,ctx:y}),h.$set(q);const T={};m&4096&&(T.$$scope={dirty:m,ctx:y}),g.$set(T);const F={};m&4096&&(F.$$scope={dirty:m,ctx:y}),v.$set(F)},i(y){_||(S(e.$$.fragment,y),S(i.$$.fragment,y),S(s.$$.fragment,y),S(l.$$.fragment,y),S(c.$$.fragment,y),S(h.$$.fragment,y),S(g.$$.fragment,y),S(v.$$.fragment,y),_=!0)},o(y){E(e.$$.fragment,y),E(i.$$.fragment,y),E(s.$$.fragment,y),E(l.$$.fragment,y),E(c.$$.fragment,y),E(h.$$.fragment,y),E(g.$$.fragment,y),E(v.$$.fragment,y),_=!1},d(y){y&&($(t),$(r)),C(e,y),C(i),C(s),C(l),C(c),C(h),C(g),C(v)}}}function Nw(n,e,t){let r,i,o;X(n,tn,d=>t(2,r=d)),X(n,Ct,d=>t(3,i=d)),X(n,hr,d=>t(4,o=d));let{cfg:s}=e,{gjSchemes:a}=e;const l=()=>oe.set({mode:"new-point"}),f=()=>oe.set({mode:"new-route"}),c=()=>oe.set({mode:"new-freehand-polygon"}),u=()=>oe.set({mode:"new-snapped-polygon"}),h=()=>oe.set({mode:"split-route"}),p=()=>oe.set({mode:"set-image"}),g=()=>oe.set({mode:"streetview"});return n.$$set=d=>{"cfg"in d&&t(0,s=d.cfg),"gjSchemes"in d&&t(1,a=d.gjSchemes)},[s,a,r,i,o,l,f,c,u,h,p,g]}class Tw extends ee{constructor(e){super(),te(this,e,Nw,Iw,Q,{cfg:0,gjSchemes:1})}}function Gw(n){let e;return{c(){e=z("Save")},m(t,r){w(t,e,r)},d(t){t&&$(e)}}}function Dw(n){let e;return{c(){e=z("Edit geometry")},m(t,r){w(t,e,r)},d(t){t&&$(e)}}}function jw(n){let e;return{c(){e=z("Delete")},m(t,r){w(t,e,r)},d(t){t&&$(e)}}}function Uw(n){let e,t,r,i,o,s;return e=new Ot({props:{$$slots:{default:[Gw]},$$scope:{ctx:n}}}),e.$on("click",n[5]),r=new ce({props:{$$slots:{default:[Dw]},$$scope:{ctx:n}}}),r.$on("click",n[6]),o=new Ar({props:{$$slots:{default:[jw]},$$scope:{ctx:n}}}),o.$on("click",n[7]),{c(){L(e.$$.fragment),t=I(),L(r.$$.fragment),i=I(),L(o.$$.fragment)},m(a,l){A(e,a,l),w(a,t,l),A(r,a,l),w(a,i,l),A(o,a,l),s=!0},p(a,l){const f={};l&8192&&(f.$$scope={dirty:l,ctx:a}),e.$set(f);const c={};l&8192&&(c.$$scope={dirty:l,ctx:a}),r.$set(c);const u={};l&8192&&(u.$$scope={dirty:l,ctx:a}),o.$set(u)},i(a){s||(S(e.$$.fragment,a),S(r.$$.fragment,a),S(o.$$.fragment,a),s=!0)},o(a){E(e.$$.fragment,a),E(r.$$.fragment,a),E(o.$$.fragment,a),s=!1},d(a){a&&($(t),$(i)),C(e,a),C(r,a),C(o,a)}}}function qw(n){let e,t,r=n[0].interventionName(n[3])+"",i,o,s,a,l,f,c,u,h,p,g,d;s=new Ut({props:{$$slots:{default:[Uw]},$$scope:{ctx:n}}}),l=new Lr({props:{errorMessage:n[0].interventionWarning(n[3])}});function v(m){n[8](m)}var _=n[0].editFeatureForm;function y(m,k){let b={cfg:m[0],gjSchemes:m[1],id:m[2]};return m[3].properties!==void 0&&(b.props=m[3].properties),{props:b}}return _&&(c=ei(_,y(n)),Me.push(()=>Be(c,"props",v))),{c(){e=G("h2"),t=z("Editing "),i=z(r),o=I(),L(s.$$.fragment),a=I(),L(l.$$.fragment),f=I(),c&&L(c.$$.fragment),h=ve()},m(m,k){w(m,e,k),D(e,t),D(e,i),w(m,o,k),A(s,m,k),w(m,a,k),A(l,m,k),w(m,f,k),c&&A(c,m,k),w(m,h,k),p=!0,g||(d=ge(window,"keydown",n[4]),g=!0)},p(m,[k]){(!p||k&9)&&r!==(r=m[0].interventionName(m[3])+"")&&ye(i,r);const b={};k&8198&&(b.$$scope={dirty:k,ctx:m}),s.$set(b);const P={};if(k&9&&(P.errorMessage=m[0].interventionWarning(m[3])),l.$set(P),k&1&&_!==(_=m[0].editFeatureForm)){if(c){fe();const R=c;E(R.$$.fragment,1,0,()=>{C(R,1)}),ue()}_?(c=ei(_,y(m)),Me.push(()=>Be(c,"props",v)),L(c.$$.fragment),S(c.$$.fragment,1),A(c,h.parentNode,h)):c=null}else if(_){const R={};k&1&&(R.cfg=m[0]),k&2&&(R.gjSchemes=m[1]),k&4&&(R.id=m[2]),!u&&k&8&&(u=!0,R.props=m[3].properties,He(()=>u=!1)),c.$set(R)}},i(m){p||(S(s.$$.fragment,m),S(l.$$.fragment,m),c&&S(c.$$.fragment,m),p=!0)},o(m){E(s.$$.fragment,m),E(l.$$.fragment,m),c&&E(c.$$.fragment,m),p=!1},d(m){m&&($(e),$(o),$(a),$(f),$(h)),C(s,m),C(l,m),c&&C(c,m),g=!1,d()}}}function zw(n,e,t){let r,i,o=Z,s=()=>(o(),o=At(l,y=>t(10,i=y)),l);X(n,xe,y=>t(9,r=y)),n.$$.on_destroy.push(()=>o());let{cfg:a}=e,{gjSchemes:l}=e;s();let{id:f}=e,c=i.features.find(y=>y.id==f);function u(y){l.set(i)}Ft(()=>{r==null||r.on("click",h)}),et(()=>{r==null||r.off("click",h)});function h(y){for(let m of r.queryRenderedFeatures(y.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]}))if(m.id==f)return;oe.set({mode:"list"})}function p(y){if(y.key=="Escape"){y.stopPropagation(),oe.set({mode:"list"});return}if(y.key=="Delete"){const m=y.target.tagName;if(m=="INPUT"||m=="TEXTAREA")return;y.stopPropagation(),Ns(l,f)}if(y.key=="e"){const m=y.target.tagName;if(m=="INPUT"||m=="TEXTAREA")return;y.stopPropagation(),oe.set({mode:"edit-geometry",id:f})}}const g=()=>oe.set({mode:"list"}),d=()=>oe.set({mode:"edit-geometry",id:f}),v=()=>Ns(l,f);function _(y){n.$$.not_equal(c.properties,y)&&(c.properties=y,t(3,c))}return n.$$set=y=>{"cfg"in y&&t(0,a=y.cfg),"gjSchemes"in y&&s(t(1,l=y.gjSchemes)),"id"in y&&t(2,f=y.id)},n.$$.update=()=>{n.$$.dirty&8&&u()},[a,l,f,c,p,g,d,v,_]}class Ww extends ee{constructor(e){super(),te(this,e,zw,qw,Q,{cfg:0,gjSchemes:1,id:2})}}const Hw="/scheme-sketcher/assets/delete-3c023172.svg";function Af(n,e,t){const r=n.slice();r[29]=e[t];const i=r[0].interventionWarning(r[29]);return r[30]=i,r}function Jw(n){let e,t,r;return{c(){e=G("img"),r=z(`
    Delete`),tt(e.src,t=Hw)||j(e,"src",t),j(e,"alt","Delete scheme")},m(i,o){w(i,e,o),w(i,r,o)},p:Z,d(i){i&&($(e),$(r))}}}function Yw(n){let e;return{c(){e=z("Show")},m(t,r){w(t,e,r)},d(t){t&&$(e)}}}function Xw(n){let e,t;return e=new Lr({props:{errorMessage:"There's a problem with "+n[8]+" interventions below"}}),{c(){L(e.$$.fragment)},m(r,i){A(e,r,i),t=!0},p(r,i){const o={};i[0]&256&&(o.errorMessage="There's a problem with "+r[8]+" interventions below"),e.$set(o)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){E(e.$$.fragment,r),t=!1},d(r){C(e,r)}}}function Vw(n){let e,t;return e=new Lr({props:{errorMessage:"There's a problem with one intervention below"}}),{c(){L(e.$$.fragment)},m(r,i){A(e,r,i),t=!0},p:Z,i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){E(e.$$.fragment,r),t=!1},d(r){C(e,r)}}}function Cf(n){let e,t;return e=new mw({props:{text:n[30]}}),{c(){L(e.$$.fragment)},m(r,i){A(e,r,i),t=!0},p(r,i){const o={};i[0]&13&&(o.text=r[30]),e.$set(o)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){E(e.$$.fragment,r),t=!1},d(r){C(e,r)}}}function Ff(n,e){let t,r,i,o=e[0].interventionName(e[29])+"",s,a,l,f,c,u=e[30]&&Cf(e);function h(...d){return e[20](e[29],...d)}function p(){return e[21](e[29])}function g(){return e[22](e[29])}return{key:n,first:null,c(){t=G("li"),r=G("a"),u&&u.c(),i=I(),s=z(o),a=I(),j(r,"href","#"),this.first=t},m(d,v){w(d,t,v),D(t,r),u&&u.m(r,null),D(r,i),D(r,s),D(t,a),l=!0,f||(c=[ge(r,"click",h),ge(r,"mouseenter",p),ge(r,"mouseleave",g)],f=!0)},p(d,v){e=d,e[30]?u?(u.p(e,v),v[0]&13&&S(u,1)):(u=Cf(e),u.c(),S(u,1),u.m(r,i)):u&&(fe(),E(u,1,1,()=>{u=null}),ue()),(!l||v[0]&13)&&o!==(o=e[0].interventionName(e[29])+"")&&ye(s,o)},i(d){l||(S(u),l=!0)},o(d){E(u),l=!1},d(d){d&&$(t),u&&u.d(),f=!1,Pr(c)}}}function Of(n){let e,t,r,i,o=n[7]==1?"intervention":"interventions",s,a,l,f,c,u;function h(g){n[23](g)}let p={label:"Move interventions to another scheme",choices:n[13]()};return n[5]!==void 0&&(p.value=n[5]),f=new bp({props:p}),Me.push(()=>Be(f,"value",h)),f.$on("change",n[12]),{c(){e=G("p"),t=z("Do you want to first move "),r=z(n[7]),i=I(),s=z(o),a=z(" to another scheme?"),l=I(),L(f.$$.fragment)},m(g,d){w(g,e,d),D(e,t),D(e,r),D(e,i),D(e,s),D(e,a),w(g,l,d),A(f,g,d),u=!0},p(g,d){(!u||d[0]&128)&&ye(r,g[7]),(!u||d[0]&128)&&o!==(o=g[7]==1?"intervention":"interventions")&&ye(s,o);const v={};!c&&d[0]&32&&(c=!0,v.value=g[5],He(()=>c=!1)),f.$set(v)},i(g){u||(S(f.$$.fragment,g),u=!0)},o(g){E(f.$$.fragment,g),u=!1},d(g){g&&($(e),$(l)),C(f,g)}}}function Kw(n){let e;return{c(){e=z("Delete scheme")},m(t,r){w(t,e,r)},d(t){t&&$(e)}}}function Zw(n){let e;return{c(){e=z("Cancel")},m(t,r){w(t,e,r)},d(t){t&&$(e)}}}function Qw(n){let e,t,r,i;return e=new Ar({props:{$$slots:{default:[Kw]},$$scope:{ctx:n}}}),e.$on("click",n[11]),r=new ce({props:{$$slots:{default:[Zw]},$$scope:{ctx:n}}}),r.$on("click",n[24]),{c(){L(e.$$.fragment),t=I(),L(r.$$.fragment)},m(o,s){A(e,o,s),w(o,t,s),A(r,o,s),i=!0},p(o,s){const a={};s[0]&67108864&&(a.$$scope={dirty:s,ctx:o}),e.$set(a);const l={};s[0]&67108864&&(l.$$scope={dirty:s,ctx:o}),r.$set(l)},i(o){i||(S(e.$$.fragment,o),S(r.$$.fragment,o),i=!0)},o(o){E(e.$$.fragment,o),E(r.$$.fragment,o),i=!1},d(o){o&&$(t),C(e,o),C(r,o)}}}function xw(n){let e=n[7]>0&&n[13]().length>0,t,r,i,o=e&&Of(n);return r=new Ut({props:{$$slots:{default:[Qw]},$$scope:{ctx:n}}}),{c(){o&&o.c(),t=I(),L(r.$$.fragment)},m(s,a){o&&o.m(s,a),w(s,t,a),A(r,s,a),i=!0},p(s,a){a[0]&128&&(e=s[7]>0&&s[13]().length>0),e?o?(o.p(s,a),a[0]&128&&S(o,1)):(o=Of(s),o.c(),S(o,1),o.m(t.parentNode,t)):o&&(fe(),E(o,1,1,()=>{o=null}),ue());const l={};a[0]&67108880&&(l.$$scope={dirty:a,ctx:s}),r.$set(l)},i(s){i||(S(o),S(r.$$.fragment,s),i=!0)},o(s){E(o),E(r.$$.fragment,s),i=!1},d(s){s&&$(t),o&&o.d(s),C(r,s)}}}function e$(n){let e,t=n[0].schemeName(n[3].schemes[n[2]])+"",r,i,o,s,a,l,f,c,u,h,p,g,d,v,_,y,m=[],k=new Map,b,P,R,N,q,T;a=new Ar({props:{$$slots:{default:[Jw]},$$scope:{ctx:n}}}),a.$on("click",n[17]);function F(W){n[18](W)}let M={$$slots:{default:[Yw]},$$scope:{ctx:n}};n[6]!==void 0&&(M.checked=n[6]),f=new uo({props:M}),Me.push(()=>Be(f,"checked",F)),f.$on("change",n[14]);const O=n[15].default,U=Ue(O,n,n[26],null);var ne=n[0].editSchemeForm;function V(W,K){return{props:{gjSchemes:W[1],scheme_reference:W[2]}}}ne&&(p=ei(ne,V(n)));const H=[Vw,Xw],B=[];function x(W,K){return W[8]==1?0:W[8]>0?1:-1}~(d=x(n))&&(v=B[d]=H[d](n));let le=ot(n[3].features.filter(n[19]));const Ne=W=>W[29].id;for(let W=0;W<le.length;W+=1){let K=Af(n,le,W),rt=Ne(K);k.set(rt,m[W]=Ff(rt,K))}function Se(W){n[25](W)}let _e={title:"Delete this scheme?",displayEscapeButton:!1,$$slots:{default:[xw]},$$scope:{ctx:n}};return n[4]!==void 0&&(_e.open=n[4]),P=new rp({props:_e}),Me.push(()=>Be(P,"open",Se)),{c(){e=G("h3"),r=z(t),i=I(),o=G("input"),s=I(),L(a.$$.fragment),l=I(),L(f.$$.fragment),u=I(),U&&U.c(),h=I(),p&&L(p.$$.fragment),g=I(),v&&v.c(),_=I(),y=G("ol");for(let W=0;W<m.length;W+=1)m[W].c();b=I(),L(P.$$.fragment),j(o,"type","color"),j(y,"class","govuk-list govuk-list--number")},m(W,K){w(W,e,K),D(e,r),D(e,i),D(e,o),pr(o,n[3].schemes[n[2]].color),D(e,s),A(a,e,null),w(W,l,K),A(f,W,K),w(W,u,K),U&&U.m(W,K),w(W,h,K),p&&A(p,W,K),w(W,g,K),~d&&B[d].m(W,K),w(W,_,K),w(W,y,K);for(let rt=0;rt<m.length;rt+=1)m[rt]&&m[rt].m(y,null);w(W,b,K),A(P,W,K),N=!0,q||(T=ge(o,"input",n[16]),q=!0)},p(W,K){(!N||K[0]&13)&&t!==(t=W[0].schemeName(W[3].schemes[W[2]])+"")&&ye(r,t),K[0]&12&&pr(o,W[3].schemes[W[2]].color);const rt={};K[0]&67108864&&(rt.$$scope={dirty:K,ctx:W}),a.$set(rt);const J={};if(K[0]&67108864&&(J.$$scope={dirty:K,ctx:W}),!c&&K[0]&64&&(c=!0,J.checked=W[6],He(()=>c=!1)),f.$set(J),U&&U.p&&(!N||K[0]&67108864)&&qe(U,O,W,W[26],N?We(O,W[26],K,null):ze(W[26]),null),K[0]&1&&ne!==(ne=W[0].editSchemeForm)){if(p){fe();const Ce=p;E(Ce.$$.fragment,1,0,()=>{C(Ce,1)}),ue()}ne?(p=ei(ne,V(W)),L(p.$$.fragment),S(p.$$.fragment,1),A(p,g.parentNode,g)):p=null}else if(ne){const Ce={};K[0]&2&&(Ce.gjSchemes=W[1]),K[0]&4&&(Ce.scheme_reference=W[2]),p.$set(Ce)}let ke=d;d=x(W),d===ke?~d&&B[d].p(W,K):(v&&(fe(),E(B[ke],1,1,()=>{B[ke]=null}),ue()),~d?(v=B[d],v?v.p(W,K):(v=B[d]=H[d](W),v.c()),S(v,1),v.m(_.parentNode,_)):v=null),K[0]&1549&&(le=ot(W[3].features.filter(W[19])),fe(),m=ns(m,K,Ne,1,W,le,k,y,is,Ff,null,Af),ue());const nr={};K[0]&67109040&&(nr.$$scope={dirty:K,ctx:W}),!R&&K[0]&16&&(R=!0,nr.open=W[4],He(()=>R=!1)),P.$set(nr)},i(W){if(!N){S(a.$$.fragment,W),S(f.$$.fragment,W),S(U,W),p&&S(p.$$.fragment,W),S(v);for(let K=0;K<le.length;K+=1)S(m[K]);S(P.$$.fragment,W),N=!0}},o(W){E(a.$$.fragment,W),E(f.$$.fragment,W),E(U,W),p&&E(p.$$.fragment,W),E(v);for(let K=0;K<m.length;K+=1)E(m[K]);E(P.$$.fragment,W),N=!1},d(W){W&&($(e),$(l),$(u),$(h),$(g),$(_),$(y),$(b)),C(a),C(f,W),U&&U.d(W),p&&C(p,W),~d&&B[d].d(W);for(let K=0;K<m.length;K+=1)m[K].d();C(P,W),q=!1,T()}}}function t$(n,e,t){let r,i,o,s,a=Z,l=()=>(a(),a=At(p,B=>t(3,s=B)),p),f;X(n,Bn,B=>t(27,o=B)),X(n,xe,B=>t(28,f=B)),n.$$.on_destroy.push(()=>a());let{$$slots:c={},$$scope:u}=e,{cfg:h}=e,{gjSchemes:p}=e;l();let{scheme_reference:g}=e,d=!1;et(()=>{Rn.set(null)});function v(B,x){B.preventDefault();let le=s.features.find(Ne=>Ne.id==x);le.geometry.type=="Point"?f==null||f.flyTo({center:le.geometry.coordinates,duration:500}):f==null||f.fitBounds(Ic(le),{padding:200,duration:500}),oe.set({mode:"edit-form",id:x})}function _(B){Rn.update(x=>x==B?null:x)}function y(){p.update(B=>(B.features=B.features.filter(x=>x.properties.scheme_reference!=g),delete B.schemes[g],Object.keys(B.schemes).length==0&&(B=Vf(h)),B)),Bn.update(B=>(B.delete(g),B)),t(4,d=!1)}let m="";function k(){m&&p.update(B=>{for(let x of B.features)x.properties.scheme_reference==g&&(x.properties.scheme_reference=m);return B})}function b(){return Object.values(s.schemes).filter(B=>B.scheme_reference!=g).map(B=>[B.scheme_reference,h.schemeName(B)])}let P=!o.has(g);function R(){Bn.update(B=>(P?B.delete(g):B.add(g),B))}function N(){s.schemes[g].color=this.value,p.set(s)}const q=()=>t(4,d=!0);function T(B){P=B,t(6,P)}const F=B=>B.properties.scheme_reference==g,M=(B,x)=>v(x,B.id),O=B=>Rn.set(B.id),U=B=>_(B.id);function ne(B){m=B,t(5,m)}const V=()=>t(4,d=!1);function H(B){d=B,t(4,d)}return n.$$set=B=>{"cfg"in B&&t(0,h=B.cfg),"gjSchemes"in B&&l(t(1,p=B.gjSchemes)),"scheme_reference"in B&&t(2,g=B.scheme_reference),"$$scope"in B&&t(26,u=B.$$scope)},n.$$.update=()=>{n.$$.dirty[0]&13&&t(8,r=s.features.filter(B=>B.properties.scheme_reference==g&&h.interventionWarning(B)!=null).length),n.$$.dirty[0]&12&&t(7,i=s.features.filter(B=>B.properties.scheme_reference==g).length)},[h,p,g,s,d,m,P,i,r,v,_,y,k,b,R,c,N,q,T,F,M,O,U,ne,V,H,u]}class r$ extends ee{constructor(e){super(),te(this,e,t$,e$,Q,{cfg:0,gjSchemes:1,scheme_reference:2},null,[-1,-1])}}function Rf(n,e,t){const r=n.slice();return r[9]=e[t],r[11]=t,r}function n$(n){let e;return{c(){e=z("Add new blank scheme")},m(t,r){w(t,e,r)},d(t){t&&$(e)}}}function Bf(n){let e,t,r,i;function o(){return n[7](n[9])}e=new ce({props:{disabled:n[11]==0,$$slots:{default:[i$]},$$scope:{ctx:n}}}),e.$on("click",o);function s(){return n[8](n[9])}return r=new ce({props:{disabled:n[11]==Object.keys(n[3].schemes).length-1,$$slots:{default:[o$]},$$scope:{ctx:n}}}),r.$on("click",s),{c(){L(e.$$.fragment),t=I(),L(r.$$.fragment)},m(a,l){A(e,a,l),w(a,t,l),A(r,a,l),i=!0},p(a,l){n=a;const f={};l&8&&(f.disabled=n[11]==0),l&4096&&(f.$$scope={dirty:l,ctx:n}),e.$set(f);const c={};l&8&&(c.disabled=n[11]==Object.keys(n[3].schemes).length-1),l&4096&&(c.$$scope={dirty:l,ctx:n}),r.$set(c)},i(a){i||(S(e.$$.fragment,a),S(r.$$.fragment,a),i=!0)},o(a){E(e.$$.fragment,a),E(r.$$.fragment,a),i=!1},d(a){a&&$(t),C(e,a),C(r,a)}}}function i$(n){let e;return{c(){e=z("Move up")},m(t,r){w(t,e,r)},d(t){t&&$(e)}}}function o$(n){let e;return{c(){e=z("Move down")},m(t,r){w(t,e,r)},d(t){t&&$(e)}}}function s$(n){let e=Object.keys(n[3].schemes).length>1,t,r,i=e&&Bf(n);return{c(){i&&i.c(),t=ve()},m(o,s){i&&i.m(o,s),w(o,t,s),r=!0},p(o,s){s&8&&(e=Object.keys(o[3].schemes).length>1),e?i?(i.p(o,s),s&8&&S(i,1)):(i=Bf(o),i.c(),S(i,1),i.m(t.parentNode,t)):i&&(fe(),E(i,1,1,()=>{i=null}),ue())},i(o){r||(S(i),r=!0)},o(o){E(i),r=!1},d(o){o&&$(t),i&&i.d(o)}}}function If(n,e){let t,r,i,o,s;return r=new r$({props:{cfg:e[0],gjSchemes:e[1],scheme_reference:e[9],$$slots:{default:[s$]},$$scope:{ctx:e}}}),{key:n,first:null,c(){t=ve(),L(r.$$.fragment),i=I(),o=G("hr"),this.first=t},m(a,l){w(a,t,l),A(r,a,l),w(a,i,l),w(a,o,l),s=!0},p(a,l){e=a;const f={};l&1&&(f.cfg=e[0]),l&2&&(f.gjSchemes=e[1]),l&8&&(f.scheme_reference=e[9]),l&4104&&(f.$$scope={dirty:l,ctx:e}),r.$set(f)},i(a){s||(S(r.$$.fragment,a),s=!0)},o(a){E(r.$$.fragment,a),s=!1},d(a){a&&($(t),$(i),$(o)),C(r,a)}}}function a$(n){let e,t,r,i,o,s,a,l,f=[],c=new Map,u,h;e=new ce({props:{$$slots:{default:[n$]},$$scope:{ctx:n}}}),e.$on("click",n[4]),r=new Kf({props:{label:"Add scheme from file",onLoad:n[5]}}),o=new Lr({props:{errorMessage:n[2]}});let p=ot(Object.keys(n[3].schemes));const g=d=>d[9];for(let d=0;d<p.length;d+=1){let v=Rf(n,p,d),_=g(v);c.set(_,f[d]=If(_,v))}return{c(){L(e.$$.fragment),t=I(),L(r.$$.fragment),i=I(),L(o.$$.fragment),s=I(),a=G("hr"),l=I();for(let d=0;d<f.length;d+=1)f[d].c();u=ve()},m(d,v){A(e,d,v),w(d,t,v),A(r,d,v),w(d,i,v),A(o,d,v),w(d,s,v),w(d,a,v),w(d,l,v);for(let _=0;_<f.length;_+=1)f[_]&&f[_].m(d,v);w(d,u,v),h=!0},p(d,[v]){const _={};v&4096&&(_.$$scope={dirty:v,ctx:d}),e.$set(_);const y={};v&4&&(y.errorMessage=d[2]),o.$set(y),v&75&&(p=ot(Object.keys(d[3].schemes)),fe(),f=ns(f,v,g,1,d,p,c,u.parentNode,is,If,u,Rf),ue())},i(d){if(!h){S(e.$$.fragment,d),S(r.$$.fragment,d),S(o.$$.fragment,d);for(let v=0;v<p.length;v+=1)S(f[v]);h=!0}},o(d){E(e.$$.fragment,d),E(r.$$.fragment,d),E(o.$$.fragment,d);for(let v=0;v<f.length;v+=1)E(f[v]);h=!1},d(d){d&&($(t),$(i),$(s),$(a),$(l),$(u)),C(e,d),C(r,d),C(o,d);for(let v=0;v<f.length;v+=1)f[v].d(d)}}}function l$(n,e,t){[n[e],n[t]]=[n[t],n[e]]}function f$(n,e){const t={};return n.forEach(r=>{t[r]=e[r]}),t}function u$(n,e,t){let r,i=Z,o=()=>(i(),i=At(a,g=>t(3,r=g)),a);n.$$.on_destroy.push(()=>i());let{cfg:s}=e,{gjSchemes:a}=e;o();function l(){wp(s,r),a.set(r)}let f="";function c(g,d){try{let v=s.backfill(JSON.parse(d));for(let y of Object.values(v.schemes)){if(y.scheme_reference in r.schemes)throw new Error("The file you're loading seems to contain duplicate data. Are you merging in the same file accidentally?");Pe(a,r.schemes[y.scheme_reference]=y,r)}Pe(a,r.features=r.features.concat(v.features),r);let _=1;r.features.forEach(y=>{y.id=_++}),a.set(r),t(2,f="")}catch(v){t(2,f=`Couldn't load scheme from a file: ${v}`)}}function u(g,d){const v=JSON.parse(JSON.stringify(Object.keys(r.schemes))),_=v.indexOf(g);if(_+d>=0&&_+d<v.length){l$(v,_,_+d);const y=f$(v,r.schemes);Pe(a,r.schemes=y,r),a.set(r)}}const h=g=>u(g,-1),p=g=>u(g,1);return n.$$set=g=>{"cfg"in g&&t(0,s=g.cfg),"gjSchemes"in g&&o(t(1,a=g.gjSchemes))},[s,a,f,r,l,c,u,h,p]}class c$ extends ee{constructor(e){super(),te(this,e,u$,a$,Q,{cfg:0,gjSchemes:1})}}function p$(n){let e;return{c(){e=z("Save")},m(t,r){w(t,e,r)},d(t){t&&$(e)}}}function h$(n){let e;return{c(){e=z("Delete")},m(t,r){w(t,e,r)},d(t){t&&$(e)}}}function g$(n){let e,t,r,i;return e=new Ot({props:{$$slots:{default:[p$]},$$scope:{ctx:n}}}),e.$on("click",n[6]),r=new Ar({props:{disabled:!n[2],$$slots:{default:[h$]},$$scope:{ctx:n}}}),r.$on("click",n[4]),{c(){L(e.$$.fragment),t=I(),L(r.$$.fragment)},m(o,s){A(e,o,s),w(o,t,s),A(r,o,s),i=!0},p(o,s){const a={};s&512&&(a.$$scope={dirty:s,ctx:o}),e.$set(a);const l={};s&4&&(l.disabled=!o[2]),s&512&&(l.$$scope={dirty:s,ctx:o}),r.$set(l)},i(o){i||(S(e.$$.fragment,o),S(r.$$.fragment,o),i=!0)},o(o){E(e.$$.fragment,o),E(r.$$.fragment,o),i=!1},d(o){o&&$(t),C(e,o),C(r,o)}}}function d$(n){let e,t,r;return{c(){e=G("input"),j(e,"class","govuk-file-upload"),j(e,"id","load-image"),j(e,"type","file")},m(i,o){w(i,e,o),n[7](e),t||(r=ge(e,"change",n[3]),t=!0)},p:Z,d(i){i&&$(e),n[7](null),t=!1,r()}}}function Nf(n){let e,t,r,i,o,s,a,l;return{c(){e=G("div"),t=G("label"),r=G("input"),i=z(`
      Opacity: `),o=z(n[1]),s=z("%"),j(r,"type","range"),j(r,"min","0"),j(r,"max","100")},m(f,c){w(f,e,c),D(e,t),D(t,r),pr(r,n[1]),D(t,i),D(t,o),D(t,s),a||(l=[ge(r,"change",n[8]),ge(r,"input",n[8])],a=!0)},p(f,c){c&2&&pr(r,f[1]),c&2&&ye(o,f[1])},d(f){f&&$(e),a=!1,Pr(l)}}}function m$(n){let e,t,r,i,o,s,a,l,f;e=new Ut({props:{$$slots:{default:[g$]},$$scope:{ctx:n}}}),r=new jf({props:{label:"Load an image",id:"load-image",$$slots:{default:[d$]},$$scope:{ctx:n}}});let c=n[2]&&Nf(n);return{c(){L(e.$$.fragment),t=I(),L(r.$$.fragment),i=I(),c&&c.c(),o=I(),s=G("p"),s.textContent=`Note this image isn't saved as part of this scheme. When you close this page,
  it'll be lost.`},m(u,h){A(e,u,h),w(u,t,h),A(r,u,h),w(u,i,h),c&&c.m(u,h),w(u,o,h),w(u,s,h),a=!0,l||(f=ge(window,"keydown",n[5]),l=!0)},p(u,[h]){const p={};h&516&&(p.$$scope={dirty:h,ctx:u}),e.$set(p);const g={};h&513&&(g.$$scope={dirty:h,ctx:u}),r.$set(g),u[2]?c?c.p(u,h):(c=Nf(u),c.c(),c.m(o.parentNode,o)):c&&(c.d(1),c=null)},i(u){a||(S(e.$$.fragment,u),S(r.$$.fragment,u),a=!0)},o(u){E(e.$$.fragment,u),E(r.$$.fragment,u),a=!1},d(u){u&&($(t),$(i),$(o),$(s)),C(e,u),C(r,u),c&&c.d(u),l=!1,f()}}}function y$(n,e,t){let r,i;X(n,Kn,h=>t(1,r=h)),X(n,Vn,h=>t(2,i=h));let o;async function s(h){let p=await o.files[0].arrayBuffer(),g=new Blob([new Uint8Array(p)]);Pe(Vn,i=URL.createObjectURL(g),i)}function a(){Pe(Vn,i=null,i),Pe(Kn,r=100,r)}function l(h){h.key=="Escape"&&(h.stopPropagation(),oe.set({mode:"list"}))}const f=()=>oe.set({mode:"list"});function c(h){Me[h?"unshift":"push"](()=>{o=h,t(0,o)})}function u(){r=$p(this.value),Kn.set(r)}return[o,r,i,s,a,l,f,c,u]}class v$ extends ee{constructor(e){super(),te(this,e,y$,m$,Q,{})}}function _$(n){let e;return{c(){e=z("Cancel")},m(t,r){w(t,e,r)},d(t){t&&$(e)}}}function b$(n){let e,t,r,i;return e=new ce({props:{$$slots:{default:[_$]},$$scope:{ctx:n}}}),e.$on("click",n[0]),r=new Nc({props:{editingExisting:!1}}),{c(){L(e.$$.fragment),t=I(),L(r.$$.fragment)},m(o,s){A(e,o,s),w(o,t,s),A(r,o,s),i=!0},p(o,[s]){const a={};s&32&&(a.$$scope={dirty:s,ctx:o}),e.$set(a)},i(o){i||(S(e.$$.fragment,o),S(r.$$.fragment,o),i=!0)},o(o){E(e.$$.fragment,o),E(r.$$.fragment,o),i=!1},d(o){o&&$(t),C(e,o),C(r,o)}}}function w$(n,e,t){let r;X(n,tn,l=>t(3,r=l));let{cfg:i}=e,{gjSchemes:o}=e;Ft(()=>{r.start(),r.addEventListenerSuccess(s),r.addEventListenerFailure(a)}),et(()=>{r.stop(),r.clearEventListeners()});function s(l){l.properties||(l.properties={});let f=l;o.update(c=>(f.id=gn(c),f.properties.scheme_reference=Ci(c),i.newPointFeature(f),c.features.push(f),c)),oe.set({mode:"edit-form",id:f.id})}function a(){oe.set({mode:"list"})}return n.$$set=l=>{"cfg"in l&&t(1,i=l.cfg),"gjSchemes"in l&&t(2,o=l.gjSchemes)},[a,i,o]}class $$ extends ee{constructor(e){super(),te(this,e,w$,b$,Q,{cfg:1,gjSchemes:2})}}function S$(n){let e;return{c(){e=z("Finish")},m(t,r){w(t,e,r)},d(t){t&&$(e)}}}function k$(n){let e;return{c(){e=z("Cancel")},m(t,r){w(t,e,r)},d(t){t&&$(e)}}}function E$(n){let e,t,r,i;return e=new Ot({props:{$$slots:{default:[S$]},$$scope:{ctx:n}}}),e.$on("click",n[1]),r=new ce({props:{$$slots:{default:[k$]},$$scope:{ctx:n}}}),r.$on("click",n[0]),{c(){L(e.$$.fragment),t=I(),L(r.$$.fragment)},m(o,s){A(e,o,s),w(o,t,s),A(r,o,s),i=!0},p(o,s){const a={};s&64&&(a.$$scope={dirty:s,ctx:o}),e.$set(a);const l={};s&64&&(l.$$scope={dirty:s,ctx:o}),r.$set(l)},i(o){i||(S(e.$$.fragment,o),S(r.$$.fragment,o),i=!0)},o(o){E(e.$$.fragment,o),E(r.$$.fragment,o),i=!1},d(o){o&&$(t),C(e,o),C(r,o)}}}function M$(n){let e,t,r,i;return e=new Ut({props:{$$slots:{default:[E$]},$$scope:{ctx:n}}}),r=new Tc({}),{c(){L(e.$$.fragment),t=I(),L(r.$$.fragment)},m(o,s){A(e,o,s),w(o,t,s),A(r,o,s),i=!0},p(o,[s]){const a={};s&64&&(a.$$scope={dirty:s,ctx:o}),e.$set(a)},i(o){i||(S(e.$$.fragment,o),S(r.$$.fragment,o),i=!0)},o(o){E(e.$$.fragment,o),E(r.$$.fragment,o),i=!1},d(o){o&&$(t),C(e,o),C(r,o)}}}function P$(n,e,t){let r;X(n,hr,f=>t(4,r=f));let{cfg:i}=e,{gjSchemes:o}=e;Ft(()=>{r.startNew(),r.addEventListenerSuccess(s),r.addEventListenerFailure(a)}),et(()=>{r.stop(),r.clearEventListeners()});function s(f){f.properties||(f.properties={});let c=f;o.update(u=>(c.id=gn(u),c.properties.scheme_reference=Ci(u),i.newPolygonFeature(c),u.features.push(c),u)),oe.set({mode:"edit-form",id:c.id})}function a(){oe.set({mode:"list"})}function l(){r.finish()}return n.$$set=f=>{"cfg"in f&&t(2,i=f.cfg),"gjSchemes"in f&&t(3,o=f.gjSchemes)},[a,l,i,o]}class L$ extends ee{constructor(e){super(),te(this,e,P$,M$,Q,{cfg:2,gjSchemes:3})}}function A$(n){let e;return{c(){e=z("Finish")},m(t,r){w(t,e,r)},d(t){t&&$(e)}}}function C$(n){let e;return{c(){e=z("Cancel")},m(t,r){w(t,e,r)},d(t){t&&$(e)}}}function F$(n){let e,t,r,i;return e=new Ot({props:{$$slots:{default:[A$]},$$scope:{ctx:n}}}),e.$on("click",n[2]),r=new ce({props:{$$slots:{default:[C$]},$$scope:{ctx:n}}}),r.$on("click",n[1]),{c(){L(e.$$.fragment),t=I(),L(r.$$.fragment)},m(o,s){A(e,o,s),w(o,t,s),A(r,o,s),i=!0},p(o,s){const a={};s&64&&(a.$$scope={dirty:s,ctx:o}),e.$set(a);const l={};s&64&&(l.$$scope={dirty:s,ctx:o}),r.$set(l)},i(o){i||(S(e.$$.fragment,o),S(r.$$.fragment,o),i=!0)},o(o){E(e.$$.fragment,o),E(r.$$.fragment,o),i=!1},d(o){o&&$(t),C(e,o),C(r,o)}}}function O$(n){let e,t,r,i;return e=new Ut({props:{$$slots:{default:[F$]},$$scope:{ctx:n}}}),r=new jc({props:{cfg:n[0],extendRoute:!0}}),{c(){L(e.$$.fragment),t=I(),L(r.$$.fragment)},m(o,s){A(e,o,s),w(o,t,s),A(r,o,s),i=!0},p(o,[s]){const a={};s&64&&(a.$$scope={dirty:s,ctx:o}),e.$set(a);const l={};s&1&&(l.cfg=o[0]),r.$set(l)},i(o){i||(S(e.$$.fragment,o),S(r.$$.fragment,o),i=!0)},o(o){E(e.$$.fragment,o),E(r.$$.fragment,o),i=!1},d(o){o&&$(t),C(e,o),C(r,o)}}}function R$(n,e,t){let r;X(n,Ct,f=>t(4,r=f));let{cfg:i}=e,{gjSchemes:o}=e;Ft(()=>{r.startRoute(),r.addEventListenerSuccess(s),r.addEventListenerFailure(a)}),et(()=>{r.stop(),r.clearEventListeners()});function s(f){let c=f;o.update(u=>(c.id=gn(u),c.properties.scheme_reference=Ci(u),i.newLineStringFeature(c),u.features.push(c),u)),oe.set({mode:"edit-form",id:c.id})}function a(){oe.set({mode:"list"})}function l(){r.finish()}return n.$$set=f=>{"cfg"in f&&t(0,i=f.cfg),"gjSchemes"in f&&t(3,o=f.gjSchemes)},[i,a,l,o]}class B$ extends ee{constructor(e){super(),te(this,e,R$,O$,Q,{cfg:0,gjSchemes:3})}}function I$(n){let e,t;return e=new Lr({props:{errorMessage:"Failed to load route snapper"}}),{c(){L(e.$$.fragment)},m(r,i){A(e,r,i),t=!0},p:Z,i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){E(e.$$.fragment,r),t=!1},d(r){C(e,r)}}}function N$(n){let e,t,r;return{c(){e=G("label"),e.textContent="Route data unpacking",t=I(),r=G("progress"),j(e,"for","route-unpacking"),j(r,"id","route-unpacking"),j(r,"class","svelte-q3473n")},m(i,o){w(i,e,o),w(i,t,o),w(i,r,o)},p:Z,i:Z,o:Z,d(i){i&&($(e),$(t),$(r))}}}function T$(n){let e,t,r;return{c(){e=G("label"),e.textContent="Route tool loading",t=I(),r=G("progress"),j(e,"for","route-loading"),j(r,"id","route-loading"),r.value=n[0],j(r,"class","svelte-q3473n")},m(i,o){w(i,e,o),w(i,t,o),w(i,r,o)},p(i,o){o&1&&(r.value=i[0])},i:Z,o:Z,d(i){i&&($(e),$(t),$(r))}}}function G$(n){let e,t,r,i;const o=[T$,N$,I$],s=[];function a(l,f){return!l[1]&&!l[2]&&!l[3]?0:l[3]&&!l[1]&&!l[2]?1:l[2]?2:-1}return~(e=a(n))&&(t=s[e]=o[e](n)),{c(){t&&t.c(),r=ve()},m(l,f){~e&&s[e].m(l,f),w(l,r,f),i=!0},p(l,[f]){let c=e;e=a(l),e===c?~e&&s[e].p(l,f):(t&&(fe(),E(s[c],1,1,()=>{s[c]=null}),ue()),~e?(t=s[e],t?t.p(l,f):(t=s[e]=o[e](l),t.c()),S(t,1),t.m(r.parentNode,r)):t=null)},i(l){i||(S(t),i=!0)},o(l){E(t),i=!1},d(l){l&&$(r),~e&&s[e].d(l)}}}function D$(n,e,t){let r,i;X(n,xe,f=>t(5,i=f));let{url:o}=e,s=0,a=!1,l=!1;return Ft(async()=>{await _u(),console.log(`Grabbing ${o}`);try{const f=await yw(o,c=>{t(0,s=c)});Ct.set(new Wg(i,f,Gc,Dc,Os)),t(0,s=100),t(1,a=!0)}catch(f){console.log(`Route tool broke: ${f}`),t(2,l=!0)}}),n.$$set=f=>{"url"in f&&t(4,o=f.url)},n.$$.update=()=>{n.$$.dirty&1&&t(3,r=s>=100)},[s,a,l,r,o]}class j$ extends ee{constructor(e){super(),te(this,e,D$,G$,Q,{url:4})}}function U$(n){let e;return{c(){e=z("Finish")},m(t,r){w(t,e,r)},d(t){t&&$(e)}}}function q$(n){let e;return{c(){e=z("Cancel")},m(t,r){w(t,e,r)},d(t){t&&$(e)}}}function z$(n){let e,t,r,i;return e=new Ot({props:{$$slots:{default:[U$]},$$scope:{ctx:n}}}),e.$on("click",n[1]),r=new ce({props:{$$slots:{default:[q$]},$$scope:{ctx:n}}}),r.$on("click",n[0]),{c(){L(e.$$.fragment),t=I(),L(r.$$.fragment)},m(o,s){A(e,o,s),w(o,t,s),A(r,o,s),i=!0},p(o,s){const a={};s&64&&(a.$$scope={dirty:s,ctx:o}),e.$set(a);const l={};s&64&&(l.$$scope={dirty:s,ctx:o}),r.$set(l)},i(o){i||(S(e.$$.fragment,o),S(r.$$.fragment,o),i=!0)},o(o){E(e.$$.fragment,o),E(r.$$.fragment,o),i=!1},d(o){o&&$(t),C(e,o),C(r,o)}}}function W$(n){let e,t,r,i;return e=new Ut({props:{$$slots:{default:[z$]},$$scope:{ctx:n}}}),r=new Uc({}),{c(){L(e.$$.fragment),t=I(),L(r.$$.fragment)},m(o,s){A(e,o,s),w(o,t,s),A(r,o,s),i=!0},p(o,[s]){const a={};s&64&&(a.$$scope={dirty:s,ctx:o}),e.$set(a)},i(o){i||(S(e.$$.fragment,o),S(r.$$.fragment,o),i=!0)},o(o){E(e.$$.fragment,o),E(r.$$.fragment,o),i=!1},d(o){o&&$(t),C(e,o),C(r,o)}}}function H$(n,e,t){let r;X(n,Ct,f=>t(4,r=f));let{cfg:i}=e,{gjSchemes:o}=e;Ft(()=>{r.startArea(),r.addEventListenerSuccess(s),r.addEventListenerFailure(a)}),et(()=>{r.stop(),r.clearEventListeners()});function s(f){let c=f;o.update(u=>(c.id=gn(u),c.properties.scheme_reference=Ci(u),i.newPolygonFeature(c),u.features.push(c),u)),oe.set({mode:"edit-form",id:c.id})}function a(){oe.set({mode:"list"})}function l(){r.finish()}return n.$$set=f=>{"cfg"in f&&t(2,i=f.cfg),"gjSchemes"in f&&t(3,o=f.gjSchemes)},[a,l,i,o]}class J$ extends ee{constructor(e){super(),te(this,e,H$,W$,Q,{cfg:2,gjSchemes:3})}}function Tf(n){let e,t;return e=new j$({props:{url:n[2]}}),{c(){L(e.$$.fragment)},m(r,i){A(e,r,i),t=!0},p(r,i){const o={};i&4&&(o.url=r[2]),e.$set(o)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){E(e.$$.fragment,r),t=!1},d(r){C(e,r)}}}function Y$(n){let e,t,r,i;return r=new ww({props:{cfg:n[0]}}),{c(){e=G("h2"),e.textContent="StreetView",t=I(),L(r.$$.fragment)},m(o,s){w(o,e,s),w(o,t,s),A(r,o,s),i=!0},p(o,s){const a={};s&1&&(a.cfg=o[0]),r.$set(a)},i(o){i||(S(r.$$.fragment,o),i=!0)},o(o){E(r.$$.fragment,o),i=!1},d(o){o&&($(e),$(t)),C(r,o)}}}function X$(n){let e,t,r,i;return r=new v$({}),{c(){e=G("h2"),e.textContent="Georeference image",t=I(),L(r.$$.fragment)},m(o,s){w(o,e,s),w(o,t,s),A(r,o,s),i=!0},p:Z,i(o){i||(S(r.$$.fragment,o),i=!0)},o(o){E(r.$$.fragment,o),i=!1},d(o){o&&($(e),$(t)),C(r,o)}}}function V$(n){let e,t,r,i,o,s;return r=new Ot({props:{$$slots:{default:[nS]},$$scope:{ctx:n}}}),r.$on("click",n[7]),{c(){e=G("h2"),e.textContent="Split route",t=I(),L(r.$$.fragment),i=I(),o=G("ul"),o.innerHTML=`<li><b>Click</b>
      on a route to split it</li> <li><b>Click</b>
      on the map or press
      <b>Escape</b>
      to cancel</li>`},m(a,l){w(a,e,l),w(a,t,l),A(r,a,l),w(a,i,l),w(a,o,l),s=!0},p(a,l){const f={};l&512&&(f.$$scope={dirty:l,ctx:a}),r.$set(f)},i(a){s||(S(r.$$.fragment,a),s=!0)},o(a){E(r.$$.fragment,a),s=!1},d(a){a&&($(e),$(t),$(i),$(o)),C(r,a)}}}function K$(n){let e,t,r,i;return r=new J$({props:{cfg:n[0],gjSchemes:n[1]}}),{c(){e=G("h2"),e.textContent="New polygon (snapped)",t=I(),L(r.$$.fragment)},m(o,s){w(o,e,s),w(o,t,s),A(r,o,s),i=!0},p(o,s){const a={};s&1&&(a.cfg=o[0]),s&2&&(a.gjSchemes=o[1]),r.$set(a)},i(o){i||(S(r.$$.fragment,o),i=!0)},o(o){E(r.$$.fragment,o),i=!1},d(o){o&&($(e),$(t)),C(r,o)}}}function Z$(n){let e,t,r,i;return r=new L$({props:{cfg:n[0],gjSchemes:n[1]}}),{c(){e=G("h2"),e.textContent="New polygon (freehand)",t=I(),L(r.$$.fragment)},m(o,s){w(o,e,s),w(o,t,s),A(r,o,s),i=!0},p(o,s){const a={};s&1&&(a.cfg=o[0]),s&2&&(a.gjSchemes=o[1]),r.$set(a)},i(o){i||(S(r.$$.fragment,o),i=!0)},o(o){E(r.$$.fragment,o),i=!1},d(o){o&&($(e),$(t)),C(r,o)}}}function Q$(n){let e,t,r,i;return r=new B$({props:{cfg:n[0],gjSchemes:n[1]}}),{c(){e=G("h2"),e.textContent="New route",t=I(),L(r.$$.fragment)},m(o,s){w(o,e,s),w(o,t,s),A(r,o,s),i=!0},p(o,s){const a={};s&1&&(a.cfg=o[0]),s&2&&(a.gjSchemes=o[1]),r.$set(a)},i(o){i||(S(r.$$.fragment,o),i=!0)},o(o){E(r.$$.fragment,o),i=!1},d(o){o&&($(e),$(t)),C(r,o)}}}function x$(n){let e,t,r,i;return r=new $$({props:{cfg:n[0],gjSchemes:n[1]}}),{c(){e=G("h2"),e.textContent="New point",t=I(),L(r.$$.fragment)},m(o,s){w(o,e,s),w(o,t,s),A(r,o,s),i=!0},p(o,s){const a={};s&1&&(a.cfg=o[0]),s&2&&(a.gjSchemes=o[1]),r.$set(a)},i(o){i||(S(r.$$.fragment,o),i=!0)},o(o){E(r.$$.fragment,o),i=!1},d(o){o&&($(e),$(t)),C(r,o)}}}function eS(n){let e,t;return e=new Fb({props:{cfg:n[0],gjSchemes:n[1],id:n[4].id}}),{c(){L(e.$$.fragment)},m(r,i){A(e,r,i),t=!0},p(r,i){const o={};i&1&&(o.cfg=r[0]),i&2&&(o.gjSchemes=r[1]),i&16&&(o.id=r[4].id),e.$set(o)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){E(e.$$.fragment,r),t=!1},d(r){C(e,r)}}}function tS(n){let e,t;return e=new Ww({props:{cfg:n[0],gjSchemes:n[1],id:n[4].id}}),{c(){L(e.$$.fragment)},m(r,i){A(e,r,i),t=!0},p(r,i){const o={};i&1&&(o.cfg=r[0]),i&2&&(o.gjSchemes=r[1]),i&16&&(o.id=r[4].id),e.$set(o)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){E(e.$$.fragment,r),t=!1},d(r){C(e,r)}}}function rS(n){let e,t;return e=new c$({props:{cfg:n[0],gjSchemes:n[1]}}),{c(){L(e.$$.fragment)},m(r,i){A(e,r,i),t=!0},p(r,i){const o={};i&1&&(o.cfg=r[0]),i&2&&(o.gjSchemes=r[1]),e.$set(o)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){E(e.$$.fragment,r),t=!1},d(r){C(e,r)}}}function nS(n){let e;return{c(){e=z("Finish")},m(t,r){w(t,e,r)},d(t){t&&$(e)}}}function iS(n){let e,t,r,i,o,s,a=n[3]&&Tf(n);const l=[rS,tS,eS,x$,Q$,Z$,K$,V$,X$,Y$],f=[];function c(u,h){return u[4].mode=="list"?0:u[4].mode=="edit-form"?1:u[4].mode=="edit-geometry"?2:u[4].mode=="new-point"?3:u[4].mode=="new-route"?4:u[4].mode=="new-freehand-polygon"?5:u[4].mode=="new-snapped-polygon"?6:u[4].mode=="split-route"?7:u[4].mode=="set-image"?8:u[4].mode=="streetview"?9:-1}return~(r=c(n))&&(i=f[r]=l[r](n)),{c(){e=G("div"),a&&a.c(),t=I(),i&&i.c(),o=ve(),de(e,"visibility",n[4].mode=="list"?"visible":"hidden")},m(u,h){w(u,e,h),a&&a.m(e,null),w(u,t,h),~r&&f[r].m(u,h),w(u,o,h),s=!0},p(u,[h]){u[3]?a?(a.p(u,h),h&8&&S(a,1)):(a=Tf(u),a.c(),S(a,1),a.m(e,null)):a&&(fe(),E(a,1,1,()=>{a=null}),ue()),h&16&&de(e,"visibility",u[4].mode=="list"?"visible":"hidden");let p=r;r=c(u),r===p?~r&&f[r].p(u,h):(i&&(fe(),E(f[p],1,1,()=>{f[p]=null}),ue()),~r?(i=f[r],i?i.p(u,h):(i=f[r]=l[r](u),i.c()),S(i,1),i.m(o.parentNode,o)):i=null)},i(u){s||(S(a),S(i),s=!0)},o(u){E(a),E(i),s=!1},d(u){u&&($(e),$(t),$(o)),a&&a.d(),~r&&f[r].d(u)}}}function oS(n,e,t){let r,i,o,s,a;X(n,Ct,h=>t(8,r=h)),X(n,hr,h=>t(5,i=h)),X(n,tn,h=>t(6,o=h)),X(n,xe,h=>t(3,s=h)),X(n,oe,h=>t(4,a=h));let{cfg:l}=e,{gjSchemes:f}=e,{routeSnapperUrl:c}=e;et(()=>{o==null||o.tearDown(),i==null||i.tearDown(),r==null||r.tearDown()});const u=()=>oe.set({mode:"list"});return n.$$set=h=>{"cfg"in h&&t(0,l=h.cfg),"gjSchemes"in h&&t(1,f=h.gjSchemes),"routeSnapperUrl"in h&&t(2,c=h.routeSnapperUrl)},n.$$.update=()=>{n.$$.dirty&72&&s&&!o&&tn.set(new Mh(s)),n.$$.dirty&40&&s&&!i&&hr.set(new ng(s))},[l,f,c,s,a,i,o,u]}class sS extends ee{constructor(e){super(),te(this,e,oS,iS,Q,{cfg:0,gjSchemes:1,routeSnapperUrl:2})}}const aS="/scheme-sketcher/assets/folder-939a38b7.svg";function lS(n){let e,t;return e=new sd({props:{files:n[0],currentFile:n[1],state:n[2],fileSuffix:"geojson",onStart:n[5]}}),{c(){L(e.$$.fragment)},m(r,i){A(e,r,i),t=!0},p(r,i){const o={};i&1&&(o.files=r[0]),i&2&&(o.currentFile=r[1]),i&4&&(o.state=r[2]),i&8&&(o.onStart=r[5]),e.$set(o)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){E(e.$$.fragment,r),t=!1},d(r){C(e,r)}}}function fS(n){let e,t,r;return{c(){e=G("img"),r=z(`
    Manage files`),tt(e.src,t=aS)||j(e,"src",t),j(e,"alt","Manage files"),de(e,"vertical-align","middle")},m(i,o){w(i,e,o),w(i,r,o)},p:Z,d(i){i&&($(e),$(r))}}}function uS(n){let e,t,r,i,o,s,a,l,f,c,u;function h(g){n[6](g)}let p={title:"Files",$$slots:{default:[lS]},$$scope:{ctx:n}};return n[3]!==void 0&&(p.open=n[3]),e=new rp({props:p}),Me.push(()=>Be(e,"open",h)),o=new ce({props:{$$slots:{default:[fS]},$$scope:{ctx:n}}}),o.$on("click",n[7]),{c(){L(e.$$.fragment),r=I(),i=G("div"),L(o.$$.fragment),s=I(),a=G("span"),l=z("Editing file "),f=G("u"),c=z(n[4]),j(a,"class","govuk-body")},m(g,d){A(e,g,d),w(g,r,d),w(g,i,d),A(o,i,null),D(i,s),D(i,a),D(a,l),D(a,f),D(f,c),u=!0},p(g,[d]){const v={};d&271&&(v.$$scope={dirty:d,ctx:g}),!t&&d&8&&(t=!0,v.open=g[3],He(()=>t=!1)),e.$set(v);const _={};d&256&&(_.$$scope={dirty:d,ctx:g}),o.$set(_),(!u||d&16)&&ye(c,g[4])},i(g){u||(S(e.$$.fragment,g),S(o.$$.fragment,g),u=!0)},o(g){E(e.$$.fragment,g),E(o.$$.fragment,g),u=!1},d(g){g&&($(r),$(i)),C(e,g),C(o)}}}function cS(n,e,t){let r,i=Z,o=()=>(i(),i=At(a,p=>t(4,r=p)),a);n.$$.on_destroy.push(()=>i());let{files:s}=e,{currentFile:a}=e;o();let{gjSchemes:l}=e,f=!1;const c=()=>t(3,f=!1);function u(p){f=p,t(3,f)}const h=()=>t(3,f=!0);return n.$$set=p=>{"files"in p&&t(0,s=p.files),"currentFile"in p&&o(t(1,a=p.currentFile)),"gjSchemes"in p&&t(2,l=p.gjSchemes)},[s,a,l,f,r,c,u,h]}class pS extends ee{constructor(e){super(),te(this,e,cS,uS,Q,{files:0,currentFile:1,gjSchemes:2})}}function Gf(n){let e,t,r,i,o,s,a,l,f,c,u,h;return f=new pS({props:{files:n[8],currentFile:n[7],gjSchemes:n[6]}}),{c(){e=G("h2"),e.textContent="NPT Scheme Sketcher",t=I(),r=G("p"),i=z(n[3]),o=z(` (
        `),s=G("a"),s.textContent="Change area",a=z(`
        )`),l=I(),L(f.$$.fragment),c=I(),u=G("hr"),j(s,"href","index.html")},m(p,g){w(p,e,g),w(p,t,g),w(p,r,g),D(r,i),D(r,o),D(r,s),D(r,a),w(p,l,g),A(f,p,g),w(p,c,g),w(p,u,g),h=!0},p:Z,i(p){h||(S(f.$$.fragment,p),h=!0)},o(p){E(f.$$.fragment,p),h=!1},d(p){p&&($(e),$(t),$(r),$(l),$(c),$(u)),C(f,p)}}}function hS(n){let e,t;return e=new Z1({props:{cfg:bt,gjSchemes:n[6]}}),{c(){L(e.$$.fragment)},m(r,i){A(e,r,i),t=!0},p:Z,i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){E(e.$$.fragment,r),t=!1},d(r){C(e,r)}}}function gS(n){let e,t;return e=new Tw({props:{cfg:bt,gjSchemes:n[6]}}),{c(){L(e.$$.fragment)},m(r,i){A(e,r,i),t=!0},p:Z,i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){E(e.$$.fragment,r),t=!1},d(r){C(e,r)}}}function dS(n){let e,t,r,i,o,s,a,l,f,c,u,h,p;e=new J0({props:{cfg:bt,boundaryGeojson:n[0],fitBoundsAtStart:n[4]}}),r=new Qb({props:{cfg:bt,gjSchemes:n[6]}}),o=new Tb({props:{cfg:bt}});const g=[gS,hS],d=[];function v(_,y){return _[1].mode=="list"?0:_[1].mode=="split-route"?1:-1}return~(a=v(n))&&(l=d[a]=g[a](n)),c=new l1({props:{cfg:bt}}),h=new r1({props:{cfg:bt}}),{c(){L(e.$$.fragment),t=I(),L(r.$$.fragment),i=I(),L(o.$$.fragment),s=I(),l&&l.c(),f=I(),L(c.$$.fragment),u=I(),L(h.$$.fragment)},m(_,y){A(e,_,y),w(_,t,y),A(r,_,y),w(_,i,y),A(o,_,y),w(_,s,y),~a&&d[a].m(_,y),w(_,f,y),A(c,_,y),w(_,u,y),A(h,_,y),p=!0},p(_,y){const m={};y&1&&(m.boundaryGeojson=_[0]),e.$set(m);let k=a;a=v(_),a===k?~a&&d[a].p(_,y):(l&&(fe(),E(d[k],1,1,()=>{d[k]=null}),ue()),~a?(l=d[a],l?l.p(_,y):(l=d[a]=g[a](_),l.c()),S(l,1),l.m(f.parentNode,f)):l=null)},i(_){p||(S(e.$$.fragment,_),S(r.$$.fragment,_),S(o.$$.fragment,_),S(l),S(c.$$.fragment,_),S(h.$$.fragment,_),p=!0)},o(_){E(e.$$.fragment,_),E(r.$$.fragment,_),E(o.$$.fragment,_),E(l),E(c.$$.fragment,_),E(h.$$.fragment,_),p=!1},d(_){_&&($(t),$(i),$(s),$(f),$(u)),C(e,_),C(r,_),C(o,_),~a&&d[a].d(_),C(c,_),C(h,_)}}}function mS(n){let e,t,r,i,o,s,a,l,f,c=n[1].mode=="list"&&Gf(n);i=new sS({props:{cfg:bt,gjSchemes:n[6],routeSnapperUrl:n[5]}});function u(p){n[9](p)}let h={style:"https://api.maptiler.com/maps/uk-openzoomstack-light/style.json?key="+bt.maptilerApiKey,standardControls:!0,hash:!0,$$slots:{default:[dS]},$$scope:{ctx:n}};return n[2]!==void 0&&(h.map=n[2]),a=new Sp({props:h}),Me.push(()=>Be(a,"map",u)),a.$on("error",n[10]),{c(){e=G("div"),t=G("div"),c&&c.c(),r=I(),L(i.$$.fragment),o=I(),s=G("div"),L(a.$$.fragment),j(t,"class","sidebar svelte-1j3l30i"),j(s,"class","map svelte-1j3l30i"),de(e,"display","flex"),de(e,"height","100vh")},m(p,g){w(p,e,g),D(e,t),c&&c.m(t,null),D(t,r),A(i,t,null),D(e,o),D(e,s),A(a,s,null),f=!0},p(p,[g]){p[1].mode=="list"?c?(c.p(p,g),g&2&&S(c,1)):(c=Gf(p),c.c(),S(c,1),c.m(t,r)):c&&(fe(),E(c,1,1,()=>{c=null}),ue());const d={};g&8195&&(d.$$scope={dirty:g,ctx:p}),!l&&g&4&&(l=!0,d.map=p[2],He(()=>l=!1)),a.$set(d)},i(p){f||(S(c),S(i.$$.fragment,p),S(a.$$.fragment,p),f=!0)},o(p){E(c),E(i.$$.fragment,p),E(a.$$.fragment,p),f=!1},d(p){p&&$(e),c&&c.d(),C(i),C(a)}}}function Df(n,e){return n.startsWith(e)?n.slice(e.length):n}function yS(n,e,t){let r,i;X(n,oe,v=>t(1,r=v)),X(n,xe,v=>t(2,i=v));let o=new URLSearchParams(window.location.search),s=o.get("boundary"),a=!window.location.hash,l={type:"FeatureCollection",features:[]};Ft(async()=>{Mp();let _=await(await fetch(Pp)).json();_.features=_.features.filter(y=>y.properties.LAD23NM==Df(s,"LAD_")),_.features.length===0&&(window.location.href=`index.html?error=Boundary name not found: ${s}`),t(0,l=_)});let f=`https://atip.uk/npt_tmp/${Df(s,"LAD_")}.bin.gz`,c=mt(p()),u=mt(""),h=new ad({prefix:`npt_ss/${s}/`,initiallyLoadFile:o.get("file"),emptyState:p,validate:kp,describe:Ep,state:c,currentFile:u});function p(){let v=Vf(bt);return v.boundary=s,v}function g(v){i=v,xe.set(i)}return[l,r,i,s,a,f,c,u,h,g,v=>{console.log(v.detail.error)}]}class vS extends ee{constructor(e){super(),te(this,e,yS,mS,Q,{})}}document.body.className+=" js-enabled"+("noModule"in HTMLScriptElement.prototype?" govuk-frontend-supported":"");new vS({target:document.getElementById("app")});
